!function(){var s=s||[];function t(){Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var s in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+s+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[s]:("00"+t[s]).substr((""+t[s]).length)));return e};var e=function(e){var r=e;return chrome.runtime.onMessage.addListener(function(e,t,s){switch(e.cmd){case"popup_init":case"popup_reload":console.log(e.result),r.refresh(e.result.data),e.result.recognize_status&&r.start();break;case"popup_parse_result":r.show_new_result(e.result.data);break;case"popup_error":case"popup_update_version":console.log(e.result),r.show_message(e.result.msg,-1);break;case"popup_login":r.show_message('Please <a url="chrome://chrome-signin/" href="#"> login with your google account</a>',-1)}"popup_init"!=e.cmd&&r.stop(),r.refresh()}),{init:function(){chrome.runtime.sendMessage({cmd:"background_init"})},reload:function(){chrome.runtime.sendMessage({cmd:"background_reload"})},start:function(){this.cancel(),chrome.runtime.sendMessage({cmd:"background_start"}),r.start()},cancel:function(){r.reset(),chrome.runtime.sendMessage({cmd:"background_cancel"})},clear_history:function(){chrome.runtime.sendMessage({cmd:"background_clear_history"})}}}(function(){Handlebars.registerHelper("if_even",function(e,t){return(e+1)%2==0?t.fn(this):t.inverse(this)}),Handlebars.registerHelper("format_date",function(e,t){var s=new Date;return s.setTime(parseInt(e)),s.format("yyyy/MM/dd hh:mm:ss")});var e=$("#music_info_template").html(),r=Handlebars.compile(e);return{start:function(){$("#search_bar_start").hide(),$("#search_bar_running").show()},stop:function(){$("#search_bar_start").show(),$("#search_bar_running").hide()},show_message:function(e,t){var s="success";-1==t&&(s="error"),$("#search_result").hide(),$("#search_result").html("<div class='"+s+"'>"+e+"</div>"),$("#search_result").slideDown("slow")},refresh:function(e){if(void 0!==e){$("#history_music_info").html("");var t=r({music_infos:e});$("#history_music_info").html(t),$("#history_music_info").slideDown("slow")}$("a").each(function(){var t=$(this).attr("url"),e=$(this).attr("is_set_click");t&&!e&&($(this).attr("is_set_click","true"),$(this).click(function(){var e=$(this).attr("name");s.push(["_trackEvent",e,"clicked"]),chrome.tabs.create({url:t})}))})},reset:function(){$("#search_result").fadeOut(),$("#search_result").html("")},show_new_result:function(e){var t=r({music_infos:[e]}),s=$(t).addClass("success");$("#search_result").append(s),$("#search_result").slideDown("slow")},clear_history:function(){$("#search_result").html("")}}}());$("#search_bar_start").click(function(){s.push(["_trackEvent","search_bar_start","clicked"]),e.start()}),$("#recycle").click(function(){s.push(["_trackEvent","recycle","clicked"]),e.clear_history()}),e.init(),e.start(),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://ssl.google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()}s.push(["_setAccount","UA-101242276-1"]),s.push(["_trackPageview"]),$(window).load(function(){var e=(new Date).getFullYear();$("#copyright_year").html(e),setTimeout(t,800)})}();