(function(){var _gliffy={};_gliffy.renderers={};_gliffy.stages={};_gliffy.Debug={SKIP_CATCH_ERRORS:false,SKIP_RENDER_LOOP:false,DISPLAY_GUIDES:false,NO_CONTEXT_MENU:false,NO_ERROR_DIALOG:false,FINITE_NUMBER_CHECKS:false,NO_TIPS:false,NO_NAVIGATE_WARNING:false,STARTUP_FILE:null,LOG_TO_CONSOLE:false,LOG_ANALYTICS:false,USE_ANALYTICS_DEBUG_JS:false,I18N_UNDERSCORES:false,SHOW_RTREE:false};_gliffy.FEATURES={};_gliffy.versionString="unavailable";_gliffy.confluenceVersion="unavailable";_gliffy.workQueue=$({});_gliffy.textDimensionMap={width:{},height:{}};_gliffy.textDimensionMapSize={width:0,height:0};_gliffy.MIN_OPACITY=0.008;_gliffy.MIN_VISIBLE_VALUE=2;_gliffy.clipboard=null;_gliffy.camelMap={};_gliffy.camelSize=0;$.camelCase=function(string){var getCamel=function(string){return string.replace(/^-ms-/,"ms-").replace(/-([a-z]|[0-9])/ig,function(all,letter){return(letter+"").toUpperCase()})};if(_gliffy.camelMap[string]===undefined){_gliffy.camelMap[string]=getCamel(string);if(++_gliffy.camelSize>1000){_gliffy.camelSize=0;_gliffy.camelMap={}}}return _gliffy.camelMap[string]};
/*!! Simple JavaScript Inheritance
 * By John Resig http://ejohn.org/
 * MIT Licensed.
 * http://ejohn.org/blog/simple-javascript-inheritance
 *
 */
(function(){var initializing=false,fnTest=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;var Class=function(){};Class.extend=function(prop){var _super=this.prototype;initializing=true;var prototype=new this();initializing=false;for(var name in prop){prototype[name]=typeof prop[name]=="function"&&typeof _super[name]=="function"&&fnTest.test(prop[name])?(function(name,fn){return function(){var tmp=this._super;this._super=_super[name];var ret=fn.apply(this,arguments);this._super=tmp;return ret}})(name,prop[name]):prop[name]}function Class(){if(!(this instanceof Class)){return new Class(arguments)}if(!initializing&&this.init){this.init.apply(this,arguments)}}Class.prototype=prototype;Class.prototype.constructor=Class;Class.extend=arguments.callee;return Class};_gliffy.Class=Class})();var RTree=function(width){var _Min_Width=3;var _Max_Width=6;if(!isNaN(width)){_Min_Width=Math.floor(width/2);_Max_Width=width}var _T={x:0,y:0,w:0,h:0,id:"root",nodes:[]};var isArray=function(o){return Object.prototype.toString.call(o)==="[object Array]"};var _name_to_id=(function(){var idCache={};return function(idPrefix){var idVal=0;if(idPrefix in idCache){idVal=idCache[idPrefix]++}else{idCache[idPrefix]=0}return idPrefix+"_"+idVal}})();RTree.Rectangle.squarified_ratio=function(l,w,fill){var lperi=(l+w)/2;var larea=l*w;var lgeo=larea/(lperi*lperi);return(larea*fill/lgeo)};var _remove_subtree=function(rect,obj,root){var hit_stack=[];var count_stack=[];var ret_array=[];var current_depth=1;if(!rect||!RTree.Rectangle.overlap_rectangle(rect,root)){return ret_array}var ret_obj={x:rect.x,y:rect.y,w:rect.w,h:rect.h,target:obj};count_stack.push(root.nodes.length);hit_stack.push(root);do{var tree=hit_stack.pop();var i=count_stack.pop()-1;if("target" in ret_obj){while(i>=0){var ltree=tree.nodes[i];if(RTree.Rectangle.overlap_rectangle(ret_obj,ltree)){if((ret_obj.target&&"leaf" in ltree&&ltree.leaf===ret_obj.target)||(!ret_obj.target&&("leaf" in ltree||RTree.Rectangle.contains_rectangle(ltree,ret_obj)))){if("nodes" in ltree){ret_array=_search_subtree(ltree,true,[],ltree);tree.nodes.splice(i,1)}else{ret_array=tree.nodes.splice(i,1)}RTree.Rectangle.make_MBR(tree.nodes,tree);delete ret_obj.target;if(tree.nodes.length<_Min_Width){ret_obj.nodes=_search_subtree(tree,true,[],tree)}break}else{if("nodes" in ltree){current_depth+=1;count_stack.push(i);hit_stack.push(tree);tree=ltree;i=ltree.nodes.length}}}i-=1}}else{if("nodes" in ret_obj){tree.nodes.splice(i+1,1);if(tree.nodes.length>0){RTree.Rectangle.make_MBR(tree.nodes,tree)}for(var t=0;t<ret_obj.nodes.length;t++){_insert_subtree(ret_obj.nodes[t],tree)}ret_obj.nodes.length=0;if(hit_stack.length==0&&tree.nodes.length<=1){ret_obj.nodes=_search_subtree(tree,true,ret_obj.nodes,tree);tree.nodes.length=0;hit_stack.push(tree);count_stack.push(1)}else{if(hit_stack.length>0&&tree.nodes.length<_Min_Width){ret_obj.nodes=_search_subtree(tree,true,ret_obj.nodes,tree);tree.nodes.length=0}else{delete ret_obj.nodes}}}else{RTree.Rectangle.make_MBR(tree.nodes,tree)}}current_depth-=1}while(hit_stack.length>0);return(ret_array)};var _choose_leaf_subtree=function(rect,root){var best_choice_index=-1;var best_choice_stack=[];var best_choice_area;var load_callback=function(local_tree,local_node){return(function(data){local_tree._attach_data(local_node,data)})};best_choice_stack.push(root);var nodes=root.nodes;do{if(best_choice_index!=-1){best_choice_stack.push(nodes[best_choice_index]);nodes=nodes[best_choice_index].nodes;best_choice_index=-1}for(var i=nodes.length-1;i>=0;i--){var ltree=nodes[i];if("leaf" in ltree){best_choice_index=-1;break}var old_lratio=RTree.Rectangle.squarified_ratio(ltree.w,ltree.h,ltree.nodes.length+1);var nw=Math.max(ltree.x+ltree.w,rect.x+rect.w)-Math.min(ltree.x,rect.x);var nh=Math.max(ltree.y+ltree.h,rect.y+rect.h)-Math.min(ltree.y,rect.y);var lratio=RTree.Rectangle.squarified_ratio(nw,nh,ltree.nodes.length+2);if(best_choice_index<0||Math.abs(lratio-old_lratio)<best_choice_area){best_choice_area=Math.abs(lratio-old_lratio);best_choice_index=i}}}while(best_choice_index!=-1);return(best_choice_stack)};var _linear_split=function(nodes){var n=_pick_linear(nodes);while(nodes.length>0){_pick_next(nodes,n[0],n[1])}return(n)};var _pick_next=function(nodes,a,b){var area_a=RTree.Rectangle.squarified_ratio(a.w,a.h,a.nodes.length+1);var area_b=RTree.Rectangle.squarified_ratio(b.w,b.h,b.nodes.length+1);var high_area_delta;var high_area_node;var lowest_growth_group;for(var i=nodes.length-1;i>=0;i--){var l=nodes[i];var new_area_a={};new_area_a.x=Math.min(a.x,l.x);new_area_a.y=Math.min(a.y,l.y);new_area_a.w=Math.max(a.x+a.w,l.x+l.w)-new_area_a.x;new_area_a.h=Math.max(a.y+a.h,l.y+l.h)-new_area_a.y;var change_new_area_a=Math.abs(RTree.Rectangle.squarified_ratio(new_area_a.w,new_area_a.h,a.nodes.length+2)-area_a);var new_area_b={};new_area_b.x=Math.min(b.x,l.x);new_area_b.y=Math.min(b.y,l.y);new_area_b.w=Math.max(b.x+b.w,l.x+l.w)-new_area_b.x;new_area_b.h=Math.max(b.y+b.h,l.y+l.h)-new_area_b.y;var change_new_area_b=Math.abs(RTree.Rectangle.squarified_ratio(new_area_b.w,new_area_b.h,b.nodes.length+2)-area_b);if(!high_area_node||!high_area_delta||Math.abs(change_new_area_b-change_new_area_a)<high_area_delta){high_area_node=i;high_area_delta=Math.abs(change_new_area_b-change_new_area_a);lowest_growth_group=change_new_area_b<change_new_area_a?b:a}}var temp_node=nodes.splice(high_area_node,1)[0];if(a.nodes.length+nodes.length+1<=_Min_Width){a.nodes.push(temp_node);RTree.Rectangle.expand_rectangle(a,temp_node)}else{if(b.nodes.length+nodes.length+1<=_Min_Width){b.nodes.push(temp_node);RTree.Rectangle.expand_rectangle(b,temp_node)}else{lowest_growth_group.nodes.push(temp_node);RTree.Rectangle.expand_rectangle(lowest_growth_group,temp_node)}}};var _pick_linear=function(nodes){var lowest_high_x=nodes.length-1;var highest_low_x=0;var lowest_high_y=nodes.length-1;var highest_low_y=0;var t1,t2;for(var i=nodes.length-2;i>=0;i--){var l=nodes[i];if(l.x>nodes[highest_low_x].x){highest_low_x=i}else{if(l.x+l.w<nodes[lowest_high_x].x+nodes[lowest_high_x].w){lowest_high_x=i}}if(l.y>nodes[highest_low_y].y){highest_low_y=i}else{if(l.y+l.h<nodes[lowest_high_y].y+nodes[lowest_high_y].h){lowest_high_y=i}}}var dx=Math.abs((nodes[lowest_high_x].x+nodes[lowest_high_x].w)-nodes[highest_low_x].x);var dy=Math.abs((nodes[lowest_high_y].y+nodes[lowest_high_y].h)-nodes[highest_low_y].y);if(dx>dy){if(lowest_high_x>highest_low_x){t1=nodes.splice(lowest_high_x,1)[0];t2=nodes.splice(highest_low_x,1)[0]}else{t2=nodes.splice(highest_low_x,1)[0];t1=nodes.splice(lowest_high_x,1)[0]}}else{if(lowest_high_y>highest_low_y){t1=nodes.splice(lowest_high_y,1)[0];t2=nodes.splice(highest_low_y,1)[0]}else{t2=nodes.splice(highest_low_y,1)[0];t1=nodes.splice(lowest_high_y,1)[0]}}return([{x:t1.x,y:t1.y,w:t1.w,h:t1.h,nodes:[t1]},{x:t2.x,y:t2.y,w:t2.w,h:t2.h,nodes:[t2]}])};var _attach_data=function(node,more_tree){node.nodes=more_tree.nodes;node.x=more_tree.x;node.y=more_tree.y;node.w=more_tree.w;node.h=more_tree.h;return(node)};var _search_subtree=function(rect,return_node,return_array,root){var hit_stack=[];if(!RTree.Rectangle.overlap_rectangle(rect,root)){return(return_array)}var load_callback=function(local_tree,local_node){return(function(data){local_tree._attach_data(local_node,data)})};hit_stack.push(root.nodes);do{var nodes=hit_stack.pop();for(var i=nodes.length-1;i>=0;i--){var ltree=nodes[i];if(RTree.Rectangle.overlap_rectangle(rect,ltree)){if("nodes" in ltree){hit_stack.push(ltree.nodes)}else{if("leaf" in ltree){if(!return_node){return_array.push(ltree.leaf)}else{return_array.push(ltree)}}}}}}while(hit_stack.length>0);return(return_array)};var _insert_subtree=function(node,root){var bc;if(root.nodes.length==0){root.x=node.x;root.y=node.y;root.w=node.w;root.h=node.h;root.nodes.push(node);return}var tree_stack=_choose_leaf_subtree(node,root);var ret_obj=node;do{if(bc&&"nodes" in bc&&bc.nodes.length==0){var pbc=bc;bc=tree_stack.pop();for(var t=0;t<bc.nodes.length;t++){if(bc.nodes[t]===pbc||bc.nodes[t].nodes.length==0){bc.nodes.splice(t,1);break}}}else{bc=tree_stack.pop()}if("leaf" in ret_obj||"nodes" in ret_obj||isArray(ret_obj)){if(isArray(ret_obj)){for(var ai=0;ai<ret_obj.length;ai++){RTree.Rectangle.expand_rectangle(bc,ret_obj[ai])}bc.nodes=bc.nodes.concat(ret_obj)}else{RTree.Rectangle.expand_rectangle(bc,ret_obj);bc.nodes.push(ret_obj)}if(bc.nodes.length<=_Max_Width){ret_obj={x:bc.x,y:bc.y,w:bc.w,h:bc.h}}else{var a=_linear_split(bc.nodes);ret_obj=a;if(tree_stack.length<1){bc.nodes.push(a[0]);tree_stack.push(bc);ret_obj=a[1]}}}else{RTree.Rectangle.expand_rectangle(bc,ret_obj);ret_obj={x:bc.x,y:bc.y,w:bc.w,h:bc.h}}}while(tree_stack.length>0)};this.get_tree=function(){return _T};this.set_tree=function(new_tree,where){if(!where){where=_T}return(_attach_data(where,new_tree))};this.search=function(rect,return_node,return_array){if(arguments.length<1){throw"Wrong number of arguments. RT.Search requires at least a bounding rectangle."}switch(arguments.length){case 1:arguments[1]=false;case 2:arguments[2]=[];case 3:arguments[3]=_T;default:arguments.length=4}return(_search_subtree.apply(this,arguments))};this.toJSON=function(rect,tree){var hit_stack=[];var count_stack=[];var return_stack={};var max_depth=3;var current_depth=1;var return_string="";if(rect&&!RTree.Rectangle.overlap_rectangle(rect,_T)){return""}if(!tree){count_stack.push(_T.nodes.length);hit_stack.push(_T.nodes);return_string+="var main_tree = {x:"+_T.x.toFixed()+",y:"+_T.y.toFixed()+",w:"+_T.w.toFixed()+",h:"+_T.h.toFixed()+",nodes:["}else{max_depth+=4;count_stack.push(tree.nodes.length);hit_stack.push(tree.nodes);return_string+="var main_tree = {x:"+tree.x.toFixed()+",y:"+tree.y.toFixed()+",w:"+tree.w.toFixed()+",h:"+tree.h.toFixed()+",nodes:["}do{var nodes=hit_stack.pop();var i=count_stack.pop()-1;if(i>=0&&i<nodes.length-1){return_string+=","}while(i>=0){var ltree=nodes[i];if(!rect||RTree.Rectangle.overlap_rectangle(rect,ltree)){if(ltree.nodes){if(current_depth>=max_depth){var len=return_stack.length;var nam=_name_to_id("saved_subtree");return_string+="{x:"+ltree.x.toFixed()+",y:"+ltree.y.toFixed()+",w:"+ltree.w.toFixed()+",h:"+ltree.h.toFixed()+",load:'"+nam+".js'}";return_stack[nam]=this.toJSON(rect,ltree);if(i>0){return_string+=","}}else{return_string+="{x:"+ltree.x.toFixed()+",y:"+ltree.y.toFixed()+",w:"+ltree.w.toFixed()+",h:"+ltree.h.toFixed()+",nodes:[";current_depth+=1;count_stack.push(i);hit_stack.push(nodes);nodes=ltree.nodes;i=ltree.nodes.length}}else{if(ltree.leaf){var data=ltree.leaf.toJSON?ltree.leaf.toJSON():JSON.stringify(ltree.leaf);return_string+="{x:"+ltree.x.toFixed()+",y:"+ltree.y.toFixed()+",w:"+ltree.w.toFixed()+",h:"+ltree.h.toFixed()+",leaf:"+data+"}";if(i>0){return_string+=","}}else{if(ltree.load){return_string+="{x:"+ltree.x.toFixed()+",y:"+ltree.y.toFixed()+",w:"+ltree.w.toFixed()+",h:"+ltree.h.toFixed()+",load:'"+ltree.load+"'}";if(i>0){return_string+=","}}}}}i-=1}if(i<0){return_string+="]}";current_depth-=1}}while(hit_stack.length>0);return_string+=";";for(var my_key in return_stack){return_string+="\nvar "+my_key+" = function(){"+return_stack[my_key]+" return(main_tree);};"}return(return_string)};this.remove=function(rect,obj){if(arguments.length<1){throw"Wrong number of arguments. RT.remove requires at least a bounding rectangle."}switch(arguments.length){case 1:arguments[1]=false;case 2:arguments[2]=_T;default:arguments.length=3}if(arguments[1]===false){var numberdeleted=0;var ret_array=[];do{numberdeleted=ret_array.length;ret_array=ret_array.concat(_remove_subtree.apply(this,arguments))}while(numberdeleted!=ret_array.length);return ret_array}else{return(_remove_subtree.apply(this,arguments))}};this.insert=function(rect,obj){if(arguments.length<2){throw"Wrong number of arguments. RT.Insert requires at least a bounding rectangle and an object."}return(_insert_subtree({x:rect.x,y:rect.y,w:rect.w,h:rect.h,leaf:obj},_T))}};RTree.Rectangle=function(ix,iy,iw,ih){var x,x2,y,y2,w,h;if(ix.x){x=ix.x;y=ix.y;if(ix.w!==0&&!ix.w&&ix.x2){w=ix.x2-ix.x;h=ix.y2-ix.y}else{w=ix.w;h=ix.h}x2=x+w;y2=y+h}else{x=ix;y=iy;w=iw;h=ih;x2=x+w;y2=y+h}this.x1=this.x=function(){return x};this.y1=this.y=function(){return y};this.x2=function(){return x2};this.y2=function(){return y2};this.w=function(){return w};this.h=function(){return h};this.toJSON=function(){return('{"x":'+x.toString()+', "y":'+y.toString()+', "w":'+w.toString()+', "h":'+h.toString()+"}")};this.overlap=function(a){return(this.x()<a.x2()&&this.x2()>a.x()&&this.y()<a.y2()&&this.y2()>a.y())};this.expand=function(a){var nx=Math.min(this.x(),a.x());var ny=Math.min(this.y(),a.y());w=Math.max(this.x2(),a.x2())-nx;h=Math.max(this.y2(),a.y2())-ny;x=nx;y=ny;return(this)};this.setRect=function(ix,iy,iw,ih){var x,x2,y,y2,w,h;if(ix.x){x=ix.x;y=ix.y;if(ix.w!==0&&!ix.w&&ix.x2){w=ix.x2-ix.x;h=ix.y2-ix.y}else{w=ix.w;h=ix.h}x2=x+w;y2=y+h}else{x=ix;y=iy;w=iw;h=ih;x2=x+w;y2=y+h}}};RTree.Rectangle.overlap_rectangle=function(a,b){return(a.x<(b.x+b.w)&&(a.x+a.w)>b.x&&a.y<(b.y+b.h)&&(a.y+a.h)>b.y)};RTree.Rectangle.contains_rectangle=function(a,b){return((a.x+a.w)<=(b.x+b.w)&&a.x>=b.x&&(a.y+a.h)<=(b.y+b.h)&&a.y>=b.y)};RTree.Rectangle.expand_rectangle=function(a,b){var nx=Math.min(a.x,b.x);var ny=Math.min(a.y,b.y);a.w=Math.max(a.x+a.w,b.x+b.w)-nx;a.h=Math.max(a.y+a.h,b.y+b.h)-ny;a.x=nx;a.y=ny;return(a)};RTree.Rectangle.make_MBR=function(nodes,rect){if(nodes.length<1){return({x:0,y:0,w:0,h:0})}if(!rect){rect={x:nodes[0].x,y:nodes[0].y,w:nodes[0].w,h:nodes[0].h}}else{rect.x=nodes[0].x}rect.y=nodes[0].y;rect.w=nodes[0].w;rect.h=nodes[0].h;for(var i=nodes.length-1;i>0;i--){RTree.Rectangle.expand_rectangle(rect,nodes[i])}return(rect)};_gliffy.RTree=RTree;!function(a){a(function(){"use strict",a.support.transition=function(){var b=document.body||document.documentElement,c=b.style,d=c.transition!==undefined||c.WebkitTransition!==undefined||c.MozTransition!==undefined||c.MsTransition!==undefined||c.OTransition!==undefined;return d&&{end:function(){var b="TransitionEnd";return a.browser.webkit?b="webkitTransitionEnd":a.browser.mozilla?b="transitionend":a.browser.opera&&(b="oTransitionEnd"),b}()}}()})}(window.jQuery),!function(a){var b='[data-dismiss="alert"]',c=function(c){a(c).on("click",b,this.close)};c.prototype={constructor:c,close:function(b){function f(){e.trigger("closed").remove()}var c=a(this),d=c.attr("data-target"),e;d||(d=c.attr("href"),d=d&&d.replace(/.*(?=#[^\s]*$)/,"")),e=a(d),e.trigger("close"),b&&b.preventDefault(),e.length||(e=c.hasClass("alert")?c:c.parent()),e.trigger("close").removeClass("in"),a.support.transition&&e.hasClass("fade")?e.on(a.support.transition.end,f):f()}},a.fn.alert=function(b){return this.each(function(){var d=a(this),e=d.data("alert");e||d.data("alert",e=new c(this)),typeof b=="string"&&e[b].call(d)})},a.fn.alert.Constructor=c,a(function(){a("body").on("click.alert.data-api",b,c.prototype.close)})}(window.jQuery),!function(a){var b=function(b,c){this.$element=a(b),this.options=a.extend({},a.fn.button.defaults,c)};b.prototype={constructor:b,setState:function(a){var b="disabled",c=this.$element,d=c.data(),e=c.is("input")?"val":"html";a+="Text",d.resetText||c.data("resetText",c[e]()),c[e](d[a]||this.options[a]),setTimeout(function(){a=="loadingText"?c.addClass(b).attr(b,b):c.removeClass(b).removeAttr(b)},0)},toggle:function(){var a=this.$element.parent('[data-toggle="buttons-radio"]');a&&a.find(".active").removeClass("active"),this.$element.toggleClass("active")}},a.fn.button=function(c){return this.each(function(){var d=a(this),e=d.data("button"),f=typeof c=="object"&&c;e||d.data("button",e=new b(this,f)),c=="toggle"?e.toggle():c&&e.setState(c)})},a.fn.button.defaults={loadingText:"loading..."},a.fn.button.Constructor=b,a(function(){a("body").on("click.button.data-api","[data-toggle^=button]",function(b){var c=a(b.target);c.hasClass("btn")||(c=c.closest(".btn")),c.button("toggle")})})}(window.jQuery),!function(a){var b=function(b,c){this.$element=a(b),this.options=a.extend({},a.fn.carousel.defaults,c),this.options.slide&&this.slide(this.options.slide),this.options.pause=="hover"&&this.$element.on("mouseenter",a.proxy(this.pause,this)).on("mouseleave",a.proxy(this.cycle,this))};b.prototype={cycle:function(){return this.interval=setInterval(a.proxy(this.next,this),this.options.interval),this},to:function(b){var c=this.$element.find(".active"),d=c.parent().children(),e=d.index(c),f=this;if(b>d.length-1||b<0){return}return this.sliding?this.$element.one("slid",function(){f.to(b)}):e==b?this.pause().cycle():this.slide(b>e?"next":"prev",a(d[b]))},pause:function(){return clearInterval(this.interval),this.interval=null,this},next:function(){if(this.sliding){return}return this.slide("next")},prev:function(){if(this.sliding){return}return this.slide("prev")},slide:function(b,c){var d=this.$element.find(".active"),e=c||d[b](),f=this.interval,g=b=="next"?"left":"right",h=b=="next"?"first":"last",i=this;this.sliding=!0,f&&this.pause(),e=e.length?e:this.$element.find(".item")[h]();if(e.hasClass("active")){return}return !a.support.transition&&this.$element.hasClass("slide")?(this.$element.trigger("slide"),d.removeClass("active"),e.addClass("active"),this.sliding=!1,this.$element.trigger("slid")):(e.addClass(b),e[0].offsetWidth,d.addClass(g),e.addClass(g),this.$element.trigger("slide"),this.$element.one(a.support.transition.end,function(){e.removeClass([b,g].join(" ")).addClass("active"),d.removeClass(["active",g].join(" ")),i.sliding=!1,setTimeout(function(){i.$element.trigger("slid")},0)})),f&&this.cycle(),this}},a.fn.carousel=function(c){return this.each(function(){var d=a(this),e=d.data("carousel"),f=typeof c=="object"&&c;e||d.data("carousel",e=new b(this,f)),typeof c=="number"?e.to(c):typeof c=="string"||(c=f.slide)?e[c]():e.cycle()})},a.fn.carousel.defaults={interval:5000,pause:"hover"},a.fn.carousel.Constructor=b,a(function(){a("body").on("click.carousel.data-api","[data-slide]",function(b){var c=a(this),d,e=a(c.attr("data-target")||(d=c.attr("href"))&&d.replace(/.*(?=#[^\s]+$)/,"")),f=!e.data("modal")&&a.extend({},e.data(),c.data());e.carousel(f),b.preventDefault()})})}(window.jQuery),!function(a){var b=function(b,c){this.$element=a(b),this.options=a.extend({},a.fn.collapse.defaults,c),this.options.parent&&(this.$parent=a(this.options.parent)),this.options.toggle&&this.toggle()};b.prototype={constructor:b,dimension:function(){var a=this.$element.hasClass("width");return a?"width":"height"},show:function(){var b=this.dimension(),c=a.camelCase(["scroll",b].join("-")),d=this.$parent&&this.$parent.find(".in"),e;d&&d.length&&(e=d.data("collapse"),d.collapse("hide"),e||d.data("collapse",null)),this.$element[b](0),this.transition("addClass","show","shown"),this.$element[b](this.$element[0][c])},hide:function(){var a=this.dimension();this.reset(this.$element[a]()),this.transition("removeClass","hide","hidden"),this.$element[a](0)},reset:function(a){var b=this.dimension();return this.$element.removeClass("collapse")[b](a||"auto")[0].offsetWidth,this.$element[a?"addClass":"removeClass"]("collapse"),this},transition:function(b,c,d){var e=this,f=function(){c=="show"&&e.reset(),e.$element.trigger(d)};this.$element.trigger(c)[b]("in"),a.support.transition&&this.$element.hasClass("collapse")?this.$element.one(a.support.transition.end,f):f()},toggle:function(){this[this.$element.hasClass("in")?"hide":"show"]()}},a.fn.collapse=function(c){return this.each(function(){var d=a(this),e=d.data("collapse"),f=typeof c=="object"&&c;e||d.data("collapse",e=new b(this,f)),typeof c=="string"&&e[c]()})},a.fn.collapse.defaults={toggle:!0},a.fn.collapse.Constructor=b,a(function(){a("body").on("click.collapse.data-api","[data-toggle=collapse]",function(b){var c=a(this),d,e=c.attr("data-target")||b.preventDefault()||(d=c.attr("href"))&&d.replace(/.*(?=#[^\s]+$)/,""),f=a(e).data("collapse")?"toggle":c.data();a(e).collapse(f)})})}(window.jQuery),!function(a){function d(){a(b).parent().removeClass("open")}"use strict";var b='[data-toggle="dropdown"]',c=function(b){var c=a(b).on("click.dropdown.data-api",this.toggle);a("html").on("click.dropdown.data-api",function(){c.parent().removeClass("open")})};c.prototype={constructor:c,toggle:function(b){var c=a(this),e=c.attr("data-target"),f,g;return e||(e=c.attr("href"),e=e&&e.replace(/.*(?=#[^\s]*$)/,"")),f=a(e),f.length||(f=c.parent()),g=f.hasClass("open"),d(),!g&&f.toggleClass("open"),!1}},a.fn.dropdown=function(b){return this.each(function(){var d=a(this),e=d.data("dropdown");e||d.data("dropdown",e=new c(this)),typeof b=="string"&&e[b].call(d)})},a.fn.dropdown.Constructor=c,a(function(){a("html").on("click.dropdown.data-api",d),a("body").on("click.dropdown.data-api",b,c.prototype.toggle)})}(window.jQuery),!function(a){function c(){var b=this,c=setTimeout(function(){b.$element.off(a.support.transition.end),d.call(b)},500);this.$element.one(a.support.transition.end,function(){clearTimeout(c),d.call(b)})}function d(a){this.$element.hide().trigger("hidden"),e.call(this)}function e(b){var c=this,d=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var e=a.support.transition&&d;this.$backdrop=a('<div class="modal-backdrop '+d+'" />').appendTo(document.body),this.options.backdrop!="static"&&this.$backdrop.click(a.proxy(this.hide,this)),e&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),e?this.$backdrop.one(a.support.transition.end,b):b()}else{!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),a.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(a.support.transition.end,a.proxy(f,this)):f.call(this)):b&&b()}}function f(){this.$backdrop.remove(),this.$backdrop=null}function g(){var b=this;this.isShown&&this.options.keyboard?a(document).on("keyup.dismiss.modal",function(a){a.which==27&&b.hide()}):this.isShown||a(document).off("keyup.dismiss.modal")}"use strict";var b=function(b,c){this.options=c,this.$element=a(b).delegate('[data-dismiss="modal"]',"click.dismiss.modal",a.proxy(this.hide,this))};b.prototype={constructor:b,toggle:function(){return this[this.isShown?"hide":"show"]()},show:function(){var b=this;if(this.isShown){return}a("body").addClass("modal-open"),this.isShown=!0,this.$element.trigger("show"),g.call(this),e.call(this,function(){var c=a.support.transition&&b.$element.hasClass("fade");!b.$element.parent().length&&b.$element.appendTo(document.body),b.$element.show(),c&&b.$element[0].offsetWidth,b.$element.addClass("in"),c?b.$element.one(a.support.transition.end,function(){b.$element.trigger("shown")}):b.$element.trigger("shown")})},hide:function(b){b&&b.preventDefault();if(!this.isShown){return}var e=this;this.isShown=!1,a("body").removeClass("modal-open"),g.call(this),this.$element.trigger("hide").removeClass("in"),a.support.transition&&this.$element.hasClass("fade")?c.call(this):d.call(this)}},a.fn.modal=function(c){return this.each(function(){var d=a(this),e=d.data("modal"),f=a.extend({},a.fn.modal.defaults,d.data(),typeof c=="object"&&c);e||d.data("modal",e=new b(this,f)),typeof c=="string"?e[c]():f.show&&e.show()})},a.fn.modal.defaults={backdrop:!0,keyboard:!0,show:!0},a.fn.modal.Constructor=b,a(function(){a("body").on("click.modal.data-api",'[data-toggle="modal"]',function(b){var c=a(this),d,e=a(c.attr("data-target")||(d=c.attr("href"))&&d.replace(/.*(?=#[^\s]+$)/,"")),f=e.data("modal")?"toggle":a.extend({},e.data(),c.data());b.preventDefault(),e.modal(f)})})}(window.jQuery),!function(a){var b=function(a,b){this.init("tooltip",a,b)};b.prototype={constructor:b,init:function(b,c,d){var e,f;this.type=b,this.$element=a(c),this.options=this.getOptions(d),this.enabled=!0,this.options.trigger!="manual"&&(e=this.options.trigger=="hover"?"mouseenter":"focus",f=this.options.trigger=="hover"?"mouseleave":"blur",this.$element.on(e,this.options.selector,a.proxy(this.enter,this)),this.$element.on(f,this.options.selector,a.proxy(this.leave,this))),this.options.selector?this._options=a.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(b){return b=a.extend({},a.fn[this.type].defaults,b,this.$element.data()),b.delay&&typeof b.delay=="number"&&(b.delay={show:b.delay,hide:b.delay}),b},enter:function(b){var c=a(b.currentTarget)[this.type](this._options).data(this.type);!c.options.delay||!c.options.delay.show?c.show():(c.hoverState="in",setTimeout(function(){c.hoverState=="in"&&c.show()},c.options.delay.show))},leave:function(b){var c=a(b.currentTarget)[this.type](this._options).data(this.type);!c.options.delay||!c.options.delay.hide?c.hide():(c.hoverState="out",setTimeout(function(){c.hoverState=="out"&&c.hide()},c.options.delay.hide))},show:function(){var a,b,c,d,e,f,g;if(this.hasContent()&&this.enabled){a=this.tip(),this.setContent(),this.options.animation&&a.addClass("fade"),f=typeof this.options.placement=="function"?this.options.placement.call(this,a[0],this.$element[0]):this.options.placement,b=/in/.test(f),a.remove().css({top:0,left:0,display:"block"}).appendTo(b?this.$element:document.body),c=this.getPosition(b),d=a[0].offsetWidth,e=a[0].offsetHeight;switch(b?f.split(" ")[1]:f){case"bottom":g={top:c.top+c.height,left:c.left+c.width/2-d/2};break;case"top":g={top:c.top-e,left:c.left+c.width/2-d/2};break;case"left":g={top:c.top+c.height/2-e/2,left:c.left-d};break;case"right":g={top:c.top+c.height/2-e/2,left:c.left+c.width}}a.css(g).addClass(f).addClass("in")}},setContent:function(){var a=this.tip();a.find(".tooltip-inner").html(this.getTitle()),a.removeClass("fade in top bottom left right")},hide:function(){function d(){var b=setTimeout(function(){c.off(a.support.transition.end).remove()},500);c.one(a.support.transition.end,function(){clearTimeout(b),c.remove()})}var b=this,c=this.tip();c.removeClass("in"),a.support.transition&&this.$tip.hasClass("fade")?d():c.remove()},fixTitle:function(){var a=this.$element;(a.attr("title")||typeof a.attr("data-original-title")!="string")&&a.attr("data-original-title",a.attr("title")||"").removeAttr("title")},hasContent:function(){return this.getTitle()},getPosition:function(b){return a.extend({},b?{top:0,left:0}:this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){var a,b=this.$element,c=this.options;return a=b.attr("data-original-title")||(typeof c.title=="function"?c.title.call(b[0]):c.title),a=(a||"").toString().replace(/(^\s*|\s*$)/,""),a},tip:function(){return this.$tip=this.$tip||a(this.options.template)},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass("in")?"hide":"show"]()}},a.fn.tooltip=function(c){return this.each(function(){var d=a(this),e=d.data("tooltip"),f=typeof c=="object"&&c;e||d.data("tooltip",e=new b(this,f)),typeof c=="string"&&e[c]()})},a.fn.tooltip.Constructor=b,a.fn.tooltip.defaults={animation:!0,delay:0,selector:!1,placement:"top",trigger:"hover",title:"",template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'}}(window.jQuery),!function(a){var b=function(a,b){this.init("popover",a,b)};b.prototype=a.extend({},a.fn.tooltip.Constructor.prototype,{constructor:b,setContent:function(){var b=this.tip(),c=this.getTitle(),d=this.getContent();b.find(".popover-title")[a.type(c)=="object"?"append":"html"](c),b.find(".popover-content > *")[a.type(d)=="object"?"append":"html"](d),b.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){var a,b=this.$element,c=this.options;return a=b.attr("data-content")||(typeof c.content=="function"?c.content.call(b[0]):c.content),a=a.toString().replace(/(^\s*|\s*$)/,""),a},tip:function(){return this.$tip||(this.$tip=a(this.options.template)),this.$tip}}),a.fn.popover=function(c){return this.each(function(){var d=a(this),e=d.data("popover"),f=typeof c=="object"&&c;e||d.data("popover",e=new b(this,f)),typeof c=="string"&&e[c]()})},a.fn.popover.Constructor=b,a.fn.popover.defaults=a.extend({},a.fn.tooltip.defaults,{placement:"right",content:"",template:'<div class="popover"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div></div>'})}(window.jQuery),!function(a){function b(b,c){var d=a.proxy(this.process,this),e=a(b).is("body")?a(window):a(b),f;this.options=a.extend({},a.fn.scrollspy.defaults,c),this.$scrollElement=e.on("scroll.scroll.data-api",d),this.selector=(this.options.target||(f=a(b).attr("href"))&&f.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a",this.$body=a("body").on("click.scroll.data-api",this.selector,d),this.refresh(),this.process()}"use strict",b.prototype={constructor:b,refresh:function(){this.targets=this.$body.find(this.selector).map(function(){var b=a(this).attr("href");return/^#\w/.test(b)&&a(b).length?b:null}),this.offsets=a.map(this.targets,function(b){return a(b).position().top})},process:function(){var a=this.$scrollElement.scrollTop()+this.options.offset,b=this.offsets,c=this.targets,d=this.activeTarget,e;for(e=b.length;e--;){d!=c[e]&&a>=b[e]&&(!b[e+1]||a<=b[e+1])&&this.activate(c[e])}},activate:function(a){var b;this.activeTarget=a,this.$body.find(this.selector).parent(".active").removeClass("active"),b=this.$body.find(this.selector+'[href="'+a+'"]').parent("li").addClass("active"),b.parent(".dropdown-menu")&&b.closest("li.dropdown").addClass("active")}},a.fn.scrollspy=function(c){return this.each(function(){var d=a(this),e=d.data("scrollspy"),f=typeof c=="object"&&c;e||d.data("scrollspy",e=new b(this,f)),typeof c=="string"&&e[c]()})},a.fn.scrollspy.Constructor=b,a.fn.scrollspy.defaults={offset:10},a(function(){a('[data-spy="scroll"]').each(function(){var b=a(this);b.scrollspy(b.data())})})}(window.jQuery),!function(a){var b=function(b){this.element=a(b)};b.prototype={constructor:b,show:function(){var b=this.element,c=b.closest("ul:not(.dropdown-menu)"),d=b.attr("data-target"),e,f;d||(d=b.attr("href"),d=d&&d.replace(/.*(?=#[^\s]*$)/,""));if(b.parent("li").hasClass("active")){return}e=c.find(".active a").last()[0],b.trigger({type:"show",relatedTarget:e}),f=a(d),this.activate(b.parent("li"),c),this.activate(f,f.parent(),function(){b.trigger({type:"shown",relatedTarget:e})})},activate:function(b,c,d){function g(){e.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),b.addClass("active"),f?(b[0].offsetWidth,b.addClass("in")):b.removeClass("fade"),b.parent(".dropdown-menu")&&b.closest("li.dropdown").addClass("active"),d&&d()}var e=c.find("> .active"),f=d&&a.support.transition&&e.hasClass("fade");f?e.one(a.support.transition.end,g):g(),e.removeClass("in")}},a.fn.tab=function(c){return this.each(function(){var d=a(this),e=d.data("tab");e||d.data("tab",e=new b(this)),typeof c=="string"&&e[c]()})},a.fn.tab.Constructor=b,a(function(){a("body").on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(b){b.preventDefault(),a(this).tab("show")})})}(window.jQuery),!function(a){var b=function(b,c){this.$element=a(b),this.options=a.extend({},a.fn.typeahead.defaults,c),this.matcher=this.options.matcher||this.matcher,this.sorter=this.options.sorter||this.sorter,this.highlighter=this.options.highlighter||this.highlighter,this.$menu=a(this.options.menu).appendTo("body"),this.source=this.options.source,this.shown=!1,this.listen()};b.prototype={constructor:b,select:function(){var a=this.$menu.find(".active").attr("data-value");return this.$element.val(a),this.$element.change(),this.hide()},show:function(){var b=a.extend({},this.$element.offset(),{height:this.$element[0].offsetHeight});return this.$menu.css({top:b.top+b.height,left:b.left}),this.$menu.show(),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.shown=!1,this},lookup:function(b){var c=this,d,e;return this.query=this.$element.val(),this.query?(d=a.grep(this.source,function(a){if(c.matcher(a)){return a}}),d=this.sorter(d),d.length?this.render(d.slice(0,this.options.items)).show():this.shown?this.hide():this):this.shown?this.hide():this},matcher:function(a){return ~a.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(a){var b=[],c=[],d=[],e;while(e=a.shift()){e.toLowerCase().indexOf(this.query.toLowerCase())?~e.indexOf(this.query)?c.push(e):d.push(e):b.push(e)}return b.concat(c,d)},highlighter:function(a){return a.replace(new RegExp("("+this.query+")","ig"),function(a,b){return"<strong>"+b+"</strong>"})},render:function(b){var c=this;return b=a(b).map(function(b,d){return b=a(c.options.item).attr("data-value",d),b.find("a").html(c.highlighter(d)),b[0]}),b.first().addClass("active"),this.$menu.html(b),this},next:function(b){var c=this.$menu.find(".active").removeClass("active"),d=c.next();d.length||(d=a(this.$menu.find("li")[0])),d.addClass("active")},prev:function(a){var b=this.$menu.find(".active").removeClass("active"),c=b.prev();c.length||(c=this.$menu.find("li").last()),c.addClass("active")},listen:function(){this.$element.on("blur",a.proxy(this.blur,this)).on("keypress",a.proxy(this.keypress,this)).on("keyup",a.proxy(this.keyup,this)),(a.browser.webkit||a.browser.msie)&&this.$element.on("keydown",a.proxy(this.keypress,this)),this.$menu.on("click",a.proxy(this.click,this)).on("mouseenter","li",a.proxy(this.mouseenter,this))},keyup:function(a){switch(a.keyCode){case 40:case 38:break;case 9:case 13:if(!this.shown){return}this.select();break;case 27:if(!this.shown){return}this.hide();break;default:this.lookup()}a.stopPropagation(),a.preventDefault()},keypress:function(a){if(!this.shown){return}switch(a.keyCode){case 9:case 13:case 27:a.preventDefault();break;case 38:a.preventDefault(),this.prev();break;case 40:a.preventDefault(),this.next()}a.stopPropagation()},blur:function(a){var b=this;setTimeout(function(){b.hide()},150)},click:function(a){a.stopPropagation(),a.preventDefault(),this.select()},mouseenter:function(b){this.$menu.find(".active").removeClass("active"),a(b.currentTarget).addClass("active")}},a.fn.typeahead=function(c){return this.each(function(){var d=a(this),e=d.data("typeahead"),f=typeof c=="object"&&c;e||d.data("typeahead",e=new b(this,f)),typeof c=="string"&&e[c]()})},a.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>'},a.fn.typeahead.Constructor=b,a(function(){a("body").on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(b){var c=a(this);if(c.data("typeahead")){return}b.preventDefault(),c.typeahead(c.data())})})}(window.jQuery);window.ENV={EXTEND_PROTOTYPES:false};(function(){if("undefined"===typeof Ember){Ember={};if("undefined"!==typeof window){window.Em=window.Ember=Em=Ember}}Ember.assert=function(desc,test){if("function"===typeof test){test=test()!==false}if(!test){throw new Error("assertion failed: "+desc)}};Ember.warn=function(message,test){if(arguments.length===1){test=false}if("function"===typeof test){test=test()!==false}if(!test){Ember.Logger.warn("WARNING: "+message)}};Ember.deprecate=function(message,test){if(Ember&&Ember.TESTING_DEPRECATION){return}if(arguments.length===1){test=false}if("function"===typeof test){test=test()!==false}if(test){return}if(Ember&&Ember.ENV.RAISE_ON_DEPRECATION){throw new Error(message)}var error,stackStr="";try{__fail__.fail()}catch(e){error=e}if(error.stack){var stack;if(error["arguments"]){stack=error.stack.replace(/^\s+at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}($1)$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}($1)").split("\n");stack.shift()}else{stack=error.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^\(/gm,"{anonymous}(").split("\n")}stackStr="\n    "+stack.slice(2).join("\n    ")}Ember.Logger.warn("DEPRECATION: "+message+stackStr)};Ember.deprecateFunc=function(message,func){return function(){Ember.deprecate(message);return func.apply(this,arguments)}};window.ember_assert=Ember.deprecateFunc("ember_assert is deprecated. Please use Ember.assert instead.",Ember.assert);window.ember_warn=Ember.deprecateFunc("ember_warn is deprecated. Please use Ember.warn instead.",Ember.warn);window.ember_deprecate=Ember.deprecateFunc("ember_deprecate is deprecated. Please use Ember.deprecate instead.",Ember.deprecate);window.ember_deprecateFunc=Ember.deprecateFunc("ember_deprecateFunc is deprecated. Please use Ember.deprecateFunc instead.",Ember.deprecateFunc)})();(function(){var Handlebars={};window.Handlebars=Handlebars;Handlebars.VERSION="1.0.beta.6";Handlebars.helpers={};Handlebars.partials={};Handlebars.registerHelper=function(name,fn,inverse){if(inverse){fn.not=inverse}this.helpers[name]=fn};Handlebars.registerPartial=function(name,str){this.partials[name]=str};Handlebars.registerHelper("helperMissing",function(arg){if(arguments.length===2){return undefined}else{throw new Error("Could not find property '"+arg+"'")}});var toString=Object.prototype.toString,functionType="[object Function]";Handlebars.registerHelper("blockHelperMissing",function(context,options){var inverse=options.inverse||function(){},fn=options.fn;var ret="";var type=toString.call(context);if(type===functionType){context=context.call(this)}if(context===true){return fn(this)}else{if(context===false||context==null){return inverse(this)}else{if(type==="[object Array]"){if(context.length>0){for(var i=0,j=context.length;i<j;i++){ret=ret+fn(context[i])}}else{ret=inverse(this)}return ret}else{return fn(context)}}}});Handlebars.registerHelper("each",function(context,options){var fn=options.fn,inverse=options.inverse;var ret="";if(context&&context.length>0){for(var i=0,j=context.length;i<j;i++){ret=ret+fn(context[i])}}else{ret=inverse(this)}return ret});Handlebars.registerHelper("if",function(context,options){var type=toString.call(context);if(type===functionType){context=context.call(this)}if(!context||Handlebars.Utils.isEmpty(context)){return options.inverse(this)}else{return options.fn(this)}});Handlebars.registerHelper("unless",function(context,options){var fn=options.fn,inverse=options.inverse;options.fn=inverse;options.inverse=fn;return Handlebars.helpers["if"].call(this,context,options)});Handlebars.registerHelper("with",function(context,options){return options.fn(context)});Handlebars.registerHelper("log",function(context){Handlebars.log(context)});var handlebars=(function(){var parser={trace:function trace(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,statements:6,simpleInverse:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,OPEN_PARTIAL:24,params:25,hash:26,param:27,STRING:28,INTEGER:29,BOOLEAN:30,hashSegments:31,hashSegment:32,ID:33,EQUALS:34,pathSegments:35,SEP:36,"$accept":0,"$end":1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"OPEN_PARTIAL",28:"STRING",29:"INTEGER",30:"BOOLEAN",33:"ID",34:"EQUALS",36:"SEP"},productions_:[0,[3,2],[4,3],[4,1],[4,0],[6,1],[6,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,3],[13,4],[7,2],[17,3],[17,2],[17,2],[17,1],[25,2],[25,1],[27,1],[27,1],[27,1],[27,1],[26,1],[31,2],[31,1],[32,3],[32,3],[32,3],[32,3],[21,1],[35,3],[35,1]],performAction:function anonymous(yytext,yyleng,yylineno,yy,yystate,$$,_$){var $0=$$.length-1;switch(yystate){case 1:return $$[$0-1];break;case 2:this.$=new yy.ProgramNode($$[$0-2],$$[$0]);break;case 3:this.$=new yy.ProgramNode($$[$0]);break;case 4:this.$=new yy.ProgramNode([]);break;case 5:this.$=[$$[$0]];break;case 6:$$[$0-1].push($$[$0]);this.$=$$[$0-1];break;case 7:this.$=new yy.InverseNode($$[$0-2],$$[$0-1],$$[$0]);break;case 8:this.$=new yy.BlockNode($$[$0-2],$$[$0-1],$$[$0]);break;case 9:this.$=$$[$0];break;case 10:this.$=$$[$0];break;case 11:this.$=new yy.ContentNode($$[$0]);break;case 12:this.$=new yy.CommentNode($$[$0]);break;case 13:this.$=new yy.MustacheNode($$[$0-1][0],$$[$0-1][1]);break;case 14:this.$=new yy.MustacheNode($$[$0-1][0],$$[$0-1][1]);break;case 15:this.$=$$[$0-1];break;case 16:this.$=new yy.MustacheNode($$[$0-1][0],$$[$0-1][1]);break;case 17:this.$=new yy.MustacheNode($$[$0-1][0],$$[$0-1][1],true);break;case 18:this.$=new yy.PartialNode($$[$0-1]);break;case 19:this.$=new yy.PartialNode($$[$0-2],$$[$0-1]);break;case 20:break;case 21:this.$=[[$$[$0-2]].concat($$[$0-1]),$$[$0]];break;case 22:this.$=[[$$[$0-1]].concat($$[$0]),null];break;case 23:this.$=[[$$[$0-1]],$$[$0]];break;case 24:this.$=[[$$[$0]],null];break;case 25:$$[$0-1].push($$[$0]);this.$=$$[$0-1];break;case 26:this.$=[$$[$0]];break;case 27:this.$=$$[$0];break;case 28:this.$=new yy.StringNode($$[$0]);break;case 29:this.$=new yy.IntegerNode($$[$0]);break;case 30:this.$=new yy.BooleanNode($$[$0]);break;case 31:this.$=new yy.HashNode($$[$0]);break;case 32:$$[$0-1].push($$[$0]);this.$=$$[$0-1];break;case 33:this.$=[$$[$0]];break;case 34:this.$=[$$[$0-2],$$[$0]];break;case 35:this.$=[$$[$0-2],new yy.StringNode($$[$0])];break;case 36:this.$=[$$[$0-2],new yy.IntegerNode($$[$0])];break;case 37:this.$=[$$[$0-2],new yy.BooleanNode($$[$0])];break;case 38:this.$=new yy.IdNode($$[$0]);break;case 39:$$[$0-2].push($$[$0]);this.$=$$[$0-2];break;case 40:this.$=[$$[$0]];break}},table:[{3:1,4:2,5:[2,4],6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{1:[3]},{5:[1,16]},{5:[2,3],7:17,8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,19],20:[2,3],22:[1,13],23:[1,14],24:[1,15]},{5:[2,5],14:[2,5],15:[2,5],16:[2,5],19:[2,5],20:[2,5],22:[2,5],23:[2,5],24:[2,5]},{4:20,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{4:21,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],24:[2,9]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],24:[2,10]},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],24:[2,11]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],24:[2,12]},{17:22,21:23,33:[1,25],35:24},{17:26,21:23,33:[1,25],35:24},{17:27,21:23,33:[1,25],35:24},{17:28,21:23,33:[1,25],35:24},{21:29,33:[1,25],35:24},{1:[2,1]},{6:30,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{5:[2,6],14:[2,6],15:[2,6],16:[2,6],19:[2,6],20:[2,6],22:[2,6],23:[2,6],24:[2,6]},{17:22,18:[1,31],21:23,33:[1,25],35:24},{10:32,20:[1,33]},{10:34,20:[1,33]},{18:[1,35]},{18:[2,24],21:40,25:36,26:37,27:38,28:[1,41],29:[1,42],30:[1,43],31:39,32:44,33:[1,45],35:24},{18:[2,38],28:[2,38],29:[2,38],30:[2,38],33:[2,38],36:[1,46]},{18:[2,40],28:[2,40],29:[2,40],30:[2,40],33:[2,40],36:[2,40]},{18:[1,47]},{18:[1,48]},{18:[1,49]},{18:[1,50],21:51,33:[1,25],35:24},{5:[2,2],8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,2],22:[1,13],23:[1,14],24:[1,15]},{14:[2,20],15:[2,20],16:[2,20],19:[2,20],22:[2,20],23:[2,20],24:[2,20]},{5:[2,7],14:[2,7],15:[2,7],16:[2,7],19:[2,7],20:[2,7],22:[2,7],23:[2,7],24:[2,7]},{21:52,33:[1,25],35:24},{5:[2,8],14:[2,8],15:[2,8],16:[2,8],19:[2,8],20:[2,8],22:[2,8],23:[2,8],24:[2,8]},{14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],24:[2,14]},{18:[2,22],21:40,26:53,27:54,28:[1,41],29:[1,42],30:[1,43],31:39,32:44,33:[1,45],35:24},{18:[2,23]},{18:[2,26],28:[2,26],29:[2,26],30:[2,26],33:[2,26]},{18:[2,31],32:55,33:[1,56]},{18:[2,27],28:[2,27],29:[2,27],30:[2,27],33:[2,27]},{18:[2,28],28:[2,28],29:[2,28],30:[2,28],33:[2,28]},{18:[2,29],28:[2,29],29:[2,29],30:[2,29],33:[2,29]},{18:[2,30],28:[2,30],29:[2,30],30:[2,30],33:[2,30]},{18:[2,33],33:[2,33]},{18:[2,40],28:[2,40],29:[2,40],30:[2,40],33:[2,40],34:[1,57],36:[2,40]},{33:[1,58]},{14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],24:[2,13]},{5:[2,16],14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],24:[2,16]},{5:[2,17],14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],24:[2,17]},{5:[2,18],14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],24:[2,18]},{18:[1,59]},{18:[1,60]},{18:[2,21]},{18:[2,25],28:[2,25],29:[2,25],30:[2,25],33:[2,25]},{18:[2,32],33:[2,32]},{34:[1,57]},{21:61,28:[1,62],29:[1,63],30:[1,64],33:[1,25],35:24},{18:[2,39],28:[2,39],29:[2,39],30:[2,39],33:[2,39],36:[2,39]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],24:[2,19]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],24:[2,15]},{18:[2,34],33:[2,34]},{18:[2,35],33:[2,35]},{18:[2,36],33:[2,36]},{18:[2,37],33:[2,37]}],defaultActions:{16:[2,1],37:[2,23],53:[2,21]},parseError:function parseError(str,hash){throw new Error(str)},parse:function parse(input){var self=this,stack=[0],vstack=[null],lstack=[],table=this.table,yytext="",yylineno=0,yyleng=0,recovering=0,TERROR=2,EOF=1;this.lexer.setInput(input);this.lexer.yy=this.yy;this.yy.lexer=this.lexer;if(typeof this.lexer.yylloc=="undefined"){this.lexer.yylloc={}}var yyloc=this.lexer.yylloc;lstack.push(yyloc);if(typeof this.yy.parseError==="function"){this.parseError=this.yy.parseError}function popStack(n){stack.length=stack.length-2*n;vstack.length=vstack.length-n;lstack.length=lstack.length-n}function lex(){var token;token=self.lexer.lex()||1;if(typeof token!=="number"){token=self.symbols_[token]||token}return token}var symbol,preErrorSymbol,state,action,a,r,yyval={},p,len,newState,expected;while(true){state=stack[stack.length-1];if(this.defaultActions[state]){action=this.defaultActions[state]}else{if(symbol==null){symbol=lex()}action=table[state]&&table[state][symbol]}if(typeof action==="undefined"||!action.length||!action[0]){if(!recovering){expected=[];for(p in table[state]){if(this.terminals_[p]&&p>2){expected.push("'"+this.terminals_[p]+"'")}}var errStr="";if(this.lexer.showPosition){errStr="Parse error on line "+(yylineno+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+expected.join(", ")+", got '"+this.terminals_[symbol]+"'"}else{errStr="Parse error on line "+(yylineno+1)+": Unexpected "+(symbol==1?"end of input":"'"+(this.terminals_[symbol]||symbol)+"'")}this.parseError(errStr,{text:this.lexer.match,token:this.terminals_[symbol]||symbol,line:this.lexer.yylineno,loc:yyloc,expected:expected})}}if(action[0] instanceof Array&&action.length>1){throw new Error("Parse Error: multiple actions possible at state: "+state+", token: "+symbol)}switch(action[0]){case 1:stack.push(symbol);vstack.push(this.lexer.yytext);lstack.push(this.lexer.yylloc);stack.push(action[1]);symbol=null;if(!preErrorSymbol){yyleng=this.lexer.yyleng;yytext=this.lexer.yytext;yylineno=this.lexer.yylineno;yyloc=this.lexer.yylloc;if(recovering>0){recovering--}}else{symbol=preErrorSymbol;preErrorSymbol=null}break;case 2:len=this.productions_[action[1]][1];yyval.$=vstack[vstack.length-len];yyval._$={first_line:lstack[lstack.length-(len||1)].first_line,last_line:lstack[lstack.length-1].last_line,first_column:lstack[lstack.length-(len||1)].first_column,last_column:lstack[lstack.length-1].last_column};r=this.performAction.call(yyval,yytext,yyleng,yylineno,this.yy,action[1],vstack,lstack);if(typeof r!=="undefined"){return r}if(len){stack=stack.slice(0,-1*len*2);vstack=vstack.slice(0,-1*len);lstack=lstack.slice(0,-1*len)}stack.push(this.productions_[action[1]][0]);vstack.push(yyval.$);lstack.push(yyval._$);newState=table[stack[stack.length-2]][stack[stack.length-1]];stack.push(newState);break;case 3:return true}}return true}};var lexer=(function(){var lexer=({EOF:1,parseError:function parseError(str,hash){if(this.yy.parseError){this.yy.parseError(str,hash)}else{throw new Error(str)}},setInput:function(input){this._input=input;this._more=this._less=this.done=false;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};return this},input:function(){var ch=this._input[0];this.yytext+=ch;this.yyleng++;this.match+=ch;this.matched+=ch;var lines=ch.match(/\n/);if(lines){this.yylineno++}this._input=this._input.slice(1);return ch},unput:function(ch){this._input=ch+this._input;return this},more:function(){this._more=true;return this},pastInput:function(){var past=this.matched.substr(0,this.matched.length-this.match.length);return(past.length>20?"...":"")+past.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var next=this.match;if(next.length<20){next+=this._input.substr(0,20-next.length)}return(next.substr(0,20)+(next.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var pre=this.pastInput();var c=new Array(pre.length+1).join("-");return pre+this.upcomingInput()+"\n"+c+"^"},next:function(){if(this.done){return this.EOF}if(!this._input){this.done=true}var token,match,col,lines;if(!this._more){this.yytext="";this.match=""}var rules=this._currentRules();for(var i=0;i<rules.length;i++){match=this._input.match(this.rules[rules[i]]);if(match){lines=match[0].match(/\n.*/g);if(lines){this.yylineno+=lines.length}this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:lines?lines[lines.length-1].length-1:this.yylloc.last_column+match[0].length};this.yytext+=match[0];this.match+=match[0];this.matches=match;this.yyleng=this.yytext.length;this._more=false;this._input=this._input.slice(match[0].length);this.matched+=match[0];token=this.performAction.call(this,this.yy,this,rules[i],this.conditionStack[this.conditionStack.length-1]);if(token){return token}else{return}}}if(this._input===""){return this.EOF}else{this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})}},lex:function lex(){var r=this.next();if(typeof r!=="undefined"){return r}else{return this.lex()}},begin:function begin(condition){this.conditionStack.push(condition)},popState:function popState(){return this.conditionStack.pop()},_currentRules:function _currentRules(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function begin(condition){this.begin(condition)}});lexer.performAction=function anonymous(yy,yy_,$avoiding_name_collisions,YY_START){var YYSTATE=YY_START;switch($avoiding_name_collisions){case 0:if(yy_.yytext.slice(-1)!=="\\"){this.begin("mu")}if(yy_.yytext.slice(-1)==="\\"){yy_.yytext=yy_.yytext.substr(0,yy_.yyleng-1),this.begin("emu")}if(yy_.yytext){return 14}break;case 1:return 14;break;case 2:this.popState();return 14;break;case 3:return 24;break;case 4:return 16;break;case 5:return 20;break;case 6:return 19;break;case 7:return 19;break;case 8:return 23;break;case 9:return 23;break;case 10:yy_.yytext=yy_.yytext.substr(3,yy_.yyleng-5);this.popState();return 15;break;case 11:return 22;break;case 12:return 34;break;case 13:return 33;break;case 14:return 33;break;case 15:return 36;break;case 16:break;case 17:this.popState();return 18;break;case 18:this.popState();return 18;break;case 19:yy_.yytext=yy_.yytext.substr(1,yy_.yyleng-2).replace(/\\"/g,'"');return 28;break;case 20:return 30;break;case 21:return 30;break;case 22:return 29;break;case 23:return 33;break;case 24:yy_.yytext=yy_.yytext.substr(1,yy_.yyleng-2);return 33;break;case 25:return"INVALID";break;case 26:return 5;break}};lexer.rules=[/^[^\x00]*?(?=(\{\{))/,/^[^\x00]+/,/^[^\x00]{2,}?(?=(\{\{))/,/^\{\{>/,/^\{\{#/,/^\{\{\//,/^\{\{\^/,/^\{\{\s*else\b/,/^\{\{\{/,/^\{\{&/,/^\{\{![\s\S]*?\}\}/,/^\{\{/,/^=/,/^\.(?=[} ])/,/^\.\./,/^[\/.]/,/^\s+/,/^\}\}\}/,/^\}\}/,/^"(\\["]|[^"])*"/,/^true(?=[}\s])/,/^false(?=[}\s])/,/^[0-9]+(?=[}\s])/,/^[a-zA-Z0-9_$-]+(?=[=}\s\/.])/,/^\[[^\]]*\]/,/^./,/^$/];lexer.conditions={mu:{rules:[3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26],inclusive:false},emu:{rules:[2],inclusive:false},INITIAL:{rules:[0,1,26],inclusive:true}};return lexer})();parser.lexer=lexer;return parser})();if(typeof require!=="undefined"&&typeof exports!=="undefined"){exports.parser=handlebars;exports.parse=function(){return handlebars.parse.apply(handlebars,arguments)};exports.main=function commonjsMain(args){if(!args[1]){throw new Error("Usage: "+args[0]+" FILE")}if(typeof process!=="undefined"){var source=require("fs").readFileSync(require("path").join(process.cwd(),args[1]),"utf8")}else{var cwd=require("file").path(require("file").cwd());var source=cwd.join(args[1]).read({charset:"utf-8"})}return exports.parser.parse(source)};if(typeof module!=="undefined"&&require.main===module){exports.main(typeof process!=="undefined"?process.argv.slice(1):require("system").args)}}Handlebars.Parser=handlebars;Handlebars.parse=function(string){Handlebars.Parser.yy=Handlebars.AST;return Handlebars.Parser.parse(string)};Handlebars.print=function(ast){return new Handlebars.PrintVisitor().accept(ast)};Handlebars.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(level,str){}};Handlebars.log=function(level,str){Handlebars.logger.log(level,str)};(function(){Handlebars.AST={};Handlebars.AST.ProgramNode=function(statements,inverse){this.type="program";this.statements=statements;if(inverse){this.inverse=new Handlebars.AST.ProgramNode(inverse)}};Handlebars.AST.MustacheNode=function(params,hash,unescaped){this.type="mustache";this.id=params[0];this.params=params.slice(1);this.hash=hash;this.escaped=!unescaped};Handlebars.AST.PartialNode=function(id,context){this.type="partial";this.id=id;this.context=context};var verifyMatch=function(open,close){if(open.original!==close.original){throw new Handlebars.Exception(open.original+" doesn't match "+close.original)}};Handlebars.AST.BlockNode=function(mustache,program,close){verifyMatch(mustache.id,close);this.type="block";this.mustache=mustache;this.program=program};Handlebars.AST.InverseNode=function(mustache,program,close){verifyMatch(mustache.id,close);this.type="inverse";this.mustache=mustache;this.program=program};Handlebars.AST.ContentNode=function(string){this.type="content";this.string=string};Handlebars.AST.HashNode=function(pairs){this.type="hash";this.pairs=pairs};Handlebars.AST.IdNode=function(parts){this.type="ID";this.original=parts.join(".");var dig=[],depth=0;for(var i=0,l=parts.length;i<l;i++){var part=parts[i];if(part===".."){depth++}else{if(part==="."||part==="this"){this.isScoped=true}else{dig.push(part)}}}this.parts=dig;this.string=dig.join(".");this.depth=depth;this.isSimple=(dig.length===1)&&(depth===0)};Handlebars.AST.StringNode=function(string){this.type="STRING";this.string=string};Handlebars.AST.IntegerNode=function(integer){this.type="INTEGER";this.integer=integer};Handlebars.AST.BooleanNode=function(bool){this.type="BOOLEAN";this.bool=bool};Handlebars.AST.CommentNode=function(comment){this.type="comment";this.comment=comment}})();Handlebars.Exception=function(message){var tmp=Error.prototype.constructor.apply(this,arguments);for(var p in tmp){if(tmp.hasOwnProperty(p)){this[p]=tmp[p]}}this.message=tmp.message};Handlebars.Exception.prototype=new Error;Handlebars.SafeString=function(string){this.string=string};Handlebars.SafeString.prototype.toString=function(){return this.string.toString()};(function(){var escape={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var badChars=/&(?!\w+;)|[<>"'`]/g;var possible=/[&<>"'`]/;var escapeChar=function(chr){return escape[chr]||"&amp;"};Handlebars.Utils={escapeExpression:function(string){if(string instanceof Handlebars.SafeString){return string.toString()}else{if(string==null||string===false){return""}}if(!possible.test(string)){return string}return string.replace(badChars,escapeChar)},isEmpty:function(value){if(typeof value==="undefined"){return true}else{if(value===null){return true}else{if(value===false){return true}else{if(Object.prototype.toString.call(value)==="[object Array]"&&value.length===0){return true}else{return false}}}}}}})();Handlebars.Compiler=function(){};Handlebars.JavaScriptCompiler=function(){};(function(Compiler,JavaScriptCompiler){Compiler.OPCODE_MAP={appendContent:1,getContext:2,lookupWithHelpers:3,lookup:4,append:5,invokeMustache:6,appendEscaped:7,pushString:8,truthyOrFallback:9,functionOrFallback:10,invokeProgram:11,invokePartial:12,push:13,assignToHash:15,pushStringParam:16};Compiler.MULTI_PARAM_OPCODES={appendContent:1,getContext:1,lookupWithHelpers:2,lookup:1,invokeMustache:3,pushString:1,truthyOrFallback:1,functionOrFallback:1,invokeProgram:3,invokePartial:1,push:1,assignToHash:1,pushStringParam:1};Compiler.DISASSEMBLE_MAP={};for(var prop in Compiler.OPCODE_MAP){var value=Compiler.OPCODE_MAP[prop];Compiler.DISASSEMBLE_MAP[value]=prop}Compiler.multiParamSize=function(code){return Compiler.MULTI_PARAM_OPCODES[Compiler.DISASSEMBLE_MAP[code]]};Compiler.prototype={compiler:Compiler,disassemble:function(){var opcodes=this.opcodes,opcode,nextCode;var out=[],str,name,value;for(var i=0,l=opcodes.length;i<l;i++){opcode=opcodes[i];if(opcode==="DECLARE"){name=opcodes[++i];value=opcodes[++i];out.push("DECLARE "+name+" = "+value)}else{str=Compiler.DISASSEMBLE_MAP[opcode];var extraParams=Compiler.multiParamSize(opcode);var codes=[];for(var j=0;j<extraParams;j++){nextCode=opcodes[++i];if(typeof nextCode==="string"){nextCode='"'+nextCode.replace("\n","\\n")+'"'}codes.push(nextCode)}str=str+" "+codes.join(" ");out.push(str)}}return out.join("\n")},guid:0,compile:function(program,options){this.children=[];this.depths={list:[]};this.options=options;var knownHelpers=this.options.knownHelpers;this.options.knownHelpers={helperMissing:true,blockHelperMissing:true,each:true,"if":true,unless:true,"with":true,log:true};if(knownHelpers){for(var name in knownHelpers){this.options.knownHelpers[name]=knownHelpers[name]}}return this.program(program)},accept:function(node){return this[node.type](node)},program:function(program){var statements=program.statements,statement;this.opcodes=[];for(var i=0,l=statements.length;i<l;i++){statement=statements[i];this[statement.type](statement)}this.isSimple=l===1;this.depths.list=this.depths.list.sort(function(a,b){return a-b});return this},compileProgram:function(program){var result=new this.compiler().compile(program,this.options);var guid=this.guid++;this.usePartial=this.usePartial||result.usePartial;this.children[guid]=result;for(var i=0,l=result.depths.list.length;i<l;i++){depth=result.depths.list[i];if(depth<2){continue}else{this.addDepth(depth-1)}}return guid},block:function(block){var mustache=block.mustache;var depth,child,inverse,inverseGuid;var params=this.setupStackForMustache(mustache);var programGuid=this.compileProgram(block.program);if(block.program.inverse){inverseGuid=this.compileProgram(block.program.inverse);this.declare("inverse",inverseGuid)}this.opcode("invokeProgram",programGuid,params.length,!!mustache.hash);this.declare("inverse",null);this.opcode("append")},inverse:function(block){var params=this.setupStackForMustache(block.mustache);var programGuid=this.compileProgram(block.program);this.declare("inverse",programGuid);this.opcode("invokeProgram",null,params.length,!!block.mustache.hash);this.declare("inverse",null);this.opcode("append")},hash:function(hash){var pairs=hash.pairs,pair,val;this.opcode("push","{}");for(var i=0,l=pairs.length;i<l;i++){pair=pairs[i];val=pair[1];this.accept(val);this.opcode("assignToHash",pair[0])}},partial:function(partial){var id=partial.id;this.usePartial=true;if(partial.context){this.ID(partial.context)}else{this.opcode("push","depth0")}this.opcode("invokePartial",id.original);this.opcode("append")},content:function(content){this.opcode("appendContent",content.string)},mustache:function(mustache){var params=this.setupStackForMustache(mustache);this.opcode("invokeMustache",params.length,mustache.id.original,!!mustache.hash);if(mustache.escaped&&!this.options.noEscape){this.opcode("appendEscaped")}else{this.opcode("append")}},ID:function(id){this.addDepth(id.depth);this.opcode("getContext",id.depth);this.opcode("lookupWithHelpers",id.parts[0]||null,id.isScoped||false);for(var i=1,l=id.parts.length;i<l;i++){this.opcode("lookup",id.parts[i])}},STRING:function(string){this.opcode("pushString",string.string)},INTEGER:function(integer){this.opcode("push",integer.integer)},BOOLEAN:function(bool){this.opcode("push",bool.bool)},comment:function(){},pushParams:function(params){var i=params.length,param;while(i--){param=params[i];if(this.options.stringParams){if(param.depth){this.addDepth(param.depth)}this.opcode("getContext",param.depth||0);this.opcode("pushStringParam",param.string)}else{this[param.type](param)}}},opcode:function(name,val1,val2,val3){this.opcodes.push(Compiler.OPCODE_MAP[name]);if(val1!==undefined){this.opcodes.push(val1)}if(val2!==undefined){this.opcodes.push(val2)}if(val3!==undefined){this.opcodes.push(val3)}},declare:function(name,value){this.opcodes.push("DECLARE");this.opcodes.push(name);this.opcodes.push(value)},addDepth:function(depth){if(depth===0){return}if(!this.depths[depth]){this.depths[depth]=true;this.depths.list.push(depth)}},setupStackForMustache:function(mustache){var params=mustache.params;this.pushParams(params);if(mustache.hash){this.hash(mustache.hash)}this.ID(mustache.id);return params}};JavaScriptCompiler.prototype={nameLookup:function(parent,name,type){if(/^[0-9]+$/.test(name)){return parent+"["+name+"]"}else{if(JavaScriptCompiler.isValidJavaScriptVariableName(name)){return parent+"."+name}else{return parent+"['"+name+"']"}}},appendToBuffer:function(string){if(this.environment.isSimple){return"return "+string+";"}else{return"buffer += "+string+";"}},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(environment,options,context,asObject){this.environment=environment;this.options=options||{};this.name=this.environment.name;this.isChild=!!context;this.context=context||{programs:[],aliases:{self:"this"},registers:{list:[]}};this.preamble();this.stackSlot=0;this.stackVars=[];this.compileChildren(environment,options);var opcodes=environment.opcodes,opcode;this.i=0;for(l=opcodes.length;this.i<l;this.i++){opcode=this.nextOpcode(0);if(opcode[0]==="DECLARE"){this.i=this.i+2;this[opcode[1]]=opcode[2]}else{this.i=this.i+opcode[1].length;this[opcode[0]].apply(this,opcode[1])}}return this.createFunctionContext(asObject)},nextOpcode:function(n){var opcodes=this.environment.opcodes,opcode=opcodes[this.i+n],name,val;var extraParams,codes;if(opcode==="DECLARE"){name=opcodes[this.i+1];val=opcodes[this.i+2];return["DECLARE",name,val]}else{name=Compiler.DISASSEMBLE_MAP[opcode];extraParams=Compiler.multiParamSize(opcode);codes=[];for(var j=0;j<extraParams;j++){codes.push(opcodes[this.i+j+1+n])}return[name,codes]}},eat:function(opcode){this.i=this.i+opcode.length},preamble:function(){var out=[];this.useRegister("foundHelper");if(!this.isChild){var namespace=this.namespace;var copies="helpers = helpers || "+namespace+".helpers;";if(this.environment.usePartial){copies=copies+" partials = partials || "+namespace+".partials;"}out.push(copies)}else{out.push("")}if(!this.environment.isSimple){out.push(", buffer = "+this.initializeBuffer())}else{out.push("")}this.lastContext=0;this.source=out},createFunctionContext:function(asObject){var locals=this.stackVars;if(!this.isChild){locals=locals.concat(this.context.registers.list)}if(locals.length>0){this.source[1]=this.source[1]+", "+locals.join(", ")}if(!this.isChild){var aliases=[];for(var alias in this.context.aliases){this.source[1]=this.source[1]+", "+alias+"="+this.context.aliases[alias]}}if(this.source[1]){this.source[1]="var "+this.source[1].substring(2)+";"}if(!this.isChild){this.source[1]+="\n"+this.context.programs.join("\n")+"\n"}if(!this.environment.isSimple){this.source.push("return buffer;")}var params=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"];for(var i=0,l=this.environment.depths.list.length;i<l;i++){params.push("depth"+this.environment.depths.list[i])}if(asObject){params.push(this.source.join("\n  "));return Function.apply(this,params)}else{var functionSource="function "+(this.name||"")+"("+params.join(",")+") {\n  "+this.source.join("\n  ")+"}";Handlebars.log(Handlebars.logger.DEBUG,functionSource+"\n\n");return functionSource}},appendContent:function(content){this.source.push(this.appendToBuffer(this.quotedString(content)))},append:function(){var local=this.popStack();this.source.push("if("+local+" || "+local+" === 0) { "+this.appendToBuffer(local)+" }");if(this.environment.isSimple){this.source.push("else { "+this.appendToBuffer("''")+" }")}},appendEscaped:function(){var opcode=this.nextOpcode(1),extra="";this.context.aliases.escapeExpression="this.escapeExpression";if(opcode[0]==="appendContent"){extra=" + "+this.quotedString(opcode[1][0]);this.eat(opcode)}this.source.push(this.appendToBuffer("escapeExpression("+this.popStack()+")"+extra))},getContext:function(depth){if(this.lastContext!==depth){this.lastContext=depth}},lookupWithHelpers:function(name,isScoped){if(name){var topStack=this.nextStack();this.usingKnownHelper=false;var toPush;if(!isScoped&&this.options.knownHelpers[name]){toPush=topStack+" = "+this.nameLookup("helpers",name,"helper");this.usingKnownHelper=true}else{if(isScoped||this.options.knownHelpersOnly){toPush=topStack+" = "+this.nameLookup("depth"+this.lastContext,name,"context")}else{this.register("foundHelper",this.nameLookup("helpers",name,"helper"));toPush=topStack+" = foundHelper || "+this.nameLookup("depth"+this.lastContext,name,"context")}}toPush+=";";this.source.push(toPush)}else{this.pushStack("depth"+this.lastContext)}},lookup:function(name){var topStack=this.topStack();this.source.push(topStack+" = ("+topStack+" === null || "+topStack+" === undefined || "+topStack+" === false ? "+topStack+" : "+this.nameLookup(topStack,name,"context")+");")},pushStringParam:function(string){this.pushStack("depth"+this.lastContext);this.pushString(string)},pushString:function(string){this.pushStack(this.quotedString(string))},push:function(name){this.pushStack(name)},invokeMustache:function(paramSize,original,hasHash){this.populateParams(paramSize,this.quotedString(original),"{}",null,hasHash,function(nextStack,helperMissingString,id){if(!this.usingKnownHelper){this.context.aliases.helperMissing="helpers.helperMissing";this.context.aliases.undef="void 0";this.source.push("else if("+id+"=== undef) { "+nextStack+" = helperMissing.call("+helperMissingString+"); }");if(nextStack!==id){this.source.push("else { "+nextStack+" = "+id+"; }")}}})},invokeProgram:function(guid,paramSize,hasHash){var inverse=this.programExpression(this.inverse);var mainProgram=this.programExpression(guid);this.populateParams(paramSize,null,mainProgram,inverse,hasHash,function(nextStack,helperMissingString,id){if(!this.usingKnownHelper){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";this.source.push("else { "+nextStack+" = blockHelperMissing.call("+helperMissingString+"); }")}})},populateParams:function(paramSize,helperId,program,inverse,hasHash,fn){var needsRegister=hasHash||this.options.stringParams||inverse||this.options.data;var id=this.popStack(),nextStack;var params=[],param,stringParam,stringOptions;if(needsRegister){this.register("tmp1",program);stringOptions="tmp1"}else{stringOptions="{ hash: {} }"}if(needsRegister){var hash=(hasHash?this.popStack():"{}");this.source.push("tmp1.hash = "+hash+";")}if(this.options.stringParams){this.source.push("tmp1.contexts = [];")}for(var i=0;i<paramSize;i++){param=this.popStack();params.push(param);if(this.options.stringParams){this.source.push("tmp1.contexts.push("+this.popStack()+");")}}if(inverse){this.source.push("tmp1.fn = tmp1;");this.source.push("tmp1.inverse = "+inverse+";")}if(this.options.data){this.source.push("tmp1.data = data;")}params.push(stringOptions);this.populateCall(params,id,helperId||id,fn,program!=="{}")},populateCall:function(params,id,helperId,fn,program){var paramString=["depth0"].concat(params).join(", ");var helperMissingString=["depth0"].concat(helperId).concat(params).join(", ");var nextStack=this.nextStack();if(this.usingKnownHelper){this.source.push(nextStack+" = "+id+".call("+paramString+");")}else{this.context.aliases.functionType='"function"';var condition=program?"foundHelper && ":"";this.source.push("if("+condition+"typeof "+id+" === functionType) { "+nextStack+" = "+id+".call("+paramString+"); }")}fn.call(this,nextStack,helperMissingString,id);this.usingKnownHelper=false},invokePartial:function(context){params=[this.nameLookup("partials",context,"partial"),"'"+context+"'",this.popStack(),"helpers","partials"];if(this.options.data){params.push("data")}this.pushStack("self.invokePartial("+params.join(", ")+");")},assignToHash:function(key){var value=this.popStack();var hash=this.topStack();this.source.push(hash+"['"+key+"'] = "+value+";")},compiler:JavaScriptCompiler,compileChildren:function(environment,options){var children=environment.children,child,compiler;for(var i=0,l=children.length;i<l;i++){child=children[i];compiler=new this.compiler();this.context.programs.push("");var index=this.context.programs.length;child.index=index;child.name="program"+index;this.context.programs[index]=compiler.compile(child,options,this.context)}},programExpression:function(guid){if(guid==null){return"self.noop"}var child=this.environment.children[guid],depths=child.depths.list;var programParams=[child.index,child.name,"data"];for(var i=0,l=depths.length;i<l;i++){depth=depths[i];if(depth===1){programParams.push("depth0")}else{programParams.push("depth"+(depth-1))}}if(depths.length===0){return"self.program("+programParams.join(", ")+")"}else{programParams.shift();return"self.programWithDepth("+programParams.join(", ")+")"}},register:function(name,val){this.useRegister(name);this.source.push(name+" = "+val+";")},useRegister:function(name){if(!this.context.registers[name]){this.context.registers[name]=true;this.context.registers.list.push(name)}},pushStack:function(item){this.source.push(this.nextStack()+" = "+item+";");return"stack"+this.stackSlot},nextStack:function(){this.stackSlot++;if(this.stackSlot>this.stackVars.length){this.stackVars.push("stack"+this.stackSlot)}return"stack"+this.stackSlot},popStack:function(){return"stack"+this.stackSlot--},topStack:function(){return"stack"+this.stackSlot},quotedString:function(str){return'"'+str.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"'}};var reservedWords=("break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected uncached double import public let yield").split(" ");var compilerWords=JavaScriptCompiler.RESERVED_WORDS={};for(var i=0,l=reservedWords.length;i<l;i++){compilerWords[reservedWords[i]]=true}JavaScriptCompiler.isValidJavaScriptVariableName=function(name){if(!JavaScriptCompiler.RESERVED_WORDS[name]&&/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(name)){return true}return false}})(Handlebars.Compiler,Handlebars.JavaScriptCompiler);Handlebars.precompile=function(string,options){options=options||{};var ast=Handlebars.parse(string);var environment=new Handlebars.Compiler().compile(ast,options);return new Handlebars.JavaScriptCompiler().compile(environment,options)};Handlebars.compile=function(string,options){options=options||{};var compiled;function compile(){var ast=Handlebars.parse(string);var environment=new Handlebars.Compiler().compile(ast,options);var templateSpec=new Handlebars.JavaScriptCompiler().compile(environment,options,undefined,true);return Handlebars.template(templateSpec)}return function(context,options){if(!compiled){compiled=compile()}return compiled.call(this,context,options)}};Handlebars.VM={template:function(templateSpec){var container={escapeExpression:Handlebars.Utils.escapeExpression,invokePartial:Handlebars.VM.invokePartial,programs:[],program:function(i,fn,data){var programWrapper=this.programs[i];if(data){return Handlebars.VM.program(fn,data)}else{if(programWrapper){return programWrapper}else{programWrapper=this.programs[i]=Handlebars.VM.program(fn);return programWrapper}}},programWithDepth:Handlebars.VM.programWithDepth,noop:Handlebars.VM.noop};return function(context,options){options=options||{};return templateSpec.call(container,Handlebars,context,options.helpers,options.partials,options.data)}},programWithDepth:function(fn,data,$depth){var args=Array.prototype.slice.call(arguments,2);return function(context,options){options=options||{};return fn.apply(this,[context,options.data||data].concat(args))}},program:function(fn,data){return function(context,options){options=options||{};return fn(context,options.data||data)}},noop:function(){return""},invokePartial:function(partial,name,context,helpers,partials,data){options={helpers:helpers,partials:partials,data:data};if(partial===undefined){throw new Handlebars.Exception("The partial "+name+" could not be found")}else{if(partial instanceof Function){return partial(context,options)}else{if(!Handlebars.compile){throw new Handlebars.Exception("The partial "+name+" could not be compiled when running in runtime-only mode")}else{partials[name]=Handlebars.compile(partial);return partials[name](context,options)}}}}};Handlebars.template=Handlebars.VM.template})();(function(){if("undefined"===typeof Ember){Ember={};if("undefined"!==typeof window){window.Em=window.Ember=Em=Ember}}Ember.isNamespace=true;Ember.toString=function(){return"Ember"};Ember.VERSION="0.9.8.1";Ember.ENV="undefined"===typeof ENV?{}:ENV;Ember.EXTEND_PROTOTYPES=(Ember.ENV.EXTEND_PROTOTYPES!==false);Ember.SHIM_ES5=(Ember.ENV.SHIM_ES5===false)?false:Ember.EXTEND_PROTOTYPES;Ember.CP_DEFAULT_CACHEABLE=!!Ember.ENV.CP_DEFAULT_CACHEABLE;Ember.VIEW_PRESERVES_CONTEXT=!!Ember.ENV.VIEW_PRESERVES_CONTEXT;Ember.K=function(){return this};if("undefined"===typeof Ember.assert){Ember.assert=Ember.K}if("undefined"===typeof Ember.warn){Ember.warn=Ember.K}if("undefined"===typeof Ember.deprecate){Ember.deprecate=Ember.K}if("undefined"===typeof Ember.deprecateFunc){Ember.deprecateFunc=function(_,func){return func}}if("undefined"===typeof ember_assert){window.ember_assert=Ember.K}if("undefined"===typeof ember_warn){window.ember_warn=Ember.K}if("undefined"===typeof ember_deprecate){window.ember_deprecate=Ember.K}if("undefined"===typeof ember_deprecateFunc){window.ember_deprecateFunc=function(_,func){return func}}Ember.Logger=window.console||{log:Ember.K,warn:Ember.K,error:Ember.K}})();(function(){var platform=Ember.platform={};platform.create=Object.create;if(!platform.create){var O_ctor=function(){},O_proto=O_ctor.prototype;platform.create=function(obj,descs){O_ctor.prototype=obj;obj=new O_ctor();O_ctor.prototype=O_proto;if(descs!==undefined){for(var key in descs){if(!descs.hasOwnProperty(key)){continue}platform.defineProperty(obj,key,descs[key])}}return obj};platform.create.isSimulated=true}var defineProperty=Object.defineProperty;var canRedefineProperties,canDefinePropertyOnDOM;if(defineProperty){try{defineProperty({},"a",{get:function(){}})}catch(e){defineProperty=null}}if(defineProperty){canRedefineProperties=(function(){var obj={};defineProperty(obj,"a",{configurable:true,enumerable:true,get:function(){},set:function(){}});defineProperty(obj,"a",{configurable:true,enumerable:true,writable:true,value:true});return obj.a===true})();canDefinePropertyOnDOM=(function(){try{defineProperty(document.createElement("div"),"definePropertyOnDOM",{});return true}catch(e){}return false})();if(!canRedefineProperties){defineProperty=null}else{if(!canDefinePropertyOnDOM){defineProperty=function(obj,keyName,desc){var isNode;if(typeof Node==="object"){isNode=obj instanceof Node}else{isNode=typeof obj==="object"&&typeof obj.nodeType==="number"&&typeof obj.nodeName==="string"}if(isNode){return(obj[keyName]=desc.value)}else{return Object.defineProperty(obj,keyName,desc)}}}}}platform.defineProperty=defineProperty;platform.hasPropertyAccessors=true;if(!platform.defineProperty){platform.hasPropertyAccessors=false;platform.defineProperty=function(obj,keyName,desc){Ember.assert("property descriptor cannot have `get` or `set` on this platform",!desc.get&&!desc.set);obj[keyName]=desc.value};platform.defineProperty.isSimulated=true}})();(function(){var GUID_KEY="__ember"+(+new Date());var uuid,numberCache,stringCache;uuid=0;numberCache=[];stringCache={};var GUID_DESC=Ember.GUID_DESC={configurable:true,writable:true,enumerable:false};var o_defineProperty=Ember.platform.defineProperty;var o_create=Ember.platform.create;Ember.GUID_KEY=GUID_KEY;Ember.generateGuid=function(obj,prefix){if(!prefix){prefix="ember"}var ret=(prefix+(uuid++));if(obj){GUID_DESC.value=ret;o_defineProperty(obj,GUID_KEY,GUID_DESC);GUID_DESC.value=null}return ret};Ember.guidFor=function(obj){if(obj===undefined){return"(undefined)"}if(obj===null){return"(null)"}var cache,ret;var type=typeof obj;switch(type){case"number":ret=numberCache[obj];if(!ret){ret=numberCache[obj]="nu"+obj}return ret;case"string":ret=stringCache[obj];if(!ret){ret=stringCache[obj]="st"+(uuid++)}return ret;case"boolean":return obj?"(true)":"(false)";default:if(obj[GUID_KEY]){return obj[GUID_KEY]}if(obj===Object){return"(Object)"}if(obj===Array){return"(Array)"}return Ember.generateGuid(obj,"ember")}};var META_DESC={writable:true,configurable:false,enumerable:false,value:null};var META_KEY=Ember.GUID_KEY+"_meta";Ember.META_KEY=META_KEY;var EMPTY_META={descs:{},watching:{}};if(Object.freeze){Object.freeze(EMPTY_META)}var createMeta=Ember.platform.defineProperty.isSimulated?o_create:(function(meta){return meta});Ember.meta=function meta(obj,writable){var ret=obj[META_KEY];if(writable===false){return ret||EMPTY_META}if(!ret){o_defineProperty(obj,META_KEY,META_DESC);ret=obj[META_KEY]=createMeta({descs:{},watching:{},values:{},lastSetValues:{},cache:{},source:obj});ret.descs.constructor=null}else{if(ret.source!==obj){ret=o_create(ret);ret.descs=o_create(ret.descs);ret.values=o_create(ret.values);ret.watching=o_create(ret.watching);ret.lastSetValues={};ret.cache={};ret.source=obj;o_defineProperty(obj,META_KEY,META_DESC);ret=obj[META_KEY]=createMeta(ret)}}return ret};Ember.getMeta=function getMeta(obj,property){var meta=Ember.meta(obj,false);return meta[property]};Ember.setMeta=function setMeta(obj,property,value){var meta=Ember.meta(obj,true);meta[property]=value;return value};Ember.metaPath=function(obj,path,writable){var meta=Ember.meta(obj,writable),keyName,value;for(var i=0,l=path.length;i<l;i++){keyName=path[i];value=meta[keyName];if(!value){if(!writable){return undefined}value=meta[keyName]={__ember_source__:obj}}else{if(value.__ember_source__!==obj){if(!writable){return undefined}value=meta[keyName]=o_create(value);value.__ember_source__=obj}}meta=value}return value};Ember.wrap=function(func,superFunc){function K(){}var newFunc=function(){var ret,sup=this._super;this._super=superFunc||K;ret=func.apply(this,arguments);this._super=sup;return ret};newFunc.base=func;return newFunc};Ember.isArray=function(obj){if(!obj||obj.setInterval){return false}if(Array.isArray&&Array.isArray(obj)){return true}if(Ember.Array&&Ember.Array.detect(obj)){return true}if((obj.length!==undefined)&&"object"===typeof obj){return true}return false};Ember.makeArray=function(obj){if(obj===null||obj===undefined){return[]}return Ember.isArray(obj)?obj:[obj]}})();(function(){var USE_ACCESSORS=Ember.platform.hasPropertyAccessors&&Ember.ENV.USE_ACCESSORS;Ember.USE_ACCESSORS=!!USE_ACCESSORS;var meta=Ember.meta;var get,set;get=function get(obj,keyName){if(keyName===undefined&&"string"===typeof obj){keyName=obj;obj=Ember}if(!obj){return undefined}var ret=obj[keyName];if(ret===undefined&&"function"===typeof obj.unknownProperty){ret=obj.unknownProperty(keyName)}return ret};set=function set(obj,keyName,value){if(("object"===typeof obj)&&!(keyName in obj)){if("function"===typeof obj.setUnknownProperty){obj.setUnknownProperty(keyName,value)}else{if("function"===typeof obj.unknownProperty){obj.unknownProperty(keyName,value)}else{obj[keyName]=value}}}else{obj[keyName]=value}return value};if(!USE_ACCESSORS){var o_get=get,o_set=set;get=function(obj,keyName){if(keyName===undefined&&"string"===typeof obj){keyName=obj;obj=Ember}Ember.assert("You need to provide an object and key to `get`.",!!obj&&keyName);if(!obj){return undefined}var desc=meta(obj,false).descs[keyName];if(desc){return desc.get(obj,keyName)}else{return o_get(obj,keyName)}};set=function(obj,keyName,value){Ember.assert("You need to provide an object and key to `set`.",!!obj&&keyName!==undefined);var desc=meta(obj,false).descs[keyName];if(desc){desc.set(obj,keyName,value)}else{o_set(obj,keyName,value)}return value}}Ember.get=get;Ember.set=set;function cleanupStars(path){if(path.indexOf("*")===-1||path==="*"){return path}Ember.deprecate("Star paths are now treated the same as normal paths",!/(^|[^\.])\*/.test(path));return path.replace(/(^|.)\*/,function(match,character){return(character===".")?match:(character+".")})}function normalizePath(path){Ember.assert("must pass non-empty string to normalizePath()",path&&path!=="");path=cleanupStars(path);if(path==="*"){return path}var first=path.charAt(0);if(first==="."){return"this"+path}return path}function getPath(target,path){var len=path.length,idx,next,key;path=cleanupStars(path);idx=0;while(target&&idx<len){next=path.indexOf(".",idx);if(next<0){next=len}key=path.slice(idx,next);target=key==="*"?target:get(target,key);if(target&&target.isDestroyed){return undefined}idx=next+1}return target}var TUPLE_RET=[];var IS_GLOBAL=/^([A-Z$]|([0-9][A-Z$]))/;var IS_GLOBAL_PATH=/^([A-Z$]|([0-9][A-Z$])).*[\.\*]/;var HAS_THIS=/^this[\.\*]/;var FIRST_KEY=/^([^\.\*]+)/;function firstKey(path){return path.match(FIRST_KEY)[0]}function normalizeTuple(target,path){var hasThis=HAS_THIS.test(path),isGlobal=!hasThis&&IS_GLOBAL_PATH.test(path),key;if(!target||isGlobal){target=window}if(hasThis){path=path.slice(5)}path=cleanupStars(path);if(target===window){key=firstKey(path);target=get(target,key);path=path.slice(key.length+1)}if(!path||path.length===0){throw new Error("Invalid Path")}TUPLE_RET[0]=target;TUPLE_RET[1]=path;return TUPLE_RET}Ember.normalizePath=normalizePath;Ember.normalizeTuple=function(target,path){return normalizeTuple(target,normalizePath(path))};Ember.normalizeTuple.primitive=normalizeTuple;Ember.getWithDefault=function(root,key,defaultValue){var value=Ember.get(root,key);if(value===undefined){return defaultValue}return value};Ember.getPath=function(root,path){var hasThis,isGlobal,ret;if(path===""){return root}if(!path&&"string"===typeof root){path=root;root=null}path=cleanupStars(path);if(root===null&&path.indexOf(".")<0){return get(window,path)}path=normalizePath(path);hasThis=HAS_THIS.test(path);if(!root||hasThis){var tuple=normalizeTuple(root,path);root=tuple[0];path=tuple[1];tuple.length=0}return getPath(root,path)};Ember.setPath=function(root,path,value,tolerant){var keyName;if(arguments.length===2&&"string"===typeof root){value=path;path=root;root=null}path=normalizePath(path);if(path.indexOf(".")>0){keyName=path.slice(path.lastIndexOf(".")+1);path=path.slice(0,path.length-(keyName.length+1));if(path!=="this"){root=Ember.getPath(root,path)}}else{if(IS_GLOBAL.test(path)){throw new Error("Invalid Path")}keyName=path}if(!keyName||keyName.length===0||keyName==="*"){throw new Error("Invalid Path")}if(!root){if(tolerant){return}else{throw new Error("Object in path "+path+" could not be found or was destroyed.")}}return Ember.set(root,keyName,value)};Ember.trySetPath=function(root,path,value){if(arguments.length===2&&"string"===typeof root){value=path;path=root;root=null}return Ember.setPath(root,path,value,true)};Ember.isGlobalPath=function(path){return !HAS_THIS.test(path)&&IS_GLOBAL.test(path)}})();(function(){var USE_ACCESSORS=Ember.USE_ACCESSORS;var GUID_KEY=Ember.GUID_KEY;var META_KEY=Ember.META_KEY;var meta=Ember.meta;var o_create=Ember.platform.create;var o_defineProperty=Ember.platform.defineProperty;var SIMPLE_PROPERTY,WATCHED_PROPERTY;var SIMPLE_DESC={writable:true,configurable:true,enumerable:true,value:null};var Dc=Ember.Descriptor=function(){};var setup=Dc.setup=function(obj,keyName,value){SIMPLE_DESC.value=value;o_defineProperty(obj,keyName,SIMPLE_DESC);SIMPLE_DESC.value=null};var Dp=Ember.Descriptor.prototype;Dp.set=function(obj,keyName,value){obj[keyName]=value;return value};Dp.get=function(obj,keyName){return w_get(obj,keyName,obj)};Dp.setup=setup;Dp.teardown=function(obj,keyName){return obj[keyName]};Dp.val=function(obj,keyName){return obj[keyName]};if(!USE_ACCESSORS){Ember.Descriptor.MUST_USE_GETTER=function(){if(this instanceof Ember.Object){Ember.assert("Must use Ember.get() to access this property",false)}};Ember.Descriptor.MUST_USE_SETTER=function(){if(this instanceof Ember.Object){if(this.isDestroyed){Ember.assert("You cannot set observed properties on destroyed objects",false)}else{Ember.assert("Must use Ember.set() to access this property",false)}}}}var WATCHED_DESC={configurable:true,enumerable:true,set:Ember.Descriptor.MUST_USE_SETTER};function w_get(obj,keyName,values){values=values||meta(obj,false).values;if(values){var ret=values[keyName];if(ret!==undefined){return ret}if(obj.unknownProperty){return obj.unknownProperty(keyName)}}}function w_set(obj,keyName,value){var m=meta(obj),watching;watching=m.watching[keyName]>0&&value!==m.values[keyName];if(watching){Ember.propertyWillChange(obj,keyName)}m.values[keyName]=value;if(watching){Ember.propertyDidChange(obj,keyName)}return value}var WATCHED_GETTERS={};function mkWatchedGetter(keyName){var ret=WATCHED_GETTERS[keyName];if(!ret){ret=WATCHED_GETTERS[keyName]=function(){return w_get(this,keyName)}}return ret}var WATCHED_SETTERS={};function mkWatchedSetter(keyName){var ret=WATCHED_SETTERS[keyName];if(!ret){ret=WATCHED_SETTERS[keyName]=function(value){return w_set(this,keyName,value)}}return ret}WATCHED_PROPERTY=new Ember.Descriptor();if(Ember.platform.hasPropertyAccessors){WATCHED_PROPERTY.get=w_get;WATCHED_PROPERTY.set=w_set;if(USE_ACCESSORS){WATCHED_PROPERTY.setup=function(obj,keyName,value){WATCHED_DESC.get=mkWatchedGetter(keyName);WATCHED_DESC.set=mkWatchedSetter(keyName);o_defineProperty(obj,keyName,WATCHED_DESC);WATCHED_DESC.get=WATCHED_DESC.set=null;if(value!==undefined){meta(obj).values[keyName]=value}}}else{WATCHED_PROPERTY.setup=function(obj,keyName,value){WATCHED_DESC.get=mkWatchedGetter(keyName);o_defineProperty(obj,keyName,WATCHED_DESC);WATCHED_DESC.get=null;if(value!==undefined){meta(obj).values[keyName]=value}}}WATCHED_PROPERTY.teardown=function(obj,keyName){var ret=meta(obj).values[keyName];delete meta(obj).values[keyName];return ret}}else{WATCHED_PROPERTY.set=function(obj,keyName,value){var m=meta(obj),watching;watching=m.watching[keyName]>0&&value!==obj[keyName];if(watching){Ember.propertyWillChange(obj,keyName)}obj[keyName]=value;if(watching){Ember.propertyDidChange(obj,keyName)}return value}}Ember.SIMPLE_PROPERTY=new Ember.Descriptor();SIMPLE_PROPERTY=Ember.SIMPLE_PROPERTY;SIMPLE_PROPERTY.unwatched=WATCHED_PROPERTY.unwatched=SIMPLE_PROPERTY;SIMPLE_PROPERTY.watched=WATCHED_PROPERTY.watched=WATCHED_PROPERTY;function hasDesc(descs,keyName){if(keyName==="toString"){return"function"!==typeof descs.toString}else{return !!descs[keyName]}}Ember.defineProperty=function(obj,keyName,desc,val){var m=meta(obj,false),descs=m.descs,watching=m.watching[keyName]>0,override=true;if(val===undefined){override=false;val=hasDesc(descs,keyName)?descs[keyName].teardown(obj,keyName):obj[keyName]}else{if(hasDesc(descs,keyName)){descs[keyName].teardown(obj,keyName)}}if(!desc){desc=SIMPLE_PROPERTY}if(desc instanceof Ember.Descriptor){m=meta(obj,true);descs=m.descs;desc=(watching?desc.watched:desc.unwatched)||desc;descs[keyName]=desc;desc.setup(obj,keyName,val,watching)}else{if(descs[keyName]){meta(obj).descs[keyName]=null}o_defineProperty(obj,keyName,desc)}if(override&&watching){Ember.overrideChains(obj,keyName,m)}return this};Ember.create=function(obj,props){var ret=o_create(obj,props);if(GUID_KEY in ret){Ember.generateGuid(ret,"ember")}if(META_KEY in ret){Ember.rewatch(ret)}return ret};Ember.createPrototype=function(obj,props){var ret=o_create(obj,props);meta(ret,true).proto=ret;if(GUID_KEY in ret){Ember.generateGuid(ret,"ember")}if(META_KEY in ret){Ember.rewatch(ret)}return ret}})();(function(){Ember.warn("Computed properties will soon be cacheable by default. To enable this in your app, set `ENV.CP_DEFAULT_CACHEABLE = true`.",Ember.CP_DEFAULT_CACHEABLE);var meta=Ember.meta;var guidFor=Ember.guidFor;var USE_ACCESSORS=Ember.USE_ACCESSORS;var a_slice=Array.prototype.slice;var o_create=Ember.platform.create;var o_defineProperty=Ember.platform.defineProperty;function uniqDeps(obj,depKey){var m=meta(obj),deps,ret;deps=m.deps;if(!deps){deps=m.deps={__emberproto__:obj}}else{if(deps.__emberproto__!==obj){deps=m.deps=o_create(deps);deps.__emberproto__=obj}}ret=deps[depKey];if(!ret){ret=deps[depKey]={__emberproto__:obj}}else{if(ret.__emberproto__!==obj){ret=deps[depKey]=o_create(ret);ret.__emberproto__=obj}}return ret}function addDependentKey(obj,keyName,depKey){var deps=uniqDeps(obj,depKey);deps[keyName]=(deps[keyName]||0)+1;Ember.watch(obj,depKey)}function removeDependentKey(obj,keyName,depKey){var deps=uniqDeps(obj,depKey);deps[keyName]=(deps[keyName]||0)-1;Ember.unwatch(obj,depKey)}function addDependentKeys(desc,obj,keyName){var keys=desc._dependentKeys,len=keys?keys.length:0;for(var idx=0;idx<len;idx++){addDependentKey(obj,keyName,keys[idx])}}function ComputedProperty(func,opts){this.func=func;this._cacheable=(opts&&opts.cacheable!==undefined)?opts.cacheable:Ember.CP_DEFAULT_CACHEABLE;this._dependentKeys=opts&&opts.dependentKeys}Ember.ComputedProperty=ComputedProperty;ComputedProperty.prototype=new Ember.Descriptor();var CP_DESC={configurable:true,enumerable:true,get:function(){return undefined},set:Ember.Descriptor.MUST_USE_SETTER};function mkCpGetter(keyName,desc){var cacheable=desc._cacheable,func=desc.func;if(cacheable){return function(){var ret,cache=meta(this).cache;if(keyName in cache){return cache[keyName]}ret=cache[keyName]=func.call(this,keyName);return ret}}else{return function(){return func.call(this,keyName)}}}function mkCpSetter(keyName,desc){var cacheable=desc._cacheable,func=desc.func;return function(value){var m=meta(this,cacheable),watched=(m.source===this)&&m.watching[keyName]>0,ret,oldSuspended,lastSetValues;oldSuspended=desc._suspended;desc._suspended=this;watched=watched&&m.lastSetValues[keyName]!==guidFor(value);if(watched){m.lastSetValues[keyName]=guidFor(value);Ember.propertyWillChange(this,keyName)}if(cacheable){delete m.cache[keyName]}ret=func.call(this,keyName,value);if(cacheable){m.cache[keyName]=ret}if(watched){Ember.propertyDidChange(this,keyName)}desc._suspended=oldSuspended;return ret}}var Cp=ComputedProperty.prototype;Cp.cacheable=function(aFlag){this._cacheable=aFlag!==false;return this};Cp.uncached=function(){return this.cacheable(false)};Cp.property=function(){this._dependentKeys=a_slice.call(arguments);return this};Cp.meta=function(meta){this._meta=meta;return this};Cp.setup=function(obj,keyName,value){CP_DESC.get=mkCpGetter(keyName,this);CP_DESC.set=mkCpSetter(keyName,this);o_defineProperty(obj,keyName,CP_DESC);CP_DESC.get=CP_DESC.set=null;addDependentKeys(this,obj,keyName)};Cp.teardown=function(obj,keyName){var keys=this._dependentKeys,len=keys?keys.length:0;for(var idx=0;idx<len;idx++){removeDependentKey(obj,keyName,keys[idx])}if(this._cacheable){delete meta(obj).cache[keyName]}return null};Cp.didChange=function(obj,keyName){if(this._cacheable&&(this._suspended!==obj)){delete meta(obj).cache[keyName]}};Cp.get=function(obj,keyName){var ret,cache;if(this._cacheable){cache=meta(obj).cache;if(keyName in cache){return cache[keyName]}ret=cache[keyName]=this.func.call(obj,keyName)}else{ret=this.func.call(obj,keyName)}return ret};Cp.set=function(obj,keyName,value){var cacheable=this._cacheable;var m=meta(obj,cacheable),watched=(m.source===obj)&&m.watching[keyName]>0,ret,oldSuspended,lastSetValues;oldSuspended=this._suspended;this._suspended=obj;watched=watched&&m.lastSetValues[keyName]!==guidFor(value);if(watched){m.lastSetValues[keyName]=guidFor(value);Ember.propertyWillChange(obj,keyName)}if(cacheable){delete m.cache[keyName]}ret=this.func.call(obj,keyName,value);if(cacheable){m.cache[keyName]=ret}if(watched){Ember.propertyDidChange(obj,keyName)}this._suspended=oldSuspended;return ret};Cp.val=function(obj,keyName){return meta(obj,false).values[keyName]};if(!Ember.platform.hasPropertyAccessors){Cp.setup=function(obj,keyName,value){obj[keyName]=undefined;addDependentKeys(this,obj,keyName)}}else{if(!USE_ACCESSORS){Cp.setup=function(obj,keyName){o_defineProperty(obj,keyName,CP_DESC);addDependentKeys(this,obj,keyName)}}}Ember.computed=function(func){var args;if(arguments.length>1){args=a_slice.call(arguments,0,-1);func=a_slice.call(arguments,-1)[0]}var cp=new ComputedProperty(func);if(args){cp.property.apply(cp,args)}return cp};Ember.cacheFor=function(obj,key){var cache=meta(obj,false).cache;if(cache&&key in cache){return cache[key]}}})();(function(){var isNativeFunc=function(func){return func&&Function.prototype.toString.call(func).indexOf("[native code]")>-1};var arrayMap=isNativeFunc(Array.prototype.map)?Array.prototype.map:function(fun){if(this===void 0||this===null){throw new TypeError()}var t=Object(this);var len=t.length>>>0;if(typeof fun!=="function"){throw new TypeError()}var res=new Array(len);var thisp=arguments[1];for(var i=0;i<len;i++){if(i in t){res[i]=fun.call(thisp,t[i],i,t)}}return res};var arrayForEach=isNativeFunc(Array.prototype.forEach)?Array.prototype.forEach:function(fun){if(this===void 0||this===null){throw new TypeError()}var t=Object(this);var len=t.length>>>0;if(typeof fun!=="function"){throw new TypeError()}var thisp=arguments[1];for(var i=0;i<len;i++){if(i in t){fun.call(thisp,t[i],i,t)}}};var arrayIndexOf=isNativeFunc(Array.prototype.indexOf)?Array.prototype.indexOf:function(obj,fromIndex){if(fromIndex===null||fromIndex===undefined){fromIndex=0}else{if(fromIndex<0){fromIndex=Math.max(0,this.length+fromIndex)}}for(var i=fromIndex,j=this.length;i<j;i++){if(this[i]===obj){return i}}return -1};Ember.ArrayUtils={map:function(obj){var args=Array.prototype.slice.call(arguments,1);return obj.map?obj.map.apply(obj,args):arrayMap.apply(obj,args)},forEach:function(obj){var args=Array.prototype.slice.call(arguments,1);return obj.forEach?obj.forEach.apply(obj,args):arrayForEach.apply(obj,args)},indexOf:function(obj){var args=Array.prototype.slice.call(arguments,1);return obj.indexOf?obj.indexOf.apply(obj,args):arrayIndexOf.apply(obj,args)},indexesOf:function(obj){var args=Array.prototype.slice.call(arguments,1);return args[0]===undefined?[]:Ember.ArrayUtils.map(args[0],function(item){return Ember.ArrayUtils.indexOf(obj,item)})},removeObject:function(array,item){var index=this.indexOf(array,item);if(index!==-1){array.splice(index,1)}}};if(Ember.SHIM_ES5){if(!Array.prototype.map){Array.prototype.map=arrayMap}if(!Array.prototype.forEach){Array.prototype.forEach=arrayForEach}if(!Array.prototype.indexOf){Array.prototype.indexOf=arrayIndexOf}}})();(function(){var AFTER_OBSERVERS=":change";var BEFORE_OBSERVERS=":before";var guidFor=Ember.guidFor;var normalizePath=Ember.normalizePath;var deferred=0;var array_Slice=Array.prototype.slice;var array_ForEach=Ember.ArrayUtils.forEach;var ObserverSet=function(){this.targetSet={}};ObserverSet.prototype.add=function(target,path){var targetSet=this.targetSet,targetGuid=Ember.guidFor(target),pathSet=targetSet[targetGuid];if(!pathSet){targetSet[targetGuid]=pathSet={}}if(pathSet[path]){return false}else{return pathSet[path]=true}};ObserverSet.prototype.clear=function(){this.targetSet={}};var DeferredEventQueue=function(){this.targetSet={};this.queue=[]};DeferredEventQueue.prototype.push=function(target,eventName){var targetSet=this.targetSet,queue=this.queue,targetGuid=Ember.guidFor(target),eventNameSet=targetSet[targetGuid],index;if(!eventNameSet){targetSet[targetGuid]=eventNameSet={}}index=eventNameSet[eventName];if(index===undefined){eventNameSet[eventName]=queue.push(Ember.deferEvent(target,eventName))-1}else{queue[index]=Ember.deferEvent(target,eventName)}};DeferredEventQueue.prototype.flush=function(){var queue=this.queue;this.queue=[];this.targetSet={};for(var i=0,len=queue.length;i<len;++i){queue[i]()}};var queue=new DeferredEventQueue(),beforeObserverSet=new ObserverSet();function notifyObservers(obj,eventName,forceNotification){if(deferred&&!forceNotification){queue.push(obj,eventName)}else{Ember.sendEvent(obj,eventName)}}function flushObserverQueue(){beforeObserverSet.clear();queue.flush()}Ember.beginPropertyChanges=function(){deferred++;return this};Ember.endPropertyChanges=function(){deferred--;if(deferred<=0){flushObserverQueue()}};Ember.changeProperties=function(cb,binding){Ember.beginPropertyChanges();try{cb.call(binding)}finally{Ember.endPropertyChanges()}};Ember.setProperties=function(self,hash){Ember.changeProperties(function(){for(var prop in hash){if(hash.hasOwnProperty(prop)){Ember.set(self,prop,hash[prop])}}});return self};function changeEvent(keyName){return keyName+AFTER_OBSERVERS}function beforeEvent(keyName){return keyName+BEFORE_OBSERVERS}function changeKey(eventName){return eventName.slice(0,-7)}function beforeKey(eventName){return eventName.slice(0,-7)}function xformForArgs(args){return function(target,method,params){var obj=params[0],keyName=changeKey(params[1]),val;var copy_args=args.slice();if(method.length>2){val=Ember.getPath(Ember.isGlobalPath(keyName)?window:obj,keyName)}copy_args.unshift(obj,keyName,val);method.apply(target,copy_args)}}var xformChange=xformForArgs([]);function xformBefore(target,method,params){var obj=params[0],keyName=beforeKey(params[1]),val;if(method.length>2){val=Ember.getPath(obj,keyName)}method.call(target,obj,keyName,val)}Ember.addObserver=function(obj,path,target,method){path=normalizePath(path);var xform;if(arguments.length>4){var args=array_Slice.call(arguments,4);xform=xformForArgs(args)}else{xform=xformChange}Ember.addListener(obj,changeEvent(path),target,method,xform);Ember.watch(obj,path);return this};Ember.observersFor=function(obj,path){return Ember.listenersFor(obj,changeEvent(path))};Ember.removeObserver=function(obj,path,target,method){path=normalizePath(path);Ember.unwatch(obj,path);Ember.removeListener(obj,changeEvent(path),target,method);return this};Ember.addBeforeObserver=function(obj,path,target,method){path=normalizePath(path);Ember.addListener(obj,beforeEvent(path),target,method,xformBefore);Ember.watch(obj,path);return this};Ember._suspendObserver=function(obj,path,target,method,callback){return Ember._suspendListener(obj,changeEvent(path),target,method,callback)};Ember.beforeObserversFor=function(obj,path){return Ember.listenersFor(obj,beforeEvent(path))};Ember.removeBeforeObserver=function(obj,path,target,method){path=normalizePath(path);Ember.unwatch(obj,path);Ember.removeListener(obj,beforeEvent(path),target,method);return this};Ember.notifyObservers=function(obj,keyName){if(obj.isDestroying){return}notifyObservers(obj,changeEvent(keyName))};Ember.notifyBeforeObservers=function(obj,keyName){if(obj.isDestroying){return}var guid,set,forceNotification=false;if(deferred){if(beforeObserverSet.add(obj,keyName)){forceNotification=true}else{return}}notifyObservers(obj,beforeEvent(keyName),forceNotification)}})();(function(){var guidFor=Ember.guidFor;var meta=Ember.meta;var get=Ember.get,set=Ember.set;var normalizeTuple=Ember.normalizeTuple.primitive;var normalizePath=Ember.normalizePath;var SIMPLE_PROPERTY=Ember.SIMPLE_PROPERTY;var GUID_KEY=Ember.GUID_KEY;var META_KEY=Ember.META_KEY;var notifyObservers=Ember.notifyObservers;var forEach=Ember.ArrayUtils.forEach;var FIRST_KEY=/^([^\.\*]+)/;var IS_PATH=/[\.\*]/;function firstKey(path){return path.match(FIRST_KEY)[0]}function isKeyName(path){return path==="*"||!IS_PATH.test(path)}var DEP_SKIP={__emberproto__:true};function iterDeps(method,obj,depKey,seen,meta){var guid=guidFor(obj);if(!seen[guid]){seen[guid]={}}if(seen[guid][depKey]){return}seen[guid][depKey]=true;var deps=meta.deps;deps=deps&&deps[depKey];if(deps){for(var key in deps){if(DEP_SKIP[key]){continue}method(obj,key)}}}var WILL_SEEN,DID_SEEN;function dependentKeysWillChange(obj,depKey,meta){if(obj.isDestroying){return}var seen=WILL_SEEN,top=!seen;if(top){seen=WILL_SEEN={}}iterDeps(propertyWillChange,obj,depKey,seen,meta);if(top){WILL_SEEN=null}}function dependentKeysDidChange(obj,depKey,meta){if(obj.isDestroying){return}var seen=DID_SEEN,top=!seen;if(top){seen=DID_SEEN={}}iterDeps(propertyDidChange,obj,depKey,seen,meta);if(top){DID_SEEN=null}}function addChainWatcher(obj,keyName,node){if(!obj||("object"!==typeof obj)){return}var m=meta(obj);var nodes=m.chainWatchers;if(!nodes||nodes.__emberproto__!==obj){nodes=m.chainWatchers={__emberproto__:obj}}if(!nodes[keyName]){nodes[keyName]={}}nodes[keyName][guidFor(node)]=node;Ember.watch(obj,keyName)}function removeChainWatcher(obj,keyName,node){if(!obj||("object"!==typeof obj)){return}var m=meta(obj,false);var nodes=m.chainWatchers;if(!nodes||nodes.__emberproto__!==obj){return}if(nodes[keyName]){delete nodes[keyName][guidFor(node)]}Ember.unwatch(obj,keyName)}var pendingQueue=[];function flushPendingChains(){if(pendingQueue.length===0){return}var queue=pendingQueue;pendingQueue=[];forEach(queue,function(q){q[0].add(q[1])});Ember.warn("Watching an undefined global, Ember expects watched globals to be setup by the time the run loop is flushed, check for typos",pendingQueue.length>0)}function isProto(pvalue){return meta(pvalue,false).proto===pvalue}var ChainNode=function(parent,key,value,separator){var obj;this._parent=parent;this._key=key;this._watching=value===undefined;this._value=value;this._separator=separator||".";this._paths={};if(this._watching){this._object=parent.value();if(this._object){addChainWatcher(this._object,this._key,this)}}if(this._parent&&this._parent._key==="@each"){this.value()}};var Wp=ChainNode.prototype;Wp.value=function(){if(this._value===undefined&&this._watching){var obj=this._parent.value();this._value=(obj&&!isProto(obj))?get(obj,this._key):undefined}return this._value};Wp.destroy=function(){if(this._watching){var obj=this._object;if(obj){removeChainWatcher(obj,this._key,this)}this._watching=false}};Wp.copy=function(obj){var ret=new ChainNode(null,null,obj,this._separator);var paths=this._paths,path;for(path in paths){if(paths[path]<=0){continue}ret.add(path)}return ret};Wp.add=function(path){var obj,tuple,key,src,separator,paths;paths=this._paths;paths[path]=(paths[path]||0)+1;obj=this.value();tuple=normalizeTuple(obj,path);if(tuple[0]&&(tuple[0]===obj)){path=tuple[1];key=firstKey(path);path=path.slice(key.length+1)}else{if(!tuple[0]){pendingQueue.push([this,path]);tuple.length=0;return}else{src=tuple[0];key=path.slice(0,0-(tuple[1].length+1));separator=path.slice(key.length,key.length+1);path=tuple[1]}}tuple.length=0;this.chain(key,path,src,separator)};Wp.remove=function(path){var obj,tuple,key,src,paths;paths=this._paths;if(paths[path]>0){paths[path]--}obj=this.value();tuple=normalizeTuple(obj,path);if(tuple[0]===obj){path=tuple[1];key=firstKey(path);path=path.slice(key.length+1)}else{src=tuple[0];key=path.slice(0,0-(tuple[1].length+1));path=tuple[1]}tuple.length=0;this.unchain(key,path)};Wp.count=0;Wp.chain=function(key,path,src,separator){var chains=this._chains,node;if(!chains){chains=this._chains={}}node=chains[key];if(!node){node=chains[key]=new ChainNode(this,key,src,separator)}node.count++;if(path&&path.length>0){key=firstKey(path);path=path.slice(key.length+1);node.chain(key,path)}};Wp.unchain=function(key,path){var chains=this._chains,node=chains[key];if(path&&path.length>1){key=firstKey(path);path=path.slice(key.length+1);node.unchain(key,path)}node.count--;if(node.count<=0){delete chains[node._key];node.destroy()}};Wp.willChange=function(){var chains=this._chains;if(chains){for(var key in chains){if(!chains.hasOwnProperty(key)){continue}chains[key].willChange()}}if(this._parent){this._parent.chainWillChange(this,this._key,1)}};Wp.chainWillChange=function(chain,path,depth){if(this._key){path=this._key+this._separator+path}if(this._parent){this._parent.chainWillChange(this,path,depth+1)}else{if(depth>1){Ember.propertyWillChange(this.value(),path)}path="this."+path;if(this._paths[path]>0){Ember.propertyWillChange(this.value(),path)}}};Wp.chainDidChange=function(chain,path,depth){if(this._key){path=this._key+this._separator+path}if(this._parent){this._parent.chainDidChange(this,path,depth+1)}else{if(depth>1){Ember.propertyDidChange(this.value(),path)}path="this."+path;if(this._paths[path]>0){Ember.propertyDidChange(this.value(),path)}}};Wp.didChange=function(suppressEvent){if(this._watching){var obj=this._parent.value();if(obj!==this._object){removeChainWatcher(this._object,this._key,this);this._object=obj;addChainWatcher(obj,this._key,this)}this._value=undefined;if(this._parent&&this._parent._key==="@each"){this.value()}}var chains=this._chains;if(chains){for(var key in chains){if(!chains.hasOwnProperty(key)){continue}chains[key].didChange(suppressEvent)}}if(suppressEvent){return}if(this._parent){this._parent.chainDidChange(this,this._key,1)}};function chainsFor(obj){var m=meta(obj),ret=m.chains;if(!ret){ret=m.chains=new ChainNode(null,null,obj)}else{if(ret.value()!==obj){ret=m.chains=ret.copy(obj)}}return ret}function notifyChains(obj,m,keyName,methodName,arg){var nodes=m.chainWatchers;if(!nodes||nodes.__emberproto__!==obj){return}nodes=nodes[keyName];if(!nodes){return}for(var key in nodes){if(!nodes.hasOwnProperty(key)){continue}nodes[key][methodName](arg)}}Ember.overrideChains=function(obj,keyName,m){notifyChains(obj,m,keyName,"didChange",true)};function chainsWillChange(obj,keyName,m){notifyChains(obj,m,keyName,"willChange")}function chainsDidChange(obj,keyName,m){notifyChains(obj,m,keyName,"didChange")}var WATCHED_PROPERTY=Ember.SIMPLE_PROPERTY.watched;Ember.watch=function(obj,keyName){if(keyName==="length"&&Ember.typeOf(obj)==="array"){return this}var m=meta(obj),watching=m.watching,desc;keyName=normalizePath(keyName);if(!watching[keyName]){watching[keyName]=1;if(isKeyName(keyName)){desc=m.descs[keyName];desc=desc?desc.watched:WATCHED_PROPERTY;if(desc){Ember.defineProperty(obj,keyName,desc)}}else{chainsFor(obj).add(keyName)}}else{watching[keyName]=(watching[keyName]||0)+1}return this};Ember.isWatching=function(obj,keyName){return !!meta(obj).watching[keyName]};Ember.watch.flushPending=flushPendingChains;Ember.unwatch=function(obj,keyName){if(keyName==="length"&&Ember.typeOf(obj)==="array"){return this}var watching=meta(obj).watching,desc,descs;keyName=normalizePath(keyName);if(watching[keyName]===1){watching[keyName]=0;if(isKeyName(keyName)){desc=meta(obj).descs[keyName];desc=desc?desc.unwatched:SIMPLE_PROPERTY;if(desc){Ember.defineProperty(obj,keyName,desc)}}else{chainsFor(obj).remove(keyName)}}else{if(watching[keyName]>1){watching[keyName]--}}return this};Ember.rewatch=function(obj){var m=meta(obj,false),chains=m.chains,bindings=m.bindings,key,b;if(GUID_KEY in obj&&!obj.hasOwnProperty(GUID_KEY)){Ember.generateGuid(obj,"ember")}if(chains&&chains.value()!==obj){chainsFor(obj)}return this};function propertyWillChange(obj,keyName){var m=meta(obj,false),proto=m.proto,desc=m.descs[keyName];if(proto===obj){return}if(desc&&desc.willChange){desc.willChange(obj,keyName)}dependentKeysWillChange(obj,keyName,m);chainsWillChange(obj,keyName,m);Ember.notifyBeforeObservers(obj,keyName)}Ember.propertyWillChange=propertyWillChange;function propertyDidChange(obj,keyName){var m=meta(obj,false),proto=m.proto,desc=m.descs[keyName];if(proto===obj){return}if(desc&&desc.didChange){desc.didChange(obj,keyName)}dependentKeysDidChange(obj,keyName,m);chainsDidChange(obj,keyName,m);Ember.notifyObservers(obj,keyName)}Ember.propertyDidChange=propertyDidChange;var NODE_STACK=[];Ember.destroy=function(obj){var meta=obj[META_KEY],node,nodes,key,nodeObject;if(meta){obj[META_KEY]=null;node=meta.chains;if(node){NODE_STACK.push(node);while(NODE_STACK.length>0){node=NODE_STACK.pop();nodes=node._chains;if(nodes){for(key in nodes){if(nodes.hasOwnProperty(key)){NODE_STACK.push(nodes[key])}}}if(node._watching){nodeObject=node._object;if(nodeObject){removeChainWatcher(nodeObject,node._key,node)}}}}}}})();(function(){var o_create=Ember.platform.create;var meta=Ember.meta;var guidFor=Ember.guidFor;var a_slice=Array.prototype.slice;var metaPath=Ember.metaPath;function actionSetFor(obj,eventName,target,writable){var targetGuid=guidFor(target);return metaPath(obj,["listeners",eventName,targetGuid],writable)}function targetSetFor(obj,eventName){var listenerSet=meta(obj,false).listeners;if(!listenerSet){return false}return listenerSet[eventName]||false}var SKIP_PROPERTIES={__ember_source__:true};function iterateSet(targetSet,callback,params){if(!targetSet){return false}for(var targetGuid in targetSet){if(SKIP_PROPERTIES[targetGuid]){continue}var actionSet=targetSet[targetGuid];if(actionSet){for(var methodGuid in actionSet){if(SKIP_PROPERTIES[methodGuid]){continue}var action=actionSet[methodGuid];if(action){if(callback(action,params)===true){return true}}}}}return false}function invokeAction(action,params){var method=action.method,target=action.target,xform=action.xform;if(!target){target=params[0]}if("string"===typeof method){method=target[method]}if(xform){xform(target,method,params)}else{method.apply(target,params)}}function addListener(obj,eventName,target,method,xform){Ember.assert("You must pass at least an object and event name to Ember.addListener",!!obj&&!!eventName);if(!method&&"function"===typeof target){method=target;target=null}var actionSet=actionSetFor(obj,eventName,target,true),methodGuid=guidFor(method);if(!actionSet[methodGuid]){actionSet[methodGuid]={target:target,method:method,xform:xform}}else{actionSet[methodGuid].xform=xform}if("function"===typeof obj.didAddListener){obj.didAddListener(eventName,target,method)}}function removeListener(obj,eventName,target,method){if(!method&&"function"===typeof target){method=target;target=null}var actionSet=actionSetFor(obj,eventName,target,true),methodGuid=guidFor(method);if(actionSet&&actionSet[methodGuid]){actionSet[methodGuid]=null}if(obj&&"function"===typeof obj.didRemoveListener){obj.didRemoveListener(eventName,target,method)}}function suspendListener(obj,eventName,target,method,callback){if(!method&&"function"===typeof target){method=target;target=null}var actionSet=actionSetFor(obj,eventName,target,true),methodGuid=guidFor(method),action=actionSet&&actionSet[methodGuid];actionSet[methodGuid]=null;try{return callback.call(target)}finally{actionSet[methodGuid]=action}}function watchedEvents(obj){var listeners=meta(obj,false).listeners,ret=[];if(listeners){for(var eventName in listeners){if(!SKIP_PROPERTIES[eventName]&&listeners[eventName]){ret.push(eventName)}}}return ret}function sendEvent(obj,eventName){if(obj!==Ember&&"function"===typeof obj.sendEvent){obj.sendEvent.apply(obj,a_slice.call(arguments,1))}var targetSet=targetSetFor(obj,eventName);iterateSet(targetSet,invokeAction,arguments);return true}function deferEvent(obj,eventName){var targetSet=targetSetFor(obj,eventName),actions=[],params=arguments;iterateSet(targetSet,function(action){actions.push(action)});return function(){if(obj!==Ember&&"function"===typeof obj.sendEvent){obj.sendEvent.apply(obj,a_slice.call(params,1))}for(var i=0,len=actions.length;i<len;++i){invokeAction(actions[i],params)}}}function hasListeners(obj,eventName){var targetSet=targetSetFor(obj,eventName);if(iterateSet(targetSet,function(){return true})){return true}var set=metaPath(obj,["listeners"],true);set[eventName]=null;return false}function listenersFor(obj,eventName){var targetSet=targetSetFor(obj,eventName),ret=[];iterateSet(targetSet,function(action){ret.push([action.target,action.method])});return ret}Ember.addListener=addListener;Ember.removeListener=removeListener;Ember._suspendListener=suspendListener;Ember.sendEvent=sendEvent;Ember.hasListeners=hasListeners;Ember.watchedEvents=watchedEvents;Ember.listenersFor=listenersFor;Ember.deferEvent=deferEvent})();(function(){var slice=Array.prototype.slice;var forEach=Ember.ArrayUtils.forEach;function invoke(target,method,args,ignore){if(method===undefined){method=target;target=undefined}if("string"===typeof method){method=target[method]}if(args&&ignore>0){args=args.length>ignore?slice.call(args,ignore):null}if("function"===typeof Ember.onerror){try{return method.apply(target||this,args||[])}catch(error){Ember.onerror(error)}}else{return method.apply(target||this,args||[])}}var timerMark;var K=function(){};var RunLoop=function(prev){var self;if(this instanceof RunLoop){self=this}else{self=new K()}self._prev=prev||null;self.onceTimers={};return self};K.prototype=RunLoop.prototype;RunLoop.prototype={end:function(){this.flush()},prev:function(){return this._prev},schedule:function(queueName,target,method){var queues=this._queues,queue;if(!queues){queues=this._queues={}}queue=queues[queueName];if(!queue){queue=queues[queueName]=[]}var args=arguments.length>3?slice.call(arguments,3):null;queue.push({target:target,method:method,args:args});return this},flush:function(queueName){var queues=this._queues,queueNames,idx,len,queue,log;if(!queues){return this}function iter(item){invoke(item.target,item.method,item.args)}Ember.watch.flushPending();if(queueName){while(this._queues&&(queue=this._queues[queueName])){this._queues[queueName]=null;if(queueName==="sync"){log=Ember.LOG_BINDINGS;if(log){Ember.Logger.log("Begin: Flush Sync Queue")}Ember.beginPropertyChanges();try{forEach(queue,iter)}finally{Ember.endPropertyChanges()}if(log){Ember.Logger.log("End: Flush Sync Queue")}}else{forEach(queue,iter)}}}else{queueNames=Ember.run.queues;len=queueNames.length;do{this._queues=null;for(idx=0;idx<len;idx++){queueName=queueNames[idx];queue=queues[queueName];if(queue){if(queueName==="sync"){log=Ember.LOG_BINDINGS;if(log){Ember.Logger.log("Begin: Flush Sync Queue")}Ember.beginPropertyChanges();try{forEach(queue,iter)}finally{Ember.endPropertyChanges()}if(log){Ember.Logger.log("End: Flush Sync Queue")}}else{forEach(queue,iter)}}}}while(queues=this._queues)}timerMark=null;return this}};Ember.RunLoop=RunLoop;Ember.run=function(target,method){var ret,loop;run.begin();try{if(target||method){ret=invoke(target,method,arguments,2)}}finally{run.end()}return ret};var run=Ember.run;Ember.run.begin=function(){run.currentRunLoop=new RunLoop(run.currentRunLoop)};Ember.run.end=function(){Ember.assert("must have a current run loop",run.currentRunLoop);try{run.currentRunLoop.end()}finally{run.currentRunLoop=run.currentRunLoop.prev()}};Ember.run.queues=["sync","actions","destroy","timers"];Ember.run.schedule=function(queue,target,method){var loop=run.autorun();loop.schedule.apply(loop,arguments)};var autorunTimer;function autorun(){autorunTimer=null;if(run.currentRunLoop){run.end()}}Ember.run.autorun=function(){if(!run.currentRunLoop){run.begin();if(Ember.testing){run.end()}else{if(!autorunTimer){autorunTimer=setTimeout(autorun,1)}}}return run.currentRunLoop};Ember.run.sync=function(){run.autorun();run.currentRunLoop.flush("sync")};var timers={};var laterScheduled=false;function invokeLaterTimers(){var now=(+new Date()),earliest=-1;for(var key in timers){if(!timers.hasOwnProperty(key)){continue}var timer=timers[key];if(timer&&timer.expires){if(now>=timer.expires){delete timers[key];invoke(timer.target,timer.method,timer.args,2)}else{if(earliest<0||(timer.expires<earliest)){earliest=timer.expires}}}}if(earliest>0){setTimeout(invokeLaterTimers,earliest-(+new Date()))}}Ember.run.later=function(target,method){var args,expires,timer,guid,wait;if(arguments.length===2&&"function"===typeof target){wait=method;method=target;target=undefined;args=[target,method]}else{args=slice.call(arguments);wait=args.pop()}expires=(+new Date())+wait;timer={target:target,method:method,expires:expires,args:args};guid=Ember.guidFor(timer);timers[guid]=timer;run.once(timers,invokeLaterTimers);return guid};function invokeOnceTimer(guid,onceTimers){if(onceTimers[this.tguid]){delete onceTimers[this.tguid][this.mguid]}if(timers[guid]){invoke(this.target,this.method,this.args,2)}delete timers[guid]}Ember.run.once=function(target,method){var tguid=Ember.guidFor(target),mguid=Ember.guidFor(method),guid,timer;var onceTimers=run.autorun().onceTimers;guid=onceTimers[tguid]&&onceTimers[tguid][mguid];if(guid&&timers[guid]){timers[guid].args=slice.call(arguments)}else{timer={target:target,method:method,args:slice.call(arguments),tguid:tguid,mguid:mguid};guid=Ember.guidFor(timer);timers[guid]=timer;if(!onceTimers[tguid]){onceTimers[tguid]={}}onceTimers[tguid][mguid]=guid;run.schedule("actions",timer,invokeOnceTimer,guid,onceTimers)}return guid};var scheduledNext=false;function invokeNextTimers(){scheduledNext=null;for(var key in timers){if(!timers.hasOwnProperty(key)){continue}var timer=timers[key];if(timer.next){delete timers[key];invoke(timer.target,timer.method,timer.args,2)}}}Ember.run.next=function(target,method){var timer,guid;timer={target:target,method:method,args:slice.call(arguments),next:true};guid=Ember.guidFor(timer);timers[guid]=timer;if(!scheduledNext){scheduledNext=setTimeout(invokeNextTimers,1)}return guid};Ember.run.cancel=function(timer){delete timers[timer]}})();(function(){Ember.LOG_BINDINGS=false||!!Ember.ENV.LOG_BINDINGS;Ember.BENCHMARK_BINDING_NOTIFICATIONS=!!Ember.ENV.BENCHMARK_BINDING_NOTIFICATIONS;Ember.BENCHMARK_BINDING_SETUP=!!Ember.ENV.BENCHMARK_BINDING_SETUP;Ember.MULTIPLE_PLACEHOLDER="@@MULT@@";Ember.EMPTY_PLACEHOLDER="@@EMPTY@@";function MULTIPLE(val){if(val instanceof Array){return val}if(val===undefined||val===null){return[]}return[val]}function SINGLE(val,placeholder){if(val instanceof Array){if(val.length>1){return placeholder}else{return val[0]}}return val}var BOOL={to:function(val){return !!val}};var NOT={to:function NOT(val){return !val}};var get=Ember.get,getPath=Ember.getPath,setPath=Ember.setPath,guidFor=Ember.guidFor,isGlobalPath=Ember.isGlobalPath;function getTransformedValue(binding,val,obj,dir){var typeTransform=binding._typeTransform;if(typeTransform){val=typeTransform(val,binding._placeholder)}var transforms=binding._transforms,len=transforms?transforms.length:0,idx;for(idx=0;idx<len;idx++){var transform=transforms[idx][dir];if(transform){val=transform.call(this,val,obj)}}return val}function empty(val){return val===undefined||val===null||val===""||(Ember.isArray(val)&&get(val,"length")===0)}function getPathWithGlobals(obj,path){return getPath(isGlobalPath(path)?window:obj,path)}function getTransformedFromValue(obj,binding){var operation=binding._operation,fromValue;if(operation){fromValue=operation(obj,binding._from,binding._operand)}else{fromValue=getPathWithGlobals(obj,binding._from)}return getTransformedValue(binding,fromValue,obj,"to")}function getTransformedToValue(obj,binding){var toValue=getPath(obj,binding._to);return getTransformedValue(binding,toValue,obj,"from")}var AND_OPERATION=function(obj,left,right){return getPathWithGlobals(obj,left)&&getPathWithGlobals(obj,right)};var OR_OPERATION=function(obj,left,right){return getPathWithGlobals(obj,left)||getPathWithGlobals(obj,right)};var K=function(){};var Binding=function(toPath,fromPath){var self;if(this instanceof Binding){self=this}else{self=new K()}self._direction="fwd";self._from=fromPath;self._to=toPath;return self};K.prototype=Binding.prototype;Binding.prototype={copy:function(){var copy=new Binding(this._to,this._from);if(this._oneWay){copy._oneWay=true}if(this._transforms){copy._transforms=this._transforms.slice(0)}if(this._typeTransform){copy._typeTransform=this._typeTransform;copy._placeholder=this._placeholder}if(this._operand){copy._operand=this._operand;copy._operation=this._operation}return copy},from:function(path){this._from=path;return this},to:function(path){this._to=path;return this},oneWay:function(flag){this._oneWay=flag===undefined?true:!!flag;return this},transform:function(transform){if("function"===typeof transform){transform={to:transform}}if(!this._transforms){this._transforms=[]}this._transforms.push(transform);return this},resetTransforms:function(){this._transforms=null;return this},single:function(placeholder){if(placeholder===undefined){placeholder=Ember.MULTIPLE_PLACEHOLDER}this._typeTransform=SINGLE;this._placeholder=placeholder;return this},multiple:function(){this._typeTransform=MULTIPLE;this._placeholder=null;return this},bool:function(){this.transform(BOOL);return this},notEmpty:function(placeholder){if(placeholder===null||placeholder===undefined){placeholder=Ember.EMPTY_PLACEHOLDER}this.transform({to:function(val){return empty(val)?placeholder:val}});return this},notNull:function(placeholder){if(placeholder===null||placeholder===undefined){placeholder=Ember.EMPTY_PLACEHOLDER}this.transform({to:function(val){return(val===null||val===undefined)?placeholder:val}});return this},not:function(){this.transform(NOT);return this},isNull:function(){this.transform(function(val){return val===null||val===undefined});return this},toString:function(){var oneWay=this._oneWay?"[oneWay]":"";return"Ember.Binding<"+guidFor(this)+">("+this._from+" -> "+this._to+")"+oneWay},connect:function(obj){Ember.assert("Must pass a valid object to Ember.Binding.connect()",!!obj);var oneWay=this._oneWay,operand=this._operand;Ember.addObserver(obj,this._from,this,this.fromDidChange);if(operand){Ember.addObserver(obj,operand,this,this.fromDidChange)}if(!oneWay){Ember.addObserver(obj,this._to,this,this.toDidChange)}if(Ember.meta(obj,false).proto!==obj){this._scheduleSync(obj,"fwd")}this._readyToSync=true;return this},disconnect:function(obj){Ember.assert("Must pass a valid object to Ember.Binding.disconnect()",!!obj);var oneWay=this._oneWay,operand=this._operand;Ember.removeObserver(obj,this._from,this,this.fromDidChange);if(operand){Ember.removeObserver(obj,operand,this,this.fromDidChange)}if(!oneWay){Ember.removeObserver(obj,this._to,this,this.toDidChange)}this._readyToSync=false;return this},fromDidChange:function(target){this._scheduleSync(target,"fwd")},toDidChange:function(target){this._scheduleSync(target,"back")},_scheduleSync:function(obj,dir){var guid=guidFor(obj),existingDir=this[guid];if(!existingDir){Ember.run.schedule("sync",this,this._sync,obj);this[guid]=dir}if(existingDir==="back"&&dir==="fwd"){this[guid]="fwd"}},_sync:function(obj){var log=Ember.LOG_BINDINGS;if(obj.isDestroyed||!this._readyToSync){return}var guid=guidFor(obj),direction=this[guid];var fromPath=this._from,toPath=this._to;delete this[guid];if(direction==="fwd"){var fromValue=getTransformedFromValue(obj,this);if(log){Ember.Logger.log(" ",this.toString(),"->",fromValue,obj)}if(this._oneWay){Ember.trySetPath(Ember.isGlobalPath(toPath)?window:obj,toPath,fromValue)}else{Ember._suspendObserver(obj,toPath,this,this.toDidChange,function(){Ember.trySetPath(Ember.isGlobalPath(toPath)?window:obj,toPath,fromValue)})}}else{if(direction==="back"){var toValue=getTransformedToValue(obj,this);if(log){Ember.Logger.log(" ",this.toString(),"<-",toValue,obj)}Ember._suspendObserver(obj,fromPath,this,this.fromDidChange,function(){Ember.trySetPath(Ember.isGlobalPath(fromPath)?window:obj,fromPath,toValue)})}}}};function mixinProperties(to,from){for(var key in from){if(from.hasOwnProperty(key)){to[key]=from[key]}}}mixinProperties(Binding,{from:function(){var C=this,binding=new C();return binding.from.apply(binding,arguments)},to:function(){var C=this,binding=new C();return binding.to.apply(binding,arguments)},oneWay:function(from,flag){var C=this,binding=new C(null,from);return binding.oneWay(flag)},single:function(from,placeholder){var C=this,binding=new C(null,from);return binding.single(placeholder)},multiple:function(from){var C=this,binding=new C(null,from);return binding.multiple()},transform:function(from,func){if(!func){func=from;from=null}var C=this,binding=new C(null,from);return binding.transform(func)},notEmpty:function(from,placeholder){var C=this,binding=new C(null,from);return binding.notEmpty(placeholder)},notNull:function(from,placeholder){var C=this,binding=new C(null,from);return binding.notNull(placeholder)},bool:function(from){var C=this,binding=new C(null,from);return binding.bool()},not:function(from){var C=this,binding=new C(null,from);return binding.not()},isNull:function(from){var C=this,binding=new C(null,from);return binding.isNull()},and:function(pathA,pathB){var C=this,binding=new C(null,pathA).oneWay();binding._operand=pathB;binding._operation=AND_OPERATION;return binding},or:function(pathA,pathB){var C=this,binding=new C(null,pathA).oneWay();binding._operand=pathB;binding._operation=OR_OPERATION;return binding},registerTransform:function(name,transform){this.prototype[name]=transform;this[name]=function(from){var C=this,binding=new C(null,from),args;args=Array.prototype.slice.call(arguments,1);return binding[name].apply(binding,args)}}});Ember.Binding=Binding;Ember.bind=function(obj,to,from){return new Ember.Binding(to,from).connect(obj)};Ember.oneWay=function(obj,to,from){return new Ember.Binding(to,from).oneWay().connect(obj)}})();(function(){var Mixin,MixinDelegate,REQUIRED,Alias;var classToString,superClassString;var a_map=Ember.ArrayUtils.map;var a_indexOf=Ember.ArrayUtils.indexOf;var a_forEach=Ember.ArrayUtils.forEach;var a_slice=Array.prototype.slice;var EMPTY_META={};var META_SKIP={__emberproto__:true,__ember_count__:true};var o_create=Ember.platform.create;function meta(obj,writable){var m=Ember.meta(obj,writable!==false),ret=m.mixins;if(writable===false){return ret||EMPTY_META}if(!ret){ret=m.mixins={__emberproto__:obj}}else{if(ret.__emberproto__!==obj){ret=m.mixins=o_create(ret);ret.__emberproto__=obj}}return ret}function initMixin(mixin,args){if(args&&args.length>0){mixin.mixins=a_map(args,function(x){if(x instanceof Mixin){return x}var mixin=new Mixin();mixin.properties=x;return mixin})}return mixin}var NATIVES=[Boolean,Object,Number,Array,Date,String];function isMethod(obj){if("function"!==typeof obj||obj.isMethod===false){return false}return a_indexOf(NATIVES,obj)<0}function mergeMixins(mixins,m,descs,values,base){var len=mixins.length,idx,mixin,guid,props,value,key,ovalue,concats;function removeKeys(keyName){delete descs[keyName];delete values[keyName]}for(idx=0;idx<len;idx++){mixin=mixins[idx];if(!mixin){throw new Error("Null value found in Ember.mixin()")}if(mixin instanceof Mixin){guid=Ember.guidFor(mixin);if(m[guid]){continue}m[guid]=mixin;props=mixin.properties}else{props=mixin}if(props){concats=values.concatenatedProperties||base.concatenatedProperties;if(props.concatenatedProperties){concats=concats?concats.concat(props.concatenatedProperties):props.concatenatedProperties}for(key in props){if(!props.hasOwnProperty(key)){continue}value=props[key];if(value instanceof Ember.Descriptor){if(value===REQUIRED&&descs[key]){continue}descs[key]=value;values[key]=undefined}else{if(isMethod(value)){ovalue=(descs[key]===Ember.SIMPLE_PROPERTY)&&values[key];if(!ovalue){ovalue=base[key]}if("function"!==typeof ovalue){ovalue=null}if(ovalue){var o=value.__ember_observes__,ob=value.__ember_observesBefore__;value=Ember.wrap(value,ovalue);value.__ember_observes__=o;value.__ember_observesBefore__=ob}}else{if((concats&&a_indexOf(concats,key)>=0)||key==="concatenatedProperties"){var baseValue=values[key]||base[key];value=baseValue?baseValue.concat(value):Ember.makeArray(value)}}descs[key]=Ember.SIMPLE_PROPERTY;values[key]=value}}if(props.hasOwnProperty("toString")){base.toString=props.toString}}else{if(mixin.mixins){mergeMixins(mixin.mixins,m,descs,values,base);if(mixin._without){a_forEach(mixin._without,removeKeys)}}}}}var defineProperty=Ember.defineProperty;function writableReq(obj){var m=Ember.meta(obj),req=m.required;if(!req||(req.__emberproto__!==obj)){req=m.required=req?o_create(req):{__ember_count__:0};req.__emberproto__=obj}return req}function getObserverPaths(value){return("function"===typeof value)&&value.__ember_observes__}function getBeforeObserverPaths(value){return("function"===typeof value)&&value.__ember_observesBefore__}var IS_BINDING=Ember.IS_BINDING=/^.+Binding$/;function detectBinding(obj,key,m){if(IS_BINDING.test(key)){var bindings=m.bindings;if(!bindings){bindings=m.bindings={__emberproto__:obj}}else{if(bindings.__emberproto__!==obj){bindings=m.bindings=o_create(m.bindings);bindings.__emberproto__=obj}}bindings[key]=true}}function connectBindings(obj,m){if(m===undefined){m=Ember.meta(obj)}var bindings=m.bindings,key,binding;if(bindings){for(key in bindings){binding=key!=="__emberproto__"&&obj[key];if(binding){if(binding instanceof Ember.Binding){binding=binding.copy();binding.to(key.slice(0,-7))}else{binding=new Ember.Binding(key.slice(0,-7),binding)}binding.connect(obj);obj[key]=binding}}}}function applyMixin(obj,mixins,partial){var descs={},values={},m=Ember.meta(obj),req=m.required;var key,willApply,didApply,value,desc;mergeMixins(mixins,meta(obj),descs,values,obj);if(MixinDelegate.detect(obj)){willApply=values.willApplyProperty||obj.willApplyProperty;didApply=values.didApplyProperty||obj.didApplyProperty}for(key in descs){if(!descs.hasOwnProperty(key)){continue}desc=descs[key];value=values[key];if(desc===REQUIRED){if(!(key in obj)){if(!partial){throw new Error("Required property not defined: "+key)}req=writableReq(obj);req.__ember_count__++;req[key]=true}}else{while(desc instanceof Alias){var altKey=desc.methodName;if(descs[altKey]){value=values[altKey];desc=descs[altKey]}else{if(m.descs[altKey]){desc=m.descs[altKey];value=desc.val(obj,altKey)}else{value=obj[altKey];desc=Ember.SIMPLE_PROPERTY}}}if(willApply){willApply.call(obj,key)}var observerPaths=getObserverPaths(value),curObserverPaths=observerPaths&&getObserverPaths(obj[key]),beforeObserverPaths=getBeforeObserverPaths(value),curBeforeObserverPaths=beforeObserverPaths&&getBeforeObserverPaths(obj[key]),len,idx;if(curObserverPaths){len=curObserverPaths.length;for(idx=0;idx<len;idx++){Ember.removeObserver(obj,curObserverPaths[idx],null,key)}}if(curBeforeObserverPaths){len=curBeforeObserverPaths.length;for(idx=0;idx<len;idx++){Ember.removeBeforeObserver(obj,curBeforeObserverPaths[idx],null,key)}}detectBinding(obj,key,m);defineProperty(obj,key,desc,value);if(observerPaths){len=observerPaths.length;for(idx=0;idx<len;idx++){Ember.addObserver(obj,observerPaths[idx],null,key)}}if(beforeObserverPaths){len=beforeObserverPaths.length;for(idx=0;idx<len;idx++){Ember.addBeforeObserver(obj,beforeObserverPaths[idx],null,key)}}if(req&&req[key]){req=writableReq(obj);req.__ember_count__--;req[key]=false}if(didApply){didApply.call(obj,key)}}}if(!partial){value=connectBindings(obj,m)}if(!partial&&req&&req.__ember_count__>0){var keys=[];for(key in req){if(META_SKIP[key]){continue}keys.push(key)}throw new Error("Required properties not defined: "+keys.join(","))}return obj}Ember.mixin=function(obj){var args=a_slice.call(arguments,1);return applyMixin(obj,args,false)};Ember.Mixin=function(){return initMixin(this,arguments)};Mixin=Ember.Mixin;Mixin._apply=applyMixin;Mixin.applyPartial=function(obj){var args=a_slice.call(arguments,1);return applyMixin(obj,args,true)};Mixin.finishPartial=function(obj){connectBindings(obj);return obj};Mixin.create=function(){classToString.processed=false;var M=this;return initMixin(new M(),arguments)};Mixin.prototype.reopen=function(){var mixin,tmp;if(this.properties){mixin=Mixin.create();mixin.properties=this.properties;delete this.properties;this.mixins=[mixin]}var len=arguments.length,mixins=this.mixins,idx;for(idx=0;idx<len;idx++){mixin=arguments[idx];if(mixin instanceof Mixin){mixins.push(mixin)}else{tmp=Mixin.create();tmp.properties=mixin;mixins.push(tmp)}}return this};var TMP_ARRAY=[];Mixin.prototype.apply=function(obj){TMP_ARRAY[0]=this;var ret=applyMixin(obj,TMP_ARRAY,false);TMP_ARRAY.length=0;return ret};Mixin.prototype.applyPartial=function(obj){TMP_ARRAY[0]=this;var ret=applyMixin(obj,TMP_ARRAY,true);TMP_ARRAY.length=0;return ret};function _detect(curMixin,targetMixin,seen){var guid=Ember.guidFor(curMixin);if(seen[guid]){return false}seen[guid]=true;if(curMixin===targetMixin){return true}var mixins=curMixin.mixins,loc=mixins?mixins.length:0;while(--loc>=0){if(_detect(mixins[loc],targetMixin,seen)){return true}}return false}Mixin.prototype.detect=function(obj){if(!obj){return false}if(obj instanceof Mixin){return _detect(obj,this,{})}return !!meta(obj,false)[Ember.guidFor(this)]};Mixin.prototype.without=function(){var ret=new Mixin(this);ret._without=a_slice.call(arguments);return ret};function _keys(ret,mixin,seen){if(seen[Ember.guidFor(mixin)]){return}seen[Ember.guidFor(mixin)]=true;if(mixin.properties){var props=mixin.properties;for(var key in props){if(props.hasOwnProperty(key)){ret[key]=true}}}else{if(mixin.mixins){a_forEach(mixin.mixins,function(x){_keys(ret,x,seen)})}}}Mixin.prototype.keys=function(){var keys={},seen={},ret=[];_keys(keys,this,seen);for(var key in keys){if(keys.hasOwnProperty(key)){ret.push(key)}}return ret};var NAME_KEY=Ember.GUID_KEY+"_name";var get=Ember.get;function processNames(paths,root,seen){var idx=paths.length;for(var key in root){if(!root.hasOwnProperty||!root.hasOwnProperty(key)){continue}var obj=root[key];paths[idx]=key;if(obj&&obj.toString===classToString){obj[NAME_KEY]=paths.join(".")}else{if(obj&&get(obj,"isNamespace")){if(seen[Ember.guidFor(obj)]){continue}seen[Ember.guidFor(obj)]=true;processNames(paths,obj,seen)}}}paths.length=idx}function findNamespaces(){var Namespace=Ember.Namespace,obj,isNamespace;if(Namespace.PROCESSED){return}for(var prop in window){if(prop==="globalStorage"&&window.StorageList&&window.globalStorage instanceof window.StorageList){continue}if(window.hasOwnProperty&&!window.hasOwnProperty(prop)){continue}try{obj=window[prop];isNamespace=obj&&get(obj,"isNamespace")}catch(e){continue}if(isNamespace){Ember.deprecate("Namespaces should not begin with lowercase.",/^[A-Z]/.test(prop));obj[NAME_KEY]=prop}}}Ember.identifyNamespaces=findNamespaces;superClassString=function(mixin){var superclass=mixin.superclass;if(superclass){if(superclass[NAME_KEY]){return superclass[NAME_KEY]}else{return superClassString(superclass)}}else{return}};classToString=function(){var Namespace=Ember.Namespace,namespace;if(Namespace){if(!this[NAME_KEY]&&!classToString.processed){if(!Namespace.PROCESSED){findNamespaces();Namespace.PROCESSED=true}classToString.processed=true;var namespaces=Namespace.NAMESPACES;for(var i=0,l=namespaces.length;i<l;i++){namespace=namespaces[i];processNames([namespace.toString()],namespace,{})}}}if(this[NAME_KEY]){return this[NAME_KEY]}else{var str=superClassString(this);if(str){return"(subclass of "+str+")"}else{return"(unknown mixin)"}}};Mixin.prototype.toString=classToString;Mixin.mixins=function(obj){var ret=[],mixins=meta(obj,false),key,mixin;for(key in mixins){if(META_SKIP[key]){continue}mixin=mixins[key];if(!mixin.properties){ret.push(mixins[key])}}return ret};REQUIRED=new Ember.Descriptor();REQUIRED.toString=function(){return"(Required Property)"};Ember.required=function(){return REQUIRED};Alias=function(methodName){this.methodName=methodName};Alias.prototype=new Ember.Descriptor();Ember.alias=function(methodName){return new Alias(methodName)};Ember.MixinDelegate=Mixin.create({willApplyProperty:Ember.required(),didApplyProperty:Ember.required()});MixinDelegate=Ember.MixinDelegate;Ember.observer=function(func){var paths=a_slice.call(arguments,1);func.__ember_observes__=paths;return func};Ember.beforeObserver=function(func){var paths=a_slice.call(arguments,1);func.__ember_observesBefore__=paths;return func}})();(function(){})();(function(){})();(function(){var indexOf=Ember.ArrayUtils.indexOf;var TYPE_MAP={};var t="Boolean Number String Function Array Date RegExp Object".split(" ");Ember.ArrayUtils.forEach(t,function(name){TYPE_MAP["[object "+name+"]"]=name.toLowerCase()});var toString=Object.prototype.toString;Ember.typeOf=function(item){var ret;ret=(item===null||item===undefined)?String(item):TYPE_MAP[toString.call(item)]||"object";if(ret==="function"){if(Ember.Object&&Ember.Object.detect(item)){ret="class"}}else{if(ret==="object"){if(item instanceof Error){ret="error"}else{if(Ember.Object&&item instanceof Ember.Object){ret="instance"}else{ret="object"}}}}return ret};Ember.none=function(obj){return obj===null||obj===undefined};Ember.empty=function(obj){return obj===null||obj===undefined||(obj.length===0&&typeof obj!=="function")};Ember.compare=function compare(v,w){if(v===w){return 0}var type1=Ember.typeOf(v);var type2=Ember.typeOf(w);var Comparable=Ember.Comparable;if(Comparable){if(type1==="instance"&&Comparable.detect(v.constructor)){return v.constructor.compare(v,w)}if(type2==="instance"&&Comparable.detect(w.constructor)){return 1-w.constructor.compare(w,v)}}var mapping=Ember.ORDER_DEFINITION_MAPPING;if(!mapping){var order=Ember.ORDER_DEFINITION;mapping=Ember.ORDER_DEFINITION_MAPPING={};var idx,len;for(idx=0,len=order.length;idx<len;++idx){mapping[order[idx]]=idx}delete Ember.ORDER_DEFINITION}var type1Index=mapping[type1];var type2Index=mapping[type2];if(type1Index<type2Index){return -1}if(type1Index>type2Index){return 1}switch(type1){case"boolean":case"number":if(v<w){return -1}if(v>w){return 1}return 0;case"string":var comp=v.localeCompare(w);if(comp<0){return -1}if(comp>0){return 1}return 0;case"array":var vLen=v.length;var wLen=w.length;var l=Math.min(vLen,wLen);var r=0;var i=0;while(r===0&&i<l){r=compare(v[i],w[i]);i++}if(r!==0){return r}if(vLen<wLen){return -1}if(vLen>wLen){return 1}return 0;case"instance":if(Ember.Comparable&&Ember.Comparable.detect(v)){return v.compare(v,w)}return 0;default:return 0}};function _copy(obj,deep,seen,copies){var ret,loc,key;if("object"!==typeof obj||obj===null){return obj}if(deep&&(loc=indexOf(seen,obj))>=0){return copies[loc]}Ember.assert("Cannot clone an Ember.Object that does not implement Ember.Copyable",!(obj instanceof Ember.Object)||(Ember.Copyable&&Ember.Copyable.detect(obj)));if(Ember.typeOf(obj)==="array"){ret=obj.slice();if(deep){loc=ret.length;while(--loc>=0){ret[loc]=_copy(ret[loc],deep,seen,copies)}}}else{if(Ember.Copyable&&Ember.Copyable.detect(obj)){ret=obj.copy(deep,seen,copies)}else{ret={};for(key in obj){if(!obj.hasOwnProperty(key)){continue}ret[key]=deep?_copy(obj[key],deep,seen,copies):obj[key]}}}if(deep){seen.push(obj);copies.push(ret)}return ret}Ember.copy=function(obj,deep){if("object"!==typeof obj||obj===null){return obj}if(Ember.Copyable&&Ember.Copyable.detect(obj)){return obj.copy(deep)}return _copy(obj,deep,deep?[]:null,deep?[]:null)};Ember.inspect=function(obj){var v,ret=[];for(var key in obj){if(obj.hasOwnProperty(key)){v=obj[key];if(v==="toString"){continue}if(Ember.typeOf(v)==="function"){v="function() { ... }"}ret.push(key+": "+v)}}return"{"+ret.join(" , ")+"}"};Ember.isEqual=function(a,b){if(a&&"function"===typeof a.isEqual){return a.isEqual(b)}return a===b};Ember.ORDER_DEFINITION=Ember.ENV.ORDER_DEFINITION||["undefined","null","boolean","number","string","array","object","instance","function","class"];Ember.keys=Object.keys;if(!Ember.keys){Ember.keys=function(obj){var ret=[];for(var key in obj){if(obj.hasOwnProperty(key)){ret.push(key)}}return ret}}Ember.Error=function(){var tmp=Error.prototype.constructor.apply(this,arguments);for(var p in tmp){if(tmp.hasOwnProperty(p)){this[p]=tmp[p]}}this.message=tmp.message};Ember.Error.prototype=Ember.create(Error.prototype)})();(function(){var STRING_DASHERIZE_REGEXP=(/[ _]/g);var STRING_DASHERIZE_CACHE={};var STRING_DECAMELIZE_REGEXP=(/([a-z])([A-Z])/g);var STRING_CAMELIZE_REGEXP=(/(\-|_|\s)+(.)?/g);var STRING_UNDERSCORE_REGEXP_1=(/([a-z\d])([A-Z]+)/g);var STRING_UNDERSCORE_REGEXP_2=(/\-|\s+/g);Ember.STRINGS={};Ember.String={fmt:function(str,formats){var idx=0;return str.replace(/%@([0-9]+)?/g,function(s,argIndex){argIndex=(argIndex)?parseInt(argIndex,0)-1:idx++;s=formats[argIndex];return((s===null)?"(null)":(s===undefined)?"":s).toString()})},loc:function(str,formats){str=Ember.STRINGS[str]||str;return Ember.String.fmt(str,formats)},w:function(str){return str.split(/\s+/)},decamelize:function(str){return str.replace(STRING_DECAMELIZE_REGEXP,"$1_$2").toLowerCase()},dasherize:function(str){var cache=STRING_DASHERIZE_CACHE,ret=cache[str];if(ret){return ret}else{ret=Ember.String.decamelize(str).replace(STRING_DASHERIZE_REGEXP,"-");cache[str]=ret}return ret},camelize:function(str){return str.replace(STRING_CAMELIZE_REGEXP,function(match,separator,chr){return chr?chr.toUpperCase():""})},underscore:function(str){return str.replace(STRING_UNDERSCORE_REGEXP_1,"$1_$2").replace(STRING_UNDERSCORE_REGEXP_2,"_").toLowerCase()}}})();(function(){var fmt=Ember.String.fmt,w=Ember.String.w,loc=Ember.String.loc,camelize=Ember.String.camelize,decamelize=Ember.String.decamelize,dasherize=Ember.String.dasherize,underscore=Ember.String.underscore;if(Ember.EXTEND_PROTOTYPES){String.prototype.fmt=function(){return fmt(this,arguments)};String.prototype.w=function(){return w(this)};String.prototype.loc=function(){return loc(this,arguments)};String.prototype.camelize=function(){return camelize(this)};String.prototype.decamelize=function(){return decamelize(this)};String.prototype.dasherize=function(){return dasherize(this)};String.prototype.underscore=function(){return underscore(this)}}})();(function(){var a_slice=Array.prototype.slice;if(Ember.EXTEND_PROTOTYPES){Function.prototype.property=function(){var ret=Ember.computed(this);return ret.property.apply(ret,arguments)};Function.prototype.observes=function(){this.__ember_observes__=a_slice.call(arguments);return this};Function.prototype.observesBefore=function(){this.__ember_observesBefore__=a_slice.call(arguments);return this}}})();(function(){})();(function(){var get=Ember.get,set=Ember.set;var a_slice=Array.prototype.slice;var a_indexOf=Ember.ArrayUtils.indexOf;var contexts=[];function popCtx(){return contexts.length===0?{}:contexts.pop()}function pushCtx(ctx){contexts.push(ctx);return null}function iter(key,value){var valueProvided=arguments.length===2;function i(item){var cur=get(item,key);return valueProvided?value===cur:!!cur}return i}function xform(target,method,params){method.call(target,params[0],params[2],params[3])}Ember.Enumerable=Ember.Mixin.create({isEnumerable:true,nextObject:Ember.required(Function),firstObject:Ember.computed(function(){if(get(this,"length")===0){return undefined}var context=popCtx(),ret;ret=this.nextObject(0,null,context);pushCtx(context);return ret}).property("[]").cacheable(),lastObject:Ember.computed(function(){var len=get(this,"length");if(len===0){return undefined}var context=popCtx(),idx=0,cur,last=null;do{last=cur;cur=this.nextObject(idx++,last,context)}while(cur!==undefined);pushCtx(context);return last}).property("[]").cacheable(),contains:function(obj){return this.find(function(item){return item===obj})!==undefined},forEach:function(callback,target){if(typeof callback!=="function"){throw new TypeError()}var len=get(this,"length"),last=null,context=popCtx();if(target===undefined){target=null}for(var idx=0;idx<len;idx++){var next=this.nextObject(idx,last,context);callback.call(target,next,idx,this);last=next}last=null;context=pushCtx(context);return this},getEach:function(key){return this.mapProperty(key)},setEach:function(key,value){return this.forEach(function(item){set(item,key,value)})},map:function(callback,target){var ret=[];this.forEach(function(x,idx,i){ret[idx]=callback.call(target,x,idx,i)});return ret},mapProperty:function(key){return this.map(function(next){return get(next,key)})},filter:function(callback,target){var ret=[];this.forEach(function(x,idx,i){if(callback.call(target,x,idx,i)){ret.push(x)}});return ret},filterProperty:function(key,value){return this.filter(iter.apply(this,arguments))},find:function(callback,target){var len=get(this,"length");if(target===undefined){target=null}var last=null,next,found=false,ret;var context=popCtx();for(var idx=0;idx<len&&!found;idx++){next=this.nextObject(idx,last,context);if(found=callback.call(target,next,idx,this)){ret=next}last=next}next=last=null;context=pushCtx(context);return ret},findProperty:function(key,value){return this.find(iter.apply(this,arguments))},every:function(callback,target){return !this.find(function(x,idx,i){return !callback.call(target,x,idx,i)})},everyProperty:function(key,value){return this.every(iter.apply(this,arguments))},some:function(callback,target){return !!this.find(function(x,idx,i){return !!callback.call(target,x,idx,i)})},someProperty:function(key,value){return this.some(iter.apply(this,arguments))},reduce:function(callback,initialValue,reducerProperty){if(typeof callback!=="function"){throw new TypeError()}var ret=initialValue;this.forEach(function(item,i){ret=callback.call(null,ret,item,i,this,reducerProperty)},this);return ret},invoke:function(methodName){var args,ret=[];if(arguments.length>1){args=a_slice.call(arguments,1)}this.forEach(function(x,idx){var method=x&&x[methodName];if("function"===typeof method){ret[idx]=args?method.apply(x,args):method.call(x)}},this);return ret},toArray:function(){var ret=[];this.forEach(function(o,idx){ret[idx]=o});return ret},compact:function(){return this.without(null)},without:function(value){if(!this.contains(value)){return this}var ret=[];this.forEach(function(k){if(k!==value){ret[ret.length]=k}});return ret},uniq:function(){var ret=[];this.forEach(function(k){if(a_indexOf(ret,k)<0){ret.push(k)}});return ret},"[]":Ember.computed(function(key,value){return this}).property().cacheable(),addEnumerableObserver:function(target,opts){var willChange=(opts&&opts.willChange)||"enumerableWillChange",didChange=(opts&&opts.didChange)||"enumerableDidChange";var hasObservers=get(this,"hasEnumerableObservers");if(!hasObservers){Ember.propertyWillChange(this,"hasEnumerableObservers")}Ember.addListener(this,"@enumerable:before",target,willChange,xform);Ember.addListener(this,"@enumerable:change",target,didChange,xform);if(!hasObservers){Ember.propertyDidChange(this,"hasEnumerableObservers")}return this},removeEnumerableObserver:function(target,opts){var willChange=(opts&&opts.willChange)||"enumerableWillChange",didChange=(opts&&opts.didChange)||"enumerableDidChange";var hasObservers=get(this,"hasEnumerableObservers");if(hasObservers){Ember.propertyWillChange(this,"hasEnumerableObservers")}Ember.removeListener(this,"@enumerable:before",target,willChange);Ember.removeListener(this,"@enumerable:change",target,didChange);if(hasObservers){Ember.propertyDidChange(this,"hasEnumerableObservers")}return this},hasEnumerableObservers:Ember.computed(function(){return Ember.hasListeners(this,"@enumerable:change")||Ember.hasListeners(this,"@enumerable:before")}).property().cacheable(),enumerableContentWillChange:function(removing,adding){var removeCnt,addCnt,hasDelta;if("number"===typeof removing){removeCnt=removing}else{if(removing){removeCnt=get(removing,"length")}else{removeCnt=removing=-1}}if("number"===typeof adding){addCnt=adding}else{if(adding){addCnt=get(adding,"length")}else{addCnt=adding=-1}}hasDelta=addCnt<0||removeCnt<0||addCnt-removeCnt!==0;if(removing===-1){removing=null}if(adding===-1){adding=null}Ember.propertyWillChange(this,"[]");if(hasDelta){Ember.propertyWillChange(this,"length")}Ember.sendEvent(this,"@enumerable:before",removing,adding);return this},enumerableContentDidChange:function(removing,adding){var notify=this.propertyDidChange,removeCnt,addCnt,hasDelta;if("number"===typeof removing){removeCnt=removing}else{if(removing){removeCnt=get(removing,"length")}else{removeCnt=removing=-1}}if("number"===typeof adding){addCnt=adding}else{if(adding){addCnt=get(adding,"length")}else{addCnt=adding=-1}}hasDelta=addCnt<0||removeCnt<0||addCnt-removeCnt!==0;if(removing===-1){removing=null}if(adding===-1){adding=null}Ember.sendEvent(this,"@enumerable:change",removing,adding);if(hasDelta){Ember.propertyDidChange(this,"length")}Ember.propertyDidChange(this,"[]");return this}})})();(function(){var get=Ember.get,set=Ember.set,meta=Ember.meta,map=Ember.ArrayUtils.map,cacheFor=Ember.cacheFor;function none(obj){return obj===null||obj===undefined}function xform(target,method,params){method.call(target,params[0],params[2],params[3],params[4])}Ember.Array=Ember.Mixin.create(Ember.Enumerable,{isSCArray:true,length:Ember.required(),objectAt:function(idx){if((idx<0)||(idx>=get(this,"length"))){return undefined}return get(this,idx)},objectsAt:function(indexes){var self=this;return map(indexes,function(idx){return self.objectAt(idx)})},nextObject:function(idx){return this.objectAt(idx)},"[]":Ember.computed(function(key,value){if(value!==undefined){this.replace(0,get(this,"length"),value)}return this}).property().cacheable(),firstObject:Ember.computed(function(){return this.objectAt(0)}).property().cacheable(),lastObject:Ember.computed(function(){return this.objectAt(get(this,"length")-1)}).property().cacheable(),contains:function(obj){return this.indexOf(obj)>=0},slice:function(beginIndex,endIndex){var ret=[];var length=get(this,"length");if(none(beginIndex)){beginIndex=0}if(none(endIndex)||(endIndex>length)){endIndex=length}while(beginIndex<endIndex){ret[ret.length]=this.objectAt(beginIndex++)}return ret},indexOf:function(object,startAt){var idx,len=get(this,"length");if(startAt===undefined){startAt=0}if(startAt<0){startAt+=len}for(idx=startAt;idx<len;idx++){if(this.objectAt(idx,true)===object){return idx}}return -1},lastIndexOf:function(object,startAt){var idx,len=get(this,"length");if(startAt===undefined||startAt>=len){startAt=len-1}if(startAt<0){startAt+=len}for(idx=startAt;idx>=0;idx--){if(this.objectAt(idx)===object){return idx}}return -1},addArrayObserver:function(target,opts){var willChange=(opts&&opts.willChange)||"arrayWillChange",didChange=(opts&&opts.didChange)||"arrayDidChange";var hasObservers=get(this,"hasArrayObservers");if(!hasObservers){Ember.propertyWillChange(this,"hasArrayObservers")}Ember.addListener(this,"@array:before",target,willChange,xform);Ember.addListener(this,"@array:change",target,didChange,xform);if(!hasObservers){Ember.propertyDidChange(this,"hasArrayObservers")}return this},removeArrayObserver:function(target,opts){var willChange=(opts&&opts.willChange)||"arrayWillChange",didChange=(opts&&opts.didChange)||"arrayDidChange";var hasObservers=get(this,"hasArrayObservers");if(hasObservers){Ember.propertyWillChange(this,"hasArrayObservers")}Ember.removeListener(this,"@array:before",target,willChange,xform);Ember.removeListener(this,"@array:change",target,didChange,xform);if(hasObservers){Ember.propertyDidChange(this,"hasArrayObservers")}return this},hasArrayObservers:Ember.computed(function(){return Ember.hasListeners(this,"@array:change")||Ember.hasListeners(this,"@array:before")}).property().cacheable(),arrayContentWillChange:function(startIdx,removeAmt,addAmt){if(startIdx===undefined){startIdx=0;removeAmt=addAmt=-1}else{if(removeAmt===undefined){removeAmt=-1}if(addAmt===undefined){addAmt=-1}}Ember.sendEvent(this,"@array:before",startIdx,removeAmt,addAmt);var removing,lim;if(startIdx>=0&&removeAmt>=0&&get(this,"hasEnumerableObservers")){removing=[];lim=startIdx+removeAmt;for(var idx=startIdx;idx<lim;idx++){removing.push(this.objectAt(idx))}}else{removing=removeAmt}this.enumerableContentWillChange(removing,addAmt);if(Ember.isWatching(this,"@each")){get(this,"@each")}return this},arrayContentDidChange:function(startIdx,removeAmt,addAmt){if(startIdx===undefined){startIdx=0;removeAmt=addAmt=-1}else{if(removeAmt===undefined){removeAmt=-1}if(addAmt===undefined){addAmt=-1}}var adding,lim;if(startIdx>=0&&addAmt>=0&&get(this,"hasEnumerableObservers")){adding=[];lim=startIdx+addAmt;for(var idx=startIdx;idx<lim;idx++){adding.push(this.objectAt(idx))}}else{adding=addAmt}this.enumerableContentDidChange(removeAmt,adding);Ember.sendEvent(this,"@array:change",startIdx,removeAmt,addAmt);var length=get(this,"length"),cachedFirst=cacheFor(this,"firstObject"),cachedLast=cacheFor(this,"lastObject");if(this.objectAt(0)!==cachedFirst){Ember.propertyWillChange(this,"firstObject");Ember.propertyDidChange(this,"firstObject")}if(this.objectAt(length-1)!==cachedLast){Ember.propertyWillChange(this,"lastObject");Ember.propertyDidChange(this,"lastObject")}return this},"@each":Ember.computed(function(){if(!this.__each){this.__each=new Ember.EachProxy(this)}return this.__each}).property().cacheable()})})();(function(){Ember.Comparable=Ember.Mixin.create({isComparable:true,compare:Ember.required(Function)})})();(function(){var get=Ember.get,set=Ember.set;Ember.Copyable=Ember.Mixin.create({copy:Ember.required(Function),frozenCopy:function(){if(Ember.Freezable&&Ember.Freezable.detect(this)){return get(this,"isFrozen")?this:this.copy().freeze()}else{throw new Error(Ember.String.fmt("%@ does not support freezing",[this]))}}})})();(function(){var get=Ember.get,set=Ember.set;Ember.Freezable=Ember.Mixin.create({isFrozen:false,freeze:function(){if(get(this,"isFrozen")){return this}set(this,"isFrozen",true);return this}});Ember.FROZEN_ERROR="Frozen object cannot be modified."})();(function(){var forEach=Ember.ArrayUtils.forEach;Ember.MutableEnumerable=Ember.Mixin.create(Ember.Enumerable,{addObject:Ember.required(Function),addObjects:function(objects){Ember.beginPropertyChanges(this);forEach(objects,function(obj){this.addObject(obj)},this);Ember.endPropertyChanges(this);return this},removeObject:Ember.required(Function),removeObjects:function(objects){Ember.beginPropertyChanges(this);forEach(objects,function(obj){this.removeObject(obj)},this);Ember.endPropertyChanges(this);return this}})})();(function(){var OUT_OF_RANGE_EXCEPTION="Index out of range";var EMPTY=[];var get=Ember.get,set=Ember.set,forEach=Ember.ArrayUtils.forEach;Ember.MutableArray=Ember.Mixin.create(Ember.Array,Ember.MutableEnumerable,{replace:Ember.required(),clear:function(){var len=get(this,"length");if(len===0){return this}this.replace(0,len,EMPTY);return this},insertAt:function(idx,object){if(idx>get(this,"length")){throw new Error(OUT_OF_RANGE_EXCEPTION)}this.replace(idx,0,[object]);return this},removeAt:function(start,len){var delta=0;if("number"===typeof start){if((start<0)||(start>=get(this,"length"))){throw new Error(OUT_OF_RANGE_EXCEPTION)}if(len===undefined){len=1}this.replace(start,len,EMPTY)}return this},pushObject:function(obj){this.insertAt(get(this,"length"),obj);return obj},pushObjects:function(objects){this.replace(get(this,"length"),0,objects);return this},popObject:function(){var len=get(this,"length");if(len===0){return null}var ret=this.objectAt(len-1);this.removeAt(len-1,1);return ret},shiftObject:function(){if(get(this,"length")===0){return null}var ret=this.objectAt(0);this.removeAt(0);return ret},unshiftObject:function(obj){this.insertAt(0,obj);return obj},unshiftObjects:function(objects){this.replace(0,0,objects);return this},removeObject:function(obj){var loc=get(this,"length")||0;while(--loc>=0){var curObject=this.objectAt(loc);if(curObject===obj){this.removeAt(loc)}}return this},addObject:function(obj){if(!this.contains(obj)){this.pushObject(obj)}return this}})})();(function(){var get=Ember.get,set=Ember.set;Ember.Observable=Ember.Mixin.create({isObserverable:true,get:function(keyName){return get(this,keyName)},getProperties:function(){var ret={};var propertyNames=arguments;if(arguments.length===1&&Ember.typeOf(arguments[0])==="array"){propertyNames=arguments[0]}for(var i=0;i<propertyNames.length;i++){ret[propertyNames[i]]=get(this,propertyNames[i])}return ret},set:function(keyName,value){set(this,keyName,value);return this},setProperties:function(hash){return Ember.setProperties(this,hash)},beginPropertyChanges:function(){Ember.beginPropertyChanges();return this},endPropertyChanges:function(){Ember.endPropertyChanges();return this},propertyWillChange:function(keyName){Ember.propertyWillChange(this,keyName);return this},propertyDidChange:function(keyName){Ember.propertyDidChange(this,keyName);return this},notifyPropertyChange:function(keyName){this.propertyWillChange(keyName);this.propertyDidChange(keyName);return this},addObserver:function(key,target,method){Ember.addObserver(this,key,target,method)},removeObserver:function(key,target,method){Ember.removeObserver(this,key,target,method)},hasObserverFor:function(key){return Ember.hasListeners(this,key+":change")},unknownProperty:function(key){return undefined},setUnknownProperty:function(key,value){this[key]=value},getPath:function(path){return Ember.getPath(this,path)},setPath:function(path,value){Ember.setPath(this,path,value);return this},getWithDefault:function(keyName,defaultValue){return Ember.getWithDefault(this,keyName,defaultValue)},incrementProperty:function(keyName,increment){if(!increment){increment=1}set(this,keyName,(get(this,keyName)||0)+increment);return get(this,keyName)},decrementProperty:function(keyName,increment){if(!increment){increment=1}set(this,keyName,(get(this,keyName)||0)-increment);return get(this,keyName)},toggleProperty:function(keyName){set(this,keyName,!get(this,keyName));return get(this,keyName)},cacheFor:function(keyName){return Ember.cacheFor(this,keyName)},observersForKey:function(keyName){return Ember.observersFor(this,keyName)}})})();(function(){var get=Ember.get,set=Ember.set,getPath=Ember.getPath;Ember.TargetActionSupport=Ember.Mixin.create({target:null,action:null,targetObject:Ember.computed(function(){var target=get(this,"target");if(Ember.typeOf(target)==="string"){var value=getPath(this,target);if(value===undefined){value=getPath(window,target)}return value}else{return target}}).property("target").cacheable(),triggerAction:function(){var action=get(this,"action"),target=get(this,"targetObject");if(target&&action){var ret;if(typeof target.send==="function"){ret=target.send(action,this)}else{if(typeof action==="string"){action=target[action]}ret=action.call(target,this)}if(ret!==false){ret=true}return ret}else{return false}}})})();(function(){var get=Ember.get,set=Ember.set,a_slice=Array.prototype.slice;function xform(target,method,params){var args=a_slice.call(params,2);method.apply(target,args)}Ember.Evented=Ember.Mixin.create({on:function(name,target,method){if(!method){method=target;target=null}Ember.addListener(this,name,target,method,xform)},fire:function(name){Ember.sendEvent.apply(null,[this,name].concat(a_slice.call(arguments,1)))},off:function(name,target,method){Ember.removeListener(this,name,target,method)}})})();(function(){})();(function(){var rewatch=Ember.rewatch;var classToString=Ember.Mixin.prototype.toString;var set=Ember.set,get=Ember.get;var o_create=Ember.platform.create,o_defineProperty=Ember.platform.defineProperty,a_slice=Array.prototype.slice,meta=Ember.meta;function makeCtor(){var wasApplied=false,initMixins,init=false,hasChains=false;var Class=function(){if(!wasApplied){Class.proto()}if(initMixins){this.reopen.apply(this,initMixins);initMixins=null;rewatch(this);Ember.Mixin.finishPartial(this);this.init.apply(this,arguments)}else{if(hasChains){rewatch(this)}else{Ember.GUID_DESC.value=undefined;o_defineProperty(this,Ember.GUID_KEY,Ember.GUID_DESC)}if(init===false){init=this.init}Ember.GUID_DESC.value=undefined;o_defineProperty(this,"_super",Ember.GUID_DESC);Ember.Mixin.finishPartial(this);init.apply(this,arguments)}};Class.toString=classToString;Class.willReopen=function(){if(wasApplied){Class.PrototypeMixin=Ember.Mixin.create(Class.PrototypeMixin)}wasApplied=false};Class._initMixins=function(args){initMixins=args};Class.proto=function(){var superclass=Class.superclass;if(superclass){superclass.proto()}if(!wasApplied){wasApplied=true;Class.PrototypeMixin.applyPartial(Class.prototype);Ember.rewatch(Class.prototype);hasChains=!!meta(Class.prototype,false).chains}return this.prototype};return Class}var CoreObject=makeCtor();CoreObject.PrototypeMixin=Ember.Mixin.create({reopen:function(){Ember.Mixin._apply(this,arguments,true);return this},isInstance:true,init:function(){},isDestroyed:false,isDestroying:false,destroy:function(){if(this.isDestroying){return}this.isDestroying=true;if(this.willDestroy){this.willDestroy()}set(this,"isDestroyed",true);Ember.run.schedule("destroy",this,this._scheduledDestroy);return this},_scheduledDestroy:function(){Ember.destroy(this);if(this.didDestroy){this.didDestroy()}},bind:function(to,from){if(!(from instanceof Ember.Binding)){from=Ember.Binding.from(from)}from.to(to).connect(this);return from},toString:function(){return"<"+this.constructor.toString()+":"+Ember.guidFor(this)+">"}});CoreObject.__super__=null;var ClassMixin=Ember.Mixin.create({ClassMixin:Ember.required(),PrototypeMixin:Ember.required(),isClass:true,isMethod:false,extend:function(){var Class=makeCtor(),proto;Class.ClassMixin=Ember.Mixin.create(this.ClassMixin);Class.PrototypeMixin=Ember.Mixin.create(this.PrototypeMixin);Class.ClassMixin.ownerConstructor=Class;Class.PrototypeMixin.ownerConstructor=Class;var PrototypeMixin=Class.PrototypeMixin;PrototypeMixin.reopen.apply(PrototypeMixin,arguments);Class.superclass=this;Class.__super__=this.prototype;proto=Class.prototype=o_create(this.prototype);proto.constructor=Class;Ember.generateGuid(proto,"ember");meta(proto).proto=proto;Class.subclasses=Ember.Set?new Ember.Set():null;if(this.subclasses){this.subclasses.add(Class)}Class.ClassMixin.apply(Class);return Class},create:function(){var C=this;if(arguments.length>0){this._initMixins(arguments)}return new C()},reopen:function(){this.willReopen();var PrototypeMixin=this.PrototypeMixin;PrototypeMixin.reopen.apply(PrototypeMixin,arguments);return this},reopenClass:function(){var ClassMixin=this.ClassMixin;ClassMixin.reopen.apply(ClassMixin,arguments);Ember.Mixin._apply(this,arguments,false);return this},detect:function(obj){if("function"!==typeof obj){return false}while(obj){if(obj===this){return true}obj=obj.superclass}return false},detectInstance:function(obj){return obj instanceof this},metaForProperty:function(key){var desc=meta(this.proto(),false).descs[key];Ember.assert("metaForProperty() could not find a computed property with key '"+key+"'.",!!desc&&desc instanceof Ember.ComputedProperty);return desc._meta||{}},eachComputedProperty:function(callback,binding){var proto=this.proto(),descs=meta(proto).descs,empty={},property;for(var name in descs){property=descs[name];if(property instanceof Ember.ComputedProperty){callback.call(binding||this,name,property._meta||empty)}}}});CoreObject.ClassMixin=ClassMixin;ClassMixin.apply(CoreObject);Ember.CoreObject=CoreObject})();(function(){var get=Ember.get,set=Ember.set,guidFor=Ember.guidFor,none=Ember.none;Ember.Set=Ember.CoreObject.extend(Ember.MutableEnumerable,Ember.Copyable,Ember.Freezable,{length:0,clear:function(){if(this.isFrozen){throw new Error(Ember.FROZEN_ERROR)}var len=get(this,"length");if(len===0){return this}var guid;this.enumerableContentWillChange(len,0);Ember.propertyWillChange(this,"firstObject");Ember.propertyWillChange(this,"lastObject");for(var i=0;i<len;i++){guid=guidFor(this[i]);delete this[guid];delete this[i]}set(this,"length",0);Ember.propertyDidChange(this,"firstObject");Ember.propertyDidChange(this,"lastObject");this.enumerableContentDidChange(len,0);return this},isEqual:function(obj){if(!Ember.Enumerable.detect(obj)){return false}var loc=get(this,"length");if(get(obj,"length")!==loc){return false}while(--loc>=0){if(!obj.contains(this[loc])){return false}}return true},add:Ember.alias("addObject"),remove:Ember.alias("removeObject"),pop:function(){if(get(this,"isFrozen")){throw new Error(Ember.FROZEN_ERROR)}var obj=this.length>0?this[this.length-1]:null;this.remove(obj);return obj},push:Ember.alias("addObject"),shift:Ember.alias("pop"),unshift:Ember.alias("push"),addEach:Ember.alias("addObjects"),removeEach:Ember.alias("removeObjects"),init:function(items){this._super();if(items){this.addObjects(items)}},nextObject:function(idx){return this[idx]},firstObject:Ember.computed(function(){return this.length>0?this[0]:undefined}).property().cacheable(),lastObject:Ember.computed(function(){return this.length>0?this[this.length-1]:undefined}).property().cacheable(),addObject:function(obj){if(get(this,"isFrozen")){throw new Error(Ember.FROZEN_ERROR)}if(none(obj)){return this}var guid=guidFor(obj),idx=this[guid],len=get(this,"length"),added;if(idx>=0&&idx<len&&(this[idx]===obj)){return this}added=[obj];this.enumerableContentWillChange(null,added);Ember.propertyWillChange(this,"lastObject");len=get(this,"length");this[guid]=len;this[len]=obj;set(this,"length",len+1);Ember.propertyDidChange(this,"lastObject");this.enumerableContentDidChange(null,added);return this},removeObject:function(obj){if(get(this,"isFrozen")){throw new Error(Ember.FROZEN_ERROR)}if(none(obj)){return this}var guid=guidFor(obj),idx=this[guid],len=get(this,"length"),isFirst=idx===0,isLast=idx===len-1,last,removed;if(idx>=0&&idx<len&&(this[idx]===obj)){removed=[obj];this.enumerableContentWillChange(removed,null);if(isFirst){Ember.propertyWillChange(this,"firstObject")}if(isLast){Ember.propertyWillChange(this,"lastObject")}if(idx<len-1){last=this[len-1];this[idx]=last;this[guidFor(last)]=idx}delete this[guid];delete this[len-1];set(this,"length",len-1);if(isFirst){Ember.propertyDidChange(this,"firstObject")}if(isLast){Ember.propertyDidChange(this,"lastObject")}this.enumerableContentDidChange(removed,null)}return this},contains:function(obj){return this[guidFor(obj)]>=0},copy:function(){var C=this.constructor,ret=new C(),loc=get(this,"length");set(ret,"length",loc);while(--loc>=0){ret[loc]=this[loc];ret[guidFor(this[loc])]=loc}return ret},toString:function(){var len=this.length,idx,array=[];for(idx=0;idx<len;idx++){array[idx]=this[idx]}return"Ember.Set<%@>".fmt(array.join(","))}})})();(function(){Ember.CoreObject.subclasses=new Ember.Set();Ember.Object=Ember.CoreObject.extend(Ember.Observable)})();(function(){var indexOf=Ember.ArrayUtils.indexOf;Ember.Namespace=Ember.Object.extend({isNamespace:true,init:function(){Ember.Namespace.NAMESPACES.push(this);Ember.Namespace.PROCESSED=false},toString:function(){Ember.identifyNamespaces();return this[Ember.GUID_KEY+"_name"]},destroy:function(){var namespaces=Ember.Namespace.NAMESPACES;window[this.toString()]=undefined;namespaces.splice(indexOf(namespaces,this),1);this._super()}});Ember.Namespace.NAMESPACES=[Ember];Ember.Namespace.PROCESSED=false})();(function(){Ember.Application=Ember.Namespace.extend()})();(function(){var get=Ember.get,set=Ember.set;Ember.ArrayProxy=Ember.Object.extend(Ember.MutableArray,{content:null,objectAtContent:function(idx){return get(this,"content").objectAt(idx)},replaceContent:function(idx,amt,objects){get(this,"content").replace(idx,amt,objects)},contentWillChange:Ember.beforeObserver(function(){var content=get(this,"content"),len=content?get(content,"length"):0;this.arrayWillChange(content,0,len,undefined);if(content){content.removeArrayObserver(this)}},"content"),contentDidChange:Ember.observer(function(){var content=get(this,"content"),len=content?get(content,"length"):0;if(content){content.addArrayObserver(this)}this.arrayDidChange(content,0,undefined,len)},"content"),objectAt:function(idx){return get(this,"content")&&this.objectAtContent(idx)},length:Ember.computed(function(){var content=get(this,"content");return content?get(content,"length"):0}).property().cacheable(),replace:function(idx,amt,objects){if(get(this,"content")){this.replaceContent(idx,amt,objects)}return this},arrayWillChange:function(item,idx,removedCnt,addedCnt){this.arrayContentWillChange(idx,removedCnt,addedCnt)},arrayDidChange:function(item,idx,removedCnt,addedCnt){this.arrayContentDidChange(idx,removedCnt,addedCnt)},init:function(){this._super();this.contentWillChange();this.contentDidChange()}})})();(function(){var set=Ember.set,get=Ember.get,guidFor=Ember.guidFor;var forEach=Ember.ArrayUtils.forEach;var EachArray=Ember.Object.extend(Ember.Array,{init:function(content,keyName,owner){this._super();this._keyName=keyName;this._owner=owner;this._content=content},objectAt:function(idx){var item=this._content.objectAt(idx);return item&&get(item,this._keyName)},length:Ember.computed(function(){var content=this._content;return content?get(content,"length"):0}).property().cacheable()});var IS_OBSERVER=/^.+:(before|change)$/;function addObserverForContentKey(content,keyName,proxy,idx,loc){var objects=proxy._objects,guid;if(!objects){objects=proxy._objects={}}while(--loc>=idx){var item=content.objectAt(loc);if(item){Ember.addBeforeObserver(item,keyName,proxy,"contentKeyWillChange");Ember.addObserver(item,keyName,proxy,"contentKeyDidChange");guid=guidFor(item);if(!objects[guid]){objects[guid]=[]}objects[guid].push(loc)}}}function removeObserverForContentKey(content,keyName,proxy,idx,loc){var objects=proxy._objects;if(!objects){objects=proxy._objects={}}var indicies,guid;while(--loc>=idx){var item=content.objectAt(loc);if(item){Ember.removeBeforeObserver(item,keyName,proxy,"contentKeyWillChange");Ember.removeObserver(item,keyName,proxy,"contentKeyDidChange");guid=guidFor(item);indicies=objects[guid];indicies[indicies.indexOf(loc)]=null}}}Ember.EachProxy=Ember.Object.extend({init:function(content){this._super();this._content=content;content.addArrayObserver(this);forEach(Ember.watchedEvents(this),function(eventName){this.didAddListener(eventName)},this)},unknownProperty:function(keyName,value){var ret;ret=new EachArray(this._content,keyName,this);new Ember.Descriptor().setup(this,keyName,ret);this.beginObservingContentKey(keyName);return ret},arrayWillChange:function(content,idx,removedCnt,addedCnt){var keys=this._keys,key,array,lim;lim=removedCnt>0?idx+removedCnt:-1;Ember.beginPropertyChanges(this);for(key in keys){if(!keys.hasOwnProperty(key)){continue}if(lim>0){removeObserverForContentKey(content,key,this,idx,lim)}Ember.propertyWillChange(this,key)}Ember.propertyWillChange(this._content,"@each");Ember.endPropertyChanges(this)},arrayDidChange:function(content,idx,removedCnt,addedCnt){var keys=this._keys,key,array,lim;lim=addedCnt>0?idx+addedCnt:-1;Ember.beginPropertyChanges(this);for(key in keys){if(!keys.hasOwnProperty(key)){continue}if(lim>0){addObserverForContentKey(content,key,this,idx,lim)}Ember.propertyDidChange(this,key)}Ember.propertyDidChange(this._content,"@each");Ember.endPropertyChanges(this)},didAddListener:function(eventName){if(IS_OBSERVER.test(eventName)){this.beginObservingContentKey(eventName.slice(0,-7))}},didRemoveListener:function(eventName){if(IS_OBSERVER.test(eventName)){this.stopObservingContentKey(eventName.slice(0,-7))}},beginObservingContentKey:function(keyName){var keys=this._keys;if(!keys){keys=this._keys={}}if(!keys[keyName]){keys[keyName]=1;var content=this._content,len=get(content,"length");addObserverForContentKey(content,keyName,this,0,len)}else{keys[keyName]++}},stopObservingContentKey:function(keyName){var keys=this._keys;if(keys&&(keys[keyName]>0)&&(--keys[keyName]<=0)){var content=this._content,len=get(content,"length");removeObserverForContentKey(content,keyName,this,0,len)}},contentKeyWillChange:function(obj,keyName){Ember.propertyWillChange(this,keyName)},contentKeyDidChange:function(obj,keyName){Ember.propertyDidChange(this,keyName)}})})();(function(){var get=Ember.get,set=Ember.set;var NativeArray=Ember.Mixin.create(Ember.MutableArray,Ember.Observable,Ember.Copyable,{get:function(key){if(key==="length"){return this.length}else{if("number"===typeof key){return this[key]}else{return this._super(key)}}},objectAt:function(idx){return this[idx]},replace:function(idx,amt,objects){if(this.isFrozen){throw Ember.FROZEN_ERROR}var len=objects?get(objects,"length"):0;this.arrayContentWillChange(idx,amt,len);if(!objects||objects.length===0){this.splice(idx,amt)}else{var args=[idx,amt].concat(objects);this.splice.apply(this,args)}this.arrayContentDidChange(idx,amt,len);return this},unknownProperty:function(key,value){var ret;if((value!==undefined)&&ret===undefined){ret=this[key]=value}return ret},indexOf:function(object,startAt){var idx,len=this.length;if(startAt===undefined){startAt=0}else{startAt=(startAt<0)?Math.ceil(startAt):Math.floor(startAt)}if(startAt<0){startAt+=len}for(idx=startAt;idx<len;idx++){if(this[idx]===object){return idx}}return -1},lastIndexOf:function(object,startAt){var idx,len=this.length;if(startAt===undefined){startAt=len-1}else{startAt=(startAt<0)?Math.ceil(startAt):Math.floor(startAt)}if(startAt<0){startAt+=len}for(idx=startAt;idx>=0;idx--){if(this[idx]===object){return idx}}return -1},copy:function(){return this.slice()}});var ignore=["length"];Ember.ArrayUtils.forEach(NativeArray.keys(),function(methodName){if(Array.prototype[methodName]){ignore.push(methodName)}});if(ignore.length>0){NativeArray=NativeArray.without.apply(NativeArray,ignore)}Ember.NativeArray=NativeArray;Ember.A=function(arr){if(arr===undefined){arr=[]}return Ember.NativeArray.apply(arr)};Ember.NativeArray.activate=function(){NativeArray.apply(Array.prototype);Ember.A=function(arr){return arr||[]}};if(Ember.EXTEND_PROTOTYPES){Ember.NativeArray.activate()}})();(function(){var guidFor=Ember.guidFor;var indexOf=Ember.ArrayUtils.indexOf;var OrderedSet=Ember.OrderedSet=function(){this.clear()};OrderedSet.create=function(){return new OrderedSet()};OrderedSet.prototype={clear:function(){this.presenceSet={};this.list=[]},add:function(obj){var guid=guidFor(obj),presenceSet=this.presenceSet,list=this.list;if(guid in presenceSet){return}presenceSet[guid]=true;list.push(obj)},remove:function(obj){var guid=guidFor(obj),presenceSet=this.presenceSet,list=this.list;delete presenceSet[guid];var index=indexOf(list,obj);if(index>-1){list.splice(index,1)}},isEmpty:function(){return this.list.length===0},forEach:function(fn,self){var list=this.list.slice();for(var i=0,j=list.length;i<j;i++){fn.call(self,list[i])}},toArray:function(){return this.list.slice()}};var Map=Ember.Map=function(){this.keys=Ember.OrderedSet.create();this.values={}};Map.create=function(){return new Map()};Map.prototype={get:function(key){var values=this.values,guid=guidFor(key);return values[guid]},set:function(key,value){var keys=this.keys,values=this.values,guid=guidFor(key);keys.add(key);values[guid]=value},remove:function(key){var keys=this.keys,values=this.values,guid=guidFor(key),value;if(values.hasOwnProperty(guid)){keys.remove(key);value=values[guid];delete values[guid];return true}else{return false}},has:function(key){var values=this.values,guid=guidFor(key);return values.hasOwnProperty(guid)},forEach:function(callback,self){var keys=this.keys,values=this.values;keys.forEach(function(key){var guid=guidFor(key);callback.call(self,key,values[guid])})}}})();(function(){var loadHooks={};var loaded={};Ember.onLoad=function(name,callback){var object;loadHooks[name]=loadHooks[name]||Ember.A();loadHooks[name].pushObject(callback);if(object=loaded[name]){callback(object)}};Ember.runLoadHooks=function(name,object){var hooks;loaded[name]=object;if(hooks=loadHooks[name]){loadHooks[name].forEach(function(callback){callback(object)})}}})();(function(){})();(function(){Ember.ArrayController=Ember.ArrayProxy.extend()})();(function(){})();(function(){})();(function(){var get=Ember.get,set=Ember.set;Ember.Application=Ember.Namespace.extend({rootElement:"body",eventDispatcher:null,customEvents:null,init:function(){var eventDispatcher,rootElement=get(this,"rootElement");this._super();eventDispatcher=Ember.EventDispatcher.create({rootElement:rootElement});set(this,"eventDispatcher",eventDispatcher);if(Ember.$.isReady){Ember.run.once(this,this.didBecomeReady)}else{var self=this;Ember.$(document).ready(function(){Ember.run.once(self,self.didBecomeReady)})}},initialize:function(stateManager){var properties=Ember.A(Ember.keys(this)),injections=get(this.constructor,"injections"),namespace=this,controller,name;Ember.runLoadHooks("application",this);properties.forEach(function(property){injections.forEach(function(injection){injection(namespace,stateManager,property)})})},didBecomeReady:function(){var eventDispatcher=get(this,"eventDispatcher"),stateManager=get(this,"stateManager"),customEvents=get(this,"customEvents");eventDispatcher.setup(customEvents);this.ready();if(stateManager&&stateManager instanceof Ember.Router){this.setupStateManager(stateManager)}},setupStateManager:function(stateManager){var location=get(stateManager,"location");stateManager.route(location.getURL());location.onUpdateURL(function(url){stateManager.route(url)})},ready:Ember.K,destroy:function(){get(this,"eventDispatcher").destroy();return this._super()},registerInjection:function(callback){this.constructor.registerInjection(callback)}});Ember.Application.reopenClass({concatenatedProperties:["injections"],injections:Ember.A(),registerInjection:function(callback){get(this,"injections").pushObject(callback)}});Ember.Application.registerInjection(function(app,stateManager,property){if(!/^[A-Z].*Controller$/.test(property)){return}var name=property[0].toLowerCase()+property.substr(1),controller=app[property].create();stateManager.set(name,controller);controller.set("target",stateManager)})})();(function(){var get=Ember.get,set=Ember.set;Ember.HashLocation=Ember.Object.extend({init:function(){set(this,"location",get(this,"location")||window.location);set(this,"callbacks",Ember.A())},getURL:function(){return get(this,"location").hash.substr(1)},setURL:function(path){get(this,"location").hash=path;set(this,"lastSetURL",path)},onUpdateURL:function(callback){var self=this;var hashchange=function(){var path=location.hash.substr(1);if(get(self,"lastSetURL")===path){return}set(self,"lastSetURL",null);callback(location.hash.substr(1))};get(this,"callbacks").pushObject(hashchange);window.addEventListener("hashchange",hashchange)},willDestroy:function(){get(this,"callbacks").forEach(function(callback){window.removeEventListener("hashchange",callback)});set(this,"callbacks",null)}});Ember.Location={create:function(options){var style=options&&options.style;Ember.assert("you must provide a style to Ember.Location.create",!!style);if(style==="hash"){return Ember.HashLocation.create.apply(Ember.HashLocation,arguments)}}}})();(function(){})();(function(){})();(function(){Ember.assert("Ember Views require jQuery 1.6 or 1.7",window.jQuery&&window.jQuery().jquery.match(/^1\.[67](\.\d+)?(pre|rc\d?)?/));Ember.$=window.jQuery})();(function(){var get=Ember.get,set=Ember.set;var forEach=Ember.ArrayUtils.forEach;var indexOf=Ember.ArrayUtils.indexOf;var ClassSet=function(){this.seen={};this.list=[]};ClassSet.prototype={add:function(string){if(string in this.seen){return}this.seen[string]=true;this.list.push(string)},toDOM:function(){return this.list.join(" ")}};Ember.RenderBuffer=function(tagName){return new Ember._RenderBuffer(tagName)};Ember._RenderBuffer=function(tagName){this.elementTag=tagName;this.childBuffers=[]};Ember._RenderBuffer.prototype={elementClasses:null,elementId:null,elementAttributes:null,elementTag:null,elementStyle:null,parentBuffer:null,push:function(string){this.childBuffers.push(String(string));return this},addClass:function(className){var elementClasses=this.elementClasses=(this.elementClasses||new ClassSet());this.elementClasses.add(className);return this},id:function(id){this.elementId=id;return this},attr:function(name,value){var attributes=this.elementAttributes=(this.elementAttributes||{});if(arguments.length===1){return attributes[name]}else{attributes[name]=value}return this},removeAttr:function(name){var attributes=this.elementAttributes;if(attributes){delete attributes[name]}return this},style:function(name,value){var style=this.elementStyle=(this.elementStyle||{});this.elementStyle[name]=value;return this},newBuffer:function(tagName,parent,fn,other){var buffer=new Ember._RenderBuffer(tagName);buffer.parentBuffer=parent;if(other){buffer.setProperties(other)}if(fn){fn.call(this,buffer)}return buffer},replaceWithBuffer:function(newBuffer){var parent=this.parentBuffer;if(!parent){return}var childBuffers=parent.childBuffers;var index=indexOf(childBuffers,this);if(newBuffer){childBuffers.splice(index,1,newBuffer)}else{childBuffers.splice(index,1)}},begin:function(tagName){return this.newBuffer(tagName,this,function(buffer){this.childBuffers.push(buffer)})},prepend:function(tagName){return this.newBuffer(tagName,this,function(buffer){this.childBuffers.splice(0,0,buffer)})},replaceWith:function(tagName){var parentBuffer=this.parentBuffer;return this.newBuffer(tagName,parentBuffer,function(buffer){this.replaceWithBuffer(buffer)})},insertAfter:function(tagName){var parentBuffer=get(this,"parentBuffer");return this.newBuffer(tagName,parentBuffer,function(buffer){var siblings=parentBuffer.childBuffers;var index=indexOf(siblings,this);siblings.splice(index+1,0,buffer)})},end:function(){var parent=this.parentBuffer;return parent||this},remove:function(){this.replaceWithBuffer(null)},element:function(){return Ember.$(this.string())[0]},string:function(){var content="",tag=this.elementTag,openTag;if(tag){var id=this.elementId,classes=this.elementClasses,attrs=this.elementAttributes,style=this.elementStyle,styleBuffer="",prop;openTag=["<"+tag];if(id){openTag.push('id="'+this._escapeAttribute(id)+'"')}if(classes){openTag.push('class="'+this._escapeAttribute(classes.toDOM())+'"')}if(style){for(prop in style){if(style.hasOwnProperty(prop)){styleBuffer+=(prop+":"+this._escapeAttribute(style[prop])+";")}}openTag.push('style="'+styleBuffer+'"')}if(attrs){for(prop in attrs){if(attrs.hasOwnProperty(prop)){openTag.push(prop+'="'+this._escapeAttribute(attrs[prop])+'"')}}}openTag=openTag.join(" ")+">"}var childBuffers=this.childBuffers;forEach(childBuffers,function(buffer){var stringy=typeof buffer==="string";content+=(stringy?buffer:buffer.string())});if(tag){return openTag+content+"</"+tag+">"}else{return content}},_escapeAttribute:function(value){var escape={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var badChars=/&(?!\w+;)|[<>"'`]/g;var possible=/[&<>"'`]/;var escapeChar=function(chr){return escape[chr]||"&amp;"};var string=value.toString();if(!possible.test(string)){return string}return string.replace(badChars,escapeChar)}}})();(function(){var get=Ember.get,set=Ember.set,fmt=Ember.String.fmt;Ember.EventDispatcher=Ember.Object.extend({rootElement:"body",setup:function(addedEvents){var event,events={touchstart:"touchStart",touchmove:"touchMove",touchend:"touchEnd",touchcancel:"touchCancel",keydown:"keyDown",keyup:"keyUp",keypress:"keyPress",mousedown:"mouseDown",mouseup:"mouseUp",contextmenu:"contextMenu",click:"click",dblclick:"doubleClick",mousemove:"mouseMove",focusin:"focusIn",focusout:"focusOut",mouseenter:"mouseEnter",mouseleave:"mouseLeave",submit:"submit",input:"input",change:"change",dragstart:"dragStart",drag:"drag",dragenter:"dragEnter",dragleave:"dragLeave",dragover:"dragOver",drop:"drop",dragend:"dragEnd"};Ember.$.extend(events,addedEvents||{});var rootElement=Ember.$(get(this,"rootElement"));Ember.assert(fmt("You cannot use the same root element (%@) multiple times in an Ember.Application",[rootElement.selector||rootElement[0].tagName]),!rootElement.is(".ember-application"));Ember.assert("You cannot make a new Ember.Application using a root element that is a descendent of an existing Ember.Application",!rootElement.closest(".ember-application").length);Ember.assert("You cannot make a new Ember.Application using a root element that is an ancestor of an existing Ember.Application",!rootElement.find(".ember-application").length);rootElement.addClass("ember-application");Ember.assert('Unable to add "ember-application" class to rootElement. Make sure you set rootElement to the body or an element in the body.',rootElement.is(".ember-application"));for(event in events){if(events.hasOwnProperty(event)){this.setupHandler(rootElement,event,events[event])}}},setupHandler:function(rootElement,event,eventName){var self=this;rootElement.delegate(".ember-view",event+".ember",function(evt,triggeringManager){var view=Ember.View.views[this.id],result=true,manager=null;manager=self._findNearestEventManager(view,eventName);if(manager&&manager!==triggeringManager){result=self._dispatchEvent(manager,evt,eventName,view)}else{if(view){result=self._bubbleEvent(view,evt,eventName)}else{evt.stopPropagation()}}return result});rootElement.delegate("[data-ember-action]",event+".ember",function(evt){var actionId=Ember.$(evt.currentTarget).attr("data-ember-action"),action=Ember.Handlebars.ActionHelper.registeredActions[actionId],handler=action.handler;if(action.eventName===eventName){return handler(evt)}})},_findNearestEventManager:function(view,eventName){var manager=null;while(view){manager=get(view,"eventManager");if(manager&&manager[eventName]){break}view=get(view,"parentView")}return manager},_dispatchEvent:function(object,evt,eventName,view){var result=true;var handler=object[eventName];if(Ember.typeOf(handler)==="function"){result=handler.call(object,evt,view);evt.stopPropagation()}else{result=this._bubbleEvent(view,evt,eventName)}return result},_bubbleEvent:function(view,evt,eventName){return Ember.run(function(){return view.handleEvent(eventName,evt)})},destroy:function(){var rootElement=get(this,"rootElement");Ember.$(rootElement).undelegate(".ember").removeClass("ember-application");return this._super()}})})();(function(){var queues=Ember.run.queues;queues.splice(Ember.$.inArray("actions",queues)+1,0,"render")})();(function(){})();(function(){var get=Ember.get,set=Ember.set,addObserver=Ember.addObserver;var getPath=Ember.getPath,meta=Ember.meta,fmt=Ember.String.fmt;var a_slice=Array.prototype.slice;var a_forEach=Ember.ArrayUtils.forEach;var childViewsProperty=Ember.computed(function(){var childViews=get(this,"_childViews");var ret=Ember.A();a_forEach(childViews,function(view){if(view.isVirtual){ret.pushObjects(get(view,"childViews"))}else{ret.push(view)}});return ret}).property().cacheable();var VIEW_PRESERVES_CONTEXT=Ember.VIEW_PRESERVES_CONTEXT;Ember.warn("The way that the {{view}} helper affects templates is about to change. Previously, templates inside child views would use the new view as the context. Soon, views will preserve their parent context when rendering their template. You can opt-in early to the new behavior by setting `ENV.VIEW_PRESERVES_CONTEXT = true`. For more information, see https://gist.github.com/2494968. You should update your templates as soon as possible; this default will change soon, and the option will be eliminated entirely before the 1.0 release.",VIEW_PRESERVES_CONTEXT);Ember.TEMPLATES={};var invokeForState={preRender:{},inBuffer:{},hasElement:{},inDOM:{},destroyed:{}};Ember.View=Ember.Object.extend(Ember.Evented,{concatenatedProperties:["classNames","classNameBindings","attributeBindings"],isView:true,templateName:null,layoutName:null,templates:Ember.TEMPLATES,template:Ember.computed(function(key,value){if(value!==undefined){return value}var templateName=get(this,"templateName"),template=this.templateForName(templateName,"template");return template||get(this,"defaultTemplate")}).property("templateName").cacheable(),controller:null,layout:Ember.computed(function(key,value){if(arguments.length===2){return value}var layoutName=get(this,"layoutName"),layout=this.templateForName(layoutName,"layout");return layout||get(this,"defaultLayout")}).property("layoutName").cacheable(),templateForName:function(name,type){if(!name){return}var templates=get(this,"templates"),template=get(templates,name);if(!template){throw new Ember.Error(fmt('%@ - Unable to find %@ "%@".',[this,type,name]))}return template},templateContext:Ember.computed(function(key,value){if(arguments.length===2){set(this,"_templateContext",value);return value}else{return get(this,"_templateContext")}}).cacheable(),_templateContext:Ember.computed(function(key,value){var parentView;if(arguments.length===2){return value}if(VIEW_PRESERVES_CONTEXT){parentView=get(this,"_parentView");if(parentView){return get(parentView,"_templateContext")}}return this}).cacheable(),_displayPropertyDidChange:Ember.observer(function(){this.rerender()},"templateContext","controller"),parentView:Ember.computed(function(){var parent=get(this,"_parentView");if(parent&&parent.isVirtual){return get(parent,"parentView")}else{return parent}}).property("_parentView").uncached(),_parentView:null,concreteView:Ember.computed(function(){if(!this.isVirtual){return this}else{return get(this,"parentView")}}).property("_parentView").uncached(),isVisible:true,childViews:childViewsProperty,_childViews:[],_childViewsWillChange:Ember.beforeObserver(function(){if(this.isVirtual){var parentView=get(this,"parentView");if(parentView){Ember.propertyWillChange(parentView,"childViews")}}},"childViews"),_childViewsDidChange:Ember.observer(function(){if(this.isVirtual){var parentView=get(this,"parentView");if(parentView){Ember.propertyDidChange(parentView,"childViews")}}},"childViews"),nearestInstanceOf:function(klass){var view=get(this,"parentView");while(view){if(view instanceof klass){return view}view=get(view,"parentView")}},nearestWithProperty:function(property){var view=get(this,"parentView");while(view){if(property in view){return view}view=get(view,"parentView")}},nearestChildOf:function(klass){var view=get(this,"parentView");while(view){if(get(view,"parentView") instanceof klass){return view}view=get(view,"parentView")}},collectionView:Ember.computed(function(){return this.nearestInstanceOf(Ember.CollectionView)}).cacheable(),itemView:Ember.computed(function(){return this.nearestChildOf(Ember.CollectionView)}).cacheable(),contentView:Ember.computed(function(){return this.nearestWithProperty("content")}).cacheable(),_parentViewDidChange:Ember.observer(function(){if(this.isDestroying){return}this.invokeRecursively(function(view){view.propertyDidChange("collectionView");view.propertyDidChange("itemView");view.propertyDidChange("contentView")})},"_parentView"),cloneKeywords:function(){var templateData=get(this,"templateData"),controller=get(this,"controller");var keywords=templateData?Ember.copy(templateData.keywords):{};keywords.view=get(this,"concreteView");if(controller){keywords.controller=controller}return keywords},render:function(buffer){var template=get(this,"layout")||get(this,"template");if(template){var context=get(this,"_templateContext");var keywords=this.cloneKeywords();var data={view:this,buffer:buffer,isRenderData:true,keywords:keywords};Ember.assert("template must be a function. Did you mean to specify templateName instead?",typeof template==="function");var output=template(context,{data:data});if(output!==undefined){buffer.push(output)}}},invokeForState:function(name){var stateName=this.state,args;if(fn=invokeForState[stateName][name]){args=a_slice.call(arguments);args[0]=this;return fn.apply(this,args)}var parent=this,states=parent.states,state;while(states){state=states[stateName];while(state){var fn=state[name];if(fn){invokeForState[stateName][name]=fn;args=a_slice.call(arguments,1);args.unshift(this);return fn.apply(this,args)}state=state.parentState}states=states.parent}},rerender:function(){return this.invokeForState("rerender")},clearRenderedChildren:function(){var lengthBefore=this.lengthBeforeRender,lengthAfter=this.lengthAfterRender;var childViews=get(this,"_childViews");for(var i=lengthAfter-1;i>=lengthBefore;i--){if(childViews[i]){childViews[i].destroy()}}},_applyClassNameBindings:function(){var classBindings=get(this,"classNameBindings"),classNames=get(this,"classNames"),elem,newClass,dasherizedClass;if(!classBindings){return}a_forEach(classBindings,function(binding){var oldClass,property;var observer=function(){newClass=this._classStringForProperty(binding);elem=this.$();if(oldClass){elem.removeClass(oldClass);classNames.removeObject(oldClass)}if(newClass){elem.addClass(newClass);oldClass=newClass}else{oldClass=null}};dasherizedClass=this._classStringForProperty(binding);if(dasherizedClass){classNames.push(dasherizedClass);oldClass=dasherizedClass}property=binding.split(":")[0];addObserver(this,property,observer)},this)},_applyAttributeBindings:function(buffer){var attributeBindings=get(this,"attributeBindings"),attributeValue,elem,type;if(!attributeBindings){return}a_forEach(attributeBindings,function(binding){var split=binding.split(":"),property=split[0],attributeName=split[1]||property;var observer=function(){elem=this.$();attributeValue=get(this,property);Ember.View.applyAttributeBindings(elem,attributeName,attributeValue)};addObserver(this,property,observer);attributeValue=get(this,property);Ember.View.applyAttributeBindings(buffer,attributeName,attributeValue)},this)},_classStringForProperty:function(property){var split=property.split(":"),className=split[1];property=split[0];var val=Ember.getPath(this,property,false);if(val===undefined&&Ember.isGlobalPath(property)){val=Ember.getPath(window,property)}if(!!val&&className){return className}else{if(val===true){var parts=property.split(".");return Ember.String.dasherize(parts[parts.length-1])}else{if(val!==false&&val!==undefined&&val!==null){return val}else{return null}}}},element:Ember.computed(function(key,value){if(value!==undefined){return this.invokeForState("setElement",value)}else{return this.invokeForState("getElement")}}).property("_parentView").cacheable(),$:function(sel){return this.invokeForState("$",sel)},mutateChildViews:function(callback){var childViews=get(this,"_childViews"),idx=get(childViews,"length"),view;while(--idx>=0){view=childViews[idx];callback.call(this,view,idx)}return this},forEachChildView:function(callback){var childViews=get(this,"_childViews");if(!childViews){return this}var len=get(childViews,"length"),view,idx;for(idx=0;idx<len;idx++){view=childViews[idx];callback.call(this,view)}return this},appendTo:function(target){Ember.assert("You cannot append to an existing Ember.View. Consider using Ember.ContainerView instead.",!Ember.$(target).is(".ember-view")&&!Ember.$(target).parents().is(".ember-view"));this._insertElementLater(function(){this.$().appendTo(target)});return this},replaceIn:function(target){Ember.assert("You cannot replace an existing Ember.View. Consider using Ember.ContainerView instead.",!Ember.$(target).is(".ember-view")&&!Ember.$(target).parents().is(".ember-view"));this._insertElementLater(function(){Ember.$(target).empty();this.$().appendTo(target)});return this},_insertElementLater:function(fn){this._lastInsert=Ember.guidFor(fn);Ember.run.schedule("render",this,this.invokeForState,"insertElement",fn)},append:function(){return this.appendTo(document.body)},remove:function(){this.destroyElement();this.invokeRecursively(function(view){view.clearRenderedChildren()})},elementId:Ember.computed(function(key,value){return value!==undefined?value:Ember.guidFor(this)}).cacheable(),_elementIdDidChange:Ember.beforeObserver(function(){throw"Changing a view's elementId after creation is not allowed."},"elementId"),findElementInParentElement:function(parentElem){var id="#"+get(this,"elementId");return Ember.$(id)[0]||Ember.$(id,parentElem)[0]},renderBuffer:function(tagName){tagName=tagName||get(this,"tagName");if(tagName===null||tagName===undefined){tagName="div"}return Ember.RenderBuffer(tagName)},createElement:function(){if(get(this,"element")){return this}var buffer=this.renderToBuffer();set(this,"element",buffer.element());return this},willInsertElement:Ember.K,didInsertElement:Ember.K,willRerender:Ember.K,invokeRecursively:function(fn){fn.call(this,this);this.forEachChildView(function(view){view.invokeRecursively(fn)})},invalidateRecursively:function(key){this.forEachChildView(function(view){view.propertyDidChange(key)})},_notifyWillInsertElement:function(){this.invokeRecursively(function(view){view.fire("willInsertElement")})},_notifyDidInsertElement:function(){this.invokeRecursively(function(view){view.fire("didInsertElement")})},_notifyWillRerender:function(){this.invokeRecursively(function(view){view.fire("willRerender")})},destroyElement:function(){return this.invokeForState("destroyElement")},willDestroyElement:function(){},_notifyWillDestroyElement:function(){this.invokeRecursively(function(view){view.fire("willDestroyElement")})},_elementWillChange:Ember.beforeObserver(function(){this.forEachChildView(function(view){Ember.propertyWillChange(view,"element")})},"element"),_elementDidChange:Ember.observer(function(){this.forEachChildView(function(view){Ember.propertyDidChange(view,"element")})},"element"),parentViewDidChange:Ember.K,renderToBuffer:function(parentBuffer,bufferOperation){var buffer;Ember.run.sync();bufferOperation=bufferOperation||"begin";if(parentBuffer){var tagName=get(this,"tagName");if(tagName===null||tagName===undefined){tagName="div"}buffer=parentBuffer[bufferOperation](tagName)}else{buffer=this.renderBuffer()}this.buffer=buffer;this.transitionTo("inBuffer",false);this.lengthBeforeRender=get(get(this,"_childViews"),"length");this.beforeRender(buffer);this.render(buffer);this.afterRender(buffer);this.lengthAfterRender=get(get(this,"_childViews"),"length");return buffer},beforeRender:function(buffer){this.applyAttributesToBuffer(buffer)},afterRender:Ember.K,applyAttributesToBuffer:function(buffer){this._applyClassNameBindings();this._applyAttributeBindings(buffer);a_forEach(get(this,"classNames"),function(name){buffer.addClass(name)});buffer.id(get(this,"elementId"));var role=get(this,"ariaRole");if(role){buffer.attr("role",role)}if(get(this,"isVisible")===false){buffer.style("display","none")}},tagName:null,ariaRole:null,classNames:["ember-view"],classNameBindings:[],attributeBindings:[],state:"preRender",init:function(){this._super();Ember.View.views[get(this,"elementId")]=this;var childViews=get(this,"_childViews").slice();set(this,"_childViews",childViews);Ember.assert("Only arrays are allowed for 'classNameBindings'",Ember.typeOf(this.classNameBindings)==="array");this.classNameBindings=Ember.A(this.classNameBindings.slice());Ember.assert("Only arrays are allowed for 'classNames'",Ember.typeOf(this.classNames)==="array");this.classNames=Ember.A(this.classNames.slice());var viewController=get(this,"viewController");if(viewController){viewController=Ember.getPath(viewController);if(viewController){set(viewController,"view",this)}}},appendChild:function(view,options){return this.invokeForState("appendChild",view,options)},removeChild:function(view){if(this.isDestroying){return}set(view,"_parentView",null);var childViews=get(this,"_childViews");Ember.ArrayUtils.removeObject(childViews,view);this.propertyDidChange("childViews");return this},removeAllChildren:function(){return this.mutateChildViews(function(view){this.removeChild(view)})},destroyAllChildren:function(){return this.mutateChildViews(function(view){view.destroy()})},removeFromParent:function(){var parent=get(this,"_parentView");this.remove();if(parent){parent.removeChild(this)}return this},willDestroy:function(){var childViews=get(this,"_childViews"),parent=get(this,"_parentView"),elementId=get(this,"elementId"),childLen;if(!this.removedFromDOM){this.destroyElement()}if(this.viewName){var nonVirtualParentView=get(this,"parentView");if(nonVirtualParentView){set(nonVirtualParentView,this.viewName,null)}}if(parent){parent.removeChild(this)}this.state="destroyed";childLen=get(childViews,"length");for(var i=childLen-1;i>=0;i--){childViews[i].removedFromDOM=true;childViews[i].destroy()}delete Ember.View.views[get(this,"elementId")]},createChildView:function(view,attrs){var coreAttrs,templateData;if(Ember.View.detect(view)){coreAttrs={_parentView:this,templateData:get(this,"templateData")};if(attrs){view=view.create(coreAttrs,attrs)}else{view=view.create(coreAttrs)}var viewName=view.viewName;if(viewName){set(get(this,"concreteView"),viewName,view)}}else{Ember.assert("You must pass instance or subclass of View",view instanceof Ember.View);Ember.assert("You can only pass attributes when a class is provided",!attrs);if(!get(view,"templateData")){set(view,"templateData",get(this,"templateData"))}set(view,"_parentView",this)}return view},becameVisible:Ember.K,becameHidden:Ember.K,_isVisibleDidChange:Ember.observer(function(){var isVisible=get(this,"isVisible");this.$().toggle(isVisible);if(this._isAncestorHidden()){return}if(isVisible){this._notifyBecameVisible()}else{this._notifyBecameHidden()}},"isVisible"),_notifyBecameVisible:function(){this.fire("becameVisible");this.forEachChildView(function(view){var isVisible=get(view,"isVisible");if(isVisible||isVisible===null){view._notifyBecameVisible()}})},_notifyBecameHidden:function(){this.fire("becameHidden");this.forEachChildView(function(view){var isVisible=get(view,"isVisible");if(isVisible||isVisible===null){view._notifyBecameHidden()}})},_isAncestorHidden:function(){var parent=get(this,"parentView");while(parent){if(get(parent,"isVisible")===false){return true}parent=get(parent,"parentView")}return false},clearBuffer:function(){this.invokeRecursively(function(view){this.buffer=null})},transitionTo:function(state,children){this.state=state;if(children!==false){this.forEachChildView(function(view){view.transitionTo(state)})}},fire:function(name){if(this[name]){this[name].apply(this,[].slice.call(arguments,1))}this._super.apply(this,arguments)},handleEvent:function(eventName,evt){return this.invokeForState("handleEvent",eventName,evt)}});var DOMManager={prepend:function(view,childView){childView._insertElementLater(function(){var element=view.$();element.prepend(childView.$())})},after:function(view,nextView){nextView._insertElementLater(function(){var element=view.$();element.after(nextView.$())})},replace:function(view){var element=get(view,"element");set(view,"element",null);view._insertElementLater(function(){Ember.$(element).replaceWith(get(view,"element"))})},remove:function(view){var elem=get(view,"element");set(view,"element",null);view._lastInsert=null;Ember.$(elem).remove()},empty:function(view){view.$().empty()}};Ember.View.reopen({states:Ember.View.states,domManager:DOMManager});Ember.View.views={};Ember.View.childViewsProperty=childViewsProperty;Ember.View.applyAttributeBindings=function(elem,name,value){var type=Ember.typeOf(value);var currentValue=elem.attr(name);if((type==="string"||(type==="number"&&!isNaN(value)))&&value!==currentValue){elem.attr(name,value)}else{if(value&&type==="boolean"){elem.attr(name,name)}else{if(!value){elem.removeAttr(name)}}}}})();(function(){var get=Ember.get,set=Ember.set;Ember.View.states={_default:{appendChild:function(){throw"You can't use appendChild outside of the rendering process"},$:function(){return Ember.$()},getElement:function(){return null},handleEvent:function(){return true},destroyElement:function(view){set(view,"element",null);view._lastInsert=null;return view}}};Ember.View.reopen({states:Ember.View.states})})();(function(){Ember.View.states.preRender={parentState:Ember.View.states._default,insertElement:function(view,fn){if(view._lastInsert!==Ember.guidFor(fn)){return}view.createElement();view._notifyWillInsertElement();fn.call(view);view.transitionTo("inDOM");view._notifyDidInsertElement()},empty:Ember.K,setElement:function(view,value){view.beginPropertyChanges();view.invalidateRecursively("element");if(value!==null){view.transitionTo("hasElement")}view.endPropertyChanges();return value}}})();(function(){var get=Ember.get,set=Ember.set,meta=Ember.meta;Ember.View.states.inBuffer={parentState:Ember.View.states._default,$:function(view,sel){view.rerender();return Ember.$()},rerender:function(view){Ember.deprecate("Something you did caused a view to re-render after it rendered but before it was inserted into the DOM. Because this is avoidable and the cause of significant performance issues in applications, this behavior is deprecated. If you want to use the debugger to find out what caused this, you can set ENV.RAISE_ON_DEPRECATION to true.");view._notifyWillRerender();view.clearRenderedChildren();view.renderToBuffer(view.buffer,"replaceWith")},appendChild:function(view,childView,options){var buffer=view.buffer;childView=this.createChildView(childView,options);get(view,"_childViews").push(childView);childView.renderToBuffer(buffer);view.propertyDidChange("childViews");return childView},destroyElement:function(view){view.clearBuffer();view._notifyWillDestroyElement();view.transitionTo("preRender");return view},empty:function(){Ember.assert("Emptying a view in the inBuffer state is not allowed and should not happen under normal circumstances. Most likely there is a bug in your application. This may be due to excessive property change notifications.")},insertElement:function(){throw"You can't insert an element that has already been rendered"},setElement:function(view,value){view.invalidateRecursively("element");if(value===null){view.transitionTo("preRender")}else{view.clearBuffer();view.transitionTo("hasElement")}return value}}})();(function(){var get=Ember.get,set=Ember.set,meta=Ember.meta;Ember.View.states.hasElement={parentState:Ember.View.states._default,$:function(view,sel){var elem=get(view,"element");return sel?Ember.$(sel,elem):Ember.$(elem)},getElement:function(view){var parent=get(view,"parentView");if(parent){parent=get(parent,"element")}if(parent){return view.findElementInParentElement(parent)}return Ember.$("#"+get(view,"elementId"))[0]},setElement:function(view,value){if(value===null){view.invalidateRecursively("element");view.transitionTo("preRender")}else{throw"You cannot set an element to a non-null value when the element is already in the DOM."}return value},rerender:function(view){view._notifyWillRerender();view.clearRenderedChildren();view.domManager.replace(view);return view},destroyElement:function(view){view._notifyWillDestroyElement();view.domManager.remove(view);return view},empty:function(view){var _childViews=get(view,"_childViews"),len,idx;if(_childViews){len=get(_childViews,"length");for(idx=0;idx<len;idx++){_childViews[idx]._notifyWillDestroyElement()}}view.domManager.empty(view)},handleEvent:function(view,eventName,evt){var handler=view[eventName];if(Ember.typeOf(handler)==="function"){return handler.call(view,evt)}else{return true}}};Ember.View.states.inDOM={parentState:Ember.View.states.hasElement,insertElement:function(view,fn){if(view._lastInsert!==Ember.guidFor(fn)){return}throw"You can't insert an element into the DOM that has already been inserted"}}})();(function(){var destroyedError="You can't call %@ on a destroyed view",fmt=Ember.String.fmt;Ember.View.states.destroyed={parentState:Ember.View.states._default,appendChild:function(){throw fmt(destroyedError,["appendChild"])},rerender:function(){throw fmt(destroyedError,["rerender"])},destroyElement:function(){throw fmt(destroyedError,["destroyElement"])},empty:function(){throw fmt(destroyedError,["empty"])},setElement:function(){throw fmt(destroyedError,["set('element', ...)"])},insertElement:Ember.K}})();(function(){})();(function(){var get=Ember.get,set=Ember.set,meta=Ember.meta;var forEach=Ember.ArrayUtils.forEach;var childViewsProperty=Ember.computed(function(){return get(this,"_childViews")}).property("_childViews").cacheable();Ember.ContainerView=Ember.View.extend({init:function(){var childViews=get(this,"childViews");Ember.defineProperty(this,"childViews",childViewsProperty);this._super();var _childViews=get(this,"_childViews");forEach(childViews,function(viewName,idx){var view;if("string"===typeof viewName){view=get(this,viewName);view=this.createChildView(view);set(this,viewName,view)}else{view=this.createChildView(viewName)}_childViews[idx]=view},this);Ember.A(_childViews);get(this,"childViews").addArrayObserver(this,{willChange:"childViewsWillChange",didChange:"childViewsDidChange"})},render:function(buffer){this.forEachChildView(function(view){view.renderToBuffer(buffer)})},willDestroy:function(){get(this,"childViews").removeArrayObserver(this,{willChange:"childViewsWillChange",didChange:"childViewsDidChange"});this._super()},childViewsWillChange:function(views,start,removed){if(removed===0){return}var changedViews=views.slice(start,start+removed);this.initializeViews(changedViews,null,null);this.invokeForState("childViewsWillChange",views,start,removed)},childViewsDidChange:function(views,start,removed,added){var len=get(views,"length");if(added===0){return}var changedViews=views.slice(start,start+added);this.initializeViews(changedViews,this,get(this,"templateData"));this.invokeForState("childViewsDidChange",views,start,added)},initializeViews:function(views,parentView,templateData){forEach(views,function(view){set(view,"_parentView",parentView);if(!get(view,"templateData")){set(view,"templateData",templateData)}})},_scheduleInsertion:function(view,prev){if(prev){prev.domManager.after(prev,view)}else{this.domManager.prepend(this,view)}},currentView:null,_currentViewWillChange:Ember.beforeObserver(function(){var childViews=get(this,"childViews"),currentView=get(this,"currentView");if(currentView){childViews.removeObject(currentView)}},"currentView"),_currentViewDidChange:Ember.observer(function(){var childViews=get(this,"childViews"),currentView=get(this,"currentView");if(currentView){childViews.pushObject(currentView)}},"currentView")});Ember.ContainerView.states={parent:Ember.View.states,inBuffer:{childViewsDidChange:function(parentView,views,start,added){var buffer=parentView.buffer,startWith,prev,prevBuffer,view;if(start===0){view=views[start];startWith=start+1;view.renderToBuffer(buffer,"prepend")}else{view=views[start-1];startWith=start}for(var i=startWith;i<start+added;i++){prev=view;view=views[i];prevBuffer=prev.buffer;view.renderToBuffer(prevBuffer,"insertAfter")}}},hasElement:{childViewsWillChange:function(view,views,start,removed){for(var i=start;i<start+removed;i++){views[i].remove()}},childViewsDidChange:function(view,views,start,added){var prev=start===0?null:views[start-1];for(var i=start;i<start+added;i++){view=views[i];this._scheduleInsertion(view,prev);prev=view}}}};Ember.ContainerView.states.inDOM={parentState:Ember.ContainerView.states.hasElement};Ember.ContainerView.reopen({states:Ember.ContainerView.states})})();(function(){var get=Ember.get,set=Ember.set,fmt=Ember.String.fmt;Ember.CollectionView=Ember.ContainerView.extend({content:null,emptyViewClass:Ember.View,emptyView:null,itemViewClass:Ember.View,init:function(){var ret=this._super();this._contentDidChange();return ret},_contentWillChange:Ember.beforeObserver(function(){var content=this.get("content");if(content){content.removeArrayObserver(this)}var len=content?get(content,"length"):0;this.arrayWillChange(content,0,len)},"content"),_contentDidChange:Ember.observer(function(){var content=get(this,"content");if(content){Ember.assert(fmt("an Ember.CollectionView's content must implement Ember.Array. You passed %@",[content]),Ember.Array.detect(content));content.addArrayObserver(this)}var len=content?get(content,"length"):0;this.arrayDidChange(content,0,null,len)},"content"),willDestroy:function(){var content=get(this,"content");if(content){content.removeArrayObserver(this)}this._super()},arrayWillChange:function(content,start,removedCount){var emptyView=get(this,"emptyView");if(emptyView&&emptyView instanceof Ember.View){emptyView.removeFromParent()}var childViews=get(this,"childViews"),childView,idx,len;len=get(childViews,"length");var removingAll=removedCount===len;if(removingAll){this.invokeForState("empty")}for(idx=start+removedCount-1;idx>=start;idx--){childView=childViews[idx];if(removingAll){childView.removedFromDOM=true}childView.destroy()}},arrayDidChange:function(content,start,removed,added){var itemViewClass=get(this,"itemViewClass"),childViews=get(this,"childViews"),addedViews=[],view,item,idx,len,itemTagName;if("string"===typeof itemViewClass){itemViewClass=Ember.getPath(itemViewClass)}Ember.assert(fmt("itemViewClass must be a subclass of Ember.View, not %@",[itemViewClass]),Ember.View.detect(itemViewClass));len=content?get(content,"length"):0;if(len){for(idx=start;idx<start+added;idx++){item=content.objectAt(idx);view=this.createChildView(itemViewClass,{content:item,contentIndex:idx});addedViews.push(view)}}else{var emptyView=get(this,"emptyView");if(!emptyView){return}emptyView=this.createChildView(emptyView);addedViews.push(emptyView);set(this,"emptyView",emptyView)}childViews.replace(start,0,addedViews)},createChildView:function(view,attrs){view=this._super(view,attrs);var itemTagName=get(view,"tagName");var tagName=(itemTagName===null||itemTagName===undefined)?Ember.CollectionView.CONTAINER_MAP[get(this,"tagName")]:itemTagName;set(view,"tagName",tagName);return view}});Ember.CollectionView.CONTAINER_MAP={ul:"li",ol:"li",table:"tr",thead:"tr",tbody:"tr",tfoot:"tr",tr:"td",select:"option"}})();(function(){})();(function(){})();(function(){var get=Ember.get,set=Ember.set,getPath=Ember.getPath;Ember.State=Ember.Object.extend(Ember.Evented,{isState:true,parentState:null,start:null,name:null,path:Ember.computed(function(){var parentPath=getPath(this,"parentState.path"),path=get(this,"name");if(parentPath){path=parentPath+"."+path}return path}).property().cacheable(),fire:function(name){if(this[name]){this[name].apply(this,[].slice.call(arguments,1))}this._super.apply(this,arguments)},init:function(){var states=get(this,"states"),foundStates;set(this,"childStates",Ember.A());var name;if(!states){states={};for(name in this){if(name==="constructor"){continue}this.setupChild(states,name,this[name])}set(this,"states",states)}else{for(name in states){this.setupChild(states,name,states[name])}}set(this,"routes",{})},setupChild:function(states,name,value){if(!value){return false}if(Ember.State.detect(value)){value=value.create({name:name})}else{if(value.isState){set(value,"name",name)}}if(value.isState){set(value,"parentState",this);get(this,"childStates").pushObject(value);states[name]=value}},isLeaf:Ember.computed(function(){return !get(this,"childStates").length}).cacheable(),setupControllers:Ember.K,enter:Ember.K,exit:Ember.K})})();(function(){var get=Ember.get,set=Ember.set,getPath=Ember.getPath,fmt=Ember.String.fmt;Ember.StateManager=Ember.State.extend({init:function(){this._super();set(this,"stateMeta",Ember.Map.create());var initialState=get(this,"initialState");if(!initialState&&getPath(this,"states.start")){initialState="start"}if(initialState){this.goToState(initialState)}},currentState:null,errorOnUnhandledEvent:true,send:function(event,context){this.sendRecursively(event,get(this,"currentState"),context)},sendRecursively:function(event,currentState,context){var log=this.enableLogging;var action=currentState[event];if(typeof action==="function"){if(log){Ember.Logger.log(fmt("STATEMANAGER: Sending event '%@' to state %@.",[event,get(currentState,"path")]))}action.call(currentState,this,context)}else{var parentState=get(currentState,"parentState");if(parentState){this.sendRecursively(event,parentState,context)}else{if(get(this,"errorOnUnhandledEvent")){throw new Ember.Error(this.toString()+" could not respond to event "+event+" in state "+getPath(this,"currentState.path")+".")}}}},findStatesByRoute:function(state,route){if(!route||route===""){return undefined}var r=route.split("."),ret=[];for(var i=0,len=r.length;i<len;i+=1){var states=get(state,"states");if(!states){return undefined}var s=get(states,r[i]);if(s){state=s;ret.push(s)}else{return undefined}}return ret},goToState:function(){return this.transitionTo.apply(this,arguments)},pathForSegments:function(array){return Ember.ArrayUtils.map(array,function(tuple){Ember.assert("A segment passed to transitionTo must be an Array",Ember.typeOf(tuple)==="array");return tuple[0]}).join(".")},transitionTo:function(name,context){if(Ember.empty(name)){return}var segments;if(Ember.typeOf(name)==="array"){segments=Array.prototype.slice.call(arguments)}else{segments=[[name,context]]}var path=this.pathForSegments(segments);var currentState=get(this,"currentState")||this,state,newState;var exitStates=[],enterStates,resolveState;state=currentState;if(state.routes[path]){var route=state.routes[path];exitStates=route.exitStates;enterStates=route.enterStates;state=route.futureState;resolveState=route.resolveState}else{newState=this.findStatesByRoute(currentState,path);while(state&&!newState){exitStates.unshift(state);state=get(state,"parentState");if(!state){newState=this.findStatesByRoute(this,path);if(!newState){return}}newState=this.findStatesByRoute(state,path)}resolveState=state;enterStates=newState.slice(0);exitStates=exitStates.slice(0);if(enterStates.length>0){state=enterStates[enterStates.length-1];while(enterStates.length>0&&enterStates[0]===exitStates[0]){enterStates.shift();exitStates.shift()}}currentState.routes[path]={exitStates:exitStates,enterStates:enterStates,futureState:state,resolveState:resolveState}}this.enterState(exitStates,enterStates,state);this.triggerSetupContext(resolveState,segments)},triggerSetupContext:function(root,segments){var state=root;Ember.ArrayUtils.forEach(segments,function(tuple){var path=tuple[0],context=tuple[1];state=this.findStatesByRoute(state,path);state=state[state.length-1];state.fire("setupControllers",this,context)},this)},getState:function(name){var state=get(this,name),parentState=get(this,"parentState");if(state){return state}else{if(parentState){return parentState.getState(name)}}},asyncEach:function(list,callback,doneCallback){var async=false,self=this;if(!list.length){if(doneCallback){doneCallback.call(this)}return}var head=list[0];var tail=list.slice(1);var transition={async:function(){async=true},resume:function(){self.asyncEach(tail,callback,doneCallback)}};callback.call(this,head,transition);if(!async){transition.resume()}},enterState:function(exitStates,enterStates,state){var log=this.enableLogging;var stateManager=this;exitStates=exitStates.slice(0).reverse();this.asyncEach(exitStates,function(state,transition){state.fire("exit",stateManager,transition)},function(){this.asyncEach(enterStates,function(state,transition){if(log){Ember.Logger.log("STATEMANAGER: Entering "+get(state,"path"))}state.fire("enter",stateManager,transition)},function(){var startState=state,enteredState,initialState;initialState=get(startState,"initialState");if(!initialState){initialState="start"}while(startState=get(get(startState,"states"),initialState)){enteredState=startState;if(log){Ember.Logger.log("STATEMANAGER: Entering "+get(startState,"path"))}startState.fire("enter",stateManager);initialState=get(startState,"initialState");if(!initialState){initialState="start"}}set(this,"currentState",enteredState||state)})})}})})();(function(){var escapeForRegex=function(text){return text.replace(/[\-\[\]{}()*+?.,\\\^\$|#\s]/g,"\\$&")};Ember._RouteMatcher=Ember.Object.extend({state:null,init:function(){var route=this.route,identifiers=[],count=1,escaped;if(route.charAt(0)==="/"){route=this.route=route.substr(1)}escaped=escapeForRegex(route);var regex=escaped.replace(/:([a-z_]+)(?=$|\/)/gi,function(match,id){identifiers[count++]=id;return"([^/]+)"});this.identifiers=identifiers;this.regex=new RegExp("^/?"+regex)},match:function(path){var match=path.match(this.regex);if(match){var identifiers=this.identifiers,hash={};for(var i=1,l=identifiers.length;i<l;i++){hash[identifiers[i]]=match[i]}return{remaining:path.substr(match[0].length),hash:hash}}},generate:function(hash){var identifiers=this.identifiers,route=this.route,id;for(var i=1,l=identifiers.length;i<l;i++){id=identifiers[i];route=route.replace(new RegExp(":"+id),hash[id])}return route}})})();(function(){var get=Ember.get,getPath=Ember.getPath;Ember.Routable=Ember.Mixin.create({init:function(){this.on("setupControllers",this,this.stashContext);this._super()},stashContext:function(manager,context){var meta=get(manager,"stateMeta"),serialized=this.serialize(manager,context);meta.set(this,serialized);if(get(this,"isRoutable")){this.updateRoute(manager,get(manager,"location"))}},updateRoute:function(manager,location){if(location&&get(this,"isLeaf")){var path=this.absoluteRoute(manager);location.setURL(path)}},absoluteRoute:function(manager){var parentState=get(this,"parentState");var path="";if(get(parentState,"isRoutable")){path=parentState.absoluteRoute(manager)}var matcher=get(this,"routeMatcher"),hash=get(manager,"stateMeta").get(this);var generated=matcher.generate(hash);if(generated!==""){return path+"/"+matcher.generate(hash)}else{return path}},isRoutable:Ember.computed(function(){return typeof this.route==="string"}).cacheable(),routeMatcher:Ember.computed(function(){return Ember._RouteMatcher.create({route:get(this,"route")})}).cacheable(),deserialize:function(manager,context){return context},serialize:function(manager,context){return context},routePath:function(manager,path){if(get(this,"isLeaf")){return}var childStates=get(this,"childStates"),match;childStates=childStates.sort(function(a,b){return getPath(b,"route.length")-getPath(a,"route.length")});var state=childStates.find(function(state){var matcher=get(state,"routeMatcher");if(match=matcher.match(path)){return true}});Ember.assert("Could not find state for path "+path,!!state);var object=state.deserialize(manager,match.hash)||{};manager.transitionTo(get(state,"path"),object);manager.send("routePath",match.remaining)}});Ember.State.reopen(Ember.Routable)})();(function(){Ember.Router=Ember.StateManager.extend({route:function(path){if(path.charAt(0)==="/"){path=path.substr(1)}this.send("routePath",path)}})})();(function(){})();(function(){var get=Ember.get,set=Ember.set,getPath=Ember.getPath,fmt=Ember.String.fmt;Ember.StateManager.reopen({currentView:Ember.computed(function(){var currentState=get(this,"currentState"),view;while(currentState){if(get(currentState,"isViewState")){view=get(currentState,"view");if(view){return view}}currentState=get(currentState,"parentState")}return null}).property("currentState").cacheable()})})();(function(){var get=Ember.get,set=Ember.set;Ember.ViewState=Ember.State.extend({isViewState:true,enter:function(stateManager){var view=get(this,"view"),root,childViews;if(view){if(Ember.View.detect(view)){view=view.create();set(this,"view",view)}Ember.assert("view must be an Ember.View",view instanceof Ember.View);root=stateManager.get("rootView");if(root){childViews=get(root,"childViews");childViews.pushObject(view)}else{root=stateManager.get("rootElement")||"body";view.appendTo(root)}}},exit:function(stateManager){var view=get(this,"view");if(view){if(get(view,"parentView")){view.removeFromParent()}else{view.remove()}}}})})();(function(){})();(function(){(function(window){var K=function(){},guid=0,document=window.document,supportsRange=("createRange" in document)&&(typeof Range!=="undefined")&&Range.prototype.createContextualFragment,needsShy=(function(){var testEl=document.createElement("div");testEl.innerHTML="<div></div>";testEl.firstChild.innerHTML="<script><\/script>";return testEl.firstChild.innerHTML===""})();var Metamorph=function(html){var self;if(this instanceof Metamorph){self=this}else{self=new K()}self.innerHTML=html;var myGuid="metamorph-"+(guid++);self.start=myGuid+"-start";self.end=myGuid+"-end";return self};K.prototype=Metamorph.prototype;var rangeFor,htmlFunc,removeFunc,outerHTMLFunc,appendToFunc,afterFunc,prependFunc,startTagFunc,endTagFunc;outerHTMLFunc=function(){return this.startTag()+this.innerHTML+this.endTag()};startTagFunc=function(){return"<script id='"+this.start+"' type='text/x-placeholder'><\/script>"};endTagFunc=function(){return"<script id='"+this.end+"' type='text/x-placeholder'><\/script>"};if(supportsRange){rangeFor=function(morph,outerToo){var range=document.createRange();var before=document.getElementById(morph.start);var after=document.getElementById(morph.end);if(outerToo){range.setStartBefore(before);range.setEndAfter(after)}else{range.setStartAfter(before);range.setEndBefore(after)}return range};htmlFunc=function(html,outerToo){var range=rangeFor(this,outerToo);range.deleteContents();var fragment=range.createContextualFragment(html);range.insertNode(fragment)};removeFunc=function(){var range=rangeFor(this,true);range.deleteContents()};appendToFunc=function(node){var range=document.createRange();range.setStart(node);range.collapse(false);var frag=range.createContextualFragment(this.outerHTML());node.appendChild(frag)};afterFunc=function(html){var range=document.createRange();var after=document.getElementById(this.end);range.setStartAfter(after);range.setEndAfter(after);var fragment=range.createContextualFragment(html);range.insertNode(fragment)};prependFunc=function(html){var range=document.createRange();var start=document.getElementById(this.start);range.setStartAfter(start);range.setEndAfter(start);var fragment=range.createContextualFragment(html);range.insertNode(fragment)}}else{var wrapMap={select:[1,"<select multiple='multiple'>","</select>"],fieldset:[1,"<fieldset>","</fieldset>"],table:[1,"<table>","</table>"],tbody:[2,"<table><tbody>","</tbody></table>"],tr:[3,"<table><tbody><tr>","</tr></tbody></table>"],colgroup:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],map:[1,"<map>","</map>"],_default:[0,"",""]};var firstNodeFor=function(parentNode,html){var arr=wrapMap[parentNode.tagName.toLowerCase()]||wrapMap._default;var depth=arr[0],start=arr[1],end=arr[2];if(needsShy){html="&shy;"+html}var element=document.createElement("div");element.innerHTML=start+html+end;for(var i=0;i<=depth;i++){element=element.firstChild}if(needsShy){var shyElement=element;while(shyElement.nodeType===1&&!shyElement.nodeName){shyElement=shyElement.firstChild}if(shyElement.nodeType===3&&shyElement.nodeValue.charAt(0)==="\u00AD"){shyElement.nodeValue=shyElement.nodeValue.slice(1)}}return element};var realNode=function(start){while(start.parentNode.tagName===""){start=start.parentNode}return start};var fixParentage=function(start,end){if(start.parentNode!==end.parentNode){end.parentNode.insertBefore(start,end.parentNode.firstChild)}};htmlFunc=function(html,outerToo){var start=realNode(document.getElementById(this.start));var end=document.getElementById(this.end);var parentNode=end.parentNode;var node,nextSibling,last;fixParentage(start,end);node=start.nextSibling;while(node){nextSibling=node.nextSibling;last=node===end;if(last){if(outerToo){end=node.nextSibling}else{break}}node.parentNode.removeChild(node);if(last){break}node=nextSibling}node=firstNodeFor(start.parentNode,html);while(node){nextSibling=node.nextSibling;parentNode.insertBefore(node,end);node=nextSibling}};removeFunc=function(){var start=realNode(document.getElementById(this.start));var end=document.getElementById(this.end);this.html("");start.parentNode.removeChild(start);end.parentNode.removeChild(end)};appendToFunc=function(parentNode){var node=firstNodeFor(parentNode,this.outerHTML());while(node){nextSibling=node.nextSibling;parentNode.appendChild(node);node=nextSibling}};afterFunc=function(html){var end=document.getElementById(this.end);var insertBefore=end.nextSibling;var parentNode=end.parentNode;var nextSibling;var node;node=firstNodeFor(parentNode,html);while(node){nextSibling=node.nextSibling;parentNode.insertBefore(node,insertBefore);node=nextSibling}};prependFunc=function(html){var start=document.getElementById(this.start);var parentNode=start.parentNode;var nextSibling;var node;node=firstNodeFor(parentNode,html);var insertBefore=start.nextSibling;while(node){nextSibling=node.nextSibling;parentNode.insertBefore(node,insertBefore);node=nextSibling}}}Metamorph.prototype.html=function(html){this.checkRemoved();if(html===undefined){return this.innerHTML}htmlFunc.call(this,html);this.innerHTML=html};Metamorph.prototype.replaceWith=function(html){this.checkRemoved();htmlFunc.call(this,html,true)};Metamorph.prototype.remove=removeFunc;Metamorph.prototype.outerHTML=outerHTMLFunc;Metamorph.prototype.appendTo=appendToFunc;Metamorph.prototype.after=afterFunc;Metamorph.prototype.prepend=prependFunc;Metamorph.prototype.startTag=startTagFunc;Metamorph.prototype.endTag=endTagFunc;Metamorph.prototype.isRemoved=function(){var before=document.getElementById(this.start);var after=document.getElementById(this.end);return !before||!after};Metamorph.prototype.checkRemoved=function(){if(this.isRemoved()){throw new Error("Cannot perform operations on a Metamorph that is not in the DOM.")}};window.Metamorph=Metamorph})(this)})();(function(){Ember.Handlebars=Ember.create(Handlebars);Ember.Handlebars.helpers=Ember.create(Handlebars.helpers);Ember.Handlebars.Compiler=function(){};Ember.Handlebars.Compiler.prototype=Ember.create(Handlebars.Compiler.prototype);Ember.Handlebars.Compiler.prototype.compiler=Ember.Handlebars.Compiler;Ember.Handlebars.JavaScriptCompiler=function(){};Ember.Handlebars.JavaScriptCompiler.prototype=Ember.create(Handlebars.JavaScriptCompiler.prototype);Ember.Handlebars.JavaScriptCompiler.prototype.compiler=Ember.Handlebars.JavaScriptCompiler;Ember.Handlebars.JavaScriptCompiler.prototype.namespace="Ember.Handlebars";Ember.Handlebars.JavaScriptCompiler.prototype.initializeBuffer=function(){return"''"};Ember.Handlebars.JavaScriptCompiler.prototype.appendToBuffer=function(string){return"data.buffer.push("+string+");"};Ember.Handlebars.Compiler.prototype.mustache=function(mustache){if(mustache.params.length||mustache.hash){return Handlebars.Compiler.prototype.mustache.call(this,mustache)}else{var id=new Handlebars.AST.IdNode(["_triageMustache"]);if(mustache.escaped){mustache.hash=mustache.hash||new Handlebars.AST.HashNode([]);mustache.hash.pairs.push(["escaped",new Handlebars.AST.StringNode("true")])}mustache=new Handlebars.AST.MustacheNode([id].concat([mustache.id]),mustache.hash,!mustache.escaped);return Handlebars.Compiler.prototype.mustache.call(this,mustache)}};Ember.Handlebars.precompile=function(string){var ast=Handlebars.parse(string);var options={data:true,stringParams:true};var environment=new Ember.Handlebars.Compiler().compile(ast,options);return new Ember.Handlebars.JavaScriptCompiler().compile(environment,options,undefined,true)};Ember.Handlebars.compile=function(string){var ast=Handlebars.parse(string);var options={data:true,stringParams:true};var environment=new Ember.Handlebars.Compiler().compile(ast,options);var templateSpec=new Ember.Handlebars.JavaScriptCompiler().compile(environment,options,undefined,true);return Handlebars.template(templateSpec)};var normalizePath=Ember.Handlebars.normalizePath=function(root,path,data){var keywords=(data&&data.keywords)||{},keyword,isKeyword;keyword=path.split(".",1)[0];if(keywords.hasOwnProperty(keyword)){root=keywords[keyword];isKeyword=true;if(path===keyword){path=""}else{path=path.substr(keyword.length)}}return{root:root,path:path,isKeyword:isKeyword}};Ember.Handlebars.getPath=function(root,path,options){var data=options&&options.data,normalizedPath=normalizePath(root,path,data),value;root=normalizedPath.root;path=normalizedPath.path;value=Ember.getPath(root,path);if(value===undefined&&root!==window&&Ember.isGlobalPath(path)){value=Ember.getPath(window,path)}return value};Ember.Handlebars.registerHelper("helperMissing",function(path,options){var error,view="";error="%@ Handlebars error: Could not find property '%@' on object %@.";if(options.data){view=options.data.view}throw new Ember.Error(Ember.String.fmt(error,[view,path,this]))})})();(function(){Ember.String.htmlSafe=function(str){return new Handlebars.SafeString(str)};var htmlSafe=Ember.String.htmlSafe;if(Ember.EXTEND_PROTOTYPES){String.prototype.htmlSafe=function(){return htmlSafe(this)}}})();(function(){var set=Ember.set,get=Ember.get,getPath=Ember.getPath;var DOMManager={remove:function(view){var morph=view.morph;if(morph.isRemoved()){return}set(view,"element",null);view._lastInsert=null;morph.remove()},prepend:function(view,childView){childView._insertElementLater(function(){var morph=view.morph;morph.prepend(childView.outerHTML);childView.outerHTML=null})},after:function(view,nextView){nextView._insertElementLater(function(){var morph=view.morph;morph.after(nextView.outerHTML);nextView.outerHTML=null})},replace:function(view){var morph=view.morph;view.transitionTo("preRender");view.clearRenderedChildren();var buffer=view.renderToBuffer();Ember.run.schedule("render",this,function(){if(get(view,"isDestroyed")){return}view.invalidateRecursively("element");view._notifyWillInsertElement();morph.replaceWith(buffer.string());view.transitionTo("inDOM");view._notifyDidInsertElement()})},empty:function(view){view.morph.html("")}};Ember._Metamorph=Ember.Mixin.create({isVirtual:true,tagName:"",init:function(){this._super();this.morph=Metamorph()},beforeRender:function(buffer){buffer.push(this.morph.startTag())},afterRender:function(buffer){buffer.push(this.morph.endTag())},createElement:function(){var buffer=this.renderToBuffer();this.outerHTML=buffer.string();this.clearBuffer()},domManager:DOMManager});Ember._MetamorphView=Ember.View.extend(Ember._Metamorph)})();(function(){var get=Ember.get,set=Ember.set,getPath=Ember.Handlebars.getPath;Ember._HandlebarsBoundView=Ember._MetamorphView.extend({shouldDisplayFunc:null,preserveContext:false,previousContext:null,displayTemplate:null,inverseTemplate:null,path:null,pathRoot:null,normalizedValue:Ember.computed(function(){var path=get(this,"path"),pathRoot=get(this,"pathRoot"),valueNormalizer=get(this,"valueNormalizerFunc"),result,templateData;if(path===""){result=pathRoot}else{templateData=get(this,"templateData");result=getPath(pathRoot,path,{data:templateData})}return valueNormalizer?valueNormalizer(result):result}).property("path","pathRoot","valueNormalizerFunc").uncached(),rerenderIfNeeded:function(){if(!get(this,"isDestroyed")&&get(this,"normalizedValue")!==this._lastNormalizedValue){this.rerender()}},render:function(buffer){var escape=get(this,"isEscaped");var shouldDisplay=get(this,"shouldDisplayFunc"),preserveContext=get(this,"preserveContext"),context=get(this,"previousContext");var inverseTemplate=get(this,"inverseTemplate"),displayTemplate=get(this,"displayTemplate");var result=get(this,"normalizedValue");this._lastNormalizedValue=result;if(shouldDisplay(result)){set(this,"template",displayTemplate);if(preserveContext){set(this,"_templateContext",context)}else{if(displayTemplate){set(this,"_templateContext",result)}else{if(result===null||result===undefined){result=""}else{if(!(result instanceof Handlebars.SafeString)){result=String(result)}}if(escape){result=Handlebars.Utils.escapeExpression(result)}buffer.push(result);return}}}else{if(inverseTemplate){set(this,"template",inverseTemplate);if(preserveContext){set(this,"_templateContext",context)}else{set(this,"_templateContext",result)}}else{set(this,"template",function(){return""})}}return this._super(buffer)}})})();(function(){var get=Ember.get,set=Ember.set,fmt=Ember.String.fmt;var getPath=Ember.Handlebars.getPath,normalizePath=Ember.Handlebars.normalizePath;var forEach=Ember.ArrayUtils.forEach;var EmberHandlebars=Ember.Handlebars,helpers=EmberHandlebars.helpers;var bind=function(property,options,preserveContext,shouldDisplay,valueNormalizer){var data=options.data,fn=options.fn,inverse=options.inverse,view=data.view,currentContext=this,pathRoot,path,normalized;normalized=normalizePath(currentContext,property,data);pathRoot=normalized.root;path=normalized.path;if("object"===typeof this){var bindView=view.createChildView(Ember._HandlebarsBoundView,{preserveContext:preserveContext,shouldDisplayFunc:shouldDisplay,valueNormalizerFunc:valueNormalizer,displayTemplate:fn,inverseTemplate:inverse,path:path,pathRoot:pathRoot,previousContext:currentContext,isEscaped:options.hash.escaped,templateData:options.data});view.appendChild(bindView);var observer=function(){Ember.run.once(bindView,"rerenderIfNeeded")};if(path!==""){Ember.addObserver(pathRoot,path,observer)}}else{data.buffer.push(getPath(pathRoot,path,options))}};EmberHandlebars.registerHelper("_triageMustache",function(property,fn){Ember.assert("You cannot pass more than one argument to the _triageMustache helper",arguments.length<=2);if(helpers[property]){return helpers[property].call(this,fn)}else{return helpers.bind.apply(this,arguments)}});EmberHandlebars.registerHelper("bind",function(property,fn){Ember.assert("You cannot pass more than one argument to the bind helper",arguments.length<=2);var context=(fn.contexts&&fn.contexts[0])||this;return bind.call(context,property,fn,false,function(result){return !Ember.none(result)})});EmberHandlebars.registerHelper("boundIf",function(property,fn){var context=(fn.contexts&&fn.contexts[0])||this;var func=function(result){if(Ember.typeOf(result)==="array"){return get(result,"length")!==0}else{return !!result}};return bind.call(context,property,fn,true,func,func)});EmberHandlebars.registerHelper("with",function(context,options){if(arguments.length===4){var keywordName,path;Ember.assert("If you pass more than one argument to the with helper, it must be in the form #with foo as bar",arguments[1]==="as");options=arguments[3];keywordName=arguments[2];path=arguments[0];Ember.assert("You must pass a block to the with helper",options.fn&&options.fn!==Handlebars.VM.noop);var contextKey=Ember.$.expando+Ember.guidFor(this);options.data.keywords[contextKey]=this;Ember.bind(options.data.keywords,keywordName,contextKey+"."+path);return bind.call(this,path,options.fn,true,function(result){return !Ember.none(result)})}else{Ember.assert("You must pass exactly one argument to the with helper",arguments.length===2);Ember.assert("You must pass a block to the with helper",options.fn&&options.fn!==Handlebars.VM.noop);return helpers.bind.call(options.contexts[0],context,options)}});EmberHandlebars.registerHelper("if",function(context,options){Ember.assert("You must pass exactly one argument to the if helper",arguments.length===2);Ember.assert("You must pass a block to the if helper",options.fn&&options.fn!==Handlebars.VM.noop);return helpers.boundIf.call(options.contexts[0],context,options)});EmberHandlebars.registerHelper("unless",function(context,options){Ember.assert("You must pass exactly one argument to the unless helper",arguments.length===2);Ember.assert("You must pass a block to the unless helper",options.fn&&options.fn!==Handlebars.VM.noop);var fn=options.fn,inverse=options.inverse;options.fn=inverse;options.inverse=fn;return helpers.boundIf.call(options.contexts[0],context,options)});EmberHandlebars.registerHelper("bindAttr",function(options){var attrs=options.hash;Ember.assert("You must specify at least one hash argument to bindAttr",!!Ember.keys(attrs).length);var view=options.data.view;var ret=[];var ctx=this;var dataId=++Ember.$.uuid;var classBindings=attrs["class"];if(classBindings!==null&&classBindings!==undefined){var classResults=EmberHandlebars.bindClasses(this,classBindings,view,dataId,options);ret.push('class="'+Handlebars.Utils.escapeExpression(classResults.join(" "))+'"');delete attrs["class"]}var attrKeys=Ember.keys(attrs);forEach(attrKeys,function(attr){var path=attrs[attr],pathRoot,normalized;Ember.assert(fmt("You must provide a String for a bound attribute, not %@",[path]),typeof path==="string");normalized=normalizePath(ctx,path,options.data);pathRoot=normalized.root;path=normalized.path;var value=(path==="this")?pathRoot:getPath(pathRoot,path,options),type=Ember.typeOf(value);Ember.assert(fmt("Attributes must be numbers, strings or booleans, not %@",[value]),value===null||value===undefined||type==="number"||type==="string"||type==="boolean");var observer,invoker;observer=function observer(){var result=getPath(pathRoot,path,options);Ember.assert(fmt("Attributes must be numbers, strings or booleans, not %@",[result]),result===null||result===undefined||typeof result==="number"||typeof result==="string"||typeof result==="boolean");var elem=view.$("[data-bindattr-"+dataId+"='"+dataId+"']");if(elem.length===0){Ember.removeObserver(pathRoot,path,invoker);return}Ember.View.applyAttributeBindings(elem,attr,result)};invoker=function(){Ember.run.once(observer)};if(path!=="this"){Ember.addObserver(pathRoot,path,invoker)}if((type==="string"||(type==="number"&&!isNaN(value)))){ret.push(attr+'="'+Handlebars.Utils.escapeExpression(value)+'"')}else{if(value&&type==="boolean"){ret.push(attr+'="'+attr+'"')}}},this);ret.push("data-bindattr-"+dataId+'="'+dataId+'"');return new EmberHandlebars.SafeString(ret.join(" "))});EmberHandlebars.bindClasses=function(context,classBindings,view,bindAttrId,options){var ret=[],newClass,value,elem;var classStringForPath=function(root,path,className,options){var val=path!==""?getPath(root,path,options):true;if(!!val&&className){return className}else{if(val===true){var parts=path.split(".");return Ember.String.dasherize(parts[parts.length-1])}else{if(val!==false&&val!==undefined&&val!==null){return val}else{return null}}}};forEach(classBindings.split(" "),function(binding){var oldClass;var observer,invoker;var split=binding.split(":"),path=split[0],className=split[1],pathRoot=context,normalized;if(path!==""){normalized=normalizePath(context,path,options.data);pathRoot=normalized.root;path=normalized.path}observer=function(){newClass=classStringForPath(pathRoot,path,className,options);elem=bindAttrId?view.$("[data-bindattr-"+bindAttrId+"='"+bindAttrId+"']"):view.$();if(elem.length===0){Ember.removeObserver(pathRoot,path,invoker)}else{if(oldClass){elem.removeClass(oldClass)}if(newClass){elem.addClass(newClass);oldClass=newClass}else{oldClass=null}}};invoker=function(){Ember.run.once(observer)};if(path!==""){Ember.addObserver(pathRoot,path,invoker)}value=classStringForPath(pathRoot,path,className,options);if(value){ret.push(value);oldClass=value}});return ret}})();(function(){var get=Ember.get,set=Ember.set;var indexOf=Ember.ArrayUtils.indexOf;var PARENT_VIEW_PATH=/^parentView\./;var EmberHandlebars=Ember.Handlebars;EmberHandlebars.ViewHelper=Ember.Object.create({viewClassFromHTMLOptions:function(viewClass,options,thisContext){var hash=options.hash,data=options.data;var extensions={},classes=hash["class"],dup=false;if(hash.id){extensions.elementId=hash.id;dup=true}if(classes){classes=classes.split(" ");extensions.classNames=classes;dup=true}if(hash.classBinding){extensions.classNameBindings=hash.classBinding.split(" ");dup=true}if(hash.classNameBindings){extensions.classNameBindings=hash.classNameBindings.split(" ");dup=true}if(hash.attributeBindings){Ember.assert("Setting 'attributeBindings' via Handlebars is not allowed. Please subclass Ember.View and set it there instead.");extensions.attributeBindings=null;dup=true}if(dup){hash=Ember.$.extend({},hash);delete hash.id;delete hash["class"];delete hash.classBinding}var path,normalized;for(var prop in hash){if(!hash.hasOwnProperty(prop)){continue}if(Ember.IS_BINDING.test(prop)){path=hash[prop];normalized=Ember.Handlebars.normalizePath(null,path,data);if(normalized.isKeyword){hash[prop]="templateData.keywords."+path}else{if(!Ember.isGlobalPath(path)){if(path==="this"){hash[prop]="bindingContext"}else{hash[prop]="bindingContext."+path}}}}}extensions.bindingContext=thisContext;return viewClass.extend(hash,extensions)},helper:function(thisContext,path,options){var inverse=options.inverse,data=options.data,view=data.view,fn=options.fn,hash=options.hash,newView;if("string"===typeof path){newView=EmberHandlebars.getPath(thisContext,path,options);Ember.assert("Unable to find view at path '"+path+"'",!!newView)}else{newView=path}Ember.assert(Ember.String.fmt("You must pass a view class to the #view helper, not %@ (%@)",[path,newView]),Ember.View.detect(newView));newView=this.viewClassFromHTMLOptions(newView,options,thisContext);var currentView=data.view;var viewOptions={templateData:options.data};if(fn){Ember.assert("You cannot provide a template block if you also specified a templateName",!get(viewOptions,"templateName")&&!get(newView.proto(),"templateName"));viewOptions.template=fn}currentView.appendChild(newView,viewOptions)}});EmberHandlebars.registerHelper("view",function(path,options){Ember.assert("The view helper only takes a single argument",arguments.length<=2);if(path&&path.data&&path.data.isRenderData){options=path;path="Ember.View"}return EmberHandlebars.ViewHelper.helper(this,path,options)})})();(function(){var get=Ember.get,getPath=Ember.Handlebars.getPath,fmt=Ember.String.fmt;Ember.Handlebars.registerHelper("collection",function(path,options){if(path&&path.data&&path.data.isRenderData){options=path;path=undefined;Ember.assert("You cannot pass more than one argument to the collection helper",arguments.length===1)}else{Ember.assert("You cannot pass more than one argument to the collection helper",arguments.length===2)}var fn=options.fn;var data=options.data;var inverse=options.inverse;var collectionClass;collectionClass=path?getPath(this,path,options):Ember.CollectionView;Ember.assert(fmt("%@ #collection: Could not find %@",data.view,path),!!collectionClass);var hash=options.hash,itemHash={},match;var itemViewClass,itemViewPath=hash.itemViewClass;var collectionPrototype=collectionClass.proto();delete hash.itemViewClass;itemViewClass=itemViewPath?getPath(collectionPrototype,itemViewPath,options):collectionPrototype.itemViewClass;Ember.assert(fmt("%@ #collection: Could not find %@",data.view,itemViewPath),!!itemViewClass);for(var prop in hash){if(hash.hasOwnProperty(prop)){match=prop.match(/^item(.)(.*)$/);if(match){itemHash[match[1].toLowerCase()+match[2]]=hash[prop];delete hash[prop]}}}var tagName=hash.tagName||collectionPrototype.tagName;if(fn){itemHash.template=fn;delete options.fn}if(inverse&&inverse!==Handlebars.VM.noop){var emptyViewClass=get(collectionPrototype,"emptyViewClass");hash.emptyView=emptyViewClass.extend({template:inverse,tagName:itemHash.tagName})}if(hash.eachHelper==="each"){itemHash._templateContext=Ember.computed(function(){return get(this,"content")}).property("content");delete hash.eachHelper}hash.itemViewClass=Ember.Handlebars.ViewHelper.viewClassFromHTMLOptions(itemViewClass,{data:data,hash:itemHash},this);return Ember.Handlebars.helpers.view.call(this,collectionClass,options)})})();(function(){var getPath=Ember.Handlebars.getPath;Ember.Handlebars.registerHelper("unbound",function(property,fn){var context=(fn.contexts&&fn.contexts[0])||this;return getPath(context,property,fn)})})();(function(){var getPath=Ember.getPath;Ember.Handlebars.registerHelper("log",function(property,fn){var context=(fn.contexts&&fn.contexts[0])||this;Ember.Logger.log(getPath(context,property))});Ember.Handlebars.registerHelper("debugger",function(){eval("debugger")})})();(function(){var get=Ember.get,set=Ember.set;Ember.Handlebars.EachView=Ember.CollectionView.extend(Ember._Metamorph,{itemViewClass:Ember._MetamorphView,emptyViewClass:Ember._MetamorphView,createChildView:function(view,attrs){view=this._super(view,attrs);var keyword=get(this,"keyword");if(keyword){var data=get(view,"templateData");data=Ember.copy(data);data.keywords=view.cloneKeywords();set(view,"templateData",data);var content=get(view,"content");data.keywords[keyword]=content}return view}});Ember.Handlebars.registerHelper("each",function(path,options){if(arguments.length===4){Ember.assert("If you pass more than one argument to the each helper, it must be in the form #each foo in bar",arguments[1]==="in");var keywordName=arguments[0];options=arguments[3];path=arguments[2];options.hash.keyword=keywordName}else{options.hash.eachHelper="each"}Ember.assert("You must pass a block to the each helper",options.fn&&options.fn!==Handlebars.VM.noop);options.hash.contentBinding=path;return Ember.Handlebars.helpers.collection.call(this,"Ember.Handlebars.EachView",options)})})();(function(){Ember.Handlebars.registerHelper("template",function(name,options){var template=Ember.TEMPLATES[name];Ember.assert("Unable to find template with name '"+name+"'.",!!template);Ember.TEMPLATES[name](this,{data:options.data})})})();(function(){var EmberHandlebars=Ember.Handlebars,getPath=EmberHandlebars.getPath,get=Ember.get;var ActionHelper=EmberHandlebars.ActionHelper={registeredActions:{}};ActionHelper.registerAction=function(actionName,eventName,target,view,context){var actionId=(++Ember.$.uuid).toString();ActionHelper.registeredActions[actionId]={eventName:eventName,handler:function(event){event.view=view;event.context=context;if(target.isState&&typeof target.send==="function"){return target.send(actionName,event)}else{return target[actionName].call(target,event)}}};view.on("willRerender",function(){delete ActionHelper.registeredActions[actionId]});return actionId};EmberHandlebars.registerHelper("action",function(actionName,options){var hash=options.hash||{},eventName=hash.on||"click",view=options.data.view,target,context,controller;if(view.isVirtual){view=view.get("parentView")}if(hash.target){target=getPath(this,hash.target,options)}else{if(controller=options.data.keywords.controller){target=get(controller,"target")}}target=target||view;context=hash.context?getPath(this,hash.context,options):options.contexts[0];var actionId=ActionHelper.registerAction(actionName,eventName,target,view,context);return new EmberHandlebars.SafeString('data-ember-action="'+actionId+'"')})})();(function(){var get=Ember.get,set=Ember.set;Ember.Handlebars.registerHelper("yield",function(options){var view=options.data.view,template;while(view&&!get(view,"layout")){view=get(view,"parentView")}Ember.assert("You called yield in a template that was not a layout",!!view);template=get(view,"template");if(template){template(this,options)}})})();(function(){})();(function(){})();(function(){var set=Ember.set,get=Ember.get;Ember.Checkbox=Ember.View.extend({classNames:["ember-checkbox"],tagName:"input",attributeBindings:["type","checked","disabled"],type:"checkbox",checked:false,disabled:false,title:null,value:Ember.computed(function(propName,value){Ember.deprecate("Ember.Checkbox's 'value' property has been renamed to 'checked' to match the html element attribute name");if(value!==undefined){return set(this,"checked",value)}else{return get(this,"checked")}}).property("checked").uncached(),change:function(){Ember.run.once(this,this._updateElementValue)},_updateElementValue:function(){var input=get(this,"title")?this.$("input:checkbox"):this.$();set(this,"checked",input.prop("checked"))},init:function(){if(get(this,"title")||get(this,"titleBinding")){Ember.deprecate("Automatically surrounding Ember.Checkbox inputs with a label by providing a 'title' property is deprecated");this.tagName=undefined;this.attributeBindings=[];this.defaultTemplate=Ember.Handlebars.compile('<label><input type="checkbox" {{bindAttr checked="checked" disabled="disabled"}}>{{title}}</label>')}this._super()}})})();(function(){var get=Ember.get,set=Ember.set;Ember.TextSupport=Ember.Mixin.create({value:"",attributeBindings:["placeholder","disabled","maxlength"],placeholder:null,disabled:false,maxlength:null,insertNewline:Ember.K,cancel:Ember.K,focusOut:function(event){this._elementValueDidChange()},change:function(event){this._elementValueDidChange()},keyUp:function(event){this.interpretKeyEvents(event)},interpretKeyEvents:function(event){var map=Ember.TextSupport.KEY_EVENTS;var method=map[event.keyCode];this._elementValueDidChange();if(method){return this[method](event)}},_elementValueDidChange:function(){set(this,"value",this.$().val())}});Ember.TextSupport.KEY_EVENTS={13:"insertNewline",27:"cancel"}})();(function(){var get=Ember.get,set=Ember.set;Ember.TextField=Ember.View.extend(Ember.TextSupport,{classNames:["ember-text-field"],tagName:"input",attributeBindings:["type","value","size"],value:"",type:"text",size:null})})();(function(){var get=Ember.get,set=Ember.set;Ember.Button=Ember.View.extend(Ember.TargetActionSupport,{classNames:["ember-button"],classNameBindings:["isActive"],tagName:"button",propagateEvents:false,attributeBindings:["type","disabled","href"],targetObject:Ember.computed(function(){var target=get(this,"target"),root=get(this,"templateContext"),data=get(this,"templateData");if(typeof target!=="string"){return target}return Ember.Handlebars.getPath(root,target,{data:data})}).property("target").cacheable(),type:Ember.computed(function(key,value){var tagName=this.get("tagName");if(value!==undefined){this._type=value}if(this._type!==undefined){return this._type}if(tagName==="input"||tagName==="button"){return"button"}}).property("tagName").cacheable(),disabled:false,href:Ember.computed(function(){return this.get("tagName")==="a"?"#":null}).property("tagName").cacheable(),mouseDown:function(){if(!get(this,"disabled")){set(this,"isActive",true);this._mouseDown=true;this._mouseEntered=true}return get(this,"propagateEvents")},mouseLeave:function(){if(this._mouseDown){set(this,"isActive",false);this._mouseEntered=false}},mouseEnter:function(){if(this._mouseDown){set(this,"isActive",true);this._mouseEntered=true}},mouseUp:function(event){if(get(this,"isActive")){this.triggerAction();set(this,"isActive",false)}this._mouseDown=false;this._mouseEntered=false;return get(this,"propagateEvents")},keyDown:function(event){if(event.keyCode===13||event.keyCode===32){this.mouseDown()}},keyUp:function(event){if(event.keyCode===13||event.keyCode===32){this.mouseUp()}},touchStart:function(touch){return this.mouseDown(touch)},touchEnd:function(touch){return this.mouseUp(touch)},init:function(){Ember.deprecate("Ember.Button is deprecated and will be removed from future releases. Consider using the `{{action}}` helper.");this._super()}})})();(function(){var get=Ember.get,set=Ember.set;Ember.TextArea=Ember.View.extend(Ember.TextSupport,{classNames:["ember-text-area"],tagName:"textarea",attributeBindings:["rows","cols"],rows:null,cols:null,_updateElementValue:Ember.observer(function(){this.$().val(get(this,"value"))},"value"),init:function(){this._super();this.on("didInsertElement",this,this._updateElementValue)}})})();(function(){Ember.TabContainerView=Ember.View.extend()})();(function(){var get=Ember.get,getPath=Ember.getPath;Ember.TabPaneView=Ember.View.extend({tabsContainer:Ember.computed(function(){return this.nearestInstanceOf(Ember.TabContainerView)}).property().uncached(),isVisible:Ember.computed(function(){return get(this,"viewName")===getPath(this,"tabsContainer.currentView")}).property("tabsContainer.currentView").uncached()})})();(function(){var get=Ember.get,setPath=Ember.setPath;Ember.TabView=Ember.View.extend({tabsContainer:Ember.computed(function(){return this.nearestInstanceOf(Ember.TabContainerView)}).property().uncached(),mouseUp:function(){setPath(this,"tabsContainer.currentView",get(this,"value"))}})})();(function(){})();(function(){var set=Ember.set,get=Ember.get,getPath=Ember.getPath;var indexOf=Ember.ArrayUtils.indexOf,indexesOf=Ember.ArrayUtils.indexesOf;Ember.Select=Ember.View.extend({tagName:"select",defaultTemplate:Ember.Handlebars.compile('{{#if view.prompt}}<option>{{view.prompt}}</option>{{/if}}{{#each view.content}}{{view Ember.SelectOption contentBinding="this"}}{{/each}}'),attributeBindings:["multiple"],multiple:false,content:null,selection:null,prompt:null,optionLabelPath:"content",optionValuePath:"content",change:function(){if(get(this,"multiple")){this._changeMultiple()}else{this._changeSingle()}},selectionDidChange:Ember.observer(function(){var selection=get(this,"selection"),isArray=Ember.isArray(selection);if(get(this,"multiple")){if(!isArray){set(this,"selection",Ember.A([selection]));return}this._selectionDidChangeMultiple()}else{this._selectionDidChangeSingle()}},"selection"),_triggerChange:function(){var selection=get(this,"selection");if(selection){this.selectionDidChange()}this.change()},_changeSingle:function(){var selectedIndex=this.$()[0].selectedIndex,content=get(this,"content"),prompt=get(this,"prompt");if(!content){return}if(prompt&&selectedIndex===0){set(this,"selection",null);return}if(prompt){selectedIndex-=1}set(this,"selection",content.objectAt(selectedIndex))},_changeMultiple:function(){var options=this.$("option:selected"),prompt=get(this,"prompt"),offset=prompt?1:0,content=get(this,"content");if(!content){return}if(options){var selectedIndexes=options.map(function(){return this.index-offset}).toArray();set(this,"selection",content.objectsAt(selectedIndexes))}},_selectionDidChangeSingle:function(){var el=this.$()[0],content=get(this,"content"),selection=get(this,"selection"),selectionIndex=content?indexOf(content,selection):-1,prompt=get(this,"prompt");if(prompt&&selectionIndex>-1){selectionIndex+=1}if(el){el.selectedIndex=selectionIndex}},_selectionDidChangeMultiple:function(){var content=get(this,"content"),selection=get(this,"selection"),selectedIndexes=content?indexesOf(content,selection):[-1],prompt=get(this,"prompt"),offset=prompt?1:0,options=this.$("option"),adjusted;if(options){options.each(function(){adjusted=this.index>-1?this.index+offset:-1;this.selected=indexOf(selectedIndexes,adjusted)>-1})}},init:function(){this._super();this.on("didInsertElement",this,this._triggerChange)}});Ember.SelectOption=Ember.View.extend({tagName:"option",defaultTemplate:Ember.Handlebars.compile("{{view.label}}"),attributeBindings:["value","selected"],init:function(){this.labelPathDidChange();this.valuePathDidChange();this._super()},selected:Ember.computed(function(){var content=get(this,"content"),selection=getPath(this,"parentView.selection");if(getPath(this,"parentView.multiple")){return selection&&indexOf(selection,content)>-1}else{return content==selection}}).property("content","parentView.selection").uncached(),labelPathDidChange:Ember.observer(function(){var labelPath=getPath(this,"parentView.optionLabelPath");if(!labelPath){return}Ember.defineProperty(this,"label",Ember.computed(function(){return getPath(this,labelPath)}).property(labelPath).cacheable())},"parentView.optionLabelPath"),valuePathDidChange:Ember.observer(function(){var valuePath=getPath(this,"parentView.optionValuePath");if(!valuePath){return}Ember.defineProperty(this,"value",Ember.computed(function(){return getPath(this,valuePath)}).property(valuePath).cacheable())},"parentView.optionValuePath")})})();(function(){})();(function(){Ember.Handlebars.bootstrap=function(ctx){var selectors='script[type="text/x-handlebars"], script[type="text/x-raw-handlebars"]';if(Ember.ENV.LEGACY_HANDLEBARS_TAGS){selectors+=', script[type="text/html"]'}Ember.warn("Ember no longer parses text/html script tags by default. Set ENV.LEGACY_HANDLEBARS_TAGS = true to restore this functionality.",Ember.ENV.LEGACY_HANDLEBARS_TAGS||Ember.$('script[type="text/html"]').length===0);Ember.$(selectors,ctx).each(function(){var script=Ember.$(this),type=script.attr("type");var compile=(script.attr("type")==="text/x-raw-handlebars")?Ember.$.proxy(Handlebars.compile,Handlebars):Ember.$.proxy(Ember.Handlebars.compile,Ember.Handlebars),templateName=script.attr("data-template-name")||script.attr("id"),template=compile(script.html()),view,viewPath,elementId,tagName,options;if(templateName){Ember.TEMPLATES[templateName]=template;script.remove()}else{if(script.parents("head").length!==0){throw new Ember.Error("Template found in <head> without a name specified. Please provide a data-template-name attribute.\n"+script.html())}viewPath=script.attr("data-view");view=viewPath?Ember.getPath(viewPath):Ember.View;elementId=script.attr("data-element-id");tagName=script.attr("data-tag-name");options={template:template};if(elementId){options.elementId=elementId}if(tagName){options.tagName=tagName}view=view.create(options);view._insertElementLater(function(){script.replaceWith(this.$());script=null})}})};Ember.$(document).ready(function(){Ember.Handlebars.bootstrap(Ember.$(document))})})();(function(){})();(function(){})();window.GliffyApp=Ember.Application.create({name:"GliffyApp",ready:function(){var dictionary,latinize,debug=_gliffy.Debug.I18N_UNDERSCORES,os,browser,english,otherLanguage=null,missingKeys=[],checkMissingKeys=true;english=GLIFFY.DICTIONARY?(GLIFFY.DICTIONARY.en||{}):{};if(GLIFFY.DICTIONARY){$.each(GLIFFY.DICTIONARY,function(key,value){if(key!=="en"){otherLanguage=value;return false}})}if(otherLanguage){if(checkMissingKeys){$.each(english,function(key,value){if(!otherLanguage[key]){missingKeys.push(key)}});if(missingKeys.length!==0){_gliffy.Logger.log("Warning, missing keys: "+JSON.stringify(missingKeys))}}dictionary=$.extend({},english,otherLanguage)}else{dictionary=english}os=_gliffy.BrowserDetect.OS.toUpperCase();if(os!=="WINDOWS"&&os!=="MAC"){os="WINDOWS"}browser=_gliffy.BrowserDetect.browser.toUpperCase();if(browser!=="CHROME"&&browser!=="FIREFOX"&&browser!=="EXPLORER"){browser="CHROME"}function getValue(key,options){var params=[];if(Array.isArray(options.params)){params=options.params.slice(0,-1)}var result=$.i18n._(Ember.Handlebars.Utils.escapeExpression(key)+(options.includeOS?("_"+os):"")+(options.includeBrowser?("_"+browser):""),params);return new Ember.Handlebars.SafeString(result)}Ember.Handlebars.registerHelper("i18n",function(key,params){var params=Array.prototype.slice.call(arguments,1),options={params:params,includeOS:false,includeBrowser:false};return getValue(key,options)});Ember.Handlebars.registerHelper("i18n_os",function(key,params){var params=Array.prototype.slice.call(arguments,1),options={params:params,includeOS:true,includeBrowser:false};return getValue(key,options)});Ember.Handlebars.registerHelper("i18n_os_browser",function(key,params){var params=Array.prototype.slice.call(arguments,1),options={params:params,includeOS:true,includeBrowser:true};return getValue(key,options)});latinize=function(text){text=text.replace(/\b([aeiou][a-z]*)\b/gi,"$1way");text=text.replace(/\b([bcdfghjklmnpqrstvwxy]+)([a-z]*)\b/gi,"$2$1ay");return text};if(debug){$.each(dictionary,function(key,value){if(key!=="TINYMCE_LANGUAGE_CODE"){dictionary[key]="_"+value}})}}});(function(){_gliffy.BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS"},dump:function(){return"OS: "+this.OS+", Browser: "+this.browser+", Version: "+this.version},searchString:function(data){for(var i=0;i<data.length;i++){var dataString=data[i].string;var dataProp=data[i].prop;this.versionSearchString=data[i].versionSearch||data[i].identity;if(dataString){if(dataString.indexOf(data[i].subString)!=-1){return data[i].identity}}else{if(dataProp){return data[i].identity}}}},searchVersion:function(dataString){var index=dataString.indexOf(this.versionSearchString);if(index==-1){return}return parseFloat(dataString.substring(index+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};_gliffy.BrowserDetect.init()}());(function(){if(typeof Function.empty!="function"){Function.empty=function(){}}if(typeof console=="undefined"){console={}}if(typeof console.log=="undefined"){console.log=Function.empty}if(typeof console.debug=="undefined"){console.debug=log}if(typeof console.info=="undefined"){console.info=log}if(typeof console.warn=="undefined"){console.warn=log}if(typeof console.error=="undefined"){console.error=log}if(typeof console.assert=="undefined"){console.assert=function(){var args=Array.prototype.slice.call(arguments);var parm=args.shift();if(!parm){console.error(arguments);throw new Error("Assert failed.")}}}if(typeof console.dir=="undefined"){console.dir=function(input){if(typeof JSON!="undefined"&&typeof JSON.stringify=="function"){console.log(JSON.stringify(input))}else{console.log(input.toString())}}}if(typeof console.dirxml=="undefined"){console.dirxml=console.dir}if(typeof console.trace=="undefined"){console.trace=Function.empty}if(typeof console.group=="undefined"){console.group=Function.empty}if(typeof console.groupCollapsed=="undefined"){console.groupCollapsed=Function.empty}if(typeof console.groupEnd=="undefined"){console.groupEnd=Function.empty}if(typeof console.time=="undefined"){console.time=Function.empty}if(typeof console.timeEnd=="undefined"){console.timeEnd=Function.empty}if(typeof console.profile=="undefined"){console.profile=Function.empty}if(typeof console.profileEnd=="undefined"){console.profileEnd=Function.empty}if(typeof console.count=="undefined"){console.count=Function.empty}function log(){if(typeof JSON!="undefined"&&typeof JSON.stringify=="function"){return console.log(JSON.stringify(arguments))}return console.log(arguments.toString())}})();
/*!!
 * jqModal - Minimalist Modaling with jQuery
 *   (http://dev.iceburg.net/jquery/jqModal/)
 *
 * Copyright (c) 2007,2008 Brice Burgess <bhb@iceburg.net>
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 * 
 * $Version: 03/01/2009 +r14
 */
(function($){$.fn.jqm=function(o){var p={overlay:50,overlayClass:"jqmOverlay",closeClass:"jqmClose",trigger:".jqModal",ajax:F,ajaxText:"",target:F,modal:F,toTop:F,onShow:F,onHide:F,onLoad:F};return this.each(function(){if(this._jqm){return H[this._jqm].c=$.extend({},H[this._jqm].c,o)}s++;this._jqm=s;H[s]={c:$.extend(p,$.jqm.params,o),a:F,w:$(this).addClass("jqmID"+s),s:s};if(p.trigger){$(this).jqmAddTrigger(p.trigger)}})};$.fn.jqmAddClose=function(e){return hs(this,e,"jqmHide")};$.fn.jqmAddTrigger=function(e){return hs(this,e,"jqmShow")};$.fn.jqmShow=function(t){return this.each(function(){t=t||window.event;$.jqm.open(this._jqm,t)})};$.fn.jqmHide=function(t){return this.each(function(){t=t||window.event;$.jqm.close(this._jqm,t)})};$.jqm={hash:{},open:function(s,t){var h=H[s],c=h.c,cc="."+c.closeClass,z=(parseInt(h.w.css("z-index"))),z=(z>0)?z:3000,o=$("<div></div>").css({height:"100%",width:"100%",position:"fixed",left:0,top:0,"z-index":z-1,opacity:c.overlay/100});if(h.a){return F}h.t=t;h.a=true;h.w.css("z-index",z);if(c.modal){if(!A[0]){L("bind")}A.push(s)}else{if(c.overlay>0){h.w.jqmAddClose(o)}else{o=F}}h.o=(o)?o.addClass(c.overlayClass).prependTo("body"):F;if(ie6){$("html,body").css({height:"100%",width:"100%"});if(o){o=o.css({position:"absolute"})[0];for(var y in {Top:1,Left:1}){o.style.setExpression(y.toLowerCase(),"(_=(document.documentElement.scroll"+y+" || document.body.scroll"+y+"))+'px'")}}}if(c.ajax){var r=c.target||h.w,u=c.ajax,r=(typeof r=="string")?$(r,h.w):$(r),u=(u.substr(0,1)=="@")?$(t).attr(u.substring(1)):u;r.html(c.ajaxText).load(u,function(){if(c.onLoad){c.onLoad.call(this,h)}if(cc){h.w.jqmAddClose($(cc,h.w))}e(h)})}else{if(cc){h.w.jqmAddClose($(cc,h.w))}}if(c.toTop&&h.o){h.w.before('<span id="jqmP'+h.w[0]._jqm+'"></span>').insertAfter(h.o)}(c.onShow)?c.onShow(h):h.w.show();return F},close:function(s){var h=H[s];if(!h.a){return F}h.a=F;if(A[0]){A.pop();if(!A[0]){L("unbind")}}if(h.c.toTop&&h.o){$("#jqmP"+h.w[0]._jqm).after(h.w).remove()}if(h.c.onHide){h.c.onHide(h)}else{h.w.hide();if(h.o){h.o.remove()}}return F},params:{}};var s=0,H=$.jqm.hash,A=[],ie6=$.browser.msie&&($.browser.version=="6.0"),F=false,i=$('<iframe src="javascript:false;document.write(\'\');" class="jqm"></iframe>').css({opacity:0}),e=function(h){if(ie6){if(h.o){h.o.html('<p style="width:100%;height:100%"/>').prepend(i)}else{if(!$("iframe.jqm",h.w)[0]){h.w.prepend(i)}}}f(h)},f=function(h){try{if($(":input:visible",h.w).length>0){$(":input:visible",h.w)[0].focus()}}catch(_){}},L=function(t){$()[t]("keypress",m)[t]("keydown",m)[t]("mousedown",m)},m=function(e){var h=H[A[A.length-1]],r=(!$(e.target).parents(".jqmID"+h.s)[0]);if(r){f(h)}return !r},hs=function(w,t,c){return w.each(function(){var s=this._jqm;$(t).each(function(){if(!this[c]){this[c]=[];$(this).click(function(){for(var i in {jqmShow:1,jqmHide:1}){for(var s in this[i]){if(H[this[i][s]]){H[this[i][s]].w[i](this)}}}return F})}this[c].push(s)})})}})(jQuery);var Mustache;(function(exports){if(typeof module!=="undefined"&&module.exports){module.exports=exports}else{if(typeof define==="function"){define(exports)}else{Mustache=exports}}}((function(){var exports={};exports.name="mustache.js";exports.version="0.7.0";exports.tags=["{{","}}"];exports.Scanner=Scanner;exports.Context=Context;exports.Writer=Writer;var whiteRe=/\s*/;var spaceRe=/\s+/;var nonSpaceRe=/\S/;var eqRe=/\s*=/;var curlyRe=/\s*\}/;var tagRe=/#|\^|\/|>|\{|&|=|!/;function testRe(re,string){return RegExp.prototype.test.call(re,string)}function isWhitespace(string){return !testRe(nonSpaceRe,string)}var isArray=Array.isArray||function(obj){return Object.prototype.toString.call(obj)==="[object Array]"};function escapeRe(string){return string.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function escapeHtml(string){return String(string).replace(/[&<>"'\/]/g,function(s){return entityMap[s]})}exports.escape=escapeHtml;function Scanner(string){this.string=string;this.tail=string;this.pos=0}Scanner.prototype.eos=function(){return this.tail===""};Scanner.prototype.scan=function(re){var match=this.tail.match(re);if(match&&match.index===0){this.tail=this.tail.substring(match[0].length);this.pos+=match[0].length;return match[0]}return""};Scanner.prototype.scanUntil=function(re){var match,pos=this.tail.search(re);switch(pos){case -1:match=this.tail;this.pos+=this.tail.length;this.tail="";break;case 0:match="";break;default:match=this.tail.substring(0,pos);this.tail=this.tail.substring(pos);this.pos+=pos}return match};function Context(view,parent){this.view=view;this.parent=parent;this.clearCache()}Context.make=function(view){return(view instanceof Context)?view:new Context(view)};Context.prototype.clearCache=function(){this._cache={}};Context.prototype.push=function(view){return new Context(view,this)};Context.prototype.lookup=function(name){var value=this._cache[name];if(!value){if(name==="."){value=this.view}else{var context=this;while(context){if(name.indexOf(".")>0){var names=name.split("."),i=0;value=context.view;while(value&&i<names.length){value=value[names[i++]]}}else{value=context.view[name]}if(value!=null){break}context=context.parent}}this._cache[name]=value}if(typeof value==="function"){value=value.call(this.view)}return value};function Writer(){this.clearCache()}Writer.prototype.clearCache=function(){this._cache={};this._partialCache={}};Writer.prototype.compile=function(template,tags){var fn=this._cache[template];if(!fn){var tokens=exports.parse(template,tags);fn=this._cache[template]=this.compileTokens(tokens,template)}return fn};Writer.prototype.compilePartial=function(name,template,tags){var fn=this.compile(template,tags);this._partialCache[name]=fn;return fn};Writer.prototype.compileTokens=function(tokens,template){var fn=compileTokens(tokens);var self=this;return function(view,partials){if(partials){if(typeof partials==="function"){self._loadPartial=partials}else{for(var name in partials){self.compilePartial(name,partials[name])}}}return fn(self,Context.make(view),template)}};Writer.prototype.render=function(template,view,partials){return this.compile(template)(view,partials)};Writer.prototype._section=function(name,context,text,callback){var value=context.lookup(name);switch(typeof value){case"object":if(isArray(value)){var buffer="";for(var i=0,len=value.length;i<len;++i){buffer+=callback(this,context.push(value[i]))}return buffer}return value?callback(this,context.push(value)):"";case"function":var self=this;var scopedRender=function(template){return self.render(template,context)};return value.call(context.view,text,scopedRender)||"";default:if(value){return callback(this,context)}}return""};Writer.prototype._inverted=function(name,context,callback){var value=context.lookup(name);if(!value||(isArray(value)&&value.length===0)){return callback(this,context)}return""};Writer.prototype._partial=function(name,context){if(!(name in this._partialCache)&&this._loadPartial){this.compilePartial(name,this._loadPartial(name))}var fn=this._partialCache[name];return fn?fn(context):""};Writer.prototype._name=function(name,context){var value=context.lookup(name);if(typeof value==="function"){value=value.call(context.view)}return(value==null)?"":String(value)};Writer.prototype._escaped=function(name,context){return exports.escape(this._name(name,context))};function sectionBounds(token){var start=token[3];var end=start;var tokens;while((tokens=token[4])&&tokens.length){token=tokens[tokens.length-1];end=token[3]}return[start,end]}function compileTokens(tokens){var subRenders={};function subRender(i,tokens,template){if(!subRenders[i]){var fn=compileTokens(tokens);subRenders[i]=function(writer,context){return fn(writer,context,template)}}return subRenders[i]}return function(writer,context,template){var buffer="";var token,sectionText;for(var i=0,len=tokens.length;i<len;++i){token=tokens[i];switch(token[0]){case"#":sectionText=template.slice.apply(template,sectionBounds(token));buffer+=writer._section(token[1],context,sectionText,subRender(i,token[4],template));break;case"^":buffer+=writer._inverted(token[1],context,subRender(i,token[4],template));break;case">":buffer+=writer._partial(token[1],context);break;case"&":buffer+=writer._name(token[1],context);break;case"name":buffer+=writer._escaped(token[1],context);break;case"text":buffer+=token[1];break}}return buffer}}function nestTokens(tokens){var tree=[];var collector=tree;var sections=[];var token,section;for(var i=0;i<tokens.length;++i){token=tokens[i];switch(token[0]){case"#":case"^":token[4]=[];sections.push(token);collector.push(token);collector=token[4];break;case"/":if(sections.length===0){throw new Error("Unopened section: "+token[1])}section=sections.pop();if(section[1]!==token[1]){throw new Error("Unclosed section: "+section[1])}if(sections.length>0){collector=sections[sections.length-1][4]}else{collector=tree}break;default:collector.push(token)}}section=sections.pop();if(section){throw new Error("Unclosed section: "+section[1])}return tree}function squashTokens(tokens){var token,lastToken;for(var i=0;i<tokens.length;++i){token=tokens[i];if(lastToken&&lastToken[0]==="text"&&token[0]==="text"){lastToken[1]+=token[1];lastToken[3]=token[3];tokens.splice(i--,1)}else{lastToken=token}}}function escapeTags(tags){if(tags.length!==2){throw new Error("Invalid tags: "+tags.join(" "))}return[new RegExp(escapeRe(tags[0])+"\\s*"),new RegExp("\\s*"+escapeRe(tags[1]))]}exports.parse=function(template,tags){tags=tags||exports.tags;var tagRes=escapeTags(tags);var scanner=new Scanner(template);var tokens=[],spaces=[],hasTag=false,nonSpace=false;function stripSpace(){if(hasTag&&!nonSpace){while(spaces.length){tokens.splice(spaces.pop(),1)}}else{spaces=[]}hasTag=false;nonSpace=false}var start,type,value,chr;while(!scanner.eos()){start=scanner.pos;value=scanner.scanUntil(tagRes[0]);if(value){for(var i=0,len=value.length;i<len;++i){chr=value.charAt(i);if(isWhitespace(chr)){spaces.push(tokens.length)}else{nonSpace=true}tokens.push(["text",chr,start,start+1]);start+=1;if(chr==="\n"){stripSpace()}}}start=scanner.pos;if(!scanner.scan(tagRes[0])){break}hasTag=true;type=scanner.scan(tagRe)||"name";scanner.scan(whiteRe);if(type==="="){value=scanner.scanUntil(eqRe);scanner.scan(eqRe);scanner.scanUntil(tagRes[1])}else{if(type==="{"){var closeRe=new RegExp("\\s*"+escapeRe("}"+tags[1]));value=scanner.scanUntil(closeRe);scanner.scan(curlyRe);scanner.scanUntil(tagRes[1]);type="&"}else{value=scanner.scanUntil(tagRes[1])}}if(!scanner.scan(tagRes[1])){throw new Error("Unclosed tag at "+scanner.pos)}tokens.push([type,value,start,scanner.pos]);if(type==="name"||type==="{"||type==="&"){nonSpace=true}if(type==="="){tags=value.split(spaceRe);tagRes=escapeTags(tags)}}squashTokens(tokens);return nestTokens(tokens)};var _writer=new Writer();exports.clearCache=function(){return _writer.clearCache()};exports.compile=function(template,tags){return _writer.compile(template,tags)};exports.compilePartial=function(name,template,tags){return _writer.compilePartial(name,template,tags)};exports.compileTokens=function(tokens,template){return _writer.compileTokens(tokens,template)};exports.render=function(template,view,partials){return _writer.render(template,view,partials)};exports.to_html=function(template,view,partials,send){var result=exports.render(template,view,partials);if(typeof send==="function"){send(result)}else{return result}};return exports}())));
/*!!
 * jquery.event.drag - v 2.0.0 
 * Copyright (c) 2010 Three Dub Media - http://threedubmedia.com
 * Open Source MIT License - http://threedubmedia.com/code/license
 */
(function($){$.fn.drag=function(str,arg,opts){var type=typeof str=="string"?str:"",fn=$.isFunction(str)?str:$.isFunction(arg)?arg:null;if(type.indexOf("drag")!==0){type="drag"+type}opts=(str==fn?arg:opts)||{};return fn?this.bind(type,opts,fn):this.trigger(type)};var $event=$.event,$special=$event.special,drag=$special.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:false,drop:true,click:false},datakey:"dragdata",livekey:"livedrag",add:function(obj){var data=$.data(this,drag.datakey),opts=obj.data||{};data.related+=1;if(!data.live&&obj.selector){data.live=true;$event.add(this,"draginit."+drag.livekey,drag.delegate)}$.each(drag.defaults,function(key,def){if(opts[key]!==undefined){data[key]=opts[key]}})},remove:function(){$.data(this,drag.datakey).related-=1},setup:function(){if($.data(this,drag.datakey)){return}var data=$.extend({related:0},drag.defaults);$.data(this,drag.datakey,data);$event.add(this,"mousedown",drag.init,data);if(this.attachEvent){this.attachEvent("ondragstart",drag.dontstart)}},teardown:function(){if($.data(this,drag.datakey).related){return}$.removeData(this,drag.datakey);$event.remove(this,"mousedown",drag.init);$event.remove(this,"draginit",drag.delegate);drag.textselect(true,$(this).closest("html").parent().get(0));if(this.detachEvent){this.detachEvent("ondragstart",drag.dontstart)}},init:function(event){var dd=event.data,results;if(dd.which>0&&event.which!=dd.which){return}if($(event.target).is(dd.not)){return}if(dd.handle&&!$(event.target).closest(dd.handle,event.currentTarget).length){return}dd.propagates=1;dd.document=this.ownerDocument;dd.interactions=[drag.interaction(this,dd)];dd.target=event.target;dd.pageX=event.pageX;dd.pageY=event.pageY;dd.dragging=null;results=drag.hijack(event,"draginit",dd);if(!dd.propagates){return}results=drag.flatten(results);if(results&&results.length){dd.interactions=[];$.each(results,function(){dd.interactions.push(drag.interaction(this,dd))})}dd.propagates=dd.interactions.length;if(dd.drop!==false&&$special.drop){$special.drop.handler(event,dd)}drag.textselect(false,dd.document);$event.add($(this).closest("html").parent().get(0),"mousemove mouseup",drag.handler,dd);return false},interaction:function(elem,dd){return{drag:elem,callback:new drag.callback(),droppable:[],offset:$(elem)[dd.relative?"position":"offset"]()||{top:0,left:0}}},handler:function(event){var dd=event.data;switch(event.type){case !dd.dragging&&"mousemove":if(Math.pow(event.pageX-dd.pageX,2)+Math.pow(event.pageY-dd.pageY,2)<Math.pow(dd.distance,2)){break}event.target=dd.target;drag.hijack(event,"dragstart",dd);if(dd.propagates){dd.dragging=true}case"mousemove":if(dd.dragging){drag.hijack(event,"drag",dd);if(dd.propagates){if(dd.drop!==false&&$special.drop){$special.drop.handler(event,dd)}break}event.type="mouseup"}case"mouseup":$event.remove(dd.document,"mousemove mouseup",drag.handler);if(dd.dragging){if(dd.drop!==false&&$special.drop){$special.drop.handler(event,dd)}drag.hijack(event,"dragend",dd)}drag.textselect(true,dd.document);if(dd.click===false&&dd.dragging){jQuery.event.triggered=true;setTimeout(function(){jQuery.event.triggered=false},20);dd.dragging=false}break}},delegate:function(event){var elems=[],target,events=$.data(this,"events")||{};$.each(events.live||[],function(i,obj){if(obj.preType.indexOf("drag")!==0){return}target=$(event.target).closest(obj.selector,event.currentTarget)[0];if(!target){return}$event.add(target,obj.origType+"."+drag.livekey,obj.origHandler,obj.data);if($.inArray(target,elems)<0){elems.push(target)}});if(!elems.length){return false}return $(elems).bind("dragend."+drag.livekey,function(){$event.remove(this,"."+drag.livekey)})},hijack:function(event,type,dd,x,elem){if(!dd){return}var orig={event:event.originalEvent,type:event.type},mode=type.indexOf("drop")?"drag":"drop",result,i=x||0,ia,$elems,callback,len=!isNaN(x)?x:dd.interactions.length;event.type=type;event.originalEvent=null;dd.results=[];do{if(ia=dd.interactions[i]){if(type!=="dragend"&&ia.cancelled){continue}callback=drag.properties(event,dd,ia);ia.results=[];$(elem||ia[mode]||dd.droppable).each(function(p,subject){callback.target=subject;result=subject?$event.handle.call(subject,event,callback):null;if(result===false){if(mode=="drag"){ia.cancelled=true;dd.propagates-=1}if(type=="drop"){ia[mode][p]=null}}else{if(type=="dropinit"){ia.droppable.push(drag.element(result)||subject)}}if(type=="dragstart"){ia.proxy=$(drag.element(result)||ia.drag)[0]}ia.results.push(result);delete event.result;if(type!=="dropinit"){return result}});dd.results[i]=drag.flatten(ia.results);if(type=="dropinit"){ia.droppable=drag.flatten(ia.droppable)}if(type=="dragstart"&&!ia.cancelled){callback.update()}}}while(++i<len);event.type=orig.type;event.originalEvent=orig.event;return drag.flatten(dd.results)},properties:function(event,dd,ia){var obj=ia.callback;obj.drag=ia.drag;obj.proxy=ia.proxy||ia.drag;obj.startX=dd.pageX;obj.startY=dd.pageY;obj.deltaX=event.pageX-dd.pageX;obj.deltaY=event.pageY-dd.pageY;obj.originalX=ia.offset.left;obj.originalY=ia.offset.top;obj.offsetX=event.pageX-(dd.pageX-obj.originalX);obj.offsetY=event.pageY-(dd.pageY-obj.originalY);obj.drop=drag.flatten((ia.drop||[]).slice());obj.available=drag.flatten((ia.droppable||[]).slice());return obj},element:function(arg){if(arg&&(arg.jquery||arg.nodeType==1)){return arg}},flatten:function(arr){return $.map(arr,function(member){return member&&member.jquery?$.makeArray(member):member&&member.length?drag.flatten(member):member})},textselect:function(bool,doc){$(doc)[bool?"unbind":"bind"]("selectstart",drag.dontstart).attr("unselectable",bool?"off":"on").css("MozUserSelect",bool?"":"none")},dontstart:function(){return false},callback:function(){}};drag.callback.prototype={update:function(){if($special.drop&&this.available.length){$.each(this.available,function(i){$special.drop.locate(this,i)})}}};$special.draginit=$special.dragstart=$special.dragend=drag})(jQuery);(function(jQuery){jQuery.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"numpadplus",109:"numpadminus",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta",187:"plus",189:"minus",61:"ffplus",173:"ffminus"},shiftNums:{"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}};function keyHandler(handleObj){if(typeof handleObj.data!=="string"){return}var origHandler=handleObj.handler,keys=handleObj.data.toLowerCase().split(" ");handleObj.handler=function(event){if(this!==event.target&&(/textarea|select/i.test(event.target.nodeName)||event.target.type==="text")){return}var special=event.type!=="keypress"&&jQuery.hotkeys.specialKeys[event.which],character=String.fromCharCode(event.which).toLowerCase(),key,modif="",possible={};if(event.altKey&&special!=="alt"){modif+="alt+"}if(event.ctrlKey&&special!=="ctrl"){modif+="ctrl+"}if(event.metaKey&&!event.ctrlKey&&special!=="meta"){modif+="meta+"}if(event.shiftKey&&special!=="shift"){modif+="shift+"}if(special){possible[modif+special]=true}else{possible[modif+character]=true;possible[modif+jQuery.hotkeys.shiftNums[character]]=true;if(modif==="shift+"){possible[jQuery.hotkeys.shiftNums[character]]=true}}for(var i=0,l=keys.length;i<l;i++){if(possible[keys[i]]){return origHandler.apply(this,arguments)}}}}jQuery.each(["keydown","keyup","keypress"],function(){jQuery.event.special[this]={add:keyHandler}})})(jQuery);
/*! Copyright (c) 2011 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 * Thanks to: Seamus Leahy for adding deltaX and deltaY
 *
 * Version: 3.0.6
 *
 * Requires: 1.2.2+
 */
(function($){var types=["DOMMouseScroll","mousewheel"];if($.event.fixHooks){for(var i=types.length;i;){$.event.fixHooks[types[--i]]=$.event.mouseHooks}}$.event.special.mousewheel={setup:function(){if(this.addEventListener){for(var i=types.length;i;){this.addEventListener(types[--i],handler,false)}}else{this.onmousewheel=handler}},teardown:function(){if(this.removeEventListener){for(var i=types.length;i;){this.removeEventListener(types[--i],handler,false)}}else{this.onmousewheel=null}}};$.fn.extend({mousewheel:function(fn){return fn?this.bind("mousewheel",fn):this.trigger("mousewheel")},unmousewheel:function(fn){return this.unbind("mousewheel",fn)}});function handler(event){var orgEvent=event||window.event,args=[].slice.call(arguments,1),delta=0,returnValue=true,deltaX=0,deltaY=0;event=$.event.fix(orgEvent);event.type="mousewheel";if(orgEvent.wheelDelta){delta=orgEvent.wheelDelta/120}if(orgEvent.detail){delta=-orgEvent.detail/3}deltaY=delta;if(orgEvent.axis!==undefined&&orgEvent.axis===orgEvent.HORIZONTAL_AXIS){deltaY=0;deltaX=-1*delta}if(orgEvent.wheelDeltaY!==undefined){deltaY=orgEvent.wheelDeltaY/120}if(orgEvent.wheelDeltaX!==undefined){deltaX=-1*orgEvent.wheelDeltaX/120}args.unshift(event,delta,deltaX,deltaY);return($.event.dispatch||$.event.handle).apply(this,args)}})(jQuery);(function($){$.i18n={dict:null,setDictionary:function(i18n_dict){this.dict=i18n_dict},_:function(str,params){var result=str;if(this.dict&&this.dict[str]){result=this.dict[str]}return this.printf(result,params)},printf:function(str,args){if(!args){return str}var result="";var search=/%(\d+)\$s/g;var matches=search.exec(str);while(matches){var index=parseInt(matches[1],10)-1;str=str.replace("%"+matches[1]+"$s",(args[index]));matches=search.exec(str)}var parts=str.split("%s");if(parts.length>1){for(var i=0;i<args.length;i++){if(parts[i].length>0&&parts[i].lastIndexOf("%")==(parts[i].length-1)){parts[i]+="s"+parts.splice(i+1,1)[0]}result+=parts[i]+args[i]}}return result+parts[parts.length-1]}};$.fn._t=function(str,params){return $(this).text($.i18n._(str,params))}})(jQuery);(function($,undefined){var hidden="hidden",copy='<textarea style="position:absolute; top:-9999px; left:-9999px; right:auto; bottom:auto; word-wrap:break-word; height:0 !important; min-height:0 !important; overflow:hidden">',copyStyle=["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing"],oninput="oninput",onpropertychange="onpropertychange",test=$(copy)[0];test.setAttribute(oninput,"return");if($.isFunction(test[oninput])||onpropertychange in test){$.fn.autosize=function(o){var options=$.extend({className:null,heightCallback:function(){}},o);var className=options.className;var heightCallback=options.heightCallback;return this.each(function(){var ta=this,$ta=$(ta).css({overflow:hidden,overflowY:hidden,wordWrap:"break-word"}),mirror=$(copy).addClass(className||"autosizejs")[0],minHeight=$ta.height(),maxHeight=parseInt($ta.css("maxHeight"),10),active,i=copyStyle.length;maxHeight=maxHeight&&maxHeight>0?maxHeight:90000;function adjust(){var height,overflow;if(!active){active=true;mirror.value=ta.value;mirror.style.overflowY=ta.style.overflowY;mirror.style.width=$ta.css("width");mirror.scrollTop=0;mirror.scrollTop=90000;height=mirror.scrollTop;if(heightCallback){heightCallback(height)}overflow=hidden;if(height>maxHeight){height=maxHeight;overflow="scroll"}else{if(height<minHeight){height=minHeight}}ta.style.overflowY=overflow;ta.style.height=ta.style.minHeight=ta.style.maxHeight=height+"px";setTimeout(function(){active=false},1)}}while(i--){mirror.style[copyStyle[i]]=$ta.css(copyStyle[i])}$("body").append(mirror);if(onpropertychange in ta){if(oninput in ta){ta[oninput]=ta.onkeyup=adjust}else{ta[onpropertychange]=adjust}}else{ta[oninput]=adjust}$(window).resize(adjust);$ta.bind("autosize",adjust);adjust()})}}else{$.fn.autosize=function(){return this}}}(jQuery));(function($){$.contextMenu={shadow:true,shadowOffset:0,shadowOffsetX:5,shadowOffsetY:5,shadowWidthAdjust:-3,shadowHeightAdjust:-3,shadowOpacity:0.2,shadowClass:"context-menu-shadow",shadowColor:"black",offsetX:0,offsetY:0,appendTo:"body",direction:"down",constrainToScreen:true,showTransition:"show",hideTransition:"hide",showSpeed:null,hideSpeed:null,showCallback:null,hideCallback:null,className:"context-menu",itemClassName:"context-menu-item",itemHoverClassName:"context-menu-item-hover",disabledItemClassName:"context-menu-item-disabled",disabledItemHoverClassName:"context-menu-item-disabled-hover",separatorClassName:"context-menu-separator",innerDivClassName:"context-menu-item-inner",themePrefix:"context-menu-theme-",theme:"default",separator:"context-menu-separator",target:null,menu:null,shadowObj:null,bgiframe:null,shown:false,useIframe:
/*@cc_on @*/
/*@if (@_win32) true, @else @*/
false,
/*@end @*/
create:function(menu,opts){var cmenu=$.extend({},this,opts);if(typeof menu=="string"){cmenu.menu=$(menu)}else{if(typeof menu=="function"){cmenu.menuFunction=menu}else{cmenu.menu=cmenu.createMenu(menu,cmenu)}}if(cmenu.menu){cmenu.menu.css({display:"none"});$(cmenu.appendTo).append(cmenu.menu)}if(cmenu.shadow){cmenu.createShadow(cmenu);if(cmenu.shadowOffset){cmenu.shadowOffsetX=cmenu.shadowOffsetY=cmenu.shadowOffset}}$("body").bind("contextmenu",function(){cmenu.hide()});return cmenu},createIframe:function(){return $('<iframe frameborder="0" tabindex="-1" src="javascript:false" style="display:block;position:absolute;z-index:-1;filter:Alpha(Opacity=0);"/>')},createMenu:function(menu,cmenu){var className=cmenu.className;$.each(cmenu.theme.split(","),function(i,n){className+=" "+cmenu.themePrefix+n});var $t=$("<table cellspacing=0 cellpadding=0></table>").click(function(){cmenu.hide();return false});var $tr=$("<tr></tr>");var $td=$("<td></td>");var $div=$('<div class="'+className+'"></div>');for(var i=0;i<menu.length;i++){var m=menu[i];if(m==$.contextMenu.separator){$div.append(cmenu.createSeparator())}else{for(var opt in menu[i]){$div.append(cmenu.createMenuItem(opt,menu[i][opt]))}}}if(cmenu.useIframe){$td.append(cmenu.createIframe())}$t.append($tr.append($td.append($div)));return $t},createMenuItem:function(label,obj){var cmenu=this;if(typeof obj=="function"){obj={onclick:obj}}var o=$.extend({onclick:function(){},className:"",hoverClassName:cmenu.itemHoverClassName,icon:"",disabled:false,title:"",hoverItem:cmenu.hoverItem,hoverItemOut:cmenu.hoverItemOut},obj);var iconStyle=(o.icon)?"background-image:url("+o.icon+");":"";var $div=$('<div class="'+cmenu.itemClassName+" "+o.className+((o.disabled)?" "+cmenu.disabledItemClassName:"")+'" title="'+o.title+'"></div>').click(function(e){if(cmenu.isItemDisabled(this)){return false}else{return o.onclick.call(cmenu.target,this,cmenu,e)}}).hover(function(){o.hoverItem.call(this,(cmenu.isItemDisabled(this))?cmenu.disabledItemHoverClassName:o.hoverClassName)},function(){o.hoverItemOut.call(this,(cmenu.isItemDisabled(this))?cmenu.disabledItemHoverClassName:o.hoverClassName)});var $idiv=$('<div class="'+cmenu.innerDivClassName+'" style="'+iconStyle+'">'+label+"</div>");$div.append($idiv);return $div},createSeparator:function(){return $('<div class="'+this.separatorClassName+'"></div>')},isItemDisabled:function(item){return $(item).is("."+this.disabledItemClassName)},hoverItem:function(c){$(this).addClass(c)},hoverItemOut:function(c){$(this).removeClass(c)},createShadow:function(cmenu){cmenu.shadowObj=$('<div class="'+cmenu.shadowClass+'"></div>').css({display:"none",position:"absolute",zIndex:99998,opacity:cmenu.shadowOpacity,backgroundColor:cmenu.shadowColor});$(cmenu.appendTo).append(cmenu.shadowObj)},showShadow:function(x,y,e){var cmenu=this;if(cmenu.shadow){cmenu.shadowObj.css({width:(cmenu.menu.width()+cmenu.shadowWidthAdjust)+"px",height:(cmenu.menu.height()+cmenu.shadowHeightAdjust)+"px",top:(y+cmenu.shadowOffsetY)+"px",left:(x+cmenu.shadowOffsetX)+"px"}).addClass(cmenu.shadowClass)[cmenu.showTransition](cmenu.showSpeed)}},beforeShow:function(){return true},show:function(t,e){var cmenu=this,x=e.pageX,y=e.pageY;cmenu.target=t;if(cmenu.beforeShow()!==false){if(cmenu.menuFunction){if(cmenu.menu){$(cmenu.menu).remove()}cmenu.menu=cmenu.createMenu(cmenu.menuFunction(cmenu,t),cmenu);cmenu.menu.css({display:"none"});$(cmenu.appendTo).append(cmenu.menu)}var $c=cmenu.menu;x+=cmenu.offsetX;y+=cmenu.offsetY;var pos=cmenu.getPosition(x,y,cmenu,e);cmenu.showShadow(pos.x,pos.y,e);if(cmenu.useIframe){$c.find("iframe").css({width:$c.width()+cmenu.shadowOffsetX+cmenu.shadowWidthAdjust,height:$c.height()+cmenu.shadowOffsetY+cmenu.shadowHeightAdjust})}$c.css({top:pos.y+"px",left:pos.x+"px",position:"absolute",zIndex:99999})[cmenu.showTransition](cmenu.showSpeed,((cmenu.showCallback)?function(){cmenu.showCallback.call(cmenu)}:null));cmenu.shown=true;$(document).one("click",null,function(e){if(!(_gliffy.BrowserDetect.OS==="Mac")){cmenu.hide()}})}},getPosition:function(clickX,clickY,cmenu,e){var x=clickX+cmenu.offsetX;var y=clickY+cmenu.offsetY;var h=$(cmenu.menu).height();var w=$(cmenu.menu).width();var dir=cmenu.direction;if(cmenu.constrainToScreen){var $w=$(window);var wh=$w.height();var ww=$w.width();if(dir=="down"&&(y+h-$w.scrollTop()>wh)){dir="up"}var maxRight=x+w-$w.scrollLeft();if(maxRight>ww){x-=(maxRight-ww)}}if(dir=="up"){y-=h}return{x:x,y:y}},hide:function(){var cmenu=this;if(cmenu.shown){if(cmenu.iframe){$(cmenu.iframe).hide()}if(cmenu.menu){cmenu.menu[cmenu.hideTransition](cmenu.hideSpeed,((cmenu.hideCallback)?function(){cmenu.hideCallback.call(cmenu)}:null))}if(cmenu.shadow){cmenu.shadowObj[cmenu.hideTransition](cmenu.hideSpeed)}}cmenu.shown=false}};$.fn.contextMenu=function(menu,options){var cmenu=$.contextMenu.create(menu,options);return this.each(function(){$(this).bind("contextmenu",function(e){cmenu.show(this,e);return false})})}})(jQuery);
/*!
 * hoverIntent r7 // 2013.03.11 // jQuery 1.9.1+
 * http://cherne.net/brian/resources/jquery.hoverIntent.html
 *
 * You may use hoverIntent under the terms of the MIT license. Basically that
 * means you are free to use hoverIntent as long as this header is left intact.
 * Copyright 2007, 2013 Brian Cherne
 */
(function($){$.fn.hoverIntent=function(handlerIn,handlerOut,selector){var cfg={interval:100,sensitivity:7,timeout:0};if(typeof handlerIn==="object"){cfg=$.extend(cfg,handlerIn)}else{if($.isFunction(handlerOut)){cfg=$.extend(cfg,{over:handlerIn,out:handlerOut,selector:selector})}else{cfg=$.extend(cfg,{over:handlerIn,out:handlerIn,selector:handlerOut})}}var cX,cY,pX,pY;var track=function(ev){cX=ev.pageX;cY=ev.pageY};var compare=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);if((Math.abs(pX-cX)+Math.abs(pY-cY))<cfg.sensitivity){$(ob).off("mousemove.hoverIntent",track);ob.hoverIntent_s=1;return cfg.over.apply(ob,[ev])}else{pX=cX;pY=cY;ob.hoverIntent_t=setTimeout(function(){compare(ev,ob)},cfg.interval)}};var delay=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);ob.hoverIntent_s=0;return cfg.out.apply(ob,[ev])};var handleHover=function(e){var ev=jQuery.extend({},e);var ob=this;if(ob.hoverIntent_t){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t)}if(e.type=="mouseenter"){pX=ev.pageX;pY=ev.pageY;$(ob).on("mousemove.hoverIntent",track);if(ob.hoverIntent_s!=1){ob.hoverIntent_t=setTimeout(function(){compare(ev,ob)},cfg.interval)}}else{$(ob).off("mousemove.hoverIntent",track);if(ob.hoverIntent_s==1){ob.hoverIntent_t=setTimeout(function(){delay(ev,ob)},cfg.timeout)}}};return this.on({"mouseenter.hoverIntent":handleHover,"mouseleave.hoverIntent":handleHover},cfg.selector)}})(jQuery);(function(factory){if(typeof define==="function"&&define.amd){define(["jquery"],factory)}else{factory(jQuery)}})(function($,undefined){var tag2attr={a:"href",img:"src",form:"action",base:"href",script:"src",iframe:"src",link:"href"},key=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","fragment"],aliases={anchor:"fragment"},parser={strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},querystring_parser=/(?:^|&|;)([^&=;]*)=?([^&;]*)/g,fragment_parser=/(?:^|&|;)([^&=;]*)=?([^&;]*)/g;function parseUri(url,strictMode){var str=decodeURI(unescape(url)),res=parser[strictMode||false?"strict":"loose"].exec(str),uri={attr:{},param:{},seg:{}},i=14;while(i--){uri.attr[key[i]]=res[i]||""}uri.param.query={};uri.param.fragment={};uri.attr.query.replace(querystring_parser,function($0,$1,$2){if($1){uri.param.query[$1]=$2}});uri.attr.fragment.replace(fragment_parser,function($0,$1,$2){if($1){uri.param.fragment[$1]=$2}});uri.seg.path=uri.attr.path.replace(/^\/+|\/+$/g,"").split("/");uri.seg.fragment=uri.attr.fragment.replace(/^\/+|\/+$/g,"").split("/");uri.attr.base=uri.attr.host?(uri.attr.protocol?uri.attr.protocol+"://"+uri.attr.host:uri.attr.host)+(uri.attr.port?":"+uri.attr.port:""):"";return uri}function getAttrName(elm){var tn=elm.tagName;if(tn!==undefined){return tag2attr[tn.toLowerCase()]}return tn}$.fn.url=function(strictMode){var url="";if(this.length){url=$(this).attr(getAttrName(this[0]))||""}return $.url(url,strictMode)};$.url=function(url,strictMode){if(arguments.length===1&&url===true){strictMode=true;url=undefined}strictMode=strictMode||false;url=url||window.location.toString();return{data:parseUri(url,strictMode),attr:function(attr){attr=aliases[attr]||attr;return attr!==undefined?this.data.attr[attr]:this.data.attr},param:function(param){return param!==undefined?this.data.param.query[param]:this.data.param.query},fparam:function(param){return param!==undefined?this.data.param.fragment[param]:this.data.param.fragment},segment:function(seg){if(seg===undefined){return this.data.seg.path}else{seg=seg<0?this.data.seg.path.length+seg:seg-1;return this.data.seg.path[seg]}},fsegment:function(seg){if(seg===undefined){return this.data.seg.fragment}else{seg=seg<0?this.data.seg.fragment.length+seg:seg-1;return this.data.seg.fragment[seg]}}}}});
/*!!
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * @link   http://www.phpied.com/rgb-color-parser-in-javascript/
 * @license Use it if you like it
 */
(function(){var RGBColor=function(color_string){this.ok=false;if(color_string.charAt(0)=="#"){color_string=color_string.substr(1,6)}color_string=color_string.replace(/ /g,"");color_string=color_string.toLowerCase();var simple_colors={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var key in simple_colors){if(color_string==key){color_string=simple_colors[key]}}var color_defs=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(bits){return[parseInt(bits[1]),parseInt(bits[2]),parseInt(bits[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(bits){return[parseInt(bits[1],16),parseInt(bits[2],16),parseInt(bits[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(bits){return[parseInt(bits[1]+bits[1],16),parseInt(bits[2]+bits[2],16),parseInt(bits[3]+bits[3],16)]}}];for(var i=0;i<color_defs.length;i++){var re=color_defs[i].re;var processor=color_defs[i].process;var bits=re.exec(color_string);if(bits){channels=processor(bits);this.r=channels[0];this.g=channels[1];this.b=channels[2];this.ok=true}}this.r=(this.r<0||isNaN(this.r))?0:((this.r>255)?255:this.r);this.g=(this.g<0||isNaN(this.g))?0:((this.g>255)?255:this.g);this.b=(this.b<0||isNaN(this.b))?0:((this.b>255)?255:this.b);this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"};this.toRGBA=function(a){return"rgba("+this.r+", "+this.g+", "+this.b+", "+a+")"};this.toHex=function(){var r=this.r.toString(16);var g=this.g.toString(16);var b=this.b.toString(16);if(r.length==1){r="0"+r}if(g.length==1){g="0"+g}if(b.length==1){b="0"+b}return"#"+r+g+b};this.getHelpXML=function(){var examples=new Array();for(var i=0;i<color_defs.length;i++){var example=color_defs[i].example;for(var j=0;j<example.length;j++){examples[examples.length]=example[j]}}for(var sc in simple_colors){examples[examples.length]=sc}var xml=document.createElement("ul");xml.setAttribute("id","rgbcolor-examples");for(var i=0;i<examples.length;i++){try{var list_item=document.createElement("li");var list_color=new RGBColor(examples[i]);var example_div=document.createElement("div");example_div.style.cssText="margin: 3px; border: 1px solid black; background:"+list_color.toHex()+"; color:"+list_color.toHex();example_div.appendChild(document.createTextNode("test"));var list_item_value=document.createTextNode(" "+examples[i]+" -> "+list_color.toRGB()+" -> "+list_color.toHex());list_item.appendChild(example_div);list_item.appendChild(list_item_value);xml.appendChild(list_item)}catch(e){}}return xml}};_gliffy.RGBColor=RGBColor})();(function(){var isFiniteNumber=function(num){return isFinite(num)&&!isNaN(num)};var isNumber=function(val){return typeof val=="number"};var checkFiniteNumbers=function(args){if(_gliffy.Debug.FINITE_NUMBER_CHECKS){var len=args.length;for(var i=0;i<len;i++){if(!isFiniteNumber(args[i])){throw Error("Invalid transform parameters")}}}};var AffineTransform=function(opt_m00,opt_m10,opt_m01,opt_m11,opt_m02,opt_m12){checkFiniteNumbers(arguments);if(arguments.length==6){this.setTransform((opt_m00),(opt_m10),(opt_m01),(opt_m11),(opt_m02),(opt_m12))}else{if(arguments.length!=0){throw Error("Insufficient matrix parameters")}else{this.m00_=this.m11_=1;this.m10_=this.m01_=this.m02_=this.m12_=0}}};AffineTransform.prototype.isIdentity=function(){return this.m00_==1&&this.m10_==0&&this.m01_==0&&this.m11_==1&&this.m02_==0&&this.m12_==0};AffineTransform.prototype.clone=function(){return new AffineTransform(this.m00_,this.m10_,this.m01_,this.m11_,this.m02_,this.m12_)};AffineTransform.prototype.setTransform=function(m00,m10,m01,m11,m02,m12){checkFiniteNumbers(arguments);this.m00_=m00;this.m10_=m10;this.m01_=m01;this.m11_=m11;this.m02_=m02;this.m12_=m12;return this};AffineTransform.prototype.copyFrom=function(tx){checkFiniteNumbers([tx.m00_,tx.m01_,tx.m02_,tx.m10_,tx.m11_,tx.m12_]);this.m00_=tx.m00_;this.m10_=tx.m10_;this.m01_=tx.m01_;this.m11_=tx.m11_;this.m02_=tx.m02_;this.m12_=tx.m12_;return this};AffineTransform.prototype.scale=function(sx,sy){checkFiniteNumbers(arguments);this.m00_*=sx;this.m10_*=sx;this.m01_*=sy;this.m11_*=sy;return this};AffineTransform.prototype.preScale=function(sx,sy){checkFiniteNumbers(arguments);this.m00_*=sx;this.m01_*=sx;this.m02_*=sx;this.m10_*=sy;this.m11_*=sy;this.m12_*=sy;return this};AffineTransform.prototype.translate=function(dx,dy){checkFiniteNumbers(arguments);this.m02_+=dx*this.m00_+dy*this.m01_;this.m12_+=dx*this.m10_+dy*this.m11_;return this};AffineTransform.prototype.preTranslate=function(dx,dy){checkFiniteNumbers(arguments);this.m02_+=dx;this.m12_+=dy;return this};AffineTransform.prototype.rotate=function(theta,x,y){checkFiniteNumbers(arguments);return this.concatenate(AffineTransform.getRotateInstance(theta,x,y))};AffineTransform.prototype.preRotate=function(theta,x,y){checkFiniteNumbers(arguments);return this.preConcatenate(AffineTransform.getRotateInstance(theta,x,y))};AffineTransform.prototype.shear=function(shx,shy){checkFiniteNumbers(arguments);var m00=this.m00_;var m10=this.m10_;this.m00_+=shy*this.m01_;this.m10_+=shy*this.m11_;this.m01_+=shx*m00;this.m11_+=shx*m10;return this};AffineTransform.prototype.preShear=function(shx,shy){checkFiniteNumbers(arguments);var m00=this.m00_;var m01=this.m01_;var m02=this.m02_;this.m00_+=shx*this.m10_;this.m01_+=shx*this.m11_;this.m02_+=shx*this.m12_;this.m10_+=shy*m00;this.m11_+=shy*m01;this.m12_+=shy*m02;return this};AffineTransform.prototype.toString=function(){return"matrix("+[this.m00_,this.m10_,this.m01_,this.m11_,this.m02_,this.m12_].join(",")+")"};AffineTransform.prototype.getValue=function(i){var arr=[this.m00_,this.m10_,this.m01_,this.m11_,this.m02_,this.m12_];return arr[i]};AffineTransform.prototype.getValues=function(){return[this.m00_,this.m10_,this.m01_,this.m11_,this.m02_,this.m12_]};AffineTransform.prototype.getScaleX=function(){return this.m00_};AffineTransform.prototype.getScaleY=function(){return this.m11_};AffineTransform.prototype.getTranslateX=function(){return this.m02_};AffineTransform.prototype.getTranslateY=function(){return this.m12_};AffineTransform.prototype.getShearX=function(){return this.m01_};AffineTransform.prototype.getShearY=function(){return this.m10_};AffineTransform.prototype.concatenate=function(tx){checkFiniteNumbers([tx.m00_,tx.m01_,tx.m02_,tx.m10_,tx.m11_,tx.m12_]);var m0=this.m00_;var m1=this.m01_;this.m00_=tx.m00_*m0+tx.m10_*m1;this.m01_=tx.m01_*m0+tx.m11_*m1;this.m02_+=tx.m02_*m0+tx.m12_*m1;m0=this.m10_;m1=this.m11_;this.m10_=tx.m00_*m0+tx.m10_*m1;this.m11_=tx.m01_*m0+tx.m11_*m1;this.m12_+=tx.m02_*m0+tx.m12_*m1;return this};AffineTransform.prototype.preConcatenate=function(tx){checkFiniteNumbers([tx.m00_,tx.m01_,tx.m02_,tx.m10_,tx.m11_,tx.m12_]);var m0=this.m00_;var m1=this.m10_;this.m00_=tx.m00_*m0+tx.m01_*m1;this.m10_=tx.m10_*m0+tx.m11_*m1;m0=this.m01_;m1=this.m11_;this.m01_=tx.m00_*m0+tx.m01_*m1;this.m11_=tx.m10_*m0+tx.m11_*m1;m0=this.m02_;m1=this.m12_;this.m02_=tx.m00_*m0+tx.m01_*m1+tx.m02_;this.m12_=tx.m10_*m0+tx.m11_*m1+tx.m12_;return this};AffineTransform.prototype.transform=function(src,srcOff,dst,dstOff,numPts){var i=srcOff;var j=dstOff;var srcEnd=srcOff+2*numPts;while(i<srcEnd){var x=src[i++];var y=src[i++];dst[j++]=x*this.m00_+y*this.m01_+this.m02_;dst[j++]=x*this.m10_+y*this.m11_+this.m12_}};AffineTransform.prototype.transformPoint=function(x,y){checkFiniteNumbers(arguments);return{x:x*this.m00_+y*this.m01_+this.m02_,y:x*this.m10_+y*this.m11_+this.m12_}};AffineTransform.prototype.getDeterminant=function(){return this.m00_*this.m11_-this.m01_*this.m10_};AffineTransform.prototype.isInvertible=function(){var det=this.getDeterminant();return isFiniteNumber(det)&&isFiniteNumber(this.m02_)&&isFiniteNumber(this.m12_)&&det!=0};AffineTransform.prototype.createInverse=function(){var det=this.getDeterminant();return new AffineTransform(this.m11_/det,-this.m10_/det,-this.m01_/det,this.m00_/det,(this.m01_*this.m12_-this.m11_*this.m02_)/det,(this.m10_*this.m02_-this.m00_*this.m12_)/det)};AffineTransform.getScaleInstance=function(sx,sy){checkFiniteNumbers(arguments);return new AffineTransform().setToScale(sx,sy)};AffineTransform.getTranslateInstance=function(dx,dy){checkFiniteNumbers(arguments);return new AffineTransform().setToTranslation(dx,dy)};AffineTransform.getShearInstance=function(shx,shy){checkFiniteNumbers(arguments);return new AffineTransform().setToShear(shx,shy)};AffineTransform.getRotateInstance=function(theta,x,y){checkFiniteNumbers(arguments);return new AffineTransform().setToRotation(theta,x,y)};AffineTransform.prototype.setToScale=function(sx,sy){checkFiniteNumbers(arguments);return this.setTransform(sx,0,0,sy,0,0)};AffineTransform.prototype.setToTranslation=function(dx,dy){checkFiniteNumbers(arguments);return this.setTransform(1,0,0,1,dx,dy)};AffineTransform.prototype.setToShear=function(shx,shy){checkFiniteNumbers(arguments);return this.setTransform(1,shy,shx,1,0,0)};AffineTransform.prototype.setToRotation=function(theta,x,y){checkFiniteNumbers(arguments);var cos=Math.cos(theta);var sin=Math.sin(theta);return this.setTransform(cos,sin,-sin,cos,x-x*cos+y*sin,y-x*sin-y*cos)};AffineTransform.prototype.equals=function(tx){checkFiniteNumbers(arguments);if(this==tx){return true}if(!tx){return false}return this.m00_==tx.m00_&&this.m01_==tx.m01_&&this.m02_==tx.m02_&&this.m10_==tx.m10_&&this.m11_==tx.m11_&&this.m12_==tx.m12_};AffineTransform.prototype.toCssNoTranslate=function(o){var options=$.extend({isMoz:false,roundTranslate:false},o);if(options.isMoz){return"matrix("+this.m00_.toFixed(8)+","+this.m10_.toFixed(8)+","+this.m01_.toFixed(8)+","+this.m11_.toFixed(8)+",0,0)"}else{return"matrix("+this.m00_.toFixed(8)+","+this.m10_.toFixed(8)+","+this.m01_.toFixed(8)+","+this.m11_.toFixed(8)+",0,0)"}};AffineTransform.prototype.toCss=function(o){var options=$.extend({isMoz:false,roundTranslate:false},o);var translateX=options.roundTranslate?Math.round(this.m02_):this.m02_;var translateY=options.roundTranslate?Math.round(this.m12_):this.m12_;if(options.isMoz){return"matrix("+this.m00_.toFixed(8)+","+this.m10_.toFixed(8)+","+this.m01_.toFixed(8)+","+this.m11_.toFixed(8)+","+translateX+"px,"+translateY+"px)"}else{return"matrix("+this.m00_.toFixed(8)+","+this.m10_.toFixed(8)+","+this.m01_.toFixed(8)+","+this.m11_.toFixed(8)+","+translateX+","+translateY+")"}};_gliffy.AffineTransform=AffineTransform})();(function(){var candash=function(){var MAX_POINTS=24;var __abscissa=[[],[],[-0.5773502691896257,0.5773502691896257],[0,-0.7745966692414834,0.7745966692414834],[-0.33998104358485626,0.33998104358485626,-0.8611363115940526,0.8611363115940526],[0,-0.5384693101056831,0.5384693101056831,-0.906179845938664,0.906179845938664],[0.6612093864662645,-0.6612093864662645,-0.2386191860831969,0.2386191860831969,-0.932469514203152,0.932469514203152],[0,0.4058451513773972,-0.4058451513773972,-0.7415311855993945,0.7415311855993945,-0.9491079123427585,0.9491079123427585],[-0.1834346424956498,0.1834346424956498,-0.525532409916329,0.525532409916329,-0.7966664774136267,0.7966664774136267,-0.9602898564975363,0.9602898564975363],[0,-0.8360311073266358,0.8360311073266358,-0.9681602395076261,0.9681602395076261,-0.3242534234038089,0.3242534234038089,-0.6133714327005904,0.6133714327005904],[-0.14887433898163122,0.14887433898163122,-0.4333953941292472,0.4333953941292472,-0.6794095682990244,0.6794095682990244,-0.8650633666889845,0.8650633666889845,-0.9739065285171717,0.9739065285171717],[0,-0.26954315595234496,0.26954315595234496,-0.5190961292068118,0.5190961292068118,-0.7301520055740494,0.7301520055740494,-0.8870625997680953,0.8870625997680953,-0.978228658146057,0.978228658146057],[-0.1252334085114689,0.1252334085114689,-0.3678314989981802,0.3678314989981802,-0.5873179542866175,0.5873179542866175,-0.7699026741943047,0.7699026741943047,-0.9041172563704749,0.9041172563704749,-0.9815606342467192,0.9815606342467192],[0,-0.2304583159551348,0.2304583159551348,-0.44849275103644687,0.44849275103644687,-0.6423493394403402,0.6423493394403402,-0.8015780907333099,0.8015780907333099,-0.9175983992229779,0.9175983992229779,-0.9841830547185881,0.9841830547185881],[-0.10805494870734367,0.10805494870734367,-0.31911236892788974,0.31911236892788974,-0.5152486363581541,0.5152486363581541,-0.6872929048116855,0.6872929048116855,-0.827201315069765,0.827201315069765,-0.9284348836635735,0.9284348836635735,-0.9862838086968123,0.9862838086968123],[0,-0.20119409399743451,0.20119409399743451,-0.3941513470775634,0.3941513470775634,-0.5709721726085388,0.5709721726085388,-0.7244177313601701,0.7244177313601701,-0.8482065834104272,0.8482065834104272,-0.937273392400706,0.937273392400706,-0.9879925180204854,0.9879925180204854],[-0.09501250983763744,0.09501250983763744,-0.2816035507792589,0.2816035507792589,-0.45801677765722737,0.45801677765722737,-0.6178762444026438,0.6178762444026438,-0.755404408355003,0.755404408355003,-0.8656312023878318,0.8656312023878318,-0.9445750230732326,0.9445750230732326,-0.9894009349916499,0.9894009349916499],[0,-0.17848418149584785,0.17848418149584785,-0.3512317634538763,0.3512317634538763,-0.5126905370864769,0.5126905370864769,-0.6576711592166907,0.6576711592166907,-0.7815140038968014,0.7815140038968014,-0.8802391537269859,0.8802391537269859,-0.9506755217687678,0.9506755217687678,-0.9905754753144174,0.9905754753144174],[-0.0847750130417353,0.0847750130417353,-0.2518862256915055,0.2518862256915055,-0.41175116146284263,0.41175116146284263,-0.5597708310739475,0.5597708310739475,-0.6916870430603532,0.6916870430603532,-0.8037049589725231,0.8037049589725231,-0.8926024664975557,0.8926024664975557,-0.9558239495713977,0.9558239495713977,-0.9915651684209309,0.9915651684209309],[0,-0.16035864564022537,0.16035864564022537,-0.31656409996362983,0.31656409996362983,-0.46457074137596094,0.46457074137596094,-0.600545304661681,0.600545304661681,-0.7209661773352294,0.7209661773352294,-0.8227146565371428,0.8227146565371428,-0.9031559036148179,0.9031559036148179,-0.96020815213483,0.96020815213483,-0.9924068438435844,0.9924068438435844],[-0.07652652113349734,0.07652652113349734,-0.22778585114164507,0.22778585114164507,-0.37370608871541955,0.37370608871541955,-0.5108670019508271,0.5108670019508271,-0.636053680726515,0.636053680726515,-0.7463319064601508,0.7463319064601508,-0.8391169718222188,0.8391169718222188,-0.912234428251326,0.912234428251326,-0.9639719272779138,0.9639719272779138,-0.9931285991850949,0.9931285991850949],[0,-0.1455618541608951,0.1455618541608951,-0.2880213168024011,0.2880213168024011,-0.4243421202074388,0.4243421202074388,-0.5516188358872198,0.5516188358872198,-0.6671388041974123,0.6671388041974123,-0.7684399634756779,0.7684399634756779,-0.8533633645833173,0.8533633645833173,-0.9200993341504008,0.9200993341504008,-0.9672268385663063,0.9672268385663063,-0.9937521706203895,0.9937521706203895],[-0.06973927331972223,0.06973927331972223,-0.20786042668822127,0.20786042668822127,-0.34193582089208424,0.34193582089208424,-0.469355837986757,0.469355837986757,-0.5876404035069116,0.5876404035069116,-0.6944872631866827,0.6944872631866827,-0.7878168059792081,0.7878168059792081,-0.8658125777203002,0.8658125777203002,-0.926956772187174,0.926956772187174,-0.9700604978354287,0.9700604978354287,-0.9942945854823992,0.9942945854823992],[0,-0.1332568242984661,0.1332568242984661,-0.26413568097034495,0.26413568097034495,-0.3903010380302908,0.3903010380302908,-0.5095014778460075,0.5095014778460075,-0.6196098757636461,0.6196098757636461,-0.7186613631319502,0.7186613631319502,-0.8048884016188399,0.8048884016188399,-0.8767523582704416,0.8767523582704416,-0.9329710868260161,0.9329710868260161,-0.9725424712181152,0.9725424712181152,-0.9947693349975522,0.9947693349975522],[-0.06405689286260563,0.06405689286260563,-0.1911188674736163,0.1911188674736163,-0.3150426796961634,0.3150426796961634,-0.4337935076260451,0.4337935076260451,-0.5454214713888396,0.5454214713888396,-0.6480936519369755,0.6480936519369755,-0.7401241915785544,0.7401241915785544,-0.820001985973903,0.820001985973903,-0.8864155270044011,0.8864155270044011,-0.9382745520027328,0.9382745520027328,-0.9747285559713095,0.9747285559713095,-0.9951872199970213,0.9951872199970213]];var __weight=[[],[],[1,1],[0.8888888888888888,0.5555555555555556,0.5555555555555556],[0.6521451548625461,0.6521451548625461,0.34785484513745385,0.34785484513745385],[0.5688888888888889,0.47862867049936647,0.47862867049936647,0.23692688505618908,0.23692688505618908],[0.3607615730481386,0.3607615730481386,0.46791393457269104,0.46791393457269104,0.17132449237917036,0.17132449237917036],[0.4179591836734694,0.3818300505051189,0.3818300505051189,0.27970539148927664,0.27970539148927664,0.1294849661688697,0.1294849661688697],[0.362683783378362,0.362683783378362,0.31370664587788727,0.31370664587788727,0.22238103445337448,0.22238103445337448,0.10122853629037626,0.10122853629037626],[0.3302393550012598,0.1806481606948574,0.1806481606948574,0.08127438836157441,0.08127438836157441,0.31234707704000286,0.31234707704000286,0.26061069640293544,0.26061069640293544],[0.29552422471475287,0.29552422471475287,0.26926671930999635,0.26926671930999635,0.21908636251598204,0.21908636251598204,0.1494513491505806,0.1494513491505806,0.06667134430868814,0.06667134430868814],[0.2729250867779006,0.26280454451024665,0.26280454451024665,0.23319376459199048,0.23319376459199048,0.18629021092773426,0.18629021092773426,0.1255803694649046,0.1255803694649046,0.05566856711617366,0.05566856711617366],[0.24914704581340277,0.24914704581340277,0.2334925365383548,0.2334925365383548,0.20316742672306592,0.20316742672306592,0.16007832854334622,0.16007832854334622,0.10693932599531843,0.10693932599531843,0.04717533638651183,0.04717533638651183],[0.2325515532308739,0.22628318026289723,0.22628318026289723,0.2078160475368885,0.2078160475368885,0.17814598076194574,0.17814598076194574,0.13887351021978725,0.13887351021978725,0.09212149983772845,0.09212149983772845,0.04048400476531588,0.04048400476531588],[0.2152638534631578,0.2152638534631578,0.2051984637212956,0.2051984637212956,0.18553839747793782,0.18553839747793782,0.15720316715819355,0.15720316715819355,0.12151857068790319,0.12151857068790319,0.08015808715976021,0.08015808715976021,0.03511946033175186,0.03511946033175186],[0.2025782419255613,0.19843148532711158,0.19843148532711158,0.1861610000155622,0.1861610000155622,0.16626920581699392,0.16626920581699392,0.13957067792615432,0.13957067792615432,0.10715922046717194,0.10715922046717194,0.07036604748810812,0.07036604748810812,0.03075324199611727,0.03075324199611727],[0.1894506104550685,0.1894506104550685,0.18260341504492358,0.18260341504492358,0.16915651939500254,0.16915651939500254,0.14959598881657674,0.14959598881657674,0.12462897125553388,0.12462897125553388,0.09515851168249279,0.09515851168249279,0.062253523938647894,0.062253523938647894,0.027152459411754096,0.027152459411754096],[0.17944647035620653,0.17656270536699264,0.17656270536699264,0.16800410215645004,0.16800410215645004,0.15404576107681028,0.15404576107681028,0.13513636846852548,0.13513636846852548,0.11188384719340397,0.11188384719340397,0.08503614831717918,0.08503614831717918,0.0554595293739872,0.0554595293739872,0.02414830286854793,0.02414830286854793],[0.1691423829631436,0.1691423829631436,0.16427648374583273,0.16427648374583273,0.15468467512626524,0.15468467512626524,0.14064291467065065,0.14064291467065065,0.12255520671147846,0.12255520671147846,0.10094204410628717,0.10094204410628717,0.07642573025488905,0.07642573025488905,0.0497145488949698,0.0497145488949698,0.02161601352648331,0.02161601352648331],[0.1610544498487837,0.15896884339395434,0.15896884339395434,0.15276604206585967,0.15276604206585967,0.1426067021736066,0.1426067021736066,0.12875396253933621,0.12875396253933621,0.11156664554733399,0.11156664554733399,0.09149002162245,0.09149002162245,0.06904454273764123,0.06904454273764123,0.0448142267656996,0.0448142267656996,0.019461788229726478,0.019461788229726478],[0.15275338713072584,0.15275338713072584,0.14917298647260374,0.14917298647260374,0.14209610931838204,0.14209610931838204,0.13168863844917664,0.13168863844917664,0.11819453196151841,0.11819453196151841,0.10193011981724044,0.10193011981724044,0.08327674157670475,0.08327674157670475,0.06267204833410907,0.06267204833410907,0.04060142980038694,0.04060142980038694,0.017614007139152118,0.017614007139152118],[0.14608113364969041,0.14452440398997005,0.14452440398997005,0.13988739479107315,0.13988739479107315,0.13226893863333747,0.13226893863333747,0.12183141605372853,0.12183141605372853,0.10879729916714838,0.10879729916714838,0.09344442345603386,0.09344442345603386,0.0761001136283793,0.0761001136283793,0.057134425426857205,0.057134425426857205,0.036953789770852494,0.036953789770852494,0.016017228257774335,0.016017228257774335],[0.13925187285563198,0.13925187285563198,0.13654149834601517,0.13654149834601517,0.13117350478706238,0.13117350478706238,0.12325237681051242,0.12325237681051242,0.11293229608053922,0.11293229608053922,0.10041414444288096,0.10041414444288096,0.08594160621706773,0.08594160621706773,0.06979646842452049,0.06979646842452049,0.052293335152683286,0.052293335152683286,0.03377490158481415,0.03377490158481415,0.0146279952982722,0.0146279952982722],[0.13365457218610619,0.1324620394046966,0.1324620394046966,0.12890572218808216,0.12890572218808216,0.12304908430672953,0.12304908430672953,0.11499664022241136,0.11499664022241136,0.10489209146454141,0.10489209146454141,0.09291576606003515,0.09291576606003515,0.07928141177671895,0.07928141177671895,0.06423242140852585,0.06423242140852585,0.04803767173108467,0.04803767173108467,0.030988005856979445,0.030988005856979445,0.013411859487141771,0.013411859487141771],[0.12793819534675216,0.12793819534675216,0.1258374563468283,0.1258374563468283,0.12167047292780339,0.12167047292780339,0.1155056680537256,0.1155056680537256,0.10744427011596563,0.10744427011596563,0.09761865210411388,0.09761865210411388,0.08619016153195327,0.08619016153195327,0.0733464814110803,0.0733464814110803,0.05929858491543678,0.05929858491543678,0.04427743881741981,0.04427743881741981,0.028531388628933663,0.028531388628933663,0.0123412297999872,0.0123412297999872]];var __approximateIntegralValue=function(_f,_a,_b,_n){if(!_n){_n=5}if(isNaN(_a)||isNaN(_b)){throw"invalid parameters: _a or _b is not a number"}if(_a>=_b){throw"invalid parameters: _a is greater or equal to _b"}if(!(typeof _f==="function")){throw"invalid parameters: _f is not a function"}if(isNaN(_n)||_n<2){throw"invalid parameters: _n is not a number or _n is less than 2"}var n=Math.max(_n,2);n=Math.min(n,MAX_POINTS);var sum=0;if(_a==-1&&_b==1){for(var i=0;i<n;++i){sum+=_f(__abscissa[n][i]*__weight[n][i])}return sum}else{var mult=0.5*(_b-_a);var ab2=0.5*(_a+_b);for(i=0;i<n;++i){sum+=_f(ab2+mult*__abscissa[n][i])*__weight[n][i]}return mult*sum}};var __quadraticCurve=function(t,p1,p2,p3){var mt=1-t;return mt*mt*p1+2*mt*t*p2+t*t*p3};var __cubicCurve=function(t,p1,p2,p3,p4){var mt=1-t;return mt*mt*mt*p1+3*mt*mt*t*p2+3*mt*t*t*p3+t*t*t*p4};var __base2=function(t,p1,p2,p3){return t*(2*p1-4*p2+2*p3)-2*p1+2*p2};var __base2Root=function(s,c,e){var numerator=s-c;var denominator=s-2*c+e;if(denominator===0){return -1}return numerator/denominator};var __base3=function(t,p1,p2,p3,p4){var t1=-3*p1+9*p2-9*p3+3*p4;var t2=t*t1+6*p1-12*p2+6*p3;return t*t2-3*p1+3*p2};var __base3Roots=function(s,c1,c2,e){var tl=-s+2*c1-c2;var tr=Math.sqrt(-s*(c2-e)+c1*c1-c1*(c2+e)+c2*c2);var denominator=-s+3*c1-3*c2+e;if(denominator===0){return[-1,-1]}return[(tl-tr)/denominator,(tl+tr)/denominator]};var __lineDistance=function(start,end){return Math.sqrt(Math.pow(end.x-start.x,2)+Math.pow(end.y-start.y,2))};var __quadraticBezierDistance=function(start,control,end,start_t,end_t,steps){if(start_t<0||start_t>1||start_t>end_t||end_t<0||end_t>1){throw new Error("values of t must be between 0 and 1.0")}return __approximateIntegralValue(function(_t){var xPrime=__base2(_t,start.x,control.x,end.x);var yPrime=__base2(_t,start.y,control.y,end.y);return Math.sqrt(xPrime*xPrime+yPrime*yPrime)},start_t,end_t,steps)};var __cubicBezierDistance=function(start,control1,control2,end,start_t,end_t,steps){if(start_t<0||start_t>1||start_t>end_t||end_t<0||end_t>1){throw new Error("values of t must be between 0 and 1.0")}return __approximateIntegralValue(function(_t){var xPrime=__base3(_t,start.x,control1.x,control2.x,end.x);var yPrime=__base3(_t,start.y,control1.y,control2.y,end.y);return Math.sqrt(xPrime*xPrime+yPrime*yPrime)},start_t,end_t,steps)};var __linearBoundingBox=function(start,end){return[{x:Math.min(start.x,end.x),y:Math.min(start.y,end.y)},{x:Math.max(start.x,end.x),y:Math.max(start.y,end.y)}]};var __quadraticBoundingBox=function(start,control1,end){var linearBounds=__linearBoundingBox(start,end);if(control1.x<linearBounds[0].x||control1.y<linearBounds[0].y||control1.x>linearBounds[1].x||control1.y>linearBounds[1].y){var tx=__base2Root(start.x,control1.x,end.x);if(tx>=0&&tx<=1){var x=__quadraticCurve(tx,start.x,control1.x,end.x);linearBounds[0].x=Math.min(linearBounds[0].x,x);linearBounds[1].x=Math.max(linearBounds[1].x,x)}var ty=__base2Root(start.y,control1.y,end.y);if(ty>=0&&ty<=1){var y=__quadraticCurve(ty,start.y,control1.y,end.y);linearBounds[0].y=Math.min(linearBounds[0].y,y);linearBounds[1].y=Math.max(linearBounds[1].y,y)}}return linearBounds};var __cubicBoundingBox=function(start,control1,control2,end){var linearBounds=__linearBoundingBox(start,end);if(control1.x<linearBounds[0].x||control1.y<linearBounds[0].y||control1.x>linearBounds[1].x||control1.y>linearBounds[1].y||control2.x<linearBounds[0].x||control2.y<linearBounds[0].y||control2.x>linearBounds[1].x||control2.y>linearBounds[1].y){var i;var tx=__base3Roots(start.x,control1.x,control2.x,end.x);for(i=0;i<tx.length;i++){var t=tx[i];if(t>=0&&t<=1){var x=__cubicCurve(t,start.x,control1.x,control2.x,end.x);linearBounds[0].x=Math.min(linearBounds[0].x,x);linearBounds[1].x=Math.max(linearBounds[1].x,x)}}var ty=__base3Roots(start.y,control1.y,control2.y,end.y);for(i=0;i<ty.length;i++){var t=ty[i];if(t>=0&&t<=1){var y=__cubicCurve(t,start.y,control1.y,control2.y,end.y);linearBounds[0].y=Math.min(linearBounds[0].y,y);linearBounds[1].y=Math.max(linearBounds[1].y,y)}}}return linearBounds};var __newtonsMethodQuadratic=function(start,control,end,distance,n,iterations){var xPrime=__base2(n,start.x,control.x,end.x);var yPrime=__base2(n,start.y,control.y,end.y);var nPlusOne=n-(__quadraticBezierDistance(start,control,end,0,n,12)-distance)/Math.sqrt(xPrime*xPrime+yPrime*yPrime);if(nPlusOne<=0){nPlusOne=0.00001}if(nPlusOne>=1){nPlusOne=0.99999}if(iterations===0){return nPlusOne}else{return __newtonsMethodQuadratic(start,control,end,distance,nPlusOne,--iterations)}};var __newtonsMethodCubic=function(start,control1,control2,end,distance,n,iterations){var xPrime=__base3(n,start.x,control1.x,control2.x,end.x);var yPrime=__base3(n,start.y,control1.y,control2.y,end.y);var nPlusOne=n-(__cubicBezierDistance(start,control1,control2,end,0,n,12)-distance)/Math.sqrt(xPrime*xPrime+yPrime*yPrime);if(nPlusOne<=0){nPlusOne=0.00001}if(nPlusOne>=1){nPlusOne=0.99999}if(iterations===0){return nPlusOne}else{return __newtonsMethodCubic(start,control1,control2,end,distance,nPlusOne,--iterations)}};var __splitQuadraticCurve=function(start,control,end,t){var a={x:(1-t)*start.x+t*control.x,y:(1-t)*start.y+t*control.y};var b={x:(1-t)*control.x+t*end.x,y:(1-t)*control.y+t*end.y};var c={x:(1-t)*a.x+t*b.x,y:(1-t)*a.y+t*b.y};return[[start,a,c],[c,b,end]]};var __splitCubicCurve=function(start,control1,control2,end,t){var a={x:(1-t)*start.x+t*control1.x,y:(1-t)*start.y+t*control1.y};var b={x:(1-t)*control1.x+t*control2.x,y:(1-t)*control1.y+t*control2.y};var c={x:(1-t)*control2.x+t*end.x,y:(1-t)*control2.y+t*end.y};var m={x:(1-t)*a.x+t*b.x,y:(1-t)*a.y+t*b.y};var n={x:(1-t)*b.x+t*c.x,y:(1-t)*b.y+t*c.y};var p={x:(1-t)*m.x+t*n.x,y:(1-t)*m.y+t*n.y};return[[start,a,m,p],[p,n,c,end]]};var __splitLine=function(start,end,distance){var N=[0,0];if(start.x===end.x){N=[0,1]}else{var slope=(end.y-start.y)/(end.x-start.x);var magnitude=Math.sqrt(1+slope*slope);N=[1/magnitude,slope/magnitude]}var dashPoint={x:start.x+distance*N[0],y:start.y+distance*N[1]};if(__lineDistance(dashPoint,end)>__lineDistance(start,end)){dashPoint={x:start.x-distance*N[0],y:start.y-distance*N[1]}}return[[start,dashPoint],[dashPoint,end]]};return{lineTo:function(start,end,ctx){if(!ctx.dasharray){throw new Error("No dasharray property set on canvas context. Ex: ctx.dasharray = [10,5]")}if(!ctx.dashinfo){ctx.dashinfo={index:0,remainder:0}}var index=ctx.dashinfo.index%ctx.dasharray.length;var dash=ctx.dasharray[index];if(ctx.dashinfo.remainder&&ctx.dashinfo.remainder>0){dash=ctx.dashinfo.remainder}else{ctx.moveTo(start.x,start.y)}var distance=__lineDistance(start,end);if(distance<dash){if(index%2===0){ctx.lineTo(end.x,end.y)}ctx.dashinfo={remainder:(dash-distance),index:index}}else{var lines=__splitLine(start,end,dash);if(index%2===0){ctx.lineTo(lines[0][1].x,lines[0][1].y)}ctx.dashinfo={remainder:0,index:++index};this.lineTo(lines[1][0],lines[1][1],ctx)}},quadraticCurveTo:function(start,control,end,ctx){if(!ctx.dasharray){throw new Error("No dasharray property set on canvas context. Ex: ctx.dasharray = [10,5]")}if(!ctx.dashinfo){ctx.dashinfo={index:0,remainder:0}}var index=ctx.dashinfo.index%ctx.dasharray.length;var dash=ctx.dasharray[index];if(ctx.dashinfo.remainder&&ctx.dashinfo.remainder>0){dash=ctx.dashinfo.remainder}else{ctx.moveTo(start.x,start.y)}var distance=__quadraticBezierDistance(start,control,end,0,1,12);if(distance<dash){if(index%2===0){ctx.quadraticCurveTo(control.x,control.y,end.x,end.y)}ctx.dashinfo={remainder:dash-distance,index:index}}else{var t=__newtonsMethodQuadratic(start,control,end,dash,0.5,3);var curves=__splitQuadraticCurve(start,control,end,t);if(index%2===0){ctx.quadraticCurveTo(curves[0][1].x,curves[0][1].y,curves[0][2].x,curves[0][2].y)}ctx.dashinfo={remainder:0,index:++index};this.quadraticCurveTo(curves[1][0],curves[1][1],curves[1][2],ctx)}},bezierCurveTo:function(start,control1,control2,end,ctx){if(!ctx.dasharray){throw new Error("No dasharray property set on canvas context. Ex: ctx.dasharray = [10,5]")}if(!ctx.dashinfo){ctx.dashinfo={index:0,remainder:0}}var index=ctx.dashinfo.index%ctx.dasharray.length;var dash=ctx.dasharray[index];if(ctx.dashinfo.remainder&&ctx.dashinfo.remainder>0){dash=ctx.dashinfo.remainder}else{ctx.moveTo(start.x,start.y)}var distance=__cubicBezierDistance(start,control1,control2,end,0,1,12);if(distance<dash){if(index%2===0){ctx.bezierCurveTo(control1.x,control1.y,control2.x,control2.y,end.x,end.y)}ctx.dashinfo={remainder:dash-distance,index:index}}else{var t=__newtonsMethodCubic(start,control1,control2,end,dash,0.5,3);var curves=__splitCubicCurve(start,control1,control2,end,t);if(index%2===0){ctx.bezierCurveTo(curves[0][1].x,curves[0][1].y,curves[0][2].x,curves[0][2].y,curves[0][3].x,curves[0][3].y)}ctx.dashinfo={remainder:0,index:++index};this.bezierCurveTo(curves[1][0],curves[1][1],curves[1][2],curves[1][3],ctx)}},cleanCtx:function(ctx){delete ctx.dashinfo;delete ctx.dasharray},getPathDistance:function(path){var totalDistance=0;var distanceArray=[];for(var i=0;i<path.length;i++){var line=path[i];switch(line.length){case 2:var d=__lineDistance(line[0],line[1]);distanceArray.push(d);totalDistance+=d;break;case 3:var d=__quadraticBezierDistance(line[0],line[1],line[2],0,1,12);distanceArray.push(d);totalDistance+=d;break;case 4:var d=__cubicBezierDistance(line[0],line[1],line[2],line[3],0,1,12);distanceArray.push(d);totalDistance+=d;break;default:throw new Error("a line with "+line.length+" points is unsupported")}}return{totalDistance:totalDistance,distanceArray:distanceArray}},getPointInPathAtT:function(path,t){if(t===0){return path[0][0]}else{if(t===1){var last=path[path.length-1];return last[last.length-1]}else{var d=this.getPathDistance(path);return this.getPointInPathAtDistance(path,d.totalDistance*t,d)}}},getBoundingBox:function(path){var bounds;for(var i=0;i<path.length;i++){var line=path[i];switch(line.length){case 2:var b=__linearBoundingBox(line[0],line[1]);if(!bounds){bounds=b}else{bounds[0].x=Math.min(bounds[0].x,b[0].x);bounds[0].y=Math.min(bounds[0].y,b[0].y);bounds[1].x=Math.max(bounds[1].x,b[1].x);bounds[1].y=Math.max(bounds[1].y,b[1].y)}break;case 3:var b=__quadraticBoundingBox(line[0],line[1],line[2]);if(!bounds){bounds=b}else{bounds[0].x=Math.min(bounds[0].x,b[0].x);bounds[0].y=Math.min(bounds[0].y,b[0].y);bounds[1].x=Math.max(bounds[1].x,b[1].x);bounds[1].y=Math.max(bounds[1].y,b[1].y)}break;case 4:var b=__cubicBoundingBox(line[0],line[1],line[2],line[3]);if(!bounds){bounds=b}else{bounds[0].x=Math.min(bounds[0].x,b[0].x);bounds[0].y=Math.min(bounds[0].y,b[0].y);bounds[1].x=Math.max(bounds[1].x,b[1].x);bounds[1].y=Math.max(bounds[1].y,b[1].y)}break;default:throw new Error("a line with "+line.length+" points is unsupported")}}return bounds},getPointInPathAtDistance:function(path,distance,distanceInfo){if(distance===0){return path[0][0]}else{var d=(distanceInfo)?distanceInfo:this.getPathDistance(path);var i=0,distanceLeft=distance;while(distanceLeft>d.distanceArray[i]){distanceLeft-=d.distanceArray[i];i++}if(i>=path.length){var points=path[i-1];return points[points.length-1]}switch(path[i].length){case 2:return __splitLine(path[i][0],path[i][1],distanceLeft)[0][1];case 3:var t=__newtonsMethodQuadratic(path[i][0],path[i][1],path[i][2],distanceLeft,0.5,3);return __splitQuadraticCurve(path[i][0],path[i][1],path[i][2],t)[0][2];case 4:var t=__newtonsMethodCubic(path[i][0],path[i][1],path[i][2],path[i][3],distanceLeft,0.5,3);return __splitCubicCurve(path[i][0],path[i][1],path[i][2],path[i][3],t)[0][3];default:throw new Error("a line with "+path[i].length+" points is unsupported")}}}}};_gliffy.candash=candash()})();(function(){var Point,PathParser,Linevg,compressSpaces,trim,drawPath;compressSpaces=function(s){return s.replace(/[\s\r\t\n]+/gm," ")};trim=function(s){return s.replace(/^\s+|\s+$/g,"")};Point=function(x,y){this.x=x;this.y=y};Point.prototype.angleTo=function(p){return Math.atan2(p.y-this.y,p.x-this.x)};Point.prototype.applyTransform=function(v){var xp=this.x*v[0]+this.y*v[2]+v[4];var yp=this.x*v[1]+this.y*v[3]+v[5];this.x=xp;this.y=yp};PathParser=function(d){var i,tokens=[];for(i=0;i<d.length;i++){tokens.push(d[i].name);tokens=tokens.concat(d[i].args.split(/[,\s+)]/))}this.tokens=tokens};PathParser.prototype.reset=function(){this.i=-1;this.command="";this.previousCommand="";this.start=new Point(0,0);this.control=new Point(0,0);this.current=new Point(0,0);this.points=[];this.angles=[]};PathParser.prototype.isEnd=function(){return this.i>=this.tokens.length-1};PathParser.prototype.isCommandOrEnd=function(){if(this.isEnd()){return true}return this.tokens[this.i+1].match(/^[A-Za-z]$/)!=null};PathParser.prototype.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return true;break}return false};PathParser.prototype.getToken=function(){this.i++;return this.tokens[this.i]};PathParser.prototype.getScalar=function(){return parseFloat(this.getToken())};PathParser.prototype.nextCommand=function(){this.previousCommand=this.command;this.command=this.getToken()};PathParser.prototype.getPoint=function(){var p=new Point(this.getScalar(),this.getScalar());return this.makeAbsolute(p)};PathParser.prototype.getAsControlPoint=function(){var p=this.getPoint();this.control=p;return p};PathParser.prototype.getAsCurrentPoint=function(){var p=this.getPoint();this.current=p;return p};PathParser.prototype.getReflectedControlPoint=function(){if(this.previousCommand.toLowerCase()!="c"&&this.previousCommand.toLowerCase()!="s"){return this.current}return new Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y)};PathParser.prototype.makeAbsolute=function(p){if(this.isRelativeCommand()){p.x+=this.current.x;p.y+=this.current.y}return p};PathParser.prototype.addMarker=function(p,from,priorTo){if(priorTo!=null&&this.angles.length>0&&this.angles[this.angles.length-1]==null){this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(priorTo)}this.addMarkerAngle(p,from==null?null:from.angleTo(p))};PathParser.prototype.addMarkerAngle=function(p,a){this.points.push(p);this.angles.push(a)};PathParser.prototype.getMarkerPoints=function(){return this.points};PathParser.prototype.getMarkerAngles=function(){for(var i=0;i<this.angles.length;i++){if(this.angles[i]==null){for(var j=i+1;j<this.angles.length;j++){if(this.angles[j]!=null){this.angles[i]=this.angles[j];break}}}}return this.angles};drawPath=function(ctx,pp){var p,c,curr,p1,cntrl,cp,currp,cpp,centp,newP,r,rx,ry,sx,sy,u,v,ad,a,m,l,a1,xAxisRotation,largeArcFlag,sweepFlag,halfWay;pp.reset();ctx.beginPath();if(ctx!=null){ctx.beginPath()}while(!pp.isEnd()){pp.nextCommand();switch(pp.command){case"M":case"m":p=pp.getAsCurrentPoint();pp.addMarker(p);if(ctx!=null){ctx.moveTo(p.x,p.y)}pp.start=pp.current;while(!pp.isCommandOrEnd()){p=pp.getAsCurrentPoint();pp.addMarker(p,pp.start);if(ctx!=null){ctx.lineTo(p.x,p.y)}}break;case"L":case"l":while(!pp.isCommandOrEnd()){c=pp.current;p=pp.getAsCurrentPoint();pp.addMarker(p,c);if(ctx!=null){if(ctx.dasharray&&ctx.dasharray.length>0){_gliffy.candash.lineTo({x:c.x,y:c.y},{x:p.x,y:p.y},ctx)}else{ctx.lineTo(p.x,p.y)}}}break;case"H":case"h":while(!pp.isCommandOrEnd()){newP=new Point((pp.isRelativeCommand()?pp.current.x:0)+pp.getScalar(),pp.current.y);pp.addMarker(newP,pp.current);pp.current=newP;if(ctx!=null){ctx.lineTo(pp.current.x,pp.current.y)}}break;case"V":case"v":while(!pp.isCommandOrEnd()){newP=new Point(pp.current.x,(pp.isRelativeCommand()?pp.current.y:0)+pp.getScalar());pp.addMarker(newP,pp.current);pp.current=newP;if(ctx!=null){ctx.lineTo(pp.current.x,pp.current.y)}}break;case"C":case"c":while(!pp.isCommandOrEnd()){curr=pp.current;p1=pp.getPoint();cntrl=pp.getAsControlPoint();cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,p1);if(ctx!=null){if(ctx.dasharray&&ctx.dasharray.length>0){_gliffy.candash.bezierCurveTo({x:curr.x,y:curr.y},{x:p1.x,y:p1.y},{x:cntrl.x,y:cntrl.y},{x:cp.x,y:cp.y},ctx)}else{ctx.bezierCurveTo(p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y)}}}break;case"S":case"s":while(!pp.isCommandOrEnd()){curr=pp.current;p1=pp.getReflectedControlPoint();cntrl=pp.getAsControlPoint();cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,p1);if(ctx!=null){ctx.bezierCurveTo(p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y)}}break;case"Q":case"q":while(!pp.isCommandOrEnd()){curr=pp.current;cntrl=pp.getAsControlPoint();cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,cntrl);if(ctx!=null){if(ctx.dasharray&&ctx.dasharray.length>0){_gliffy.candash.quadraticCurveTo({x:curr.x,y:curr.y},{x:cntrl.x,y:cntrl.y},{x:cp.x,y:cp.y},ctx)}else{ctx.quadraticCurveTo(cntrl.x,cntrl.y,cp.x,cp.y)}}}break;case"T":case"t":while(!pp.isCommandOrEnd()){curr=pp.current;cntrl=pp.getReflectedControlPoint();pp.control=cntrl;cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,cntrl);if(ctx!=null){ctx.quadraticCurveTo(cntrl.x,cntrl.y,cp.x,cp.y)}}break;case"A":case"a":while(!pp.isCommandOrEnd()){curr=pp.current;rx=pp.getScalar();ry=pp.getScalar();xAxisRotation=pp.getScalar()*(Math.PI/180);largeArcFlag=pp.getScalar();sweepFlag=pp.getScalar();cp=pp.getAsCurrentPoint();currp=new Point(Math.cos(xAxisRotation)*(curr.x-cp.x)/2+Math.sin(xAxisRotation)*(curr.y-cp.y)/2,-Math.sin(xAxisRotation)*(curr.x-cp.x)/2+Math.cos(xAxisRotation)*(curr.y-cp.y)/2);l=Math.pow(currp.x,2)/Math.pow(rx,2)+Math.pow(currp.y,2)/Math.pow(ry,2);if(l>1){rx*=Math.sqrt(l);ry*=Math.sqrt(l)}var s=(largeArcFlag==sweepFlag?-1:1)*Math.sqrt(((Math.pow(rx,2)*Math.pow(ry,2))-(Math.pow(rx,2)*Math.pow(currp.y,2))-(Math.pow(ry,2)*Math.pow(currp.x,2)))/(Math.pow(rx,2)*Math.pow(currp.y,2)+Math.pow(ry,2)*Math.pow(currp.x,2)));if(isNaN(s)){s=0}cpp=new Point(s*rx*currp.y/ry,s*-ry*currp.x/rx);centp=new Point((curr.x+cp.x)/2+Math.cos(xAxisRotation)*cpp.x-Math.sin(xAxisRotation)*cpp.y,(curr.y+cp.y)/2+Math.sin(xAxisRotation)*cpp.x+Math.cos(xAxisRotation)*cpp.y);m=function(v){return Math.sqrt(Math.pow(v[0],2)+Math.pow(v[1],2))};r=function(u,v){return(u[0]*v[0]+u[1]*v[1])/(m(u)*m(v))};a=function(u,v){return(u[0]*v[1]<u[1]*v[0]?-1:1)*Math.acos(r(u,v))};a1=a([1,0],[(currp.x-cpp.x)/rx,(currp.y-cpp.y)/ry]);u=[(currp.x-cpp.x)/rx,(currp.y-cpp.y)/ry];v=[(-currp.x-cpp.x)/rx,(-currp.y-cpp.y)/ry];ad=a(u,v);if(r(u,v)<=-1){ad=Math.PI}if(r(u,v)>=1){ad=0}if(sweepFlag==0&&ad>0){ad=ad-2*Math.PI}if(sweepFlag==1&&ad<0){ad=ad+2*Math.PI}halfWay=new Point(centp.x-rx*Math.cos((a1+ad)/2),centp.y-ry*Math.sin((a1+ad)/2));pp.addMarkerAngle(halfWay,(a1+ad)/2+(sweepFlag==0?1:-1)*Math.PI/2);pp.addMarkerAngle(cp,ad+(sweepFlag==0?1:-1)*Math.PI/2);if(ctx!=null){r=rx>ry?rx:ry;sx=rx>ry?1:rx/ry;sy=rx>ry?ry/rx:1;ctx.translate(centp.x,centp.y);ctx.rotate(xAxisRotation);ctx.scale(sx,sy);ctx.arc(0,0,r,a1,a1+ad,1-sweepFlag);ctx.scale(1/sx,1/sy);ctx.rotate(-xAxisRotation);ctx.translate(-centp.x,-centp.y)}}break;case"Z":case"z":if(ctx!=null){ctx.closePath()}pp.current=pp.start}}ctx.stroke()};Linevg=function(d){this.PathParser=new PathParser(d)};Linevg.prototype.getMarkers=function(){var points=this.PathParser.getMarkerPoints();var angles=this.PathParser.getMarkerAngles();var markers=[];for(var i=0;i<points.length;i++){markers.push([points[i],angles[i]])}return markers};Linevg.prototype.drawPath=function(ctx,data){var angle,point,markers;ctx.save();if(data.stroke_width!==undefined&&data.stroke_width!==null){ctx.lineWidth=data.stroke_width}if(data.stroke_dasharray!==undefined&&data.stroke_dasharray!==null){ctx.dasharray=data.stroke_dasharray.split(",")}if(data.opacity!==undefined&&data.opacity!==null){ctx.globalAlpha=data.opacity}if(data.stroke_linejoin!==undefined&&data.stroke_linejoin!==null){ctx.lineJoin=data.stroke_linejoin}if(data.stroke!==undefined&&data.stroke!==null){ctx.strokeStyle=(data.strokeStyle==="none")?"rgba(0,0,0,0)":data.stroke}drawPath(ctx,this.PathParser);if(ctx.dasharray){_gliffy.candash.cleanCtx(ctx)}markers=this.getMarkers();if(data.start_arrow!==0&&data.start_arrow!==null&&data.start_arrow!==undefined&&data.start_arrow!=="none"){ctx.save();point=markers[0][0];angle=markers[0][1];ctx.translate(point.x,point.y);if(data.marker_start_orient==="auto"){ctx.rotate(angle)}else{ctx.rotate(data.marker_start_orient*Math.PI/180)}_gliffy.shapeLibrary.drawStencil(data.start_arrow_tid,ctx,data);ctx.restore()}if(data.end_arrow!==0&&data.end_arrow!==null&&data.end_arrow!==undefined&&data.end_arrow!=="none"){ctx.save();point=markers[markers.length-1][0];angle=markers[markers.length-1][1];ctx.translate(point.x,point.y);if(data.marker_end_orient==="auto"){ctx.rotate(angle)}else{ctx.rotate(data.marker_end_orient*Math.PI/180)}_gliffy.shapeLibrary.drawStencil(data.end_arrow_tid,ctx,data);ctx.restore()}ctx.restore()};_gliffy.Linevg=Linevg}());(function(){var styleProp=($.browser.msie)?"display":"pointerEvents";var KoreSampl=function(){};KoreSampl.prototype.fromEvent=function(e,lastElement){e=e||window.event;return this.atPoint(e.clientX,e.clientY,lastElement)};KoreSampl.prototype.atPoint=function(clientX,clientY,lastElement,previousElement){var d=(lastElement)?lastElement.ownerDocument:document;lastElement=lastElement||d.getElementsByTagName("html")[0];var element=d.elementFromPoint(clientX,clientY);if(element===null||element===undefined||element===previousElement){return[]}else{if(element===lastElement||element.nodeName==="HTML"){return[element]}else{var style=element.style[styleProp];element.style[styleProp]="none";var result=[element].concat(this.atPoint(clientX,clientY,lastElement,element));element.style[styleProp]=style;return result}}};_gliffy.KoreSampl=new KoreSampl()})();(function($){var check={};var keys=[];$.fn.lazyload=function(options){var settings={threshold:0,failurelimit:0,delay:100,container:window,callback:function(element){}},elements=this,timeout=null;if(options){$.extend(settings,options)}$.fn.lazyload.delay=settings.delay;var key=new Date().getTime();var unseen=this.length;function checkElements(){var counter=0;var containerOffsets=getOffsets(settings.container);elements.each(function(){var $this=$(this);if($this.is(":visible")){var elementOffsets=getOffsets($this);if(aboveTheTop(containerOffsets,elementOffsets,settings)||leftOfBegin(containerOffsets,elementOffsets,settings)){}else{if(!belowTheFold(containerOffsets,elementOffsets,settings)&&!rightOfFold(containerOffsets,elementOffsets,settings)){$this.trigger("appear")}else{if(counter++>settings.failurelimit){return false}}}}})}function getOffsets(element){var elementTop,elementLeft,elementWidth,elementHeight;if(element==undefined||element==window){var $window=$(window);elementTop=$window.scrollTop();elementHeight=$window.height();elementLeft=$window.scrollLeft();elementWidth=$window.width()}else{var $element=$(element);elementTop=$element.offset().top;elementHeight=$element.height();elementLeft=$element.offset().left;elementWidth=$element.width()}return{top:elementTop,height:elementHeight,left:elementLeft,width:elementWidth}}function belowTheFold(containerOffsets,elementOffsets,settings){var fold=containerOffsets.top+containerOffsets.height;return fold<=elementOffsets.top-settings.threshold}function rightOfFold(containerOffsets,elementOffsets,settings){var fold=containerOffsets.left+containerOffsets.width;return fold<=elementOffsets.left-settings.threshold}function aboveTheTop(containerOffsets,elementOffsets,settings){var fold=containerOffsets.top;return fold>=elementOffsets.top+settings.threshold+elementOffsets.height}function leftOfBegin(containerOffsets,elementOffsets,settings){var fold=containerOffsets.left;return fold>=elementOffsets.left+settings.threshold+elementOffsets.width}this.each(function(){var $this=$(this);$this.one("appear",function(e){unseen--;if(unseen===0){var index=keys.indexOf(key);if(index>-1){keys.splice(index,1);delete check[key]}else{$(settings.container).unbind("scroll."+key)}}settings.callback($this)})});if(settings.container!==window){$(settings.container).bind("scroll."+key+" lazyload",function(e){if(timeout){clearTimeout(timeout)}timeout=setTimeout(function(){checkElements()},settings.delay)})}else{keys.push(key);check[key]=checkElements}checkElements();return this};var windowTimeout;$(window).bind("scroll.lazyload resize.lazyload lazyload",function(){if(windowTimeout){clearTimeout(windowTimeout)}if(keys.length>0){windowTimeout=setTimeout(function(){for(var i=0;i<keys.length;i++){check[keys[i]]()}},$.fn.lazyload.delay)}else{if(document.readyState==="complete"){$(window).unbind("scroll.lazyload resize.lazyload lazyload")}}})})(jQuery);(function(){var isDef=function(val){return val!==undefined};var Coordinate=function(opt_x,opt_y){this.x=isDef(opt_x)?opt_x:0;this.y=isDef(opt_y)?opt_y:0};Coordinate.prototype.clone=function(){return new Coordinate(this.x,this.y)};Coordinate.prototype.toString=function(){return"("+this.x+", "+this.y+")"};Coordinate.equals=function(a,b){if(a==b){return true}if(!a||!b){return false}return a.x==b.x&&a.y==b.y};Coordinate.distance=function(a,b){var dx=a.x-b.x;var dy=a.y-b.y;return Math.sqrt(dx*dx+dy*dy)};Coordinate.squaredDistance=function(a,b){var dx=a.x-b.x;var dy=a.y-b.y;return dx*dx+dy*dy};Coordinate.difference=function(a,b){return new Coordinate(a.x-b.x,a.y-b.y)};Coordinate.sum=function(a,b){return new Coordinate(a.x+b.x,a.y+b.y)};_gliffy.Coordinate=Coordinate})();(function(){var inherits=function(childCtor,parentCtor){function tempCtor(){}tempCtor.prototype=parentCtor.prototype;childCtor.superClass_=parentCtor.prototype;childCtor.prototype=new tempCtor();childCtor.prototype.constructor=childCtor};var Vec2=function(x,y){this.x=x;this.y=y};inherits(Vec2,_gliffy.Coordinate);Vec2.randomUnit=function(){var angle=Math.random()*Math.PI*2;return new Vec2(Math.cos(angle),Math.sin(angle))};Vec2.random=function(){var mag=Math.sqrt(Math.random());var angle=Math.random()*Math.PI*2;return new Vec2(Math.cos(angle)*mag,Math.sin(angle)*mag)};Vec2.fromCoordinate=function(a){return new Vec2(a.x,a.y)};Vec2.prototype.clone=function(){return new Vec2(this.x,this.y)};Vec2.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};Vec2.prototype.squaredMagnitude=function(){return this.x*this.x+this.y*this.y};Vec2.prototype.scale=function(s){this.x*=s;this.y*=s;return this};Vec2.prototype.invert=function(){this.x=-this.x;this.y=-this.y;return this};Vec2.prototype.normalize=function(){return this.scale(1/this.magnitude())};Vec2.prototype.safeNormalize=function(){var mag=this.magnitude();if(mag>0.00001){return this.scale(1/mag)}return this};Vec2.prototype.add=function(b){this.x+=b.x;this.y+=b.y;return this};Vec2.prototype.subtract=function(b){this.x-=b.x;this.y-=b.y;return this};Vec2.prototype.rotate=function(angle){var cos=Math.cos(angle);var sin=Math.sin(angle);var newX=this.x*cos-this.y*sin;var newY=this.y*cos+this.x*sin;this.x=newX;this.y=newY;return this};Vec2.rotateAroundPoint=function(v,axisPoint,angle){var res=v.clone();return res.subtract(axisPoint).rotate(angle).add(axisPoint)};Vec2.prototype.equals=function(b){return this==b||!!b&&this.x==b.x&&this.y==b.y};Vec2.distance=_gliffy.Coordinate.distance;Vec2.squaredDistance=_gliffy.Coordinate.squaredDistance;Vec2.equals=_gliffy.Coordinate.equals;Vec2.sum=function(a,b){return new Vec2(a.x+b.x,a.y+b.y)};Vec2.difference=function(a,b){return new Vec2(a.x-b.x,a.y-b.y)};Vec2.dot=function(a,b){return a.x*b.x+a.y*b.y};var lerp=function(a,b,x){return a+x*(b-a)};Vec2.lerp=function(a,b,x){return new Vec2(lerp(a.x,b.x,x),lerp(a.y,b.y,x))};_gliffy.Vec2=Vec2})();(function($){var ColorPicker=function(){var ids={},inAction,charMin=65,visible,__callback,__newColor,__mode="fill",tpl='<div class="colorpicker gliffy-icon-colorpicker-background gliffy-dialog-dropshadow">   <div class="colorpicker_color">      <div class="gliffy-icon-colorpicker-overlay">          <div class="gliffy-icon-colorpicker-select"></div>      </div>   </div>   <div class="colorpicker_hue">       <div class="gliffy-icon-colorpicker-indic"></div>   </div>   <div class="colorpicker_new_color" title="'+$.i18n._("COLORPICKER_NEW_COLOR")+'"></div>   <div class="colorpicker_current_color" title="'+$.i18n._("COLORPICKER_CURRENT_COLOR")+'"></div>   <div class="colorpicker_hex gliffy-icon-colorpicker-hex">       <input type="text" maxlength="6" size="6" />   </div>   <div class="colorpicker_rgb_r gliffy-icon-colorpicker-rgb-r colorpicker_field">       <input type="text" maxlength="3" size="3" /><span></span>   </div>   <div class="colorpicker_rgb_g gliffy-icon-colorpicker-rgb-g colorpicker_field">       <input type="text" maxlength="3" size="3" /><span></span>   </div>   <div class="colorpicker_rgb_b gliffy-icon-colorpicker-rgb-b colorpicker_field">       <input type="text" maxlength="3" size="3" /><span></span>   </div>   <div class="colorpicker_hsb_h gliffy-icon-colorpicker-hsb-h colorpicker_field">       <input type="text" maxlength="3" size="3" /><span></span>   </div>   <div class="colorpicker_hsb_s gliffy-icon-colorpicker-hsb-s colorpicker_field">       <input type="text" maxlength="3" size="3" /><span></span>   </div>   <div class="colorpicker_hsb_b gliffy-icon-colorpicker-hsb-b colorpicker_field">       <input type="text" maxlength="3" size="3" /><span></span>   </div>   <div class="colorpicker_submit gliffy-icon-colorpicker-submit" title="'+$.i18n._("COLORPICKER_SET_NEW")+'"></div>   <button class="btn swatches-button" title="'+$.i18n._("COLORPICKER_COLOR_SWATCHES")+'">'+$.i18n._("COLORPICKER_SWATCHES")+'</button>   <button class="btn gliffy-btn-primary ok-button">'+$.i18n._("COLORPICKER_OK")+'</button>   <button class="btn cancel-button">'+$.i18n._("COLORPICKER_CANCEL")+"</button></div>",defaults={eventName:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},color:"ff0000",livePreview:true,flat:false},fillRGBFields=function(hsb,cal){var rgb=HSBToRGB(hsb);$(cal).data("colorpicker").fields.eq(1).val(rgb.r).end().eq(2).val(rgb.g).end().eq(3).val(rgb.b).end()},fillHSBFields=function(hsb,cal){$(cal).data("colorpicker").fields.eq(4).val(Math.round(hsb.h)).end().eq(5).val(Math.round(hsb.s)).end().eq(6).val(Math.round(hsb.b)).end()},fillHexFields=function(hsb,cal){$(cal).data("colorpicker").fields.eq(0).val(HSBToHex(hsb)).end()},setSelector=function(hsb,cal){$(cal).data("colorpicker").selector.css("backgroundColor","#"+HSBToHex({h:hsb.h,s:100,b:100}));$(cal).data("colorpicker").selectorIndic.css({left:parseInt(150*hsb.s/100,10),top:parseInt(150*(100-hsb.b)/100,10)})},setHue=function(hsb,cal){$(cal).data("colorpicker").hue.css("top",parseInt(150-150*hsb.h/360,10))},setCurrentColor=function(hsb,cal){$(cal).data("colorpicker").currentColor.css("backgroundColor","#"+HSBToHex(hsb))},setNewColor=function(hsb,cal){var tempHex="#"+HSBToHex(hsb);$(cal).data("colorpicker").newColor.css("backgroundColor",tempHex);__newColor=tempHex},keyDown=function(ev){var pressedKey=ev.charCode||ev.keyCode||-1;if((pressedKey>charMin&&pressedKey<=90)||pressedKey==32){return false}var cal=$(this).parent().parent();if(cal.data("colorpicker").livePreview===true){change.apply(this)}},change=function(ev){var cal=$(this).parent().parent(),col;if(this.parentNode.className.indexOf("_hex")>0){cal.data("colorpicker").color=col=HexToHSB(fixHex(this.value))}else{if(this.parentNode.className.indexOf("_hsb")>0){cal.data("colorpicker").color=col=fixHSB({h:parseInt(cal.data("colorpicker").fields.eq(4).val(),10),s:parseInt(cal.data("colorpicker").fields.eq(5).val(),10),b:parseInt(cal.data("colorpicker").fields.eq(6).val(),10)})}else{cal.data("colorpicker").color=col=RGBToHSB(fixRGB({r:parseInt(cal.data("colorpicker").fields.eq(1).val(),10),g:parseInt(cal.data("colorpicker").fields.eq(2).val(),10),b:parseInt(cal.data("colorpicker").fields.eq(3).val(),10)}))}}if(ev){fillRGBFields(col,cal.get(0));fillHexFields(col,cal.get(0));fillHSBFields(col,cal.get(0))}setSelector(col,cal.get(0));setHue(col,cal.get(0));setNewColor(col,cal.get(0));cal.data("colorpicker").onChange.apply(cal,[col,HSBToHex(col),HSBToRGB(col)])},blur=function(ev){var cal=$(this).parent().parent();cal.data("colorpicker").fields.parent().removeClass("colorpicker_focus")},focus=function(){charMin=this.parentNode.className.indexOf("_hex")>0?70:65;$(this).parent().parent().data("colorpicker").fields.parent().removeClass("colorpicker_focus");$(this).parent().addClass("colorpicker_focus")},downIncrement=function(ev){var field=$(this).parent().find("input").focus();var current={el:$(this).parent().addClass("colorpicker_slider"),max:this.parentNode.className.indexOf("_hsb_h")>0?360:(this.parentNode.className.indexOf("_hsb")>0?100:255),y:ev.pageY,field:field,val:parseInt(field.val(),10),preview:$(this).parent().parent().data("colorpicker").livePreview};$(document).bind("mouseup",current,upIncrement);$(document).bind("mousemove",current,moveIncrement)},moveIncrement=function(ev){ev.data.field.val(Math.max(0,Math.min(ev.data.max,parseInt(ev.data.val+ev.pageY-ev.data.y,10))));if(ev.data.preview){change.apply(ev.data.field.get(0),[true])}return false},upIncrement=function(ev){change.apply(ev.data.field.get(0),[true]);ev.data.el.removeClass("colorpicker_slider").find("input").focus();$(document).unbind("mouseup",upIncrement);$(document).unbind("mousemove",moveIncrement);return false},downHue=function(ev){var current={cal:$(this).parent(),y:$(this).offset().top};current.preview=current.cal.data("colorpicker").livePreview;$(document).bind("mouseup",current,upHue);$(document).bind("mousemove",current,moveHue);$(document).bind("mousedown",current,moveHue)},moveHue=function(ev){change.apply(ev.data.cal.data("colorpicker").fields.eq(4).val(parseInt(360*(150-Math.max(0,Math.min(150,(ev.pageY-ev.data.y))))/150,10)).get(0),[ev.data.preview]);return false},upHue=function(ev){fillRGBFields(ev.data.cal.data("colorpicker").color,ev.data.cal.get(0));fillHexFields(ev.data.cal.data("colorpicker").color,ev.data.cal.get(0));$(document).unbind("mouseup",upHue);$(document).unbind("mousemove",moveHue);$(document).unbind("mousedown",moveHue);return false},downSelector=function(ev){var current={cal:$(this).parent(),pos:$(this).offset()};current.preview=current.cal.data("colorpicker").livePreview;$(document).bind("mouseup",current,upSelector);$(document).bind("mousemove",current,moveSelector);$(document).bind("mousedown",current,moveSelector)},moveSelector=function(ev){change.apply(ev.data.cal.data("colorpicker").fields.eq(6).val(parseInt(100*(150-Math.max(0,Math.min(150,(ev.pageY-ev.data.pos.top))))/150,10)).end().eq(5).val(parseInt(100*(Math.max(0,Math.min(150,(ev.pageX-ev.data.pos.left))))/150,10)).get(0),[ev.data.preview]);return false},upSelector=function(ev){fillRGBFields(ev.data.cal.data("colorpicker").color,ev.data.cal.get(0));fillHexFields(ev.data.cal.data("colorpicker").color,ev.data.cal.get(0));$(document).unbind("mouseup",upSelector);$(document).unbind("mousemove",moveSelector);$(document).unbind("mousedown",moveSelector);return false},enterSubmit=function(ev){$(this).removeClass("gliffy-icon-colorpicker-submit").addClass("colorpicker_focus gliffy-icon-colorpicker-submit-hover")},leaveSubmit=function(ev){$(this).removeClass("colorpicker_focus gliffy-icon-colorpicker-submit-hover").addClass("gliffy-icon-colorpicker-submit")},clickSubmit=function(ev){var cal=$(this).parent();var col=cal.data("colorpicker").color;cal.data("colorpicker").origColor=col;setCurrentColor(col,cal.get(0));cal.data("colorpicker").onSubmit(col,HSBToHex(col),HSBToRGB(col),cal.data("colorpicker").el)},show=function(ev){var cal=$("#"+$(this).data("colorpickerId"));cal.data("colorpicker").onBeforeShow.apply(this,[cal.get(0)]);var pos=$(this).offset();var viewPort=getViewport();var top=pos.top+this.offsetHeight;var left=pos.left;if(top+176>viewPort.t+viewPort.h){top-=this.offsetHeight+176}if(left+356>viewPort.l+viewPort.w){left-=356}cal.css({left:left+"px",top:top+"px"});if(cal.data("colorpicker").onShow.apply(this,[cal.get(0)])!=false){cal.show()}$(document).bind("mousedown",{cal:cal},hide);return false},hide=function(ev){},isChildOf=function(parentEl,el,container){if(parentEl==el){return true}if(parentEl.contains){return parentEl.contains(el)}if(parentEl.compareDocumentPosition){return !!(parentEl.compareDocumentPosition(el)&16)}var prEl=el.parentNode;while(prEl&&prEl!=container){if(prEl==parentEl){return true}prEl=prEl.parentNode}return false},getViewport=function(){var m=document.compatMode=="CSS1Compat";return{l:window.pageXOffset||(m?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(m?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(m?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(m?document.documentElement.clientHeight:document.body.clientHeight)}},fixHSB=function(hsb){return{h:Math.min(360,Math.max(0,hsb.h)),s:Math.min(100,Math.max(0,hsb.s)),b:Math.min(100,Math.max(0,hsb.b))}},fixRGB=function(rgb){return{r:Math.min(255,Math.max(0,rgb.r)),g:Math.min(255,Math.max(0,rgb.g)),b:Math.min(255,Math.max(0,rgb.b))}},fixHex=function(hex){var len=6-hex.length;if(len>0){var o=[];for(var i=0;i<len;i++){o.push("0")}o.push(hex);hex=o.join("")}return hex},HexToRGB=function(hex){var hex=parseInt(((hex.indexOf("#")>-1)?hex.substring(1):hex),16);return{r:hex>>16,g:(hex&65280)>>8,b:(hex&255)}},HexToHSB=function(hex){return RGBToHSB(HexToRGB(hex))},RGBToHSB=function(rgb){var hsb={h:0,s:0,b:0};var min=Math.min(rgb.r,rgb.g,rgb.b);var max=Math.max(rgb.r,rgb.g,rgb.b);var delta=max-min;hsb.b=max;if(max!=0){}hsb.s=max!=0?255*delta/max:0;if(hsb.s!=0){if(rgb.r==max){hsb.h=(rgb.g-rgb.b)/delta}else{if(rgb.g==max){hsb.h=2+(rgb.b-rgb.r)/delta}else{hsb.h=4+(rgb.r-rgb.g)/delta}}}else{hsb.h=-1}hsb.h*=60;if(hsb.h<0){hsb.h+=360}hsb.s*=100/255;hsb.b*=100/255;return hsb},HSBToRGB=function(hsb){var rgb={};var h=Math.round(hsb.h);var s=Math.round(hsb.s*255/100);var v=Math.round(hsb.b*255/100);if(s==0){rgb.r=rgb.g=rgb.b=v}else{var t1=v;var t2=(255-s)*v/255;var t3=(t1-t2)*(h%60)/60;if(h==360){h=0}if(h<60){rgb.r=t1;rgb.b=t2;rgb.g=t2+t3}else{if(h<120){rgb.g=t1;rgb.b=t2;rgb.r=t1-t3}else{if(h<180){rgb.g=t1;rgb.r=t2;rgb.b=t2+t3}else{if(h<240){rgb.b=t1;rgb.r=t2;rgb.g=t1-t3}else{if(h<300){rgb.b=t1;rgb.g=t2;rgb.r=t2+t3}else{if(h<360){rgb.r=t1;rgb.g=t2;rgb.b=t1-t3}else{rgb.r=0;rgb.g=0;rgb.b=0}}}}}}}return{r:Math.round(rgb.r),g:Math.round(rgb.g),b:Math.round(rgb.b)}},RGBToHex=function(rgb){var hex=[rgb.r.toString(16),rgb.g.toString(16),rgb.b.toString(16)];$.each(hex,function(nr,val){if(val.length==1){hex[nr]="0"+val}});return hex.join("")},HSBToHex=function(hsb){return RGBToHex(HSBToRGB(hsb))},restoreOriginal=function(){var cal=$(this).parent();var col=cal.data("colorpicker").origColor;cal.data("colorpicker").color=col;fillRGBFields(col,cal.get(0));fillHexFields(col,cal.get(0));fillHSBFields(col,cal.get(0));setSelector(col,cal.get(0));setHue(col,cal.get(0));setNewColor(col,cal.get(0))};return{init:function(opt){opt=$.extend({},defaults,opt||{});if(typeof opt.color=="string"){opt.color=HexToHSB(opt.color)}else{if(opt.color.r!=undefined&&opt.color.g!=undefined&&opt.color.b!=undefined){opt.color=RGBToHSB(opt.color)}else{if(opt.color.h!=undefined&&opt.color.s!=undefined&&opt.color.b!=undefined){opt.color=fixHSB(opt.color)}else{return this}}}return this.each(function(){if(!$(this).data("colorpickerId")){var options=$.extend({},opt);options.origColor=opt.color;var id="collorpicker_"+parseInt(Math.random()*1000);$(this).data("colorpickerId",id);var cal=$(tpl).attr("id",id);if(options.flat){cal.appendTo(this).show()}else{cal.appendTo(document.body)}options.fields=cal.find("input").bind("keyup",keyDown).bind("change",change).bind("blur",blur).bind("focus",focus);cal.find("span").bind("mousedown",downIncrement).end().find(">div.colorpicker_current_color").bind("click",restoreOriginal);options.selector=cal.find("div.colorpicker_color").bind("mousedown",downSelector);options.selectorIndic=options.selector.find("div div");options.el=this;options.hue=cal.find("div.colorpicker_hue div");cal.find("div.colorpicker_hue").bind("mousedown",downHue);options.newColor=cal.find("div.colorpicker_new_color");options.currentColor=cal.find("div.colorpicker_current_color");cal.data("colorpicker",options);cal.find("div.colorpicker_submit").bind("mouseenter",enterSubmit).bind("mouseleave",leaveSubmit).bind("click",clickSubmit);fillRGBFields(options.color,cal.get(0));fillHSBFields(options.color,cal.get(0));fillHexFields(options.color,cal.get(0));setHue(options.color,cal.get(0));setSelector(options.color,cal.get(0));setCurrentColor(options.color,cal.get(0));setNewColor(options.color,cal.get(0));if(options.flat){cal.css({position:"relative",display:"block"})}else{$(this).bind(options.eventName,show)}$(".colorpicker .swatches-button").click(function(e){GliffyApp.colorpickerController.handleSwatchesButtonClick(e)}).tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD);$(".colorpicker .ok-button").click(function(e){__callback(__newColor,__mode);GliffyApp.colorpickerController.addToColorMemory(__newColor);GliffyApp.colorpickerController.hideColorpicker()});$(".colorpicker .cancel-button").click(function(e){GliffyApp.colorpickerController.hideColorpicker()});$(".colorpicker_new_color").tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD);$(".colorpicker_current_color").tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD);$(".colorpicker_nofill").tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD);$(".colorpicker_submit").tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD)}})},showPicker:function(){return this.each(function(){if($(this).data("colorpickerId")){show.apply(this)}})},hidePicker:function(){return this.each(function(){if($(this).data("colorpickerId")){$("#"+$(this).data("colorpickerId")).hide()}})},setColor:function(col,mode){__mode=mode;$("div.colorpicker_nofill").hide();if(mode=="fill"){$("div.colorpicker_nofill").show()}if(col===null){col=Number("0x000000")}if(typeof col=="string"){col=HexToHSB(col)}else{if(col.r!=undefined&&col.g!=undefined&&col.b!=undefined){col=RGBToHSB(col)}else{if(col.h!=undefined&&col.s!=undefined&&col.b!=undefined){col=fixHSB(col)}else{return this}}}return this.each(function(){if($(this).data("colorpickerId")){var cal=$("#"+$(this).data("colorpickerId"));cal.data("colorpicker").color=col;cal.data("colorpicker").origColor=col;fillRGBFields(col,cal.get(0));fillHSBFields(col,cal.get(0));fillHexFields(col,cal.get(0));setHue(col,cal.get(0));setSelector(col,cal.get(0));setCurrentColor(col,cal.get(0));setNewColor(col,cal.get(0))}})},position:function(coords){$(".colorpicker").css("left",coords.x);$(".colorpicker").css("top",coords.y)},setCallback:function(callback){__callback=callback},getWidth:function(){return $(".colorpicker").width()},getHeight:function(){return $(".colorpicker").height()}}}();$.fn.extend({ColorPicker:ColorPicker.init,ColorPickerHide:ColorPicker.hidePicker,ColorPickerShow:ColorPicker.showPicker,ColorPickerSetColor:ColorPicker.setColor,ColorPickerPosition:ColorPicker.position,ColorPickerSetCallback:ColorPicker.setCallback,ColorPickerGetWidth:ColorPicker.getWidth,ColorPickerGetHeight:ColorPicker.getHeight})})(jQuery);Date.CultureInfo={name:"en-US",englishName:"English (United States)",nativeName:"English (United States)",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],firstLetterDayNames:["S","M","T","W","T","F","S"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:0,twoDigitYearMax:2029,dateElementOrder:"mdy",formatPatterns:{shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"MMMM dd",yearMonth:"MMMM, yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^su(n(day)?)?/i,mon:/^mo(n(day)?)?/i,tue:/^tu(e(s(day)?)?)?/i,wed:/^we(d(nesday)?)?/i,thu:/^th(u(r(s(day)?)?)?)?/i,fri:/^fr(i(day)?)?/i,sat:/^sa(t(urday)?)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,add:/^(\+|after|from)/i,subtract:/^(\-|before|ago)/i,yesterday:/^yesterday/i,today:/^t(oday)?/i,tomorrow:/^tomorrow/i,now:/^n(ow)?/i,millisecond:/^ms|milli(second)?s?/i,second:/^sec(ond)?s?/i,minute:/^min(ute)?s?/i,hour:/^h(ou)?rs?/i,week:/^w(ee)?k/i,month:/^m(o(nth)?s?)?/i,day:/^d(ays?)?/i,year:/^y((ea)?rs?)?/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a|p)/i},abbreviatedTimeZoneStandard:{GMT:"-000",EST:"-0400",CST:"-0500",MST:"-0600",PST:"-0700"},abbreviatedTimeZoneDST:{GMT:"-000",EDT:"-0500",CDT:"-0600",MDT:"-0700",PDT:"-0800"}};Date.getMonthNumberFromName=function(name){var n=Date.CultureInfo.monthNames,m=Date.CultureInfo.abbreviatedMonthNames,s=name.toLowerCase();for(var i=0;i<n.length;i++){if(n[i].toLowerCase()==s||m[i].toLowerCase()==s){return i}}return -1};Date.getDayNumberFromName=function(name){var n=Date.CultureInfo.dayNames,m=Date.CultureInfo.abbreviatedDayNames,o=Date.CultureInfo.shortestDayNames,s=name.toLowerCase();for(var i=0;i<n.length;i++){if(n[i].toLowerCase()==s||m[i].toLowerCase()==s){return i}}return -1};Date.isLeapYear=function(year){return(((year%4===0)&&(year%100!==0))||(year%400===0))};Date.getDaysInMonth=function(year,month){return[31,(Date.isLeapYear(year)?29:28),31,30,31,30,31,31,30,31,30,31][month]};Date.getTimezoneOffset=function(s,dst){return(dst||false)?Date.CultureInfo.abbreviatedTimeZoneDST[s.toUpperCase()]:Date.CultureInfo.abbreviatedTimeZoneStandard[s.toUpperCase()]};Date.getTimezoneAbbreviation=function(offset,dst){var n=(dst||false)?Date.CultureInfo.abbreviatedTimeZoneDST:Date.CultureInfo.abbreviatedTimeZoneStandard,p;for(p in n){if(n[p]===offset){return p}}return null};Date.prototype.clone=function(){return new Date(this.getTime())};Date.prototype.compareTo=function(date){if(isNaN(this)){throw new Error(this)}if(date instanceof Date&&!isNaN(date)){return(this>date)?1:(this<date)?-1:0}else{throw new TypeError(date)}};Date.prototype.equals=function(date){return(this.compareTo(date)===0)};Date.prototype.between=function(start,end){var t=this.getTime();return t>=start.getTime()&&t<=end.getTime()};Date.prototype.addMilliseconds=function(value){this.setMilliseconds(this.getMilliseconds()+value);return this};Date.prototype.addSeconds=function(value){return this.addMilliseconds(value*1000)};Date.prototype.addMinutes=function(value){return this.addMilliseconds(value*60000)};Date.prototype.addHours=function(value){return this.addMilliseconds(value*3600000)};Date.prototype.addDays=function(value){return this.addMilliseconds(value*86400000)};Date.prototype.addWeeks=function(value){return this.addMilliseconds(value*604800000)};Date.prototype.addMonths=function(value){var n=this.getDate();this.setDate(1);this.setMonth(this.getMonth()+value);this.setDate(Math.min(n,this.getDaysInMonth()));return this};Date.prototype.addYears=function(value){return this.addMonths(value*12)};Date.prototype.add=function(config){if(typeof config=="number"){this._orient=config;return this}var x=config;if(x.millisecond||x.milliseconds){this.addMilliseconds(x.millisecond||x.milliseconds)}if(x.second||x.seconds){this.addSeconds(x.second||x.seconds)}if(x.minute||x.minutes){this.addMinutes(x.minute||x.minutes)}if(x.hour||x.hours){this.addHours(x.hour||x.hours)}if(x.month||x.months){this.addMonths(x.month||x.months)}if(x.year||x.years){this.addYears(x.year||x.years)}if(x.day||x.days){this.addDays(x.day||x.days)}return this};Date._validate=function(value,min,max,name){if(typeof value!="number"){throw new TypeError(value+" is not a Number.")}else{if(value<min||value>max){throw new RangeError(value+" is not a valid value for "+name+".")}}return true};Date.validateMillisecond=function(n){return Date._validate(n,0,999,"milliseconds")};Date.validateSecond=function(n){return Date._validate(n,0,59,"seconds")};Date.validateMinute=function(n){return Date._validate(n,0,59,"minutes")};Date.validateHour=function(n){return Date._validate(n,0,23,"hours")};Date.validateDay=function(n,year,month){return Date._validate(n,1,Date.getDaysInMonth(year,month),"days")};Date.validateMonth=function(n){return Date._validate(n,0,11,"months")};Date.validateYear=function(n){return Date._validate(n,1,9999,"seconds")};Date.prototype.set=function(config){var x=config;if(!x.millisecond&&x.millisecond!==0){x.millisecond=-1}if(!x.second&&x.second!==0){x.second=-1}if(!x.minute&&x.minute!==0){x.minute=-1}if(!x.hour&&x.hour!==0){x.hour=-1}if(!x.day&&x.day!==0){x.day=-1}if(!x.month&&x.month!==0){x.month=-1}if(!x.year&&x.year!==0){x.year=-1}if(x.millisecond!=-1&&Date.validateMillisecond(x.millisecond)){this.addMilliseconds(x.millisecond-this.getMilliseconds())}if(x.second!=-1&&Date.validateSecond(x.second)){this.addSeconds(x.second-this.getSeconds())}if(x.minute!=-1&&Date.validateMinute(x.minute)){this.addMinutes(x.minute-this.getMinutes())}if(x.hour!=-1&&Date.validateHour(x.hour)){this.addHours(x.hour-this.getHours())}if(x.month!==-1&&Date.validateMonth(x.month)){this.addMonths(x.month-this.getMonth())}if(x.year!=-1&&Date.validateYear(x.year)){this.addYears(x.year-this.getFullYear())}if(x.day!=-1&&Date.validateDay(x.day,this.getFullYear(),this.getMonth())){this.addDays(x.day-this.getDate())}if(x.timezone){this.setTimezone(x.timezone)}if(x.timezoneOffset){this.setTimezoneOffset(x.timezoneOffset)}return this};Date.prototype.clearTime=function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);return this};Date.prototype.isLeapYear=function(){var y=this.getFullYear();return(((y%4===0)&&(y%100!==0))||(y%400===0))};Date.prototype.isWeekday=function(){return !(this.is().sat()||this.is().sun())};Date.prototype.getDaysInMonth=function(){return Date.getDaysInMonth(this.getFullYear(),this.getMonth())};Date.prototype.moveToFirstDayOfMonth=function(){return this.set({day:1})};Date.prototype.moveToLastDayOfMonth=function(){return this.set({day:this.getDaysInMonth()})};Date.prototype.moveToDayOfWeek=function(day,orient){var diff=(day-this.getDay()+7*(orient||+1))%7;return this.addDays((diff===0)?diff+=7*(orient||+1):diff)};Date.prototype.moveToMonth=function(month,orient){var diff=(month-this.getMonth()+12*(orient||+1))%12;return this.addMonths((diff===0)?diff+=12*(orient||+1):diff)};Date.prototype.getDayOfYear=function(){return Math.floor((this-new Date(this.getFullYear(),0,1))/86400000)};Date.prototype.getWeekOfYear=function(firstDayOfWeek){var y=this.getFullYear(),m=this.getMonth(),d=this.getDate();var dow=firstDayOfWeek||Date.CultureInfo.firstDayOfWeek;var offset=7+1-new Date(y,0,1).getDay();if(offset==8){offset=1}var daynum=((Date.UTC(y,m,d,0,0,0)-Date.UTC(y,0,1,0,0,0))/86400000)+1;var w=Math.floor((daynum-offset+7)/7);if(w===dow){y--;var prevOffset=7+1-new Date(y,0,1).getDay();if(prevOffset==2||prevOffset==8){w=53}else{w=52}}return w};Date.prototype.isDST=function(){console.log("isDST");return this.toString().match(/(E|C|M|P)(S|D)T/)[2]=="D"};Date.prototype.getTimezone=function(){return Date.getTimezoneAbbreviation(this.getUTCOffset,this.isDST())};Date.prototype.setTimezoneOffset=function(s){var here=this.getTimezoneOffset(),there=Number(s)*-6/10;this.addMinutes(there-here);return this};Date.prototype.setTimezone=function(s){return this.setTimezoneOffset(Date.getTimezoneOffset(s))};Date.prototype.getUTCOffset=function(){var n=this.getTimezoneOffset()*-10/6,r;if(n<0){r=(n-10000).toString();return r[0]+r.substr(2)}else{r=(n+10000).toString();return"+"+r.substr(1)}};Date.prototype.getDayName=function(abbrev){return abbrev?Date.CultureInfo.abbreviatedDayNames[this.getDay()]:Date.CultureInfo.dayNames[this.getDay()]};Date.prototype.getMonthName=function(abbrev){return abbrev?Date.CultureInfo.abbreviatedMonthNames[this.getMonth()]:Date.CultureInfo.monthNames[this.getMonth()]};Date.prototype._toString=Date.prototype.toString;Date.prototype.toString=function(format){var self=this;var p=function p(s){return(s.toString().length==1)?"0"+s:s};return format?format.replace(/dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?/g,function(format){switch(format){case"hh":return p(self.getHours()<13?self.getHours():(self.getHours()-12));case"h":return self.getHours()<13?self.getHours():(self.getHours()-12);case"HH":return p(self.getHours());case"H":return self.getHours();case"mm":return p(self.getMinutes());case"m":return self.getMinutes();case"ss":return p(self.getSeconds());case"s":return self.getSeconds();case"yyyy":return self.getFullYear();case"yy":return self.getFullYear().toString().substring(2,4);case"dddd":return self.getDayName();case"ddd":return self.getDayName(true);case"dd":return p(self.getDate());case"d":return self.getDate().toString();case"MMMM":return self.getMonthName();case"MMM":return self.getMonthName(true);case"MM":return p((self.getMonth()+1));case"M":return self.getMonth()+1;case"t":return self.getHours()<12?Date.CultureInfo.amDesignator.substring(0,1):Date.CultureInfo.pmDesignator.substring(0,1);case"tt":return self.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator;case"zzz":case"zz":case"z":return""}}):this._toString()};Date.now=function(){return new Date()};Date.today=function(){return Date.now().clearTime()};Date.prototype._orient=+1;Date.prototype.next=function(){this._orient=+1;return this};Date.prototype.last=Date.prototype.prev=Date.prototype.previous=function(){this._orient=-1;return this};Date.prototype._is=false;Date.prototype.is=function(){this._is=true;return this};Number.prototype._dateElement="day";Number.prototype.fromNow=function(){var c={};c[this._dateElement]=this;return Date.now().add(c)};Number.prototype.ago=function(){var c={};c[this._dateElement]=this*-1;return Date.now().add(c)};(function(){var $D=Date.prototype,$N=Number.prototype;var dx=("sunday monday tuesday wednesday thursday friday saturday").split(/\s/),mx=("january february march april may june july august september october november december").split(/\s/),px=("Millisecond Second Minute Hour Day Week Month Year").split(/\s/),de;var df=function(n){return function(){if(this._is){this._is=false;return this.getDay()==n}return this.moveToDayOfWeek(n,this._orient)}};for(var i=0;i<dx.length;i++){$D[dx[i]]=$D[dx[i].substring(0,3)]=df(i)}var mf=function(n){return function(){if(this._is){this._is=false;return this.getMonth()===n}return this.moveToMonth(n,this._orient)}};for(var j=0;j<mx.length;j++){$D[mx[j]]=$D[mx[j].substring(0,3)]=mf(j)}var ef=function(j){return function(){if(j.substring(j.length-1)!="s"){j+="s"}return this["add"+j](this._orient)}};var nf=function(n){return function(){this._dateElement=n;return this}};for(var k=0;k<px.length;k++){de=px[k].toLowerCase();$D[de]=$D[de+"s"]=ef(px[k]);$N[de]=$N[de+"s"]=nf(de)}}());Date.prototype.toJSONString=function(){return this.toString("yyyy-MM-ddThh:mm:ssZ")};Date.prototype.toShortDateString=function(){return this.toString(Date.CultureInfo.formatPatterns.shortDatePattern)};Date.prototype.toLongDateString=function(){return this.toString(Date.CultureInfo.formatPatterns.longDatePattern)};Date.prototype.toShortTimeString=function(){return this.toString(Date.CultureInfo.formatPatterns.shortTimePattern)};Date.prototype.toLongTimeString=function(){return this.toString(Date.CultureInfo.formatPatterns.longTimePattern)};Date.prototype.getOrdinal=function(){switch(this.getDate()){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}};(function(){Date.Parsing={Exception:function(s){this.message="Parse error at '"+s.substring(0,10)+" ...'"}};var $P=Date.Parsing;var _=$P.Operators={rtoken:function(r){return function(s){var mx=s.match(r);if(mx){return([mx[0],s.substring(mx[0].length)])}else{throw new $P.Exception(s)}}},token:function(s){return function(s){return _.rtoken(new RegExp("^s*"+s+"s*"))(s)}},stoken:function(s){return _.rtoken(new RegExp("^"+s))},until:function(p){return function(s){var qx=[],rx=null;while(s.length){try{rx=p.call(this,s)}catch(e){qx.push(rx[0]);s=rx[1];continue}break}return[qx,s]}},many:function(p){return function(s){var rx=[],r=null;while(s.length){try{r=p.call(this,s)}catch(e){return[rx,s]}rx.push(r[0]);s=r[1]}return[rx,s]}},optional:function(p){return function(s){var r=null;try{r=p.call(this,s)}catch(e){return[null,s]}return[r[0],r[1]]}},not:function(p){return function(s){try{p.call(this,s)}catch(e){return[null,s]}throw new $P.Exception(s)}},ignore:function(p){return p?function(s){var r=null;r=p.call(this,s);return[null,r[1]]}:null},product:function(){var px=arguments[0],qx=Array.prototype.slice.call(arguments,1),rx=[];for(var i=0;i<px.length;i++){rx.push(_.each(px[i],qx))}return rx},cache:function(rule){var cache={},r=null;return function(s){try{r=cache[s]=(cache[s]||rule.call(this,s))}catch(e){r=cache[s]=e}if(r instanceof $P.Exception){throw r}else{return r}}},any:function(){var px=arguments;return function(s){var r=null;for(var i=0;i<px.length;i++){if(px[i]==null){continue}try{r=(px[i].call(this,s))}catch(e){r=null}if(r){return r}}throw new $P.Exception(s)}},each:function(){var px=arguments;return function(s){var rx=[],r=null;for(var i=0;i<px.length;i++){if(px[i]==null){continue}try{r=(px[i].call(this,s))}catch(e){throw new $P.Exception(s)}rx.push(r[0]);s=r[1]}return[rx,s]}},all:function(){var px=arguments,_=_;return _.each(_.optional(px))},sequence:function(px,d,c){d=d||_.rtoken(/^\s*/);c=c||null;if(px.length==1){return px[0]}return function(s){var r=null,q=null;var rx=[];for(var i=0;i<px.length;i++){try{r=px[i].call(this,s)}catch(e){break}rx.push(r[0]);try{q=d.call(this,r[1])}catch(ex){q=null;break}s=q[1]}if(!r){throw new $P.Exception(s)}if(q){throw new $P.Exception(q[1])}if(c){try{r=c.call(this,r[1])}catch(ey){throw new $P.Exception(r[1])}}return[rx,(r?r[1]:s)]}},between:function(d1,p,d2){d2=d2||d1;var _fn=_.each(_.ignore(d1),p,_.ignore(d2));return function(s){var rx=_fn.call(this,s);return[[rx[0][0],r[0][2]],rx[1]]}},list:function(p,d,c){d=d||_.rtoken(/^\s*/);c=c||null;return(p instanceof Array?_.each(_.product(p.slice(0,-1),_.ignore(d)),p.slice(-1),_.ignore(c)):_.each(_.many(_.each(p,_.ignore(d))),px,_.ignore(c)))},set:function(px,d,c){d=d||_.rtoken(/^\s*/);c=c||null;return function(s){var r=null,p=null,q=null,rx=null,best=[[],s],last=false;for(var i=0;i<px.length;i++){q=null;p=null;r=null;last=(px.length==1);try{r=px[i].call(this,s)}catch(e){continue}rx=[[r[0]],r[1]];if(r[1].length>0&&!last){try{q=d.call(this,r[1])}catch(ex){last=true}}else{last=true}if(!last&&q[1].length===0){last=true}if(!last){var qx=[];for(var j=0;j<px.length;j++){if(i!=j){qx.push(px[j])}}p=_.set(qx,d).call(this,q[1]);if(p[0].length>0){rx[0]=rx[0].concat(p[0]);rx[1]=p[1]}}if(rx[1].length<best[1].length){best=rx}if(best[1].length===0){break}}if(best[0].length===0){return best}if(c){try{q=c.call(this,best[1])}catch(ey){throw new $P.Exception(best[1])}best[1]=q[1]}return best}},forward:function(gr,fname){return function(s){return gr[fname].call(this,s)}},replace:function(rule,repl){return function(s){var r=rule.call(this,s);return[repl,r[1]]}},process:function(rule,fn){return function(s){var r=rule.call(this,s);return[fn.call(this,r[0]),r[1]]}},min:function(min,rule){return function(s){var rx=rule.call(this,s);if(rx[0].length<min){throw new $P.Exception(s)}return rx}}};var _generator=function(op){return function(){var args=null,rx=[];if(arguments.length>1){args=Array.prototype.slice.call(arguments)}else{if(arguments[0] instanceof Array){args=arguments[0]}}if(args){for(var i=0,px=args.shift();i<px.length;i++){args.unshift(px[i]);rx.push(op.apply(null,args));args.shift();return rx}}else{return op.apply(null,arguments)}}};var gx="optional not ignore cache".split(/\s/);for(var i=0;i<gx.length;i++){_[gx[i]]=_generator(_[gx[i]])}var _vector=function(op){return function(){if(arguments[0] instanceof Array){return op.apply(null,arguments[0])}else{return op.apply(null,arguments)}}};var vx="each any all".split(/\s/);for(var j=0;j<vx.length;j++){_[vx[j]]=_vector(_[vx[j]])}}());(function(){var flattenAndCompact=function(ax){var rx=[];for(var i=0;i<ax.length;i++){if(ax[i] instanceof Array){rx=rx.concat(flattenAndCompact(ax[i]))}else{if(ax[i]){rx.push(ax[i])}}}return rx};Date.Grammar={};Date.Translator={hour:function(s){return function(){this.hour=Number(s)}},minute:function(s){return function(){this.minute=Number(s)}},second:function(s){return function(){this.second=Number(s)}},meridian:function(s){return function(){this.meridian=s.slice(0,1).toLowerCase()}},timezone:function(s){return function(){var n=s.replace(/[^\d\+\-]/g,"");if(n.length){this.timezoneOffset=Number(n)}else{this.timezone=s.toLowerCase()}}},day:function(x){var s=x[0];return function(){this.day=Number(s.match(/\d+/)[0])}},month:function(s){return function(){this.month=((s.length==3)?Date.getMonthNumberFromName(s):(Number(s)-1))}},year:function(s){return function(){var n=Number(s);this.year=((s.length>2)?n:(n+(((n+2000)<Date.CultureInfo.twoDigitYearMax)?2000:1900)))}},rday:function(s){return function(){switch(s){case"yesterday":this.days=-1;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0;this.now=true;break}}},finishExact:function(x){x=(x instanceof Array)?x:[x];var now=new Date();this.year=now.getFullYear();this.month=now.getMonth();this.day=1;this.hour=0;this.minute=0;this.second=0;for(var i=0;i<x.length;i++){if(x[i]){x[i].call(this)}}this.hour=(this.meridian=="p"&&this.hour<13)?this.hour+12:this.hour;if(this.day>Date.getDaysInMonth(this.year,this.month)){throw new RangeError(this.day+" is not a valid value for days.")}var r=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);if(this.timezone){r.set({timezone:this.timezone})}else{if(this.timezoneOffset){r.set({timezoneOffset:this.timezoneOffset})}}return r},finish:function(x){x=(x instanceof Array)?flattenAndCompact(x):[x];if(x.length===0){return null}for(var i=0;i<x.length;i++){if(typeof x[i]=="function"){x[i].call(this)}}if(this.now){return new Date()}var today=Date.today();var method=null;var expression=!!(this.days!=null||this.orient||this.operator);if(expression){var gap,mod,orient;orient=((this.orient=="past"||this.operator=="subtract")?-1:1);if(this.weekday){this.unit="day";gap=(Date.getDayNumberFromName(this.weekday)-today.getDay());mod=7;this.days=gap?((gap+(orient*mod))%mod):(orient*mod)}if(this.month){this.unit="month";gap=(this.month-today.getMonth());mod=12;this.months=gap?((gap+(orient*mod))%mod):(orient*mod);this.month=null}if(!this.unit){this.unit="day"}if(this[this.unit+"s"]==null||this.operator!=null){if(!this.value){this.value=1}if(this.unit=="week"){this.unit="day";this.value=this.value*7}this[this.unit+"s"]=this.value*orient}return today.add(this)}else{if(this.meridian&&this.hour){this.hour=(this.hour<13&&this.meridian=="p")?this.hour+12:this.hour}if(this.weekday&&!this.day){this.day=(today.addDays((Date.getDayNumberFromName(this.weekday)-today.getDay()))).getDate()}if(this.month&&!this.day){this.day=1}return today.set(this)}}};var _=Date.Parsing.Operators,g=Date.Grammar,t=Date.Translator,_fn;g.datePartDelimiter=_.rtoken(/^([\s\-\.\,\/\x27]+)/);g.timePartDelimiter=_.stoken(":");g.whiteSpace=_.rtoken(/^\s*/);g.generalDelimiter=_.rtoken(/^(([\s\,]|at|on)+)/);var _C={};g.ctoken=function(keys){var fn=_C[keys];if(!fn){var c=Date.CultureInfo.regexPatterns;var kx=keys.split(/\s+/),px=[];for(var i=0;i<kx.length;i++){px.push(_.replace(_.rtoken(c[kx[i]]),kx[i]))}fn=_C[keys]=_.any.apply(null,px)}return fn};g.ctoken2=function(key){return _.rtoken(Date.CultureInfo.regexPatterns[key])};g.h=_.cache(_.process(_.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),t.hour));g.hh=_.cache(_.process(_.rtoken(/^(0[0-9]|1[0-2])/),t.hour));g.H=_.cache(_.process(_.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),t.hour));g.HH=_.cache(_.process(_.rtoken(/^([0-1][0-9]|2[0-3])/),t.hour));g.m=_.cache(_.process(_.rtoken(/^([0-5][0-9]|[0-9])/),t.minute));g.mm=_.cache(_.process(_.rtoken(/^[0-5][0-9]/),t.minute));g.s=_.cache(_.process(_.rtoken(/^([0-5][0-9]|[0-9])/),t.second));g.ss=_.cache(_.process(_.rtoken(/^[0-5][0-9]/),t.second));g.hms=_.cache(_.sequence([g.H,g.mm,g.ss],g.timePartDelimiter));g.t=_.cache(_.process(g.ctoken2("shortMeridian"),t.meridian));g.tt=_.cache(_.process(g.ctoken2("longMeridian"),t.meridian));g.z=_.cache(_.process(_.rtoken(/^(\+|\-)?\s*\d\d\d\d?/),t.timezone));g.zz=_.cache(_.process(_.rtoken(/^(\+|\-)\s*\d\d\d\d/),t.timezone));g.zzz=_.cache(_.process(g.ctoken2("timezone"),t.timezone));g.timeSuffix=_.each(_.ignore(g.whiteSpace),_.set([g.tt,g.zzz]));g.time=_.each(_.optional(_.ignore(_.stoken("T"))),g.hms,g.timeSuffix);g.d=_.cache(_.process(_.each(_.rtoken(/^([0-2]\d|3[0-1]|\d)/),_.optional(g.ctoken2("ordinalSuffix"))),t.day));g.dd=_.cache(_.process(_.each(_.rtoken(/^([0-2]\d|3[0-1])/),_.optional(g.ctoken2("ordinalSuffix"))),t.day));g.ddd=g.dddd=_.cache(_.process(g.ctoken("sun mon tue wed thu fri sat"),function(s){return function(){this.weekday=s}}));g.M=_.cache(_.process(_.rtoken(/^(1[0-2]|0\d|\d)/),t.month));g.MM=_.cache(_.process(_.rtoken(/^(1[0-2]|0\d)/),t.month));g.MMM=g.MMMM=_.cache(_.process(g.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),t.month));g.y=_.cache(_.process(_.rtoken(/^(\d\d?)/),t.year));g.yy=_.cache(_.process(_.rtoken(/^(\d\d)/),t.year));g.yyy=_.cache(_.process(_.rtoken(/^(\d\d?\d?\d?)/),t.year));g.yyyy=_.cache(_.process(_.rtoken(/^(\d\d\d\d)/),t.year));_fn=function(){return _.each(_.any.apply(null,arguments),_.not(g.ctoken2("timeContext")))};g.day=_fn(g.d,g.dd);g.month=_fn(g.M,g.MMM);g.year=_fn(g.yyyy,g.yy);g.orientation=_.process(g.ctoken("past future"),function(s){return function(){this.orient=s}});g.operator=_.process(g.ctoken("add subtract"),function(s){return function(){this.operator=s}});g.rday=_.process(g.ctoken("yesterday tomorrow today now"),t.rday);g.unit=_.process(g.ctoken("minute hour day week month year"),function(s){return function(){this.unit=s}});g.value=_.process(_.rtoken(/^\d\d?(st|nd|rd|th)?/),function(s){return function(){this.value=s.replace(/\D/g,"")}});g.expression=_.set([g.rday,g.operator,g.value,g.unit,g.orientation,g.ddd,g.MMM]);_fn=function(){return _.set(arguments,g.datePartDelimiter)};g.mdy=_fn(g.ddd,g.month,g.day,g.year);g.ymd=_fn(g.ddd,g.year,g.month,g.day);g.dmy=_fn(g.ddd,g.day,g.month,g.year);g.date=function(s){return((g[Date.CultureInfo.dateElementOrder]||g.mdy).call(this,s))};g.format=_.process(_.many(_.any(_.process(_.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(fmt){if(g[fmt]){return g[fmt]}else{throw Date.Parsing.Exception(fmt)}}),_.process(_.rtoken(/^[^dMyhHmstz]+/),function(s){return _.ignore(_.stoken(s))}))),function(rules){return _.process(_.each.apply(null,rules),t.finishExact)});var _F={};var _get=function(f){return _F[f]=(_F[f]||g.format(f)[0])};g.formats=function(fx){if(fx instanceof Array){var rx=[];for(var i=0;i<fx.length;i++){rx.push(_get(fx[i]))}return _.any.apply(null,rx)}else{return _get(fx)}};g._formats=g.formats(["yyyy-MM-ddTHH:mm:ss","ddd, MMM dd, yyyy H:mm:ss tt","ddd MMM d yyyy HH:mm:ss zzz","d"]);g._start=_.process(_.set([g.date,g.time,g.expression],g.generalDelimiter,g.whiteSpace),t.finish);g.start=function(s){try{var r=g._formats.call({},s);if(r[1].length===0){return r}}catch(e){}return g._start.call({},s)}}());Date._parse=Date.parse;Date.parse=function(s){var r=null;if(!s){return null}try{r=Date.Grammar.start.call({},s)}catch(e){return null}return((r[1].length===0)?r[0]:null)};Date.getParseFunction=function(fx){var fn=Date.Grammar.formats(fx);return function(s){var r=null;try{r=fn.call({},s)}catch(e){return null}return((r[1].length===0)?r[0]:null)}};Date.parseExact=function(s,fx){return Date.getParseFunction(fx)(s)};Date.CultureInfo={name:"en-US",englishName:"English (United States)",nativeName:"English (United States)",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],firstLetterDayNames:["S","M","T","W","T","F","S"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:0,twoDigitYearMax:2029,dateElementOrder:"mdy",formatPatterns:{shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"MMMM dd",yearMonth:"MMMM, yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^su(n(day)?)?/i,mon:/^mo(n(day)?)?/i,tue:/^tu(e(s(day)?)?)?/i,wed:/^we(d(nesday)?)?/i,thu:/^th(u(r(s(day)?)?)?)?/i,fri:/^fr(i(day)?)?/i,sat:/^sa(t(urday)?)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,add:/^(\+|after|from)/i,subtract:/^(\-|before|ago)/i,yesterday:/^yesterday/i,today:/^t(oday)?/i,tomorrow:/^tomorrow/i,now:/^n(ow)?/i,millisecond:/^ms|milli(second)?s?/i,second:/^sec(ond)?s?/i,minute:/^min(ute)?s?/i,hour:/^h(ou)?rs?/i,week:/^w(ee)?k/i,month:/^m(o(nth)?s?)?/i,day:/^d(ays?)?/i,year:/^y((ea)?rs?)?/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a|p)/i},abbreviatedTimeZoneStandard:{GMT:"-000",EST:"-0400",CST:"-0500",MST:"-0600",PST:"-0700"},abbreviatedTimeZoneDST:{GMT:"-000",EDT:"-0500",CDT:"-0600",MDT:"-0700",PDT:"-0800"}};Date.getMonthNumberFromName=function(name){var n=Date.CultureInfo.monthNames,m=Date.CultureInfo.abbreviatedMonthNames,s=name.toLowerCase();for(var i=0;i<n.length;i++){if(n[i].toLowerCase()==s||m[i].toLowerCase()==s){return i}}return -1};Date.getDayNumberFromName=function(name){var n=Date.CultureInfo.dayNames,m=Date.CultureInfo.abbreviatedDayNames,o=Date.CultureInfo.shortestDayNames,s=name.toLowerCase();for(var i=0;i<n.length;i++){if(n[i].toLowerCase()==s||m[i].toLowerCase()==s){return i}}return -1};Date.isLeapYear=function(year){return(((year%4===0)&&(year%100!==0))||(year%400===0))};Date.getDaysInMonth=function(year,month){return[31,(Date.isLeapYear(year)?29:28),31,30,31,30,31,31,30,31,30,31][month]};Date.getTimezoneOffset=function(s,dst){return(dst||false)?Date.CultureInfo.abbreviatedTimeZoneDST[s.toUpperCase()]:Date.CultureInfo.abbreviatedTimeZoneStandard[s.toUpperCase()]};Date.getTimezoneAbbreviation=function(offset,dst){var n=(dst||false)?Date.CultureInfo.abbreviatedTimeZoneDST:Date.CultureInfo.abbreviatedTimeZoneStandard,p;for(p in n){if(n[p]===offset){return p}}return null};Date.prototype.clone=function(){return new Date(this.getTime())};Date.prototype.compareTo=function(date){if(isNaN(this)){throw new Error(this)}if(date instanceof Date&&!isNaN(date)){return(this>date)?1:(this<date)?-1:0}else{throw new TypeError(date)}};Date.prototype.equals=function(date){return(this.compareTo(date)===0)};Date.prototype.between=function(start,end){var t=this.getTime();return t>=start.getTime()&&t<=end.getTime()};Date.prototype.addMilliseconds=function(value){this.setMilliseconds(this.getMilliseconds()+value);return this};Date.prototype.addSeconds=function(value){return this.addMilliseconds(value*1000)};Date.prototype.addMinutes=function(value){return this.addMilliseconds(value*60000)};Date.prototype.addHours=function(value){return this.addMilliseconds(value*3600000)};Date.prototype.addDays=function(value){return this.addMilliseconds(value*86400000)};Date.prototype.addWeeks=function(value){return this.addMilliseconds(value*604800000)};Date.prototype.addMonths=function(value){var n=this.getDate();this.setDate(1);this.setMonth(this.getMonth()+value);this.setDate(Math.min(n,this.getDaysInMonth()));return this};Date.prototype.addYears=function(value){return this.addMonths(value*12)};Date.prototype.add=function(config){if(typeof config=="number"){this._orient=config;return this}var x=config;if(x.millisecond||x.milliseconds){this.addMilliseconds(x.millisecond||x.milliseconds)}if(x.second||x.seconds){this.addSeconds(x.second||x.seconds)}if(x.minute||x.minutes){this.addMinutes(x.minute||x.minutes)}if(x.hour||x.hours){this.addHours(x.hour||x.hours)}if(x.month||x.months){this.addMonths(x.month||x.months)}if(x.year||x.years){this.addYears(x.year||x.years)}if(x.day||x.days){this.addDays(x.day||x.days)}return this};Date._validate=function(value,min,max,name){if(typeof value!="number"){throw new TypeError(value+" is not a Number.")}else{if(value<min||value>max){throw new RangeError(value+" is not a valid value for "+name+".")}}return true};Date.validateMillisecond=function(n){return Date._validate(n,0,999,"milliseconds")};Date.validateSecond=function(n){return Date._validate(n,0,59,"seconds")};Date.validateMinute=function(n){return Date._validate(n,0,59,"minutes")};Date.validateHour=function(n){return Date._validate(n,0,23,"hours")};Date.validateDay=function(n,year,month){return Date._validate(n,1,Date.getDaysInMonth(year,month),"days")};Date.validateMonth=function(n){return Date._validate(n,0,11,"months")};Date.validateYear=function(n){return Date._validate(n,1,9999,"seconds")};Date.prototype.set=function(config){var x=config;if(!x.millisecond&&x.millisecond!==0){x.millisecond=-1}if(!x.second&&x.second!==0){x.second=-1}if(!x.minute&&x.minute!==0){x.minute=-1}if(!x.hour&&x.hour!==0){x.hour=-1}if(!x.day&&x.day!==0){x.day=-1}if(!x.month&&x.month!==0){x.month=-1}if(!x.year&&x.year!==0){x.year=-1}if(x.millisecond!=-1&&Date.validateMillisecond(x.millisecond)){this.addMilliseconds(x.millisecond-this.getMilliseconds())}if(x.second!=-1&&Date.validateSecond(x.second)){this.addSeconds(x.second-this.getSeconds())}if(x.minute!=-1&&Date.validateMinute(x.minute)){this.addMinutes(x.minute-this.getMinutes())}if(x.hour!=-1&&Date.validateHour(x.hour)){this.addHours(x.hour-this.getHours())}if(x.month!==-1&&Date.validateMonth(x.month)){this.addMonths(x.month-this.getMonth())}if(x.year!=-1&&Date.validateYear(x.year)){this.addYears(x.year-this.getFullYear())}if(x.day!=-1&&Date.validateDay(x.day,this.getFullYear(),this.getMonth())){this.addDays(x.day-this.getDate())}if(x.timezone){this.setTimezone(x.timezone)}if(x.timezoneOffset){this.setTimezoneOffset(x.timezoneOffset)}return this};Date.prototype.clearTime=function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);return this};Date.prototype.isLeapYear=function(){var y=this.getFullYear();return(((y%4===0)&&(y%100!==0))||(y%400===0))};Date.prototype.isWeekday=function(){return !(this.is().sat()||this.is().sun())};Date.prototype.getDaysInMonth=function(){return Date.getDaysInMonth(this.getFullYear(),this.getMonth())};Date.prototype.moveToFirstDayOfMonth=function(){return this.set({day:1})};Date.prototype.moveToLastDayOfMonth=function(){return this.set({day:this.getDaysInMonth()})};Date.prototype.moveToDayOfWeek=function(day,orient){var diff=(day-this.getDay()+7*(orient||+1))%7;return this.addDays((diff===0)?diff+=7*(orient||+1):diff)};Date.prototype.moveToMonth=function(month,orient){var diff=(month-this.getMonth()+12*(orient||+1))%12;return this.addMonths((diff===0)?diff+=12*(orient||+1):diff)};Date.prototype.getDayOfYear=function(){return Math.floor((this-new Date(this.getFullYear(),0,1))/86400000)};Date.prototype.getWeekOfYear=function(firstDayOfWeek){var y=this.getFullYear(),m=this.getMonth(),d=this.getDate();var dow=firstDayOfWeek||Date.CultureInfo.firstDayOfWeek;var offset=7+1-new Date(y,0,1).getDay();if(offset==8){offset=1}var daynum=((Date.UTC(y,m,d,0,0,0)-Date.UTC(y,0,1,0,0,0))/86400000)+1;var w=Math.floor((daynum-offset+7)/7);if(w===dow){y--;var prevOffset=7+1-new Date(y,0,1).getDay();if(prevOffset==2||prevOffset==8){w=53}else{w=52}}return w};Date.prototype.isDST=function(){console.log("isDST");return this.toString().match(/(E|C|M|P)(S|D)T/)[2]=="D"};Date.prototype.getTimezone=function(){return Date.getTimezoneAbbreviation(this.getUTCOffset,this.isDST())};Date.prototype.setTimezoneOffset=function(s){var here=this.getTimezoneOffset(),there=Number(s)*-6/10;this.addMinutes(there-here);return this};Date.prototype.setTimezone=function(s){return this.setTimezoneOffset(Date.getTimezoneOffset(s))};Date.prototype.getUTCOffset=function(){var n=this.getTimezoneOffset()*-10/6,r;if(n<0){r=(n-10000).toString();return r[0]+r.substr(2)}else{r=(n+10000).toString();return"+"+r.substr(1)}};Date.prototype.getDayName=function(abbrev){return abbrev?Date.CultureInfo.abbreviatedDayNames[this.getDay()]:Date.CultureInfo.dayNames[this.getDay()]};Date.prototype.getMonthName=function(abbrev){return abbrev?Date.CultureInfo.abbreviatedMonthNames[this.getMonth()]:Date.CultureInfo.monthNames[this.getMonth()]};if(!Date.prototype._toString){Date.prototype._toString=Date.prototype.toString}Date.prototype.toString=function(format){var self=this;var p=function p(s){return(s.toString().length==1)?"0"+s:s};return format?format.replace(/dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?/g,function(format){switch(format){case"hh":return p(self.getHours()<13?self.getHours():(self.getHours()-12));case"h":return self.getHours()<13?self.getHours():(self.getHours()-12);case"HH":return p(self.getHours());case"H":return self.getHours();case"mm":return p(self.getMinutes());case"m":return self.getMinutes();case"ss":return p(self.getSeconds());case"s":return self.getSeconds();case"yyyy":return self.getFullYear();case"yy":return self.getFullYear().toString().substring(2,4);case"dddd":return self.getDayName();case"ddd":return self.getDayName(true);case"dd":return p(self.getDate());case"d":return self.getDate().toString();case"MMMM":return self.getMonthName();case"MMM":return self.getMonthName(true);case"MM":return p((self.getMonth()+1));case"M":return self.getMonth()+1;case"t":return self.getHours()<12?Date.CultureInfo.amDesignator.substring(0,1):Date.CultureInfo.pmDesignator.substring(0,1);case"tt":return self.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator;case"zzz":case"zz":case"z":return""}}):this._toString()};Date.now=function(){return new Date()};Date.today=function(){return Date.now().clearTime()};Date.prototype._orient=+1;Date.prototype.next=function(){this._orient=+1;return this};Date.prototype.last=Date.prototype.prev=Date.prototype.previous=function(){this._orient=-1;return this};Date.prototype._is=false;Date.prototype.is=function(){this._is=true;return this};Number.prototype._dateElement="day";Number.prototype.fromNow=function(){var c={};c[this._dateElement]=this;return Date.now().add(c)};Number.prototype.ago=function(){var c={};c[this._dateElement]=this*-1;return Date.now().add(c)};(function(){var $D=Date.prototype,$N=Number.prototype;var dx=("sunday monday tuesday wednesday thursday friday saturday").split(/\s/),mx=("january february march april may june july august september october november december").split(/\s/),px=("Millisecond Second Minute Hour Day Week Month Year").split(/\s/),de;var df=function(n){return function(){if(this._is){this._is=false;return this.getDay()==n}return this.moveToDayOfWeek(n,this._orient)}};for(var i=0;i<dx.length;i++){$D[dx[i]]=$D[dx[i].substring(0,3)]=df(i)}var mf=function(n){return function(){if(this._is){this._is=false;return this.getMonth()===n}return this.moveToMonth(n,this._orient)}};for(var j=0;j<mx.length;j++){$D[mx[j]]=$D[mx[j].substring(0,3)]=mf(j)}var ef=function(j){return function(){if(j.substring(j.length-1)!="s"){j+="s"}return this["add"+j](this._orient)}};var nf=function(n){return function(){this._dateElement=n;return this}};for(var k=0;k<px.length;k++){de=px[k].toLowerCase();$D[de]=$D[de+"s"]=ef(px[k]);$N[de]=$N[de+"s"]=nf(de)}}());Date.prototype.toJSONString=function(){return this.toString("yyyy-MM-ddThh:mm:ssZ")};Date.prototype.toShortDateString=function(){return this.toString(Date.CultureInfo.formatPatterns.shortDatePattern)};Date.prototype.toLongDateString=function(){return this.toString(Date.CultureInfo.formatPatterns.longDatePattern)};Date.prototype.toShortTimeString=function(){return this.toString(Date.CultureInfo.formatPatterns.shortTimePattern)};Date.prototype.toLongTimeString=function(){return this.toString(Date.CultureInfo.formatPatterns.longTimePattern)};Date.prototype.getOrdinal=function(){switch(this.getDate()){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}};(function(){Date.Parsing={Exception:function(s){this.message="Parse error at '"+s.substring(0,10)+" ...'"}};var $P=Date.Parsing;var _=$P.Operators={rtoken:function(r){return function(s){var mx=s.match(r);if(mx){return([mx[0],s.substring(mx[0].length)])}else{throw new $P.Exception(s)}}},token:function(s){return function(s){return _.rtoken(new RegExp("^s*"+s+"s*"))(s)}},stoken:function(s){return _.rtoken(new RegExp("^"+s))},until:function(p){return function(s){var qx=[],rx=null;while(s.length){try{rx=p.call(this,s)}catch(e){qx.push(rx[0]);s=rx[1];continue}break}return[qx,s]}},many:function(p){return function(s){var rx=[],r=null;while(s.length){try{r=p.call(this,s)}catch(e){return[rx,s]}rx.push(r[0]);s=r[1]}return[rx,s]}},optional:function(p){return function(s){var r=null;try{r=p.call(this,s)}catch(e){return[null,s]}return[r[0],r[1]]}},not:function(p){return function(s){try{p.call(this,s)}catch(e){return[null,s]}throw new $P.Exception(s)}},ignore:function(p){return p?function(s){var r=null;r=p.call(this,s);return[null,r[1]]}:null},product:function(){var px=arguments[0],qx=Array.prototype.slice.call(arguments,1),rx=[];for(var i=0;i<px.length;i++){rx.push(_.each(px[i],qx))}return rx},cache:function(rule){var cache={},r=null;return function(s){try{r=cache[s]=(cache[s]||rule.call(this,s))}catch(e){r=cache[s]=e}if(r instanceof $P.Exception){throw r}else{return r}}},any:function(){var px=arguments;return function(s){var r=null;for(var i=0;i<px.length;i++){if(px[i]==null){continue}try{r=(px[i].call(this,s))}catch(e){r=null}if(r){return r}}throw new $P.Exception(s)}},each:function(){var px=arguments;return function(s){var rx=[],r=null;for(var i=0;i<px.length;i++){if(px[i]==null){continue}try{r=(px[i].call(this,s))}catch(e){throw new $P.Exception(s)}rx.push(r[0]);s=r[1]}return[rx,s]}},all:function(){var px=arguments,_=_;return _.each(_.optional(px))},sequence:function(px,d,c){d=d||_.rtoken(/^\s*/);c=c||null;if(px.length==1){return px[0]}return function(s){var r=null,q=null;var rx=[];for(var i=0;i<px.length;i++){try{r=px[i].call(this,s)}catch(e){break}rx.push(r[0]);try{q=d.call(this,r[1])}catch(ex){q=null;break}s=q[1]}if(!r){throw new $P.Exception(s)}if(q){throw new $P.Exception(q[1])}if(c){try{r=c.call(this,r[1])}catch(ey){throw new $P.Exception(r[1])}}return[rx,(r?r[1]:s)]}},between:function(d1,p,d2){d2=d2||d1;var _fn=_.each(_.ignore(d1),p,_.ignore(d2));return function(s){var rx=_fn.call(this,s);return[[rx[0][0],r[0][2]],rx[1]]}},list:function(p,d,c){d=d||_.rtoken(/^\s*/);c=c||null;return(p instanceof Array?_.each(_.product(p.slice(0,-1),_.ignore(d)),p.slice(-1),_.ignore(c)):_.each(_.many(_.each(p,_.ignore(d))),px,_.ignore(c)))},set:function(px,d,c){d=d||_.rtoken(/^\s*/);c=c||null;return function(s){var r=null,p=null,q=null,rx=null,best=[[],s],last=false;for(var i=0;i<px.length;i++){q=null;p=null;r=null;last=(px.length==1);try{r=px[i].call(this,s)}catch(e){continue}rx=[[r[0]],r[1]];if(r[1].length>0&&!last){try{q=d.call(this,r[1])}catch(ex){last=true}}else{last=true}if(!last&&q[1].length===0){last=true}if(!last){var qx=[];for(var j=0;j<px.length;j++){if(i!=j){qx.push(px[j])}}p=_.set(qx,d).call(this,q[1]);if(p[0].length>0){rx[0]=rx[0].concat(p[0]);rx[1]=p[1]}}if(rx[1].length<best[1].length){best=rx}if(best[1].length===0){break}}if(best[0].length===0){return best}if(c){try{q=c.call(this,best[1])}catch(ey){throw new $P.Exception(best[1])}best[1]=q[1]}return best}},forward:function(gr,fname){return function(s){return gr[fname].call(this,s)}},replace:function(rule,repl){return function(s){var r=rule.call(this,s);return[repl,r[1]]}},process:function(rule,fn){return function(s){var r=rule.call(this,s);return[fn.call(this,r[0]),r[1]]}},min:function(min,rule){return function(s){var rx=rule.call(this,s);if(rx[0].length<min){throw new $P.Exception(s)}return rx}}};var _generator=function(op){return function(){var args=null,rx=[];if(arguments.length>1){args=Array.prototype.slice.call(arguments)}else{if(arguments[0] instanceof Array){args=arguments[0]}}if(args){for(var i=0,px=args.shift();i<px.length;i++){args.unshift(px[i]);rx.push(op.apply(null,args));args.shift();return rx}}else{return op.apply(null,arguments)}}};var gx="optional not ignore cache".split(/\s/);for(var i=0;i<gx.length;i++){_[gx[i]]=_generator(_[gx[i]])}var _vector=function(op){return function(){if(arguments[0] instanceof Array){return op.apply(null,arguments[0])}else{return op.apply(null,arguments)}}};var vx="each any all".split(/\s/);for(var j=0;j<vx.length;j++){_[vx[j]]=_vector(_[vx[j]])}}());(function(){var flattenAndCompact=function(ax){var rx=[];for(var i=0;i<ax.length;i++){if(ax[i] instanceof Array){rx=rx.concat(flattenAndCompact(ax[i]))}else{if(ax[i]){rx.push(ax[i])}}}return rx};Date.Grammar={};Date.Translator={hour:function(s){return function(){this.hour=Number(s)}},minute:function(s){return function(){this.minute=Number(s)}},second:function(s){return function(){this.second=Number(s)}},meridian:function(s){return function(){this.meridian=s.slice(0,1).toLowerCase()}},timezone:function(s){return function(){var n=s.replace(/[^\d\+\-]/g,"");if(n.length){this.timezoneOffset=Number(n)}else{this.timezone=s.toLowerCase()}}},day:function(x){var s=x[0];return function(){this.day=Number(s.match(/\d+/)[0])}},month:function(s){return function(){this.month=((s.length==3)?Date.getMonthNumberFromName(s):(Number(s)-1))}},year:function(s){return function(){var n=Number(s);this.year=((s.length>2)?n:(n+(((n+2000)<Date.CultureInfo.twoDigitYearMax)?2000:1900)))}},rday:function(s){return function(){switch(s){case"yesterday":this.days=-1;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0;this.now=true;break}}},finishExact:function(x){x=(x instanceof Array)?x:[x];var now=new Date();this.year=now.getFullYear();this.month=now.getMonth();this.day=1;this.hour=0;this.minute=0;this.second=0;for(var i=0;i<x.length;i++){if(x[i]){x[i].call(this)}}this.hour=(this.meridian=="p"&&this.hour<13)?this.hour+12:this.hour;if(this.day>Date.getDaysInMonth(this.year,this.month)){throw new RangeError(this.day+" is not a valid value for days.")}var r=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);if(this.timezone){r.set({timezone:this.timezone})}else{if(this.timezoneOffset){r.set({timezoneOffset:this.timezoneOffset})}}return r},finish:function(x){x=(x instanceof Array)?flattenAndCompact(x):[x];if(x.length===0){return null}for(var i=0;i<x.length;i++){if(typeof x[i]=="function"){x[i].call(this)}}if(this.now){return new Date()}var today=Date.today();var method=null;var expression=!!(this.days!=null||this.orient||this.operator);if(expression){var gap,mod,orient;orient=((this.orient=="past"||this.operator=="subtract")?-1:1);if(this.weekday){this.unit="day";gap=(Date.getDayNumberFromName(this.weekday)-today.getDay());mod=7;this.days=gap?((gap+(orient*mod))%mod):(orient*mod)}if(this.month){this.unit="month";gap=(this.month-today.getMonth());mod=12;this.months=gap?((gap+(orient*mod))%mod):(orient*mod);this.month=null}if(!this.unit){this.unit="day"}if(this[this.unit+"s"]==null||this.operator!=null){if(!this.value){this.value=1}if(this.unit=="week"){this.unit="day";this.value=this.value*7}this[this.unit+"s"]=this.value*orient}return today.add(this)}else{if(this.meridian&&this.hour){this.hour=(this.hour<13&&this.meridian=="p")?this.hour+12:this.hour}if(this.weekday&&!this.day){this.day=(today.addDays((Date.getDayNumberFromName(this.weekday)-today.getDay()))).getDate()}if(this.month&&!this.day){this.day=1}return today.set(this)}}};var _=Date.Parsing.Operators,g=Date.Grammar,t=Date.Translator,_fn;g.datePartDelimiter=_.rtoken(/^([\s\-\.\,\/\x27]+)/);g.timePartDelimiter=_.stoken(":");g.whiteSpace=_.rtoken(/^\s*/);g.generalDelimiter=_.rtoken(/^(([\s\,]|at|on)+)/);var _C={};g.ctoken=function(keys){var fn=_C[keys];if(!fn){var c=Date.CultureInfo.regexPatterns;var kx=keys.split(/\s+/),px=[];for(var i=0;i<kx.length;i++){px.push(_.replace(_.rtoken(c[kx[i]]),kx[i]))}fn=_C[keys]=_.any.apply(null,px)}return fn};g.ctoken2=function(key){return _.rtoken(Date.CultureInfo.regexPatterns[key])};g.h=_.cache(_.process(_.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),t.hour));g.hh=_.cache(_.process(_.rtoken(/^(0[0-9]|1[0-2])/),t.hour));g.H=_.cache(_.process(_.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),t.hour));g.HH=_.cache(_.process(_.rtoken(/^([0-1][0-9]|2[0-3])/),t.hour));g.m=_.cache(_.process(_.rtoken(/^([0-5][0-9]|[0-9])/),t.minute));g.mm=_.cache(_.process(_.rtoken(/^[0-5][0-9]/),t.minute));g.s=_.cache(_.process(_.rtoken(/^([0-5][0-9]|[0-9])/),t.second));g.ss=_.cache(_.process(_.rtoken(/^[0-5][0-9]/),t.second));g.hms=_.cache(_.sequence([g.H,g.mm,g.ss],g.timePartDelimiter));g.t=_.cache(_.process(g.ctoken2("shortMeridian"),t.meridian));g.tt=_.cache(_.process(g.ctoken2("longMeridian"),t.meridian));g.z=_.cache(_.process(_.rtoken(/^(\+|\-)?\s*\d\d\d\d?/),t.timezone));g.zz=_.cache(_.process(_.rtoken(/^(\+|\-)\s*\d\d\d\d/),t.timezone));g.zzz=_.cache(_.process(g.ctoken2("timezone"),t.timezone));g.timeSuffix=_.each(_.ignore(g.whiteSpace),_.set([g.tt,g.zzz]));g.time=_.each(_.optional(_.ignore(_.stoken("T"))),g.hms,g.timeSuffix);g.d=_.cache(_.process(_.each(_.rtoken(/^([0-2]\d|3[0-1]|\d)/),_.optional(g.ctoken2("ordinalSuffix"))),t.day));g.dd=_.cache(_.process(_.each(_.rtoken(/^([0-2]\d|3[0-1])/),_.optional(g.ctoken2("ordinalSuffix"))),t.day));g.ddd=g.dddd=_.cache(_.process(g.ctoken("sun mon tue wed thu fri sat"),function(s){return function(){this.weekday=s}}));g.M=_.cache(_.process(_.rtoken(/^(1[0-2]|0\d|\d)/),t.month));g.MM=_.cache(_.process(_.rtoken(/^(1[0-2]|0\d)/),t.month));g.MMM=g.MMMM=_.cache(_.process(g.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),t.month));g.y=_.cache(_.process(_.rtoken(/^(\d\d?)/),t.year));g.yy=_.cache(_.process(_.rtoken(/^(\d\d)/),t.year));g.yyy=_.cache(_.process(_.rtoken(/^(\d\d?\d?\d?)/),t.year));g.yyyy=_.cache(_.process(_.rtoken(/^(\d\d\d\d)/),t.year));_fn=function(){return _.each(_.any.apply(null,arguments),_.not(g.ctoken2("timeContext")))};g.day=_fn(g.d,g.dd);g.month=_fn(g.M,g.MMM);g.year=_fn(g.yyyy,g.yy);g.orientation=_.process(g.ctoken("past future"),function(s){return function(){this.orient=s}});g.operator=_.process(g.ctoken("add subtract"),function(s){return function(){this.operator=s}});g.rday=_.process(g.ctoken("yesterday tomorrow today now"),t.rday);g.unit=_.process(g.ctoken("minute hour day week month year"),function(s){return function(){this.unit=s}});g.value=_.process(_.rtoken(/^\d\d?(st|nd|rd|th)?/),function(s){return function(){this.value=s.replace(/\D/g,"")}});g.expression=_.set([g.rday,g.operator,g.value,g.unit,g.orientation,g.ddd,g.MMM]);_fn=function(){return _.set(arguments,g.datePartDelimiter)};g.mdy=_fn(g.ddd,g.month,g.day,g.year);g.ymd=_fn(g.ddd,g.year,g.month,g.day);g.dmy=_fn(g.ddd,g.day,g.month,g.year);g.date=function(s){return((g[Date.CultureInfo.dateElementOrder]||g.mdy).call(this,s))};g.format=_.process(_.many(_.any(_.process(_.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(fmt){if(g[fmt]){return g[fmt]}else{throw Date.Parsing.Exception(fmt)}}),_.process(_.rtoken(/^[^dMyhHmstz]+/),function(s){return _.ignore(_.stoken(s))}))),function(rules){return _.process(_.each.apply(null,rules),t.finishExact)});var _F={};var _get=function(f){return _F[f]=(_F[f]||g.format(f)[0])};g.formats=function(fx){if(fx instanceof Array){var rx=[];for(var i=0;i<fx.length;i++){rx.push(_get(fx[i]))}return _.any.apply(null,rx)}else{return _get(fx)}};g._formats=g.formats(["yyyy-MM-ddTHH:mm:ss","ddd, MMM dd, yyyy H:mm:ss tt","ddd MMM d yyyy HH:mm:ss zzz","d"]);g._start=_.process(_.set([g.date,g.time,g.expression],g.generalDelimiter,g.whiteSpace),t.finish);g.start=function(s){try{var r=g._formats.call({},s);if(r[1].length===0){return r}}catch(e){}return g._start.call({},s)}}());Date._parse=Date.parse;Date.parse=function(s){var r=null;if(!s){return null}try{r=Date.Grammar.start.call({},s)}catch(e){return null}return((r[1].length===0)?r[0]:null)};Date.getParseFunction=function(fx){var fn=Date.Grammar.formats(fx);return function(s){var r=null;try{r=fn.call({},s)}catch(e){return null}return((r[1].length===0)?r[0]:null)}};Date.parseExact=function(s,fx){return Date.getParseFunction(fx)(s)};
/*!
 * jQuery Cookie Plugin v1.2
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2011, Klaus Hartl
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/GPL-2.0
 */
(function($,document,undefined){var pluses=/\+/g;function raw(s){return s}function decoded(s){return decodeURIComponent(s.replace(pluses," "))}var config=$.cookie=function(key,value,options){if(value!==undefined){options=$.extend({},config.defaults,options);if(value===null){options.expires=-1}if(typeof options.expires==="number"){var days=options.expires,t=options.expires=new Date();t.setDate(t.getDate()+days)}value=config.json?JSON.stringify(value):String(value);return(document.cookie=[encodeURIComponent(key),"=",config.raw?value:encodeURIComponent(value),options.expires?"; expires="+options.expires.toUTCString():"",options.path?"; path="+options.path:"",options.domain?"; domain="+options.domain:"",options.secure?"; secure":""].join(""))}var decode=config.raw?raw:decoded;var cookies=document.cookie.split("; ");for(var i=0,parts;(parts=cookies[i]&&cookies[i].split("="));i++){if(decode(parts.shift())===key){var cookie=decode(parts.join("="));return config.json?JSON.parse(cookie):cookie}}return null};config.defaults={};$.removeCookie=function(key,options){if($.cookie(key)!==null){$.cookie(key,null,options);return true}return false}})(jQuery,document);!function(window,document,undefined){var prefixes=["webkit","Moz","ms","O"],animations={},useCssAnimations;function createEl(tag,prop){var el=document.createElement(tag||"div"),n;for(n in prop){el[n]=prop[n]}return el}function ins(parent){for(var i=1,n=arguments.length;i<n;i++){parent.appendChild(arguments[i])}return parent}var sheet=function(){var el=createEl("style",{type:"text/css"});ins(document.getElementsByTagName("head")[0],el);return el.sheet||el.styleSheet}();function addAnimation(alpha,trail,i,lines){var name=["opacity",trail,~~(alpha*100),i,lines].join("-"),start=0.01+i/lines*100,z=Math.max(1-(1-alpha)/trail*(100-start),alpha),prefix=useCssAnimations.substring(0,useCssAnimations.indexOf("Animation")).toLowerCase(),pre=prefix&&"-"+prefix+"-"||"";if(!animations[name]){sheet.insertRule("@"+pre+"keyframes "+name+"{0%{opacity:"+z+"}"+start+"%{opacity:"+alpha+"}"+(start+0.01)+"%{opacity:1}"+(start+trail)%100+"%{opacity:"+alpha+"}100%{opacity:"+z+"}}",sheet.cssRules.length);animations[name]=1}return name}function vendor(el,prop){var s=el.style,pp,i;if(s[prop]!==undefined){return prop}prop=prop.charAt(0).toUpperCase()+prop.slice(1);for(i=0;i<prefixes.length;i++){pp=prefixes[i]+prop;if(s[pp]!==undefined){return pp}}}function css(el,prop){for(var n in prop){el.style[vendor(el,n)||n]=prop[n]}return el}function merge(obj){for(var i=1;i<arguments.length;i++){var def=arguments[i];for(var n in def){if(obj[n]===undefined){obj[n]=def[n]}}}return obj}function pos(el){var o={x:el.offsetLeft,y:el.offsetTop};while((el=el.offsetParent)){o.x+=el.offsetLeft,o.y+=el.offsetTop}return o}var defaults={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",speed:1,trail:100,opacity:1/4,fps:20,zIndex:2000000000,className:"spinner",top:"auto",left:"auto",position:"relative"};function Spinner(o){if(!this.spin){return new Spinner(o)}this.opts=merge(o||{},Spinner.defaults,defaults)}Spinner.defaults={};merge(Spinner.prototype,{spin:function(target){this.stop();var self=this,o=self.opts,el=self.el=css(createEl(0,{className:o.className}),{position:o.position,width:0,zIndex:o.zIndex}),mid=o.radius+o.length+o.width,ep,tp;if(target){target.insertBefore(el,target.firstChild||null);tp=pos(target);ep=pos(el);css(el,{left:(o.left=="auto"?tp.x-ep.x+(target.offsetWidth>>1):parseInt(o.left,10)+mid)+"px",top:(o.top=="auto"?tp.y-ep.y+(target.offsetHeight>>1):parseInt(o.top,10)+mid)+"px"})}el.setAttribute("aria-role","progressbar");self.lines(el,self.opts);if(!useCssAnimations){var i=0,fps=o.fps,f=fps/o.speed,ostep=(1-o.opacity)/(f*o.trail/100),astep=f/o.lines;(function anim(){i++;for(var s=o.lines;s;s--){var alpha=Math.max(1-(i+s*astep)%f*ostep,o.opacity);self.opacity(el,o.lines-s,alpha,o)}self.timeout=self.el&&setTimeout(anim,~~(1000/fps))})()}return self},stop:function(){var el=this.el;if(el){clearTimeout(this.timeout);if(el.parentNode){el.parentNode.removeChild(el)}this.el=undefined}return this},lines:function(el,o){var i=0,seg;function fill(color,shadow){return css(createEl(),{position:"absolute",width:(o.length+o.width)+"px",height:o.width+"px",background:color,boxShadow:shadow,transformOrigin:"left",transform:"rotate("+~~(360/o.lines*i+o.rotate)+"deg) translate("+o.radius+"px,0)",borderRadius:(o.corners*o.width>>1)+"px"})}for(;i<o.lines;i++){seg=css(createEl(),{position:"absolute",top:1+~(o.width/2)+"px",transform:o.hwaccel?"translate3d(0,0,0)":"",opacity:o.opacity,animation:useCssAnimations&&addAnimation(o.opacity,o.trail,i,o.lines)+" "+1/o.speed+"s linear infinite"});if(o.shadow){ins(seg,css(fill("#000","0 0 4px #000"),{top:2+"px"}))}ins(el,ins(seg,fill(o.color,"0 0 1px rgba(0,0,0,.1)")))}return el},opacity:function(el,i,val){if(i<el.childNodes.length){el.childNodes[i].style.opacity=val}}});(function(){function vml(tag,attr){return createEl("<"+tag+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',attr)}var s=css(createEl("group"),{behavior:"url(#default#VML)"});if(!vendor(s,"transform")&&s.adj){sheet.addRule(".spin-vml","behavior:url(#default#VML)");Spinner.prototype.lines=function(el,o){var r=o.length+o.width,s=2*r;function grp(){return css(vml("group",{coordsize:s+" "+s,coordorigin:-r+" "+-r}),{width:s,height:s})}var margin=-(o.width+o.length)*2+"px",g=css(grp(),{position:"absolute",top:margin,left:margin}),i;function seg(i,dx,filter){ins(g,ins(css(grp(),{rotation:360/o.lines*i+"deg",left:~~dx}),ins(css(vml("roundrect",{arcsize:o.corners}),{width:r,height:o.width,left:o.radius,top:-o.width>>1,filter:filter}),vml("fill",{color:o.color,opacity:o.opacity}),vml("stroke",{opacity:0}))))}if(o.shadow){for(i=1;i<=o.lines;i++){seg(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)")}}for(i=1;i<=o.lines;i++){seg(i)}return ins(el,g)};Spinner.prototype.opacity=function(el,i,val,o){var c=el.firstChild;o=o.shadow&&o.lines||0;if(c&&i+o<c.childNodes.length){c=c.childNodes[i+o];c=c&&c.firstChild;c=c&&c.firstChild;if(c){c.opacity=val}}}}else{useCssAnimations=vendor(s,"animation")}})();if(typeof define=="function"&&define.amd){define(function(){return Spinner})}else{window.Spinner=Spinner}}(window,document);(function(){
/*!! Simple JavaScript Inheritance
     * By John Resig http://ejohn.org/
     * MIT Licensed.
     * http://ejohn.org/blog/simple-javascript-inheritance
     *
     */
var initializing=false,fnTest=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;var Class=function(){};Class.extend=function(prop){var _super=this.prototype;initializing=true;var prototype=new this();initializing=false;for(var name in prop){prototype[name]=typeof prop[name]=="function"&&typeof _super[name]=="function"&&fnTest.test(prop[name])?(function(name,fn){return function(){var tmp=this._super;this._super=_super[name];var ret=fn.apply(this,arguments);this._super=tmp;return ret}})(name,prop[name]):prop[name]}function Class(){if(!(this instanceof Class)){return new Class(arguments)}if(!initializing&&this.init){this.init.apply(this,arguments)}}Class.prototype=prototype;Class.prototype.constructor=Class;Class.extend=arguments.callee;return Class};var AnalyticsInterface=Class.extend({init:function(){},setAccount:function(){},trackEvent:function(){},trackPageView:function(){},logEvents:function(){},setLabel:function(){},runFuncIfAnalyticsExists:function(){}});var GoogleAnalytics=AnalyticsInterface.extend({_loaded:false,_trackerID:"",_logEvents:false,_logger:null,_activeLabel:null,_optPageName:null,_customVariableIndices:null,_canLog:function(){return this._logger!==null&&this._logEvents===true},init:function(trackerID,optPageName,onScriptLoadedFunc,debug){var s,ga=document.createElement("script"),self=this;this._optPageName=optPageName;if(debug===undefined){debug=false}ga.type="text/javascript";ga.async=true;ga.src=("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/"+(debug?"u/ga_debug.js":"ga.js");s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(ga,s);this._trackerID=trackerID;ga.onreadystatechange=function(){if(this.readyState==="complete"){self._scriptLoaded();if(onScriptLoadedFunc){onScriptLoadedFunc()}}};ga.onload=function(){self._scriptLoaded();if(onScriptLoadedFunc){onScriptLoadedFunc()}};self._customVariableIndices={product:1,license:2,numUsers:3}},loaded:function(){return this._loaded},setAccount:function(account){this._push(["_setAccount",account])},setLabel:function(label){this._activeLabel=label},setCustomVariables:function(product,license,numUsers){var PAGE_SCOPE=3;if(product){this._push(["_setCustomVar",this._customVariableIndices.product,"product",product,PAGE_SCOPE])}this._push(["_setCustomVar",this._customVariableIndices.license,"license",license,PAGE_SCOPE]);this._push(["_setCustomVar",this._customVariableIndices.numUsers,"numUsers",numUsers,PAGE_SCOPE])},trackEvent:function(category,action,opt_label,opt_value,opt_non_interaction){opt_label=opt_label===undefined?null:opt_label;opt_value=opt_value===undefined?null:opt_value;opt_non_interaction===undefined?null:opt_non_interaction;if(opt_label===null&&this._activeLabel!==null){opt_label=this._activeLabel}this._push(["_trackEvent",category,action,opt_label,opt_value,opt_non_interaction]);if(category==="lzxclient"){this._push(["_trackPageview","/lzxEvent/"+action])}},trackPageView:function(){if(this._optPageName){this._push(["_trackPageview",this._optPageName])}else{this._push(["_trackPageview"])}},logEvents:function(bool,logger){this._logEvents=bool;this._logger=logger},_scriptLoaded:function(){this._loaded=true;this._push(["_setDomainName","none"]);this.setAccount(this._trackerID);this.trackPageView()},_push:function(eventArray){if(typeof _gaq!="undefined"){_gaq.push(eventArray);if(this._canLog()){this._logger.log("ANALYTICS: "+eventArray.join(", "))}}},runFuncIfAnalyticsExists:function(func){if(func){func()}}});var _AnalyticsListener=Class.extend({_analytics:null,_queuedEvents:null,init:function(){var self=this;self._queuedEvents=[];jq=window.jQuery||window["$"];jq(window).bind("init.gliffyAnalytics",function(event,o){var options=jq.extend({},{accountType:"none",accountID:"UA-248648-8",debug:false,optPageName:null},o);if(!self._analytics){switch(options.accountType){case"google":self._analytics=new GoogleAnalytics(options.accountID,options.optPageName,function(){var typeAndOption;while(typeAndOption=self._queuedEvents.shift()){$(window).trigger(typeAndOption[0]+".gliffyAnalytics",typeAndOption[1])}},options.debug);break}}});jq(window).bind("trackEvent.gliffyAnalytics",function(event,o){var options=jq.extend({},{category:"",action:"",label:null,value:null,non_interaction:null},o);if(self._analytics&&self._analytics.loaded()){self._analytics.trackEvent(options.category,options.action,options.label,options.value,options.non_interaction)}else{self._queuedEvents.push(["trackEvent",o])}});jq(window).bind("setLabel.gliffyAnalytics",function(event,o){var options=jq.extend({},{label:null},o);if(self._analytics&&self._analytics.loaded()){self._analytics.setLabel(options.label)}else{self._queuedEvents.push(["setLabel",o])}});jq(window).bind("logEvents.gliffyAnalytics",function(event,o){var options=jq.extend({},{logEvents:false,logger:null},o);if(self._analytics&&self._analytics.loaded()){self._analytics.logEvents(options.logEvents,options.logger)}else{self._queuedEvents.push(["logEvents",o])}});jq(window).bind("setCustomVariables.gliffyAnalytics",function(event,o){var options=jq.extend({},{product:null,license:"none",numUsers:0},o);if(self._analytics&&self._analytics.loaded()){self._analytics.setCustomVariables(options.product,options.license,options.numUsers)}else{self._queuedEvents.push(["setCustomVariables",o])}});jq(window).bind("runFuncIfAnalyticsExists.gliffyAnalytics",function(event,o){var options=jq.extend({},{func:null},o);if(self._analytics){self._analytics.runFuncIfAnalyticsExists(options.func)}})}});var AnalyticsListener=new _AnalyticsListener()}());(function(){var MAX_STACK_LENGTH=1000;_gliffy.logger=_gliffy.Class.extend({stack:null,init:function(){this.stack=[]},log:function(message){this.stack.push({type:"log",message:"[LOG]   "+message});this.__check_length()},error:function(message){this.stack.push({type:"error",message:"[ERROR] "+message});this.__check_length()},warn:function(message){this.stack.push({type:"warn",message:"[WARN] "+message});this.__check_length()},__check_length:function(){if(_gliffy.Debug.LOG_TO_CONSOLE){console.log(this.stack[this.stack.length-1].message)}while(this.stack.length>MAX_STACK_LENGTH){this.stack.shift()}},getLog:function(o){var options=$.extend({log:true,warn:true,error:true,tail:MAX_STACK_LENGTH},o),i,stack=[];for(i=0;i<this.stack.length;i++){if(options[this.stack[i].type]>=0&&(i>this.stack.length-options.tail-1)){stack.unshift(this.stack[i].message)}}return stack}});_gliffy.Logger=new _gliffy.logger()}());(function(){var __errorHandler=null,__globalTarget=null;_gliffy.handleError=function(key,args,exception,target){args=args||[];target=target||__globalTarget||null;var message=$.i18n._(key,args);if(exception&&exception.toString().indexOf("0x80040111 (NS_ERROR_NOT_AVAILABLE)")!==-1){_gliffy.Logger.warn("FF 0x80040111 (NS_ERROR_NOT_AVAILABLE) "+exception.toString())}else{__errorHandler.report(message,exception,target)}};_gliffy.setErrorHandler=function(errorHandler){__errorHandler=errorHandler};_gliffy.setGlobalErrorTarget=function(target){__globalTarget=target||null};var DefaultErrorHandler=_gliffy.Class.extend({feedbackDialog:function(message,exception,report){var prop,output="",zIndex,confluenceSpinner,isIFrame=window.parent.document!==window.document;_gliffy.Dialog.showGenericDialog({content:message+"  "+$.i18n._("ERRORHANDLER_PLEASE_SEND_A_REPORT_TO_GLIFFY.__YOU_CAN_VIEW_THE_REPORT_BEFORE_IT_IS_SENT.")+"  "+$.i18n._("ERRORHANDLER_SADLY,_YOU_MAY_NEED_TO_REFRESH_YOUR_BROWSER_TO_CONTINUE_WORKING_NORMALLY."),title:$.i18n._("ERRORHANDLER_ERROR"),cancelCallback:null,buttons:[{text:$.i18n._("ERRORHANDLER_SEND_ERROR_REPORT"),callback:function(){$("body").trigger("send-error.gliffy-body",{message:message,report:report})},primary:true,dismiss:true},{text:$.i18n._("ERRORHANDLER_NO_THANKS"),callback:null,primary:false,dismiss:true}]});if(isIFrame){confluenceSpinner=$(window.parent.document).find(".gliffy-spinner");if(confluenceSpinner.is(":visible")){confluenceSpinner.remove();_gliffy.Spinner.show("confluence")}}},getErrorReport:function(message,exception){var prop,output=$.i18n._("ERRORHANDLER_WHAT_WERE_YOU_DOING_JUST_BEFORE_THIS_ERROR?")+"\n===============================\n\n\n\n\n"+$.i18n._("ERRORHANDLER_ERROR_REPORT")+"\n============\n\nError Type: "+message+"\n\n";try{output+="Gliffy Version: ["+_gliffy.versionString+"] \n\n"}catch(e0){output+="Missing Gliffy Version\n\n"}try{output+="Confluence Build Number ["+_gliffy.confluenceVersion+"] \n\n"}catch(e0a){output+="Missing Confluence Build Number."}try{output+=_gliffy.BrowserDetect.dump()+"\n\n"}catch(e1){output+="Missing BrowserDetect\n\n"}if(!exception||exception===undefined){output+="No exception generated.\n\n"}else{try{output+="Exception: ["+exception.toString()+"]\n\n"}catch(e2){output+="Missing exception.toString().\n\n"}try{for(prop in exception){if(exception.hasOwnProperty(prop)){output+="Exception property: "+prop+" value: ["+exception[prop]+"]\n\n"}}}catch(e3){output+="Missing Exception properties.\n\n"}try{if(exception.stack!==undefined){output+="Stack: ["+exception.stack+"]\n\n"}else{output+="No stack available\n\n"}}catch(e4){output+="Missing Stack\n\n"}}try{output+="Logger: [\n"+_gliffy.Logger.getLog({tail:20}).join("\t\n")+"]\n\n"}catch(e5){output+="Missing Logger\n"}try{_gliffy.Mouse.editor.getDocumentManager().getActiveStage().commandHistory.forceFinalizeCommandBundle();output+=_gliffy.Mouse.editor.getDocumentManager().getActiveStage().commandHistory.getReport(10)}catch(e6){output+="Missing Command Report\n"}return output},report:function(message,exception,target){var report;if(message===null||message===undefined){message="An unknown error has occurred."}report=this.getErrorReport(message,exception);if(_gliffy.Debug.NO_ERROR_DIALOG!==true){if(_gliffy.Dialog){this.feedbackDialog(message,exception,report)}else{window.alert(message)}}window.console.log(report)}});_gliffy.setErrorHandler(new DefaultErrorHandler())}());(function(){var MAC_KEYS={command:String.fromCharCode(8984),shift:String.fromCharCode(8679),del:String.fromCharCode(9003),esc:String.fromCharCode(9099),alt:String.fromCharCode(8997)},uidCounter=0;_gliffy.Utils={SNAP_DEGREES_MULTIPLIER:360,FLOAT_EQUALS_THRESHOLD:0.0001,FLOAT_FIXED:4,SNAP_PIXELS:10,__urlParams:null,getContext:function(canvas){return canvas.getContext("2d")},getMockContext:function(){return{width:0,height:0,canvas:document.createElement("canvas"),save:function(){},restore:function(){},scale:function(){},rotate:function(){},translate:function(){},transform:function(){},setTransform:function(){},globalAlpha:function(){},globalCompositeOperation:function(){},strokeStyle:"",fillStyle:"",createLinearGradient:function(){return{addColorStop:function(){}}},createRadialGradient:function(){return{addColorStop:function(){}}},createPattern:function(){},lineCap:"",lineJoin:"",miterLimit:"",shadowColor:"",shadowOffsetX:"",shadowOffsetY:"",shadowBlur:"",clearRect:function(){},fillRect:function(){},strokeRect:function(){},beginPath:function(){},moveTo:function(){},closePath:function(){},lineTo:function(){},quadraticCurveTo:function(){},bezierCurveTo:function(){},arcTo:function(){},arc:function(){},rect:function(){},fill:function(){},stroke:function(){},clip:function(){},isPointInPath:function(){},drawFocusRing:function(){},font:"",textAlign:"",textBaseline:"",fillText:function(){},strokeText:function(){},measureText:function(){return{width:0}},drawImage:function(){},createImageData:function(){},getImageData:function(){return{width:0,height:0,data:""}},putImageData:function(){}}},randomString:function(holder){var chars,randomstring,i;if(!holder){throw"cannot create a random attribute name for an undefined object"}chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";randomstring="";do{randomstring="";for(i=0;i<12;i++){randomstring+=chars[Math.floor(Math.random()*chars.length)]}}while(holder[randomstring]);return randomstring},forceMatrixOnly:false,transformCss:function(transform,o){var options=$.extend({originX:0,originY:0,roundTranslate:false,matrixOnly:false},o),transformCss,transform_origin;if(this.forceMatrixOnly){options.matrixOnly=true}if(options.matrixOnly){transformCss=transform.toCss({isMoz:false,roundTranslate:options.roundTranslate});transform_origin=options.originX+" "+options.originY;return{"-moz-transform":transform.toCss({isMoz:true,roundTranslate:options.roundTranslate}),"-webkit-transform":transformCss,"-o-transform":transformCss,msTransform:transformCss,transform:transformCss,"transform-origin":transform_origin,msTransformOrigin:transform_origin,"-webkit-transform-origin":transform_origin,"-moz-transform-origin":transform_origin,"-o-transform-origin":transform_origin}}else{transformCss=transform.toCssNoTranslate({isMoz:false,roundTranslate:options.roundTranslate});transform_origin=options.originX+" "+options.originY;return{"-moz-transform":transform.toCssNoTranslate({isMoz:true,roundTranslate:options.roundTranslate}),"-webkit-transform":transformCss,"-o-transform":transformCss,msTransform:transformCss,transform:transformCss,"transform-origin":transform_origin,msTransformOrigin:transform_origin,"-webkit-transform-origin":transform_origin,"-moz-transform-origin":transform_origin,"-o-transform-origin":transform_origin,top:transform.getTranslateY(),left:transform.getTranslateX()}}},posMod:function(x,y){if(y===0){return x}return x-y*Math.floor(x/y)},unwrapRadians:function(radians){return _gliffy.Utils.posMod(radians,Math.PI*2)},trim_right:function(text){if(String.prototype.trimRight){return text.trimRight()}else{return text.replace(/\s+$/,"")}},maxBounds:function(transform,width,height,stage){var maxX,maxY,i,inViewport=false,point,points=[{x:0,y:0},{x:width,y:0},{x:width,y:height},{x:0,y:height}];for(i=0;i<points.length;i++){point=transform.transformPoint(points[i].x,points[i].y);if(i===0){maxX=point.x;maxY=point.y}maxX=Math.max(point.x,maxX);maxY=Math.max(point.y,maxY);if(stage.autoFit){if(point.x>0&&point.y>0){inViewport=true}}else{if(point.x>0&&point.y>0&&point.x<stage.width*stage.getZoom()&&point.y<stage.height*stage.getZoom()){inViewport=true}}}return{x:maxX,y:maxY,inViewport:inViewport}},maxInArray:function(arr){return Math.max.apply(Math,arr)},minInArray:function(arr){return Math.min.apply(Math,arr)},tryCatch:function(tryFunc,catchFunc){if(_gliffy.Debug.SKIP_CATCH_ERRORS){return tryFunc()}else{try{return tryFunc()}catch(e){catchFunc(e)}}},cloneArray:function(arr){var out=[],i;for(i=0;i<arr.length;i++){if(arr[i].length){out[i]=_gliffy.Utils.cloneArray(arr[i])}else{out[i]=arr[i]}}return out},wrapDegrees:function(degree){while(degree<0){degree+=360}return degree%360},radiansToDegrees:function(radians){return(radians*180/Math.PI)},degreesToRadians:function(degrees){return(degrees*Math.PI/180)},convertRanges:function(oldValue,oldRangeStart,oldRangeEnd,newRangeStart,newRangeEnd){return(((oldValue-oldRangeStart)*(newRangeEnd-newRangeStart))/(oldRangeEnd-oldRangeStart))+newRangeStart},calculateLineSnap:function(curPoint,opposingPoint,snapDegrees){var pointToPoint=_gliffy.Vec2.difference(curPoint,opposingPoint),snapped,angle,degrees,mod,newDegrees;snapped=false;if(pointToPoint.x!==0||pointToPoint.y!==0){angle=_gliffy.Utils.unwrapRadians(Math.atan2(pointToPoint.y,pointToPoint.x));degrees=_gliffy.Utils.radiansToDegrees(angle);mod=_gliffy.Utils.posMod(degrees,90);if(mod>(90-snapDegrees)||mod<snapDegrees){snapped=true;newDegrees=Math.floor(_gliffy.Utils.posMod(degrees+snapDegrees,360)/90)*90;pointToPoint=pointToPoint.rotate(_gliffy.Utils.degreesToRadians(newDegrees-degrees));curPoint=_gliffy.Vec2.sum(pointToPoint,opposingPoint)}}return{snapped:snapped,point:curPoint}},floatEquals:function(float1,float2,threshold){threshold=threshold||this.FLOAT_EQUALS_THRESHOLD;return Math.abs(float1-float2)<=threshold},floatToString:function(floatz,fixed){var result;if(isNaN(fixed)){fixed=this.FLOAT_FIXED}result=floatz.toFixed(fixed).replace(/\.?0+$/,"");return(result==="-0")?"0":result},boundingBoxToCss:function(boundingBox,zoom){var topLeft=new _gliffy.Vec2(boundingBox.min.x,boundingBox.min.y),dimension=boundingBox.getDimension();if(zoom!==undefined){dimension.scale(zoom);topLeft.scale(zoom)}return{left:topLeft.x+"px",top:topLeft.y+"px",width:dimension.x+"px",height:dimension.y+"px"}},stealFocus:function(){if($(document.activeElement).get(0)!==document.body){$("<textarea />").prependTo($("body")).focus().blur().remove()}},hsv2rgb:function(hsv){var h=hsv.hue,s=hsv.sat,v=hsv.val,rgb,i,data=[];if(s===0){rgb=[v,v,v]}else{h=h/60;i=Math.floor(h);data=[v*(1-s),v*(1-s*(h-i)),v*(1-s*(1-(h-i)))];switch(i){case 0:rgb=[v,data[2],data[0]];break;case 1:rgb=[data[1],v,data[0]];break;case 2:rgb=[data[0],v,data[2]];break;case 3:rgb=[data[0],data[1],v];break;case 4:rgb=[data[2],data[0],v];break;default:rgb=[v,data[0],data[1]];break}}return"#"+rgb.map(function(x){return("0"+Math.round(x*255).toString(16)).slice(-2)}).join("")},selectAllTextInElement:function(element){var range,selection;element=$(element);if(element.length>0){element=element.get(0);if(document.body.createTextRange){range=document.body.createTextRange();range.moveToElementText(element);range.select()}else{if(window.getSelection){selection=window.getSelection();range=document.createRange();range.selectNodeContents(element);selection.removeAllRanges();selection.addRange(range)}}}},getTextBoundingBox:function(element,offset){var range,rect;element=$(element);if(element.length>0){element=element.get(0);offset=offset||{x:0,y:0};if(document.createRange){range=document.createRange();range.selectNodeContents(element);if(range.getBoundingClientRect){rect=range.getBoundingClientRect();if(rect){return new _gliffy.BoundingBox((rect.left+offset.x),(rect.top+offset.y),(rect.right+offset.x),(rect.bottom+offset.y))}}}}return new _gliffy.BoundingBox()},setSnapToGrid:function(auto){this.__autoGrid=auto},shouldSnapToGrid:function(){if(this.__autoGrid){return _gliffy.KeyManager.shiftKeyDown?!GliffyApp.documentModel.snapToGrid:GliffyApp.documentModel.snapToGrid}else{return false}},hasNonWhitespaceCharacter:function(str){var pattern=/\S+/;return pattern.test(str)},removeLineBreaks:function(str){return str.replace(/(\r\n|\n|\r)/gm,"")},getLocalOffset:function(startPosition,endPosition,node){var localSpace=node.worldTransform.createInverse();return _gliffy.Vec2.difference(localSpace.transformPoint(endPosition.x,endPosition.y),localSpace.transformPoint(startPosition.x,startPosition.y))},isHorizontal:function(startPoint,endPoint){return Math.abs(startPoint.y-endPoint.y)<0.001},clamp:function(value,min,max){return(value<min)?min:((value>max)?max:value)},parseBoolean:function(str){return(/true/i.test(str))},capitalize:function(str){return str.replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()})},capitalizeFirstWord:function(word){word=word.toLowerCase();return word.charAt(0).toUpperCase().concat(word.slice(1,word.length))},hashCode:function(string){var hash=0,i,char_;if(string.length===0){return hash}for(i=0;i<string.length;i++){char_=string.charCodeAt(i);hash=((hash<<5)-hash)+char_;hash=hash&hash}return hash},equalPoints:function(p1,p2,tolerance){if(tolerance===undefined){tolerance=0}if($.isArray(p1)&&$.isArray(p2)){return((Math.abs(p1[0]-p2[0])<=tolerance)&&Math.abs(p1[1]-p2[1])<=tolerance)}return false},drawBoundingBox:function(boundingBox,style,parentElement){var css=$.extend(style||{backgroundColor:"#ff0000",opacity:0.5},_gliffy.Utils.boundingBoxToCss(boundingBox)),div=$("<div></div>");css.position="absolute";css.padding="0px";css.margin="0px";css.zIndex=10000000;$(parentElement||"#container").append(div.css(css));$(document).dblclick(function(){div.remove()})},drawPoint:function(point,style,parentElement){style=$.extend(style||{},{backgroundColor:"#ffffff",outline:"5px solid #000000",opacity:0.5});_gliffy.Utils.drawBoundingBox(new _gliffy.BoundingBox(point.x,point.y,point.x+1,point.y+1),style,parentElement)},pointToColor:function(point,min,max,invert){var xColor=Math.round((point.x-min)/(max-min)*255),yColor=Math.round((point.y-min)/(max-min)*255),prefix="#00";if(invert){xColor=255-xColor;yColor=255-yColor;prefix="#ff"}xColor=xColor.toString(16);if(xColor.length===1){xColor="0"+xColor}yColor=yColor.toString(16);if(yColor.length===1){yColor="0"+yColor}return prefix+xColor+yColor},getRenderedStyle:function($ele,requestedStyle){var style="",DOCUMENT_TYPE=9;while((style===""||style===undefined||style===null)&&($ele.length>0)&&$ele[0].nodeType!==DOCUMENT_TYPE){style=$ele.css(requestedStyle);$ele=$ele.parent()}return(style===undefined||style===null)?"":style},addDynamicStyle:function(styleString){$("#gliffy-dynamic-style").append(styleString)},notify:function(type,title,message,fadeOutTime,rightOffset,topOffset){if(Mustache){var html=Mustache.render($("#gliffy-notify-popup-template").html(),{type:type,title:title,message:message});$(html).appendTo("body");if(rightOffset){$("#gliffy-notify-popup").css("right",rightOffset)}if(topOffset){$("#gliffy-notify-popup").css("top",topOffset)}if(fadeOutTime){setTimeout(function(){$("#gliffy-notify-popup").fadeOut(1000,function(){$("#gliffy-notify-popup").alert("close")})},fadeOutTime)}}else{window.alert(title+"\n\n"+message)}},analyticsEvent:function(type,options){$(window).trigger(type+".gliffyAnalytics",options)},analyticsTimerStart:function(name,alsoProfile){_gliffy.Timer.start(name,alsoProfile)},analyticsTimerEnd:function(name){var time=_gliffy.Timer.end(name);_gliffy.Utils.analyticsEvent("trackEvent",{category:"time",action:name,value:time/1000,non_interaction:true})},sortJson:function(myObj){var keys=[],k,i,len,out;for(k in myObj){if(myObj.hasOwnProperty(k)){keys.push(k)}}keys.sort();len=keys.length;for(i=0;i<len;i++){k=keys[i];out+='"'+k+'":"'+myObj[k]+'"\n'}window.console.log(out)},createIframe:function(name,onReady){var iframe,contents;iframe=$("<iframe />",{src:"",name:name,id:name}).appendTo("body");contents=iframe.contents();if(contents&&contents.get(0).readyState==="complete"){onReady(iframe)}else{iframe.bind("load.preajax",function(){iframe.unbind("load.preajax");onReady(iframe)})}},iframeDownload:function(url,successCallback,errorCallback){var name="iframeDownload"+uidCounter;uidCounter++;this.createIframe(name,function(iframe){iframe.bind("load.ajax",function(){if(successCallback){successCallback()}iframe.unbind(".ajax");iframe.remove()});iframe.bind("error.ajax",function(){if(errorCallback){errorCallback()}iframe.unbind(".ajax");iframe.remove()});iframe.attr("src",url)})},iframeAjax:function(url,data,successCallback,errorCallback){var name="iframeAjax"+uidCounter;uidCounter++;this.createIframe(name,function(iframe){var form,key;iframe.bind("load.ajax",function(){if(successCallback){successCallback()}iframe.unbind(".ajax");iframe.remove()});iframe.bind("error.ajax",function(){if(errorCallback){errorCallback()}iframe.unbind(".ajax");iframe.remove()});form=$("<form/>",{method:"post",action:url,target:iframe.attr("id")});for(key in data){if(data.hasOwnProperty(key)){form.append($("<input/>",{type:"hidden",name:key,value:data[key]}))}}form.appendTo($("body"));form.submit();form.remove()})},isEnglish:function(editor){return(!editor.language||editor.language.indexOf("en")===0)},getImageUrlFromHtml:function(html){html=html.replace("'",'"');var match=/<img\s+(\S+\s+)*src="([^"]+)"/.exec(html);if(match){return match[2]}else{return null}},escapeHTML:function(html){var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};return String(html).replace(/[&<>"'\/]/g,function(s){return entityMap[s]})}};_gliffy.Utils.forceMatrixOnly=_gliffy.BrowserDetect.browser==="Safari"&&_gliffy.BrowserDetect.version===5.1}());(function(){var __requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){window.setTimeout(callback,1000/60)},__frameRate,__tasks=[],__stop=true;function currentTime(){return(new Date()).getTime()/1000}function FrameRate(){this.__div=$("<div class='gliffy-frame-rate'>Computing fps...</div>");$("body").append(this.__div);this.__deltaTime=0;this.__currentTime=currentTime();this.__frame=0;this.update=function(){var newTime=currentTime(),display;this.__frame++;this.__deltaTime=newTime-this.__currentTime;if(this.__deltaTime>1){display=(this.__frame/this.__deltaTime).toFixed(1)+" fps";this.__div.html(display);this.__deltaTime=0;this.__frame=0;this.__currentTime=newTime}};this.remove=function(){this.__div.remove();this.__div=null}}function __runTasks(){var i;for(i=0;i<__tasks.length;i++){__tasks[i]()}}function __catchError(e){_gliffy.RenderLoop.stop();_gliffy.Logger.error("Render loop failed: "+e.message);_gliffy.handleError("com.gliffy.error.render_loop",[],e)}function __loop(){var i;if(!__stop){__requestAnimationFrame(__loop);for(i=0;i<__tasks.length;i++){if(!__stop){_gliffy.Utils.tryCatch(__runTasks,__catchError)}}if(__frameRate){__frameRate.update()}}}_gliffy.RenderLoop={start:function(){if(__stop===true&&!_gliffy.Debug.SKIP_RENDER_LOOP){__stop=false;__requestAnimationFrame(__loop)}},stop:function(){_gliffy.Logger.warn("Render loop was stopped.");__stop=true},appendTask:function(task){__tasks.push(task)},removeTask:function(task){var index=__tasks.indexOf(task);if(index!==-1){__tasks.splice(index,1)}},showFrameRate:function(){__frameRate=new FrameRate()},hideFrameRate:function(){__frameRate.remove();__frameRate=null},toggleFrameRate:function(){if(__frameRate){this.hideFrameRate()}else{this.showFrameRate()}}}}());(function(){var __tempArray=[];_gliffy.BoundingBox=_gliffy.Class.extend({min:null,max:null,init:function(minX,minY,maxX,maxY){this.min=new _gliffy.Vec2(minX||0,minY||0);this.max=new _gliffy.Vec2(maxX||0,maxY||0)},growPoint:function(point){return this.grow(point.x,point.y)},grow:function(x,y){if(x<this.min.x){this.min.x=x}if(x>this.max.x){this.max.x=x}if(y<this.min.y){this.min.y=y}if(y>this.max.y){this.max.y=y}return this},extend:function(amount){this.min.x-=amount;this.min.y-=amount;this.max.x+=amount;this.max.y+=amount;if(amount<0){this.fit([this.min.x,this.min.y,this.max.x,this.max.y])}return this},add:function(boundingBox){this.grow(boundingBox.min.x,boundingBox.min.y);this.grow(boundingBox.max.x,boundingBox.max.y);return this},copy:function(boundingBox){this.min.x=boundingBox.min.x;this.min.y=boundingBox.min.y;this.max.x=boundingBox.max.x;this.max.y=boundingBox.max.y;return this},fitPoints:function(points){var i,x,y;x=points[0].x;y=points[0].y;this.min.x=x;this.max.x=x;this.min.y=y;this.max.y=y;for(i=1;i<points.length;i++){this.grow(points[i].x,points[i].y)}return this},fit:function(coords){var i,x,y;if(coords.length<2){throw new Error("The parameter coords must be an array of at lest 2 length.")}x=coords[0];y=coords[1];this.min.x=x;this.max.x=x;this.min.y=y;this.max.y=y;for(i=2;i<coords.length;i+=2){this.grow(coords[i],coords[i+1])}return this},clone:function(){return new _gliffy.BoundingBox(this.min.x,this.min.y,this.max.x,this.max.y)},transform:function(affineTransform){this.fit(this.__toRectangle(affineTransform));return this},intersects:function(boundingBox,affineTransform){if(affineTransform){boundingBox=boundingBox.clone().transform(affineTransform)}if(this.max.x<boundingBox.min.x||this.min.x>boundingBox.max.x||this.max.y<boundingBox.min.y||this.min.y>boundingBox.max.y){return false}else{return true}},boundingBoxInside:function(boundingBox,affineTransform){if(affineTransform){boundingBox=boundingBox.clone().transform(affineTransform)}return this.min.x<=boundingBox.min.x&&this.min.y<=boundingBox.min.y&&this.max.x>=boundingBox.max.x&&this.max.y>=boundingBox.max.y},inBoundingBox:function(containingBoundingBox){return(this.max.x>containingBoundingBox.min.x)&&(this.max.y>containingBoundingBox.min.y)&&(this.min.x<containingBoundingBox.max.x)&&(this.min.y<containingBoundingBox.max.y)},pointInside:function(x,y){return x>=this.min.x&&x<=this.max.x&&y>=this.min.y&&y<=this.max.y},pointDistance:function(x,y){var xDistance=0,yDistance=0;if(x<this.min.x){xDistance=x-this.min.x}else{if(x>this.max.x){xDistance=x-this.max.x}}if(y<this.min.y){yDistance=y-this.min.y}else{if(y>this.max.y){yDistance=y-this.max.y}}return new _gliffy.Vec2(xDistance,yDistance)},setMinMax:function(minX,minY,maxX,maxY){this.min.x=minX||0;this.min.y=minY||0;this.max.x=maxX||0;this.max.y=maxY||0;return this},setByCenter:function(center,dimension){var halfX=dimension.x/2,halfY=dimension.y/2;this.min.x=center.x-halfX;this.min.y=center.y-halfY;this.max.x=center.x+halfX;this.max.y=center.y+halfY},toString:function(){return"min("+_gliffy.Utils.floatToString(this.min.x)+","+_gliffy.Utils.floatToString(this.min.y)+") max("+_gliffy.Utils.floatToString(this.max.x)+","+_gliffy.Utils.floatToString(this.max.y)+")"},equals:function(boundingBox){if(boundingBox){return _gliffy.Utils.floatEquals(this.min.x,boundingBox.min.x)&&_gliffy.Utils.floatEquals(this.max.x,boundingBox.max.x)&&_gliffy.Utils.floatEquals(this.min.y,boundingBox.min.y)&&_gliffy.Utils.floatEquals(this.max.y,boundingBox.max.y)}else{return false}},getDimension:function(){return _gliffy.Vec2.difference(this.max,this.min)},getWidth:function(){return this.getDimension().x},getHeight:function(){return this.getDimension().y},getCenter:function(){return _gliffy.Vec2.lerp(this.max,this.min,0.5)},__toRectangle:function(affineTransform){__tempArray[0]=this.min.x;__tempArray[1]=this.min.y;__tempArray[2]=this.min.x;__tempArray[3]=this.max.y;__tempArray[4]=this.max.x;__tempArray[5]=this.max.y;__tempArray[6]=this.max.x;__tempArray[7]=this.min.y;affineTransform.transform(__tempArray,0,__tempArray,0,4);return __tempArray}});_gliffy.BoundingBox.INFINITE=new _gliffy.BoundingBox(Number.MIN_VALUE,Number.MIN_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);_gliffy.BoundingBox.SMALLEST=new _gliffy.BoundingBox(Number.MAX_VALUE,Number.MAX_VALUE,Number.MIN_VALUE,Number.MIN_VALUE)}());(function(){var _compositeColor=new _gliffy.RGBColor("#000000");var MAX_BYTE=255;_gliffy.ColorUtils={multiply:function(sourceColor,destColor){sourceColor=new _gliffy.RGBColor(sourceColor);destColor=new _gliffy.RGBColor(destColor);_compositeColor.r=Math.floor(sourceColor.r*destColor.r/MAX_BYTE);_compositeColor.g=Math.floor(sourceColor.g*destColor.g/MAX_BYTE);_compositeColor.b=Math.floor(sourceColor.b*destColor.b/MAX_BYTE);return _compositeColor.toHex()},generator:function(type,sourceColor){return function(){return function(destColor){return _gliffy.ColorUtils[type](sourceColor,destColor)}}}}}());(function(){function WindowMessage(nameSpace,domainFilter,targetWindowName){this.__nameSpace=nameSpace;this.__domainFilter=domainFilter;this.__targetWindowName=targetWindowName||null}WindowMessage.prototype.setDomainFilter=function(domainFilter){this.__domainFilter=domainFilter};WindowMessage.prototype.setNameSpace=function(nameSpace){this.__nameSpace=nameSpace};WindowMessage.prototype.setTargetWindowName=function(targetWindowName){this.__targetWindowName=targetWindowName||null};WindowMessage.prototype.getTargetWindow=function(){var frame=null;if(this.__targetWindowName!==null){if(typeof(this.__targetWindowName)==="string"){frame=window.frames[this.__targetWindowName]}else{frame={window:this.__targetWindowName}}}else{frame=window.parent}if(frame&&frame.postMessage){return frame}else{if(frame&&frame.window&&frame.window.postMessage){return frame.window}else{if(frame&&frame.contentWindow&&frame.contentWindow.postMessage){return frame.contentWindow}else{throw new Error("The frame "+this.__targetWindowName+" was not found.")}}}};WindowMessage.prototype.send=function(action,data){if(this.__domainFilter){this.getTargetWindow().postMessage(JSON.stringify({nameSpace:this.__nameSpace,action:action,data:data||null}),this.__domainFilter)}else{throw new Error("No domain filter was set.")}};WindowMessage.prototype.receive=function(action,callback){var self=this,listener;listener=function(event){if(event.source===self.getTargetWindow()&&event.data){var data=JSON.parse(event.data);if(data.nameSpace===self.__nameSpace&&data.action===action){callback(data.data);window.removeEventListener("message",listener,false);listener=null}}};window.addEventListener("message",listener,false)};window.GLIFFY=window.GLIFFY||{};window.GLIFFY.WindowMessage=WindowMessage}());(function(){var STENCIL_MARKERS=["com.gliffy.stencil.marker_start.v1","com.gliffy.stencil.marker_end.v1","com.gliffy.stencil.marker_start.v2","com.gliffy.stencil.marker_end.v2","com.gliffy.stencil.marker_start.v3","com.gliffy.stencil.marker_end.v3","com.gliffy.stencil.marker_start.v4","com.gliffy.stencil.marker_end.v4","com.gliffy.stencil.marker_start.v5","com.gliffy.stencil.marker_end.v5","com.gliffy.stencil.marker_start.v6","com.gliffy.stencil.marker_end.v6","com.gliffy.stencil.marker_start.v7","com.gliffy.stencil.marker_end.v7","com.gliffy.stencil.marker_start.v8","com.gliffy.stencil.marker_end.v8","com.gliffy.stencil.marker_start.v9","com.gliffy.stencil.marker_end.v9","com.gliffy.stencil.marker_start.v10","com.gliffy.stencil.marker_end.v10","com.gliffy.stencil.marker_start.v11","com.gliffy.stencil.marker_end.v11","com.gliffy.stencil.marker_start.v12","com.gliffy.stencil.marker_end.v12","com.gliffy.stencil.marker_start.v13","com.gliffy.stencil.marker_end.v13","com.gliffy.stencil.marker_start.v14","com.gliffy.stencil.marker_end.v14","com.gliffy.stencil.marker_start.v15","com.gliffy.stencil.marker_end.v15","com.gliffy.stencil.marker_start.v16","com.gliffy.stencil.marker_end.v16","com.gliffy.stencil.marker_start.v17","com.gliffy.stencil.marker_end.v17"],STENCIL_DEPENDENCIES={RGBColor:_gliffy.RGBColor,candash:_gliffy.candash},IGNORED_SHAPE_UIDS=["com.gliffy.shape.basic.basic_v1.default.group","com.gliffy.shape.basic.basic_v1.default.selection"];_gliffy.ShapeLibrary=_gliffy.Class.extend({init:function(options){var o=$.extend({},{rootServiceURL:"../api"},options);this.rootServiceURL=o.rootServiceURL;this.shapes={};this.templates={};this.custom_function={};this.svgDim={};this.svgStencil={};this.libraries={}},setup:function(options){var o=$.extend({},{rootServiceURL:this.rootServiceURL},options);this.rootServiceURL=o.rootServiceURL},shapes:null,svgDim:null,templates:null,custom_function:null,markersLoaded:false,libraries:null,svgStencil:null,loadSvgStencil:function(svg,resource,useDefaultFailHandler){var url=this.rootServiceURL+"/stencils/svg.json",self=this,defer;if(!this.svgStencil[svg]){defer=$.Deferred();$.ajax({url:url,type:"POST",data:svg,dataType:"json",contentType:"application/json; charset=utf-8",traditional:true}).pipe(function(data){return data},function(xhr,text,error){defer.reject(xhr.responseText)}).then(function(data){try{self.templates[svg]=new Function("ctx","data","_gliffy",data.template);self.svgDim[svg]={width:parseFloat(data.width),height:parseFloat(data.height),x:parseFloat(data.x),y:parseFloat(data.y)};if(resource){resource.setX(parseFloat(data.x));resource.setY(parseFloat(data.y));resource.setWidth(parseFloat(data.width));resource.setHeight(parseFloat(data.height))}defer.resolve(data)}catch(e){defer.reject(svg)}});this.svgStencil[svg]=defer.promise()}if(useDefaultFailHandler){return this.svgStencil[svg].fail(function(xhr,text,error){_gliffy.Logger.warn("failed to load svg: "+svg);_gliffy.handleError("com.gliffy.error.stencil_load",[url],new Error(xhr.responseText))})}else{return this.svgStencil[svg]}},loadLibraries:function(library){var url=this.rootServiceURL+"/libraries.json";if(!this.libraries[library]){this.libraries[library]=$.Deferred(function(defer){$.get(url).then(defer.resolve,defer.reject)}).promise()}return this.libraries[library].fail(function(xhr,text,error){_gliffy.handleError("com.gliffy.error.operation_failed",[url],error)})},loadStencils:function(shapeArray,errorTarget){var url=this.rootServiceURL+"/stencils.json",promise,self=this,i=0,tid,shapes=[];shapeArray=shapeArray||[];if(!this.markersLoaded){this.markersLoaded=true;shapeArray=shapeArray.concat(STENCIL_MARKERS)}for(i=0;i<shapeArray.length;i++){tid=shapeArray[i];if(!self.templates[tid]&&$.inArray(tid,shapes)===-1){shapes.push(tid)}}if(shapes.length>0){promise=$.Deferred(function(defer){$.ajax({url:url,type:"POST",data:JSON.stringify(shapes),dataType:"json",contentType:"application/json; charset=utf-8",traditional:true}).then(defer.resolve,defer.reject)}).promise();promise.then(function(data,text,xhr){_gliffy.Utils.tryCatch(function(){var i,shape;for(i=0;i<data.length;i++){shape=data[i];self.__addStencil(shape)}},function(e){_gliffy.Logger.warn("failed to load stencils: "+JSON.stringify(shapes));_gliffy.handleError("com.gliffy.error.stencil_load",[url],e,errorTarget)})},function(xhr,text,error){_gliffy.Logger.warn("failed to load stencils: "+JSON.stringify(shapes));_gliffy.handleError("com.gliffy.error.stencil_load",[url],error,errorTarget)})}else{promise=$.Deferred(function(defer){defer.resolve()}).promise()}return promise},loadShapes:function(shapeArray,errorTarget,language){var i,uid,url=this.rootServiceURL+"/shapes.json"+(language?"?locale="+language:""),self=this,shapes=[],stencils=[],promise;shapeArray=shapeArray||[];for(i=0;i<shapeArray.length;i++){uid=shapeArray[i];if(!self.shapes[uid]&&$.inArray(uid,shapes)===-1&&$.inArray(uid,IGNORED_SHAPE_UIDS)===-1){shapes.push(uid)}}if(shapes.length>0){promise=$.Deferred(function(defer){$.ajax({url:url,type:"POST",data:JSON.stringify(shapes),dataType:"json",contentType:"application/json; charset=utf-8",traditional:true}).then(defer.resolve,defer.fail)}).promise();promise.then(function(data,text,xhr){_gliffy.Utils.tryCatch(function(){var i,shape;for(i=0;i<data.length;i++){shape=data[i];self.shapes[shape.uid]=shape}},function(e){_gliffy.Logger.warn("failed to load shapes: "+JSON.stringify(shapes));_gliffy.handleError("com.gliffy.error.shape_load",[url],e,errorTarget)});return stencils},function(xhr,text,error){_gliffy.Logger.warn("failed to load shapes: "+JSON.stringify(shapes));_gliffy.handleError("com.gliffy.error.shape_load",[url],error,errorTarget)})}else{promise=$.Deferred(function(defer){defer.resolve()}).promise()}return promise},canDrawStencil:function(tid){return this.templates[tid]!==undefined},drawStencil:function(tid,ctx,data){if(this.canDrawStencil(tid)){this.templates[tid](ctx,data,STENCIL_DEPENDENCIES)}else{_gliffy.Logger.warn("Attempted to draw stencil "+tid+" but was not available")}},__addStencil:function(stencil){var self=this;if(!self.templates[stencil.tid]){if(stencil.cfb){self.custom_function[stencil.tid]=new Function("data",stencil.cfb)}self.templates[stencil.tid]=new Function("ctx","data","_gliffy",stencil.template)}},getShape:function(uid){var self=this;if(self.shapes[uid]){return self.shapes[uid]}return null}});_gliffy.shapeLibrary=new _gliffy.ShapeLibrary({rootServiceURL:"../api"})}());(function(){_gliffy.Serializable=_gliffy.Class.extend({toObject:function(){var serialized=this.__toObject();if(serialized){return $.extend(true,{},serialized)}else{return null}},fromObject:function(object,opt){this.__fromObject($.extend(true,{},object),opt);return this},__toObject:function(){throw new Error("__toObject is not implemented!")},__fromObject:function(object){throw new Error("__fromObject is not implemented!")}});_gliffy.Serializable.polymorphicToObject=function(instance){var object={type:instance.getClassName()};object[instance.getClassName()]=instance.toObject();return object};_gliffy.Serializable.polymorphicFromObject=function(object,node){var instance=new _gliffy[object.type]();instance.node=node;instance.fromObject(object[object.type]);return instance}}());(function(){_gliffy._Timer=_gliffy.Class.extend({_timers:null,_profileActive:false,init:function(){this._timers={}},start:function(name,shouldProfile){if(this._timers[name]!==undefined){_gliffy.Logger.log("Warning, overriding existing timer.")}this._timers[name]={startTime:(new Date()).getTime(),profile:shouldProfile===true};if(shouldProfile&&console&&console.profile){if(this._profileActive){_gliffy.Logger.log("Only one profile can be active at a time")}else{console.profile(name)}}},end:function(name){var timer=this._timers[name],timeMs=0;if(timer===undefined){_gliffy.Logger.log("Warning: timer does not exist: "+name)}else{timeMs=(new Date()).getTime()-timer.startTime;if(timer.profile&&console&&console.profile){console.profileEnd();this._profileActive=false}delete this._timers[name]}return timeMs},hasTimer:function(name){return this._timers[name]!==undefined}});_gliffy.Timer=new _gliffy._Timer()}());(function(){var _unrenderedTemplates=[],_queued=false;_gliffy.Components={__render:function(){var render,unrenderedTemplates=_unrenderedTemplates;_unrenderedTemplates=[];while((render=unrenderedTemplates.pop())!==undefined){render()}if(unrenderedTemplates.length!==0){GLIFFY.Components.__deferredRender()}},__deferredRender:function(){if(_queued!==true){setTimeout(function(){_queued=false;GLIFFY.Components.__render()},1000/10);_queued=true}},appendTemplate:function(templateName,parent){parent=parent||"#gliffy";if($(parent).length>0){Ember.View.create({templateName:templateName}).appendTo(parent)}else{_unrenderedTemplates.push(function(){GLIFFY.Components.appendTemplate(templateName,parent)});GLIFFY.Components.__deferredRender()}},renderTemplate:function(templateName,container){if($(container).length>0){$(container).html("");Ember.View.create({templateName:templateName}).appendTo(container)}else{_unrenderedTemplates.push(function(){GLIFFY.Components.renderTemplate(templateName,container)});GLIFFY.Components.__deferredRender()}}}}());(function(){_gliffy.EmbeddedResource=_gliffy.Serializable.extend({id:null,mimeType:null,data:null,width:100,height:100,x:0,y:0,init:function(id,mimeType,data,x,y,width,height){this.id=id;this.mimeType=mimeType;this.data=data;this.x=x;this.y=y;this.width=width;this.height=height},getId:function(){return this.id},setId:function(id){this.id=id},setMimeType:function(mimeType){this.mimeType=mimeType},getMimeType:function(){return this.mimeType},setData:function(data){this.data=data},getData:function(){return this.data},getWidth:function(){return this.width},setWidth:function(width){this.width=width},getX:function(){return this.x},setX:function(x){this.x=x},getY:function(){return this.y},setY:function(y){this.y=y},getHeight:function(){return this.height},setHeight:function(height){this.height=height},__toObject:function(){return{id:this.getId(),mimeType:this.getMimeType(),data:this.getData(),x:this.getX(),y:this.getY(),width:this.getWidth(),height:this.getHeight()}},__fromObject:function(object){if(object.id!==undefined&&object.id!==null){this.setId(object.id)}if(object.mimeType!==undefined&&object.mimeType!==null){this.setMimeType(object.mimeType)}if(object.data!==undefined&&object.data!==null){this.setData(object.data)}if(object.x!==undefined&&object.x!==null){this.setX(object.x)}if(object.y!==undefined&&object.y!==null){this.setY(object.y)}if(object.width!==undefined&&object.width!==null){this.setWidth(object.width)}if(object.height!==undefined&&object.height!==null){this.setHeight(object.height)}return this}});_gliffy.EmbeddedResources=_gliffy.Serializable.extend({index:0,resources:null,_resourceMap:null,init:function(){this._resourceMap={}},getIndex:function(){return this.index},setIndex:function(index){this.index=index},add:function(mimeType,data,x,y,width,height){var resource,i;if(this.resources===null){this.resources=[]}resource=new _gliffy.EmbeddedResource(this.getIndex(),mimeType,data,x,y,width,height);for(i=0;i<this.resources.length;i++){if(this.resources[i].getData()===resource.getData()&&this.resources[i].getMimeType()===resource.getMimeType()){return this.resources[i]}}this.resources.push(resource);this._resourceMap[resource.getId()]=resource;this.index++;return resource},remove:function(resource){var index;if(this.resources!==null){index=$.inArray(resource,this.resources);if(index>=0){this.resources.splice(index,1);delete this._resourceMap[resource.getId()]}}},getResource:function(id){return this._resourceMap[id]},findExisitngResource:function(data,mimetype){var i;for(i=0;i<this.resources.length;i++){if(this.resources[i].getData()===data&&this.resources[i].getMimeType()===mimetype){return this.resources[i]}}return null},__toObject:function(){var i,resources=[],resource;for(i=0;this.resources&&i<this.resources.length;i++){resource=this.resources[i].toObject();resources.push(resource)}return{index:this.index,resources:resources}},__fromObject:function(object){var i,resource;if(object.index!==undefined&&object.index!==null){this.setIndex(object.index)}if(object.resources&&object.resources.length>0){this.resources=[];this._resourceMap={};for(i=0;i<object.resources.length;i++){resource=new _gliffy.EmbeddedResource();resource.fromObject(object.resources[i]);this.resources.push(resource);this._resourceMap[resource.getId()]=resource}}return this}})}());(function(){_gliffy.Graphic=_gliffy.Serializable.extend({_dirty:true,editable:null,init:function(){if(_gliffy.Editable){this.editable=_gliffy.Editable.getInstance(this)}},getTid:function(){throw new Error("getTid not implemented.")},markDirty:function(){this._dirty=true;if(this.node){this.node.markDirty();this.node.setFlag("skin")}},shouldBeDrawn:function(){if(this.node){return this.node.shouldBeDrawn()}return true},isDirty:function(){return this._dirty},hasParentOfType:function(type){return this.node&&this.node.parent&&this.node.parent.getGraphic() instanceof type},updateProperty:function(prop,value){if(this["set"+prop]!==undefined){this["set"+prop](value)}else{var msg="Property setter: set"+prop+" not found on graphic";throw new Error(msg)}},update:function(){throw new Error("update not implemented.")},applyStyle:function(style){throw new Error("applyStyle not implemented.")},getClassName:function(){throw new Error("getClassName not implemented.")},__toObject:function(){throw new Error("toObject not implemented.")},__fromObject:function(object){throw new Error("fromObject not implemented.")}})})();(function(){_gliffy.Editable=_gliffy.Serializable.extend({isEditable:false,__graphic:null,init:function(o){if(!o){throw new Error("editable init needs options")}if(!o.graphic){throw new Error("editable init options needs graphic")}this.__graphic=o.graphic},__toObject:function(){return{}},__fromObject:function(object){}});_gliffy.Editable.getInstance=function(graphic){var className="Editable"+graphic.getClassName();if(typeof _gliffy[className]==="function"){return new _gliffy[className]({graphic:graphic})}return new _gliffy.Editable({graphic:graphic})}})();(function(){_gliffy.AbstractGeometry=_gliffy.Graphic.extend({_strokeWidth:2,_strokeColor:"#000000",_dropShadow:true,_shadowX:5,_shadowY:5,_connections:null,_showConnections:false,svg:null,setStrokeWidth:function(strokeWidth){this._strokeWidth=strokeWidth;if(this.node){this.node.setFlag("bounds")}this.markDirty()},getStrokeWidth:function(){return this._strokeWidth},setStrokeColor:function(strokeColor){this._strokeColor=strokeColor;this.markDirty()},getStrokeColor:function(){return this._strokeColor},setDropShadow:function(dropShadow){this._dropShadow=dropShadow;if(dropShadow){this.setShadowX(4);this.setShadowY(4)}else{this.setShadowX(0);this.setShadowY(0)}if(this.node){this.node.setFlag("bounds");this.node.setFlag("skin")}this.markDirty()},isDropShadow:function(){return this._dropShadow},setShadowX:function(shadowX){this._shadowX=shadowX;this.markDirty()},getShadowX:function(){return this._shadowX},setShadowY:function(shadowY){this._shadowY=shadowY;this.markDirty()},getShadowY:function(){return this._shadowY},calculateShadowOffset:function(){if(this.isDropShadow()&&this.node){var shadow_x=this.getShadowX(),shadow_y=this.getShadowY(),rotation=this.node.getWorldRotation();var nx=0;var ny=0;var r=rotation%360;if(r<0){r+=360}if(r>=0&&r<=90){var rat1=0;if(r<45){rat1=r/45}else{rat1=(90-r)/45}var rat2=(45-r)/45;nx=shadow_x+shadow_x/3*rat1;ny=shadow_y*rat2}else{if(r>90&&r<=180){r=r-90;if(r<45){rat1=r/45}else{rat1=(90-r)/45}var rat2=(45-r)/45;nx=shadow_x*rat2;ny=-(shadow_y+shadow_y/3*rat1)}else{if(r>180&&r<=270){r=r-180;if(r<45){rat1=r/45}else{rat1=(90-r)/45}var rat2=(45-r)/45;nx=-(shadow_x+shadow_x/4*rat1);ny=-(shadow_y*rat2)}else{if(r<0){r=360+r}r=r-270;if(r<45){rat1=r/45}else{rat1=(90-r)/45}var rat2=(45-r)/45;nx=-(shadow_x*rat2);ny=shadow_y+shadow_y/3*rat1}}}return{x:nx,y:ny}}else{return{x:0,y:0}}}})}());(function(){var TID=null,OVERFLOW={name:"overflow",values:["left","none","right","both"],left:"left",right:"right",both:"both",none:"none"},VALIGN={name:"valign",values:["top","middle","bottom"],top:"top",middle:"middle",bottom:"bottom"},VPOSITION={name:"vposition",values:["above","none","below"],above:"above",none:"none",below:"below"},HPOSITION={name:"hposition",values:["left","none","right"],left:"left",none:"none",right:"right"},HORIZONTIAL_OFFSET_FIX=1;_gliffy.TextUtils={FONT_FIXES:{Arial:{normal:{9:1,10:1,11:1,12:2,13:2.5,14:2.5,18:2.5,24:3,36:5,48:5,64:8,72:8,96:10,110:12,127:16},bold:{9:1,10:1,11:1,12:2,13:2.5,14:2.5,18:2.5,24:3,36:5,48:5,64:8,72:8,96:10,110:12,127:16}},Verdana:{normal:{9:2.5,10:2.5,11:2.5,12:2.5,13:3.5,14:3.5,18:4,24:5,36:8,48:10,64:12,72:15,96:21,110:24,127:28},bold:{9:2.5,10:2.5,11:2.5,12:2.5,13:3.5,14:3.5,18:4,24:5,36:8,48:10,64:12,72:15,96:21,110:24,127:28}},Helvetica:{normal:{9:0,10:0,11:0,12:0,13:0,14:0,18:0,24:0,36:0,48:0,64:0,72:0,96:0,110:0,127:0},bold:{9:0,10:0,11:0,12:0,13:0,14:0,18:0,24:0,36:0,48:0,64:0,72:0,96:0,110:0,127:0}},Courier:{normal:{9:0,10:0,11:0,12:0,13:0,14:0,18:0,24:0,36:0,48:0,64:0,72:0,96:0,110:0,127:0},bold:{9:0,10:0,11:0,12:0,13:0,14:0,18:0,24:0,36:0,48:0,64:0,72:0,96:0,110:0,127:0}},Times:{normal:{9:0,10:0,11:0,12:0,13:0,14:0,18:0,24:0,36:0,48:0,64:0,72:0,96:0,110:0,127:0},bold:{9:0,10:0,11:0,12:0,13:0,14:0,18:0,24:0,36:0,48:0,64:0,72:0,96:0,110:0,127:0}},"Times New Roman":{normal:{9:0,10:0,11:0,12:0,13:0,14:0,18:0,24:0,36:0,48:0,64:0,72:0,96:0,110:0,127:0},bold:{9:0,10:0,11:0,12:0,13:0,14:0,18:0,24:0,36:0,48:0,64:0,72:0,96:0,110:0,127:0}}}};_gliffy.Text=_gliffy.Graphic.extend({style_default:{width:200,height:100,x:0,y:0,type:"fixed",rotate:0},node:null,_lines:null,_valign:VALIGN.middle,_overflow:OVERFLOW.none,_vposition:VPOSITION.none,_hposition:HPOSITION.none,_html:null,_hashCode:null,ruler:null,__padding_top:2,__padding_left:2,__padding_bottom:2,__padding_right:2,__ie_height_offset:0,__ie_width_offset:3,__webkit_height_offset:1,__cachedResult:null,__cachedDomResult:null,__computePositioning:false,__calculatedWidth:null,__calculatedHeight:null,__domRuler:null,init:function(){this.__domRuler=$("<div/>",{style:"visibility:hidden;padding:0;margin:0;position:fixed;","class":"gliffy-ruler-text"});this.style=$.extend({},this.style_default);this._super()},update:function(){if(this.node&&this._dirty){if(!this.editable.isEditable||!this.editable.getEditMode()){this.style=$.extend({},this.style_default,{width:this.node.getWidth(),height:this.node.getHeight()});this.__textHandler();this.__cachedDomResult=this._html}this._dirty=false;return true}return false},markDirty:function(){this._dirty=true;if(this.node){this.node.markDirty()}},calculateWidth:function(){var width=0,recalcDimensions=this.node.isPartOfMultipartShape(),mapEntry;mapEntry=""+this.node.getId()+":"+this._hashCode;if(recalcDimensions||_gliffy.textDimensionMap.width[mapEntry]===undefined){if(!recalcDimensions&&++_gliffy.textDimensionMapSize.width>5000){_gliffy.textDimensionMap.width={};_gliffy.textDimensionMapSize.width=0}if(this.hasFixedWidth()){width=this.node.getWidth()}else{this.__domRuler.html(this._html).appendTo("body").css({width:""});width=this.__domRuler.width()}width=this.getOverflow()===OVERFLOW.none?width-this.getPaddingLeft()-this.getPaddingRight():width;if(recalcDimensions){return width}_gliffy.textDimensionMap.width[mapEntry]=width}return _gliffy.textDimensionMap.width[mapEntry]},calculateHeight:function(){var height,existingWidth,mapEntry;if(this.hasFixedWidth()){existingWidth=this.node.getWidth()-this.getPaddingLeft()-this.getPaddingRight();existingWidth=(Math.round(existingWidth*4)/4).toFixed(2)}else{existingWidth=-1}mapEntry=""+this.node.getId()+":"+this._hashCode+":"+existingWidth;if(_gliffy.textDimensionMap.height[mapEntry]===undefined){if(++_gliffy.textDimensionMapSize.height>5000){_gliffy.textDimensionMap.height={};_gliffy.textDimensionMapSize.height=0}this.__domRuler.appendTo("body").css({width:""}).html(this._html);if(this.hasFixedWidth()){this.__domRuler.css("width",Number(existingWidth)+"px")}else{this.__domRuler.css("width","")}height=this.__domRuler.height();this.__domRuler.css("width","").remove();_gliffy.textDimensionMap.height[mapEntry]=height}return _gliffy.textDimensionMap.height[mapEntry]},getCalculatedHeight:function(){return this.calculateHeight()},getCalculatedWidth:function(){return this.calculateWidth()},setupDefaults:function(textDefaults){var spanStyle="",pStyle="",css={},valid,newHTML,key;valid=textDefaults&&textDefaults.length!==0;if(valid){this.fromObject(textDefaults[0]);if(textDefaults[0].html!==undefined&&textDefaults[0].html!==null){this.setHTML(textDefaults[0].html,true)}}if(valid&&textDefaults[0].bold===true){css["font-weight"]="bold"}if(valid&&textDefaults[0].italic===true){css["font-style"]="italic"}if(valid&&textDefaults[0].underline===true){css["text-decoration"]="underline"}if(valid&&textDefaults[0].face){css["font-family"]=textDefaults[0].face}else{css["font-family"]="Arial"}if(valid&&textDefaults[0].size){css["font-size"]=textDefaults[0].size+"px"}else{css["font-size"]="12px"}if(valid&&textDefaults[0].color){css.color=textDefaults[0].color}for(key in css){if(css.hasOwnProperty(key)){spanStyle+=key+":"+css[key]+";"}}if(valid&&textDefaults[0].align){pStyle+="text-align: "+textDefaults[0].align+"; "}newHTML=this.getHTML()&&this.getHTML().length!==0?this.getHTML():'<span class="gliffy-placeholder-text"><br></span>';newHTML='<p style="'+pStyle+'"><span style="'+spanStyle+'">'+newHTML+"</span></p>";this.setHTML(newHTML)},__textHandler:function(){var padding=2,height,width,linePoint,parent,hasMultipartParent=this.node.isPartOfMultipartShape();if(this.node.hasRedrawCanvasFlag()||this.__calculatedWidth===null||this.__calculatedHeight===null){this.__calculatedWidth=this.calculateWidth();this.__calculatedHeight=this.calculateHeight();parent=this.node.getUidNode();if(hasMultipartParent){this.node.setHeight(this.__calculatedHeight+this.getPaddingTop()+this.getPaddingBottom());this.node.setWidth(this.__calculatedWidth+this.getPaddingLeft()+this.getPaddingRight())}else{if((parent&&parent.isLine())||!this.hasFixedWidth()){this.node.setHeight(this.__calculatedHeight);this.node.setWidth(this.__calculatedWidth)}else{if(this.node.parent&&!this.node.parent.isGroup()){this.node.setHeight(this.__calculatedHeight)}else{if(this.node.getHeight()<this.__calculatedHeight){this.node.setHeight(this.__calculatedHeight)}}}}}if(this.node.isStandAloneText()||!this.node.parent){height=this.node.getHeight();width=this.node.getWidth()}else{height=this.node.parent.getHeight();width=this.node.parent.getWidth()}this.style.width=this.node.getWidth();this.style.height=this.node.getHeight();if(this.getOverflow()===OVERFLOW.none){this.style.width=this.node.getWidth()-this.getPaddingLeft()-this.getPaddingRight()}else{if(hasMultipartParent){this.style.height=this.node.getHeight()-this.getPaddingTop()-this.getPaddingBottom()}}this.style.x=this.getPaddingLeft();if(this.getValign()===VALIGN.top){this.style.y=this.getPaddingTop()}else{if(this.getValign()===VALIGN.middle){if(hasMultipartParent){this.style.y=(height-this.style.height)/2-this.getPaddingBottom()}else{this.style.y=(height-this.style.height)/2}}}if(this.getOverflow()===OVERFLOW.both){this.style.x=width/2-this.style.width/2-3}if(this.getVPosition()===VPOSITION.below){this.style.y=padding+height}else{if(this.getVPosition()===VPOSITION.above){this.style.y=-padding-this.style.height}}if(this.getHPosition()===HPOSITION.right){this.style.x+=padding+width}if(this.node.parent&&this.node.parent.isLine()){if(this.node.stage){this.style.text_background_fill=this.node.stage.background}linePoint=this.node.parent.getGraphic().getPointAt(0.5);this.style.x=linePoint.x-this.style.width/2;this.style.y=linePoint.y-this.style.height/2}},getLines:function(){return this._lines},setLines:function(lines){this._lines=lines;this.markDirty()},getValign:function(){return this._valign},setValign:function(valign){this._valign=valign;this.markDirty()},getOverflow:function(){return this._overflow},setOverflow:function(overflow){this._overflow=overflow;this.markDirty()},hasFixedWidth:function(){return !(this.getOverflow()===OVERFLOW.left||this.getOverflow()===OVERFLOW.right||this.getOverflow()===OVERFLOW.both)},getVPosition:function(){return this._vposition},setVPosition:function(vposition){this._vposition=vposition;this.markDirty()},__adjustHeightsAndColor:function(html){var textNode=$("<div/>").append($(html)),spans=textNode.find("span"),color,isBlack,renderedColor;spans.each(function(index){var span=$(this),font=span.css("font-family"),weight=span.css("font-weight"),size=parseFloat(span.css("font-size").replace("px","")),height,needsLineHeight=false;if(span[0].childNodes.length===0){needsLineHeight=true}for(var i=0;i<span[0].childNodes.length;i++){if(span[0].childNodes[i].nodeType===3||span[0].childNodes[i].tagName.toLowerCase()==="a"){needsLineHeight=true;break}}if(needsLineHeight){font=_gliffy.Utils.getRenderedStyle(span,"font-family");weight=_gliffy.Utils.getRenderedStyle(span,"font-weight");size=parseFloat(_gliffy.Utils.getRenderedStyle(span,"font-size").replace("px",""));font=font===""?"Arial":font;switch(weight){case"bold":case"700":weight="bold";break;case"":case"normal":case"400":weight="normal";break;default:weight="normal"}if(_gliffy.TextUtils.FONT_FIXES[font]===undefined){font="Arial"}if(_gliffy.TextUtils.FONT_FIXES[font][weight]===undefined){weight="normal"}if(isNaN(size)||_gliffy.TextUtils.FONT_FIXES[font][weight][size]===undefined){size=12}height=size+_gliffy.TextUtils.FONT_FIXES[font][weight][size];$(this).css("line-height",height+"px")}else{$(this).css("line-height","")}if(!_gliffy.Utils.hasNonWhitespaceCharacter(span[0].textContent)){$(this).css("text-decoration","none")}isBlack=function(color){return color==="rgb(0, 0, 0)"||color==="black"||color==="#000000"||color==="#000"||color==="rgb(0,0,0)"};color=$(this).css("color");if(isBlack(color)){$(this).css("color","");renderedColor=_gliffy.Utils.getRenderedStyle($(this),"color");if(!isBlack(renderedColor)){$(this).css("color",color)}}});return textNode.html()},__validateAndFix:function(html){var $html=$("<div>"+html+"</div>");$html.contents().each(function(){if(this.nodeType===3&&_gliffy.Utils.hasNonWhitespaceCharacter(this.textContent)){$(this).wrap("<p />")}});$html.contents().each(function(){var $p=$(this);if($p.is("p")){if($p.attr("style")===null||$p.attr("style")===undefined||$p.attr("style").toLowerCase().indexOf("text-align")<0){$p.css("text-align","center")}$p.contents().each(function(){if(this.nodeType===3){$(this).wrap("<span />")}})}});$html.find("a").each(function(){var $this=$(this),spans;if($this.attr("target")===undefined||$this.attr("target")===null){$this.attr("target","_blank")}spans=$this.find("span");if(spans.length>0){$this.css({textDecoration:"none"});spans.css({textDecoration:"underline"})}});return $html.html()},setHTML:function(html,raw){if(raw!==true){html=this.__validateAndFix(html);html=this.__adjustHeightsAndColor(html)}this._html=html;this._hashCode=_gliffy.Utils.hashCode(this._html);if(this.node){this.node.setFlag("bounds")}this.markDirty()},getHTML:function(){return this._html||""},getHPosition:function(){return this._hposition},setHPosition:function(hposition){this._hposition=hposition;this.markDirty()},getTid:function(){return TID},getClassName:function(){return"Text"},isComputePositioning:function(){return this.__computePositioning},positionComputed:function(){this.__computePositioning=false},isStandalone:function(){return this.node&&this.node.isStandAloneText()},hasLineParent:function(){return this.hasParentOfType(_gliffy.Line)},setPaddingLeft:function(paddingLeft){this.__padding_left=paddingLeft},setPaddingRight:function(paddingRight){this.__padding_right=paddingRight},setPaddingTop:function(paddingTop){this.__padding_top=paddingTop},setPaddingBottom:function(paddingBottom){this.__padding_bottom=paddingBottom},getPaddingLeft:function(){return this.__padding_left},getPaddingRight:function(){return this.__padding_right},getPaddingTop:function(){return this.__padding_top},getPaddingBottom:function(){return this.__padding_bottom},__toObject:function(){return{tid:this.getTid(),valign:this.getValign(),overflow:this.getOverflow(),vposition:this.getVPosition(),hposition:this.getHPosition(),html:this.getHTML(),paddingLeft:this.getPaddingLeft(),paddingRight:this.getPaddingRight(),paddingBottom:this.getPaddingBottom(),paddingTop:this.getPaddingTop()}},__fromObject:function(object){if(object.valign!==undefined&&object.valign!==null){this.setValign(object.valign)}if(object.overflow!==undefined&&object.overflow!==null){this.setOverflow(object.overflow)}if(object.vposition!==undefined&&object.vposition!==null){this.setVPosition(object.vposition)}if(object.hposition!==undefined&&object.hposition!==null){this.setHPosition(object.hposition)}if(object.html!==undefined&&object.html!==null){this.setHTML(object.html)}if(object.paddingLeft!==undefined&&object.paddingLeft!==null){this.setPaddingLeft(object.paddingLeft)}if(object.paddingRight!==undefined&&object.paddingRight!==null){this.setPaddingRight(object.paddingRight)}if(object.paddingBottom!==undefined&&object.paddingBottom!==null){this.setPaddingBottom(object.paddingBottom)}if(object.paddingTop!==undefined&&object.paddingTop!==null){this.setPaddingTop(object.paddingTop)}this.__computePositioning=true;return this}})}());(function(){var DEFAULT_STYLE={gradient_x1:"0%",gradient_x2:"0%",gradient_y1:"100%",gradient_y2:"-50%",stop_color_2:"#FFFFFF",zoom:1,stroke_linejoin:"miter",rx:10,ry:10};_gliffy.Shape=_gliffy.AbstractGeometry.extend({_tid:null,_fillColor:"#aaaaaa",_gradient:false,_opacity:1,style:null,node:null,svg:null,_dirty:true,_state:0,init:function(){this.style=$.extend({},DEFAULT_STYLE)},setTid:function(tid){this._tid=tid;this.style=$.extend({},DEFAULT_STYLE);this.markDirty()},getTid:function(){return this._tid},setFillColor:function(fillColor){this._fillColor=fillColor;if(this._fillColor==="none"){this._gradient=false}this.markDirty()},getFillColor:function(){return this._fillColor},setGradient:function(gradient){this._gradient=this._fillColor!=="none"&&gradient;this.markDirty()},isGradient:function(){return this._gradient},setOpacity:function(opacity){this._opacity=opacity;this.markDirty()},getOpacity:function(){return this._opacity},getState:function(){return this._state},setState:function(s){this._state=s;this.markDirty()},update:function(){var width=0,height=0,i=0,states;if(this._dirty){if(this.node){this.style.width=this.node.getWidth();this.style.height=this.node.getHeight()}this.style.opacity=this.getOpacity();this.style.stroke=this._strokeColor;this.style.gradient=this._gradient;if(this._fillColor!=="none"&&this.style.gradient){this.style.stop_multiply_color_2=_gliffy.ColorUtils.multiply(this._fillColor,"#AAAAAA")}this.style.fill=this._fillColor;this.style.stop_color_1=this._fillColor;this.style.center_x=width/2;this.style.center_y=height/2;if(this.node){states=this.node.getShapeInformation().states;if(states){for(i=0;i<states;i++){this.style["state"+i]=false}this.style["state"+this._state]=true}else{if(this._state===1){this.style.state0=false;this.style.state1=true}}}this.calculateStrokeOffset();this._dirty=false;return true}return false},getClassName:function(){return"Shape"},calculateGradientCoordinates:function(){var coords,width,height,rotation;if(this.node){width=this.node.getWidth();height=this.node.getHeight();rotation=this.node.getRotation()%360;if(rotation>135&&rotation<=225){coords={x1:"50%",y1:"150%",x2:"50%",y2:"0%"}}else{if(rotation>45&&rotation<=135){coords={x1:"-50%",y1:"50%",x2:"100%",y2:"50%"}}else{if(rotation>225&&rotation<=315){coords={x1:"150%",y1:"50%",x2:"0%",y2:"50%"}}else{coords={x1:"50%",y1:"-50%",x2:"50%",y2:"100%"}}}}}return coords},calculateStrokeOffset:function(){var width,height,maxMiter,shadow_offset;if(this.node){width=this.node?this.node.getWidth():0;height=this.node?this.node.getHeight():0;this.style.stroke_width=this.getStrokeWidth();maxMiter=this.maxMiterLength();this.style.graphic_width=width+maxMiter+2+this.style.stroke_width;this.style.graphic_height=height+maxMiter+2+this.style.stroke_width;shadow_offset=this.calculateShadowOffset();this.style.shadow_x=shadow_offset.x;this.style.shadow_y=shadow_offset.y;this.style.graphic_width=this.style.shadow?Math.abs(this.style.shadow_x)+this.style.graphic_width:this.style.graphic_width;this.style.graphic_height=this.style.shadow?Math.abs(this.style.shadow_y)+this.style.graphic_height:this.style.graphic_height;this.style.graphic_x_offset=maxMiter/2+-1*Math.min(shadow_offset.x,0);this.style.graphic_y_offset=maxMiter/2+-1*Math.min(shadow_offset.y,0);this.style.line_offset_x=0;this.style.line_offset_y=0;this.style.stroke_offset=this.style.stroke_width/2;if(_gliffy.shapeLibrary&&_gliffy.shapeLibrary.custom_function[this.getTid()]){_gliffy.shapeLibrary.custom_function[this.getTid()](this.style)}this.style.offset_x=this.style.graphic_x_offset+this.style.stroke_offset;this.style.offset_y=this.style.graphic_y_offset+this.style.stroke_offset}},maxMiterLength:function(){var defaultCanvasMiterLimit=10;return defaultCanvasMiterLimit*this.style.stroke_width},__toObject:function(){return{tid:this.getTid(),strokeWidth:this.getStrokeWidth(),strokeColor:this.getStrokeColor(),fillColor:this.getFillColor(),gradient:this.isGradient(),dropShadow:this.isDropShadow(),state:this._state,shadowX:this.getShadowX(),shadowY:this.getShadowY(),opacity:this.getOpacity()}},applyStyle:function(style){var shadowSize;this.setGradient(style.gradient);this.setDropShadow(style.shadow);this.setFillColor(style.fill);if(style.strokeWidth!==undefined&&style.strokeWidth!==null&&style.strokeWidth!=="null"){this.setStrokeWidth(style.strokeWidth)}if(style.stroke){this.setStrokeColor(style.stroke)}},__fromObject:function(object){if(object.tid!==undefined){this.setTid(object.tid)}if(object.strokeWidth!==undefined){this.setStrokeWidth(object.strokeWidth)}if(object.strokeColor!==undefined){this.setStrokeColor(object.strokeColor)}if(object.fillColor!==undefined){this.setFillColor(object.fillColor)}if(object.gradient!==undefined){this.setGradient(object.gradient)}if(object.dropShadow!==undefined){this.setDropShadow(object.dropShadow)}if(object.shadowX!==undefined){this.setShadowX(object.shadowX)}if(object.shadowY!==undefined){this.setShadowY(object.shadowY)}if(object.opacity!==undefined){this.setOpacity(object.opacity)}if(object.state!==undefined){this._state=object.state}return this}})}());(function(){var DEFAULT_STYLE={zoom:1,stroke_linejoin:"miter"},TID="com.gliffy.stencil.custom.svg.static";_gliffy.Svg=_gliffy.AbstractGeometry.extend({_url:null,style:null,node:null,embeddedResourceId:null,_dirty:true,init:function(node){this.node=node;this.style=$.extend({},DEFAULT_STYLE)},markDirty:function(){this._dirty=true;if(this.node){this.node.markDirty()}},getTid:function(){return TID},getEmbeddedResourceId:function(){return this.embeddedResourceId},setEmbeddedResourceId:function(id){this.embeddedResourceId=id;this.markDirty();if(this.node){this.node.setFlag("skin")}},setShadowX:function(shadowX){this._shadowX=shadowX;this.markDirty()},getShadowX:function(){return this._shadowX},setShadowY:function(shadowY){this._shadowY=shadowY;this.markDirty()},getShadowY:function(){return this._shadowY},update:function(){if(this._dirty){var width=0,height=0,shadow_offset,maxMiter;if(this.node){width=this.node.getWidth();height=this.node.getHeight();this.style.width=width;this.style.height=height}this.style.center_x=width/2;this.style.center_y=height/2;this.style.graphic_width=(this.node)?this.node.getWidth():0;this.style.graphic_height=(this.node)?this.node.getHeight():0;this.style.stroke_width=10;maxMiter=this.maxMiterLength();this.style.graphic_width=width+maxMiter+2+this.style.stroke_width;this.style.graphic_height=height+maxMiter+2+this.style.stroke_width;shadow_offset=this.calculateShadowOffset();this.style.shadow_x=shadow_offset.x;this.style.shadow_y=shadow_offset.y;this.style.graphic_width=this.style.shadow?Math.abs(this.style.shadow_x)+this.style.graphic_width:this.style.graphic_width;this.style.graphic_height=this.style.shadow?Math.abs(this.style.shadow_y)+this.style.graphic_height:this.style.graphic_height;this.style.graphic_x_offset=maxMiter/2+-1*Math.min(shadow_offset.x,0);this.style.graphic_y_offset=maxMiter/2+-1*Math.min(shadow_offset.y,0);this.style.line_offset_x=0;this.style.line_offset_y=0;this.style.stroke_offset=this.style.stroke_width/2;this.style.offset_x=this.style.graphic_x_offset+this.style.stroke_offset;this.style.offset_y=this.style.graphic_y_offset+this.style.stroke_offset;this._dirty=false;return true}return false},maxMiterLength:function(){var defaultCanvasMiterLimit=10;return defaultCanvasMiterLimit*this.style.stroke_width},getClassName:function(){return"Svg"},__toObject:function(){return{embeddedResourceId:this.getEmbeddedResourceId(),strokeWidth:this.getStrokeWidth(),strokeColor:this.getStrokeColor(),dropShadow:this.isDropShadow(),shadowX:this.getShadowX(),shadowY:this.getShadowY()}},__fromObject:function(object){if(object.embeddedResourceId!==undefined){this.setEmbeddedResourceId(object.embeddedResourceId)}if(object.strokeWidth!==undefined){this.setStrokeWidth(object.strokeWidth)}if(object.strokeColor!==undefined){this.setStrokeColor(object.strokeColor)}if(object.dropShadow!==undefined){this.setDropShadow(object.dropShadow)}if(object.shadowX!==undefined){this.setShadowX(object.shadowX)}if(object.shadowY!==undefined){this.setShadowY(object.shadowY)}}})}());(function(){var DEFAULT_STYLE={text_background:true,text_background_fill:true,start_arrow:"none",end_arrow:"none",zoom:1,stroke_dasharray:null,stroke_linejoin:"miter"},TID="path",START_MARKER="start",END_MARKER="end",ARROW_SIZE=10,INTERPOLATION_TYPE={linear:0,quadratic:1},INTERPOLATION_LOOKUP={0:"linear",1:"quadratic"};_gliffy.Line=_gliffy.Graphic.extend({_strokeWidth:2,_strokeColor:"#000000",_fillColor:"none",_fillId:null,_dashStyle:null,_startArrow:null,_endArrow:null,_pointPath:null,_drawCommands:null,_centerLinePoint:null,_startArrowRotation:"auto",_endArrowRotation:"auto",_interpolationType:INTERPOLATION_TYPE.linear,_ortho:false,_length:0,_controlPath:null,style:null,node:null,aabb:null,_dirty:true,OVERLAY_EXTEND:7,OVERLAY_DISPLAY_EXTEND:5,LINE_TYPE_STRAIGHT:"straight",LINE_TYPE_ORTHO_RIGHT_ANGLE:"ortho-right-angle",LINE_TYPE_ORTHO_ROUNDED:"ortho-rounded",LINE_TYPE_QUADRATIC_BEZIER:"quad-bezier",_overlay:false,init:function(node,start,end){this.node=node;this.style=$.extend({},DEFAULT_STYLE);this.aabb=_gliffy.BoundingBox();if(start&&end){this._controlPath=[[start.x,start.y],[end.x,end.y]]}else{this._controlPath=[[0,0],[0,0]]}this._super()},getTid:function(){return TID},setStartArrow:function(startArrow){this._startArrow=startArrow;this.markDirty()},getStartArrowTid:function(){if(this._startArrow!==0&&this._startArrow!==null&&this._startArrow!==undefined&&this._startArrow!=="none"){return"com.gliffy.stencil.marker_start.v"+this._startArrow}return null},getEndArrowTid:function(){if(this._endArrow!==0&&this._endArrow!==null&&this._endArrow!==undefined&&this._endArrow!=="none"){return"com.gliffy.stencil.marker_end.v"+this._endArrow}return null},setStartArrowRotation:function(rotation){this._startArrowRotation=rotation;this.markDirty()},getStartArrowRotation:function(){return this._startArrowRotation},setEndArrowRotation:function(rotation){this._endArrowRotation=rotation;this.markDirty()},getEndArrowRotation:function(){return this._endArrowRotation},getStartArrow:function(){if(this._startArrow==="none"||this._startArrow===null||this._startArrow===undefined){this._startArrow=0}return this._startArrow},setEndArrow:function(endArrow){this._endArrow=endArrow;this.markDirty()},getEndArrow:function(){if(this._endArrow==="none"||this._endArrow===null||this._endArrow===undefined){this._endArrow=0}return this._endArrow},setStrokeWidth:function(strokeWidth){this._strokeWidth=strokeWidth;if(strokeWidth<3){this.setFillColor(null)}if(this.node){this.node.setFlag("bounds")}this.markDirty()},getStrokeWidth:function(){return this._strokeWidth},setStrokeColor:function(strokeColor){this._strokeColor=strokeColor;this.markDirty()},getStrokeColor:function(){return this._strokeColor},setFillColor:function(fillColor){this._fillColor=fillColor;if(this._fillColor===null){this._fillColor="none"}this.markDirty()},getFillColor:function(){return this._fillColor},getStartConnectionId:function(){var constraint;if(this.node){constraint=this.node.getConstraints().getStartConstraint();if(constraint){return constraint.nodeId}else{return null}}else{return null}},getEndConnectionId:function(){var constraint;if(this.node){constraint=this.node.getConstraints().getEndConstraint();if(constraint){return constraint.nodeId}else{return null}}else{return null}},setStartConnection:function(node,ratio){var worldStartPoint;if(node){if(!ratio){worldStartPoint=this.getWorldControlPoint(0);ratio=node.worldPointToRatio(worldStartPoint.x,worldStartPoint.y)}this.node.getConstraints().add(new _gliffy.StartPositionConstraint(node,ratio.x,ratio.y))}else{this.node.getConstraints().removeStartConstraint()}this.markDirty()},getStartConnection:function(){var startConnectionId=this.getStartConnectionId(),node;if(startConnectionId!==null&&this.node&&this.node.stage){node=this.node.stage.find(startConnectionId);if(node&&node.hasConnectionIndices()){return node}}return null},getStartConnectionRatio:function(){var constraint=this.node.getConstraints().getStartConstraint();if(constraint){return constraint.getRatio()}else{return null}},setEndConnection:function(node,ratio){var worldEndPoint;if(node){if(!ratio){worldEndPoint=this.getWorldControlPoint(this.getControlPointCount()-1);ratio=node.worldPointToRatio(worldEndPoint.x,worldEndPoint.y)}this.node.getConstraints().add(new _gliffy.EndPositionConstraint(node,ratio.x,ratio.y))}else{this.node.getConstraints().removeEndConstraint()}this.markDirty()},getEndConnectionRatio:function(){var constraint=this.node.getConstraints().getEndConstraint();if(constraint){return constraint.getRatio()}else{return null}},getEndConnection:function(){var endConnectionId=this.getEndConnectionId(),node;if(endConnectionId!==null&&this.node&&this.node.stage){node=this.node.stage.find(endConnectionId);if(node&&node.hasConnectionIndices()){return node}}return null},setDashStyle:function(dashStyle){this._dashStyle=dashStyle;this.markDirty()},setOverlay:function(overlay){this._overlay=overlay;this.markDirty()},getOverlay:function(){return this._overlay},getDashStyle:function(){return this._dashStyle},__getStrokePadding:function(){return Math.ceil(this.style.stroke_width+this.OVERLAY_EXTEND)/2},update:function(){if(this._dirty){var stage=null,background="#ffffff",width=0,height=0,padding,dashes,i;if(this.editable.isEditable&&this.node){this.editable.scaleControlPath(this.node.getScaleX(),this.node.getScaleY());this.editable.computeBestPath()}this._clearArrowMarkerAttributes(START_MARKER,this.style.start_arrow);this._clearArrowMarkerAttributes(END_MARKER,this.style.end_arrow);this.style.stroke=this._strokeColor;this.style.fill=this._fillColor;this.style.stroke_width=this.getStrokeWidth();if(this._dashStyle){dashes=this._dashStyle.split(",");for(i=0;i<dashes.length;i++){dashes[i]=parseFloat(dashes[i])*this.style.stroke_width}this.style.stroke_dasharray=dashes.join(",")}else{this.style.stroke_dasharray=null}this.style.start_arrow=this._startArrow||"none";this.style.end_arrow=this._endArrow||"none";this.style.start_arrow_tid=this.getStartArrowTid();this.style.end_arrow_tid=this.getEndArrowTid();this.aabb=this.getControlPathAabb(true);this.worldAabb=this.getWorldAabb(true);if(this.node){width=this.node.getWidth();height=this.node.getHeight();if(this.node.stage){stage=this.node.stage;background=stage.background}this.style.width=width;this.style.height=height}this.style.marker_fill=(background!=="transparent"?background:"#FFFFFF");this.style.center_x=width/2;this.style.center_y=height/2;this._drawCommands=this._generateDrawCommands();this._pointPath=this._generatePointPath();this._length=_gliffy.candash.getPathDistance(this._pointPath);if(this.editable.isEditable&&this.getInterpolationType()===INTERPOLATION_TYPE.quadratic){this.setStartArrowRotation(this.getQuadraticLineAngleAtStartPoint());this.setEndArrowRotation(this.getQuadraticLineAngleAtEndPoint())}else{this.setStartArrowRotation("auto");this.setEndArrowRotation("auto")}this.calculateStrokeOffset();this._dirty=false;return true}return false},calculateStrokeOffset:function(){if(this.node&&this.node.stage){var worldAabb,dimension;this.generateArrowMarkerAttributes(START_MARKER,this.style.start_arrow);this.generateArrowMarkerAttributes(END_MARKER,this.style.end_arrow);worldAabb=this.getWorldAabb();dimension=worldAabb.getDimension();this.style.width=dimension.x;this.style.height=dimension.y;this.style.stroke_offset=0;this.style.offset_x=this.node.worldTransform.getTranslateX()-worldAabb.min.x;this.style.offset_y=this.node.worldTransform.getTranslateY()-worldAabb.min.y;this.style.pos_x=this.node.worldTransform.getTranslateX();this.style.pos_y=this.node.worldTransform.getTranslateY();this.style.graphic_width=dimension.x;this.style.graphic_height=dimension.y}},maxMiterLength:function(){var defaultCanvasMiterLimit=10;return defaultCanvasMiterLimit*this.style.stroke_width},getClassName:function(){return"Line"},_clearArrowMarkerAttributes:function(arrowPos,arrowType){if(arrowType){delete this.style["marker_"+arrowPos+"_url"];delete this.style[arrowType+"_"+arrowPos];delete this.style["marker_"+arrowPos+"_width"];delete this.style["marker_"+arrowPos+"_height"];delete this.style["marker_"+arrowPos+"_viewbox"];delete this.style["marker_"+arrowPos+"_orient"];delete this.style["marker_"+arrowPos+"_clearx"];delete this.style["marker_"+arrowPos+"_cleary"];delete this.style["marker_"+arrowPos+"_refx"];delete this.style["marker_"+arrowPos+"_refy"]}},generateArrowMarkerAttributes:function(arrowPos,arrowType){this.style["marker_"+arrowPos+"_url"]=(arrowType!=="none")?"url(#"+arrowType+"_"+arrowPos+")":"none";this.style["marker_"+arrowPos+"_orient"]=(arrowPos==="start")?this.getStartArrowRotation():this.getEndArrowRotation();this.style[arrowType+"_"+arrowPos]=true;if(arrowType!=="none"){this.style["marker_"+arrowPos+"_viewbox"]="0 0 10 10";if(arrowType===1){this.style["marker_"+arrowPos+"_width"]=(this.style.stroke_width===1?20:10);this.style["marker_"+arrowPos+"_height"]=(this.style.stroke_width===1?20:10)}else{if(arrowType===2||arrowType===3){var w=22-4*this.style.stroke_width;var h=22-4*this.style.stroke_width;this.style["marker_"+arrowPos+"_width"]=Math.max(10,w);this.style["marker_"+arrowPos+"_height"]=Math.max(10,h)}else{if(arrowType===17){if(this.style.stroke_width<4){var w=30-5*this.style.stroke_width;var h=30-5*this.style.stroke_width;this.style["marker_"+arrowPos+"_width"]=Math.max(10,w);this.style["marker_"+arrowPos+"_height"]=Math.max(10,h)}else{this.style["marker_"+arrowPos+"_width"]=10+(10-this.style.stroke_width);this.style["marker_"+arrowPos+"_height"]=10+(10-this.style.stroke_width)}}else{this.style.marker_strokewidth=this.style.stroke_width;if(this.style.stroke_width===1){this.style.marker_viewbox_width=20;this.style.marker_viewbox_height=20;this.style["marker_"+arrowPos+"_width"]=20;this.style["marker_"+arrowPos+"_height"]=20;this.style.marker_start_refx=-1;this.style.marker_end_refx=15}else{this.style["marker_"+arrowPos+"_width"]=(this.style.stroke_width*10);this.style["marker_"+arrowPos+"_height"]=(this.style.stroke_width*10);this.style.marker_viewbox_width=(this.style.stroke_width*10);this.style.marker_viewbox_height=(this.style.stroke_width*10);this.style.marker_start_refx=-1*this.style.stroke_width;this.style.marker_end_refx=14+this.style.stroke_width}}}}if(arrowPos==="start"){if(arrowType===1){this.style.marker_start_cleary=3;this.style.marker_start_clearx=-2}else{if(arrowType===2){this.style.marker_start_cleary=4;this.style.marker_start_clearx=-2}else{if(arrowType===3){this.style.marker_start_cleary=4;this.style.marker_start_clearx=-2}else{if(arrowType===4){this.style.marker_start_cleary=5;this.style.marker_start_clearx=-12}else{if(arrowType===5){this.style.marker_start_cleary=5;this.style.marker_start_clearx=-12}else{if(arrowType===6){this.style.marker_start_cleary=5;this.style.marker_start_clearx=-12}else{if(arrowType===7){this.style.marker_start_cleary=4;this.style.marker_start_clearx=-10}else{if(arrowType===8){this.style.marker_start_cleary=0;this.style.marker_start_clearx=-10}else{if(arrowType===15){this.style.marker_start_cleary=1;this.style.marker_start_clearx=-12}else{if(arrowType===17){this.style.marker_start_cleary=0;this.style.marker_start_clearx=0}}}}}}}}}}}else{if(arrowType===1){this.style.marker_end_cleary=3;this.style.marker_end_clearx=9}else{if(arrowType===2){this.style.marker_end_cleary=4;this.style.marker_end_clearx=7}else{if(arrowType===3){this.style.marker_end_cleary=4;this.style.marker_end_clearx=7}else{if(arrowType===4){this.style.marker_end_cleary=5;this.style.marker_end_clearx=12}else{if(arrowType===5){this.style.marker_end_cleary=5;this.style.marker_end_clearx=12}else{if(arrowType===6){this.style.marker_end_cleary=5;this.style.marker_end_clearx=12}else{if(arrowType===7){this.style.marker_end_cleary=4;this.style.marker_end_clearx=10}else{if(arrowType===8){this.style.marker_end_cleary=0;if(this.style.stroke_width>3){this.style.marker_end_clearx=16}else{this.style.marker_end_clearx=13}}else{if(arrowType===15){this.style.marker_end_cleary=1;this.style.marker_end_clearx=15}else{if(arrowType===17){this.style.marker_end_cleary=0;this.style.marker_end_clearx=2}}}}}}}}}}}}},getControlPathAabb:function(excludeArrows){var boundingBox=_gliffy.BoundingBox.SMALLEST.clone(),controlPath=this.getControlPath(),strokePadding=this.__getStrokePadding(),i;for(i=0;i<controlPath.length;i++){boundingBox.grow(controlPath[i][0],controlPath[i][1])}boundingBox.extend(strokePadding);if(excludeArrows!==true){boundingBox.add(this.getStartArrowAabb());boundingBox.add(this.getEndArrowAabb())}return boundingBox},getWorldAabb:function(excludeArrows){var boundingBox=_gliffy.BoundingBox.SMALLEST.clone(),worldControlPath=this.getWorldControlPath(),i,strokePadding=this.__getStrokePadding();for(i=0;i<worldControlPath.length;i++){boundingBox.grow(worldControlPath[i][0],worldControlPath[i][1])}boundingBox.extend(strokePadding);if(excludeArrows!==true){boundingBox.add(this.getStartArrowWorldAabb());boundingBox.add(this.getEndArrowWorldAabb())}return boundingBox},getStartArrowWorldAabb:function(){var startPoint=this.getWorldControlPoint(0);if(this.style.start_arrow!=="none"){return this.__getArrowWorldAabb(startPoint)}else{return new _gliffy.BoundingBox(startPoint.x,startPoint.y,startPoint.x,startPoint.y)}},getEndArrowWorldAabb:function(){var endPoint=this.getWorldControlPoint(this.getControlPointCount()-1);if(this.style.end_arrow!=="none"){return this.__getArrowWorldAabb(endPoint)}else{return new _gliffy.BoundingBox(endPoint.x,endPoint.y,endPoint.x,endPoint.y)}},__getArrowWorldAabb:function(point){var boundingBox=new _gliffy.BoundingBox(point.x,point.y,point.x,point.y);boundingBox.extend(ARROW_SIZE+this.maxMiterLength());return boundingBox},getStartArrowAabb:function(){var startPoint=this.getControlPoint(0);if(this.style.start_arrow!=="none"){return this.__getArrowAabb(startPoint)}else{return new _gliffy.BoundingBox(startPoint.x,startPoint.y,startPoint.x,startPoint.y)}},getEndArrowAabb:function(){var endPoint=this.getControlPoint(this.getControlPointCount()-1);if(this.style.end_arrow!=="none"){return this.__getArrowAabb(endPoint)}else{return new _gliffy.BoundingBox(endPoint.x,endPoint.y,endPoint.x,endPoint.y)}},__getArrowAabb:function(point){var boundingBox=new _gliffy.BoundingBox(point.x,point.y,point.x,point.y);boundingBox.extend(ARROW_SIZE+this.maxMiterLength());return boundingBox},getControlPoint:function(index){return new _gliffy.Vec2(this._controlPath[index][0],this._controlPath[index][1])},getWorldControlPoint:function(index){var local=this.getControlPoint(index);if(this.node){return this.node.worldTransform.transformPoint(local.x,local.y)}},setControlPoint:function(index,point){if(this._controlPath){this._controlPath[index][0]=point.x;this._controlPath[index][1]=point.y}this.markDirty()},setWorldControlPoint:function(index,worldPoint){var local;if(this.node){local=this.node.worldTransform.createInverse().transformPoint(worldPoint.x,worldPoint.y)}else{local=worldPoint}this.setControlPoint(index,local)},getWorldControlPath:function(){if(this.node){return this.transformPath(this._controlPath,this.node.worldTransform)}else{return this.getControlPath()}},setWorldControlPath:function(worldControlPath){this.setControlPath(this.transformPath(worldControlPath,this.node.worldTransform.createInverse()))},getControlPath:function(){var path=[],i;for(i=0;i<this._controlPath.length;i++){path.push([this._controlPath[i][0],this._controlPath[i][1]])}return path},setControlPath:function(path){if(path){this._controlPath=path}else{this._controlPath=[[0,0],[0,0]]}},getControlPointCount:function(){return this._controlPath.length},getSegmentCount:function(){return this.getControlPointCount()-1},isSegmentHorizontal:function(index){return _gliffy.Utils.isHorizontal(this.getWorldControlPoint(index),this.getWorldControlPoint(index+1))},isLinearLine:function(){var i,numSegments=this.getSegmentCount(),horizontalCount=0,verticalCount=0;for(i=0;i<numSegments;i++){if(this.isSegmentHorizontal(i)){horizontalCount++}else{verticalCount++}}return((horizontalCount===numSegments)||(verticalCount===numSegments))},getNormalizedSegmentAngle:function(p1,p2){var x=0,y=1,dx=p2[x]-p1[x],dy=p2[y]-p1[y],rot=Math.atan(dy/dx)*180/Math.PI;if(p1[x]>p2[x]&&p1[y]<p2[y]){rot=180+rot}else{if(p2[x]<p1[x]&&p2[y]<=p1[y]){rot=180+rot}else{if(p2[x]>=p1[x]&&p2[y]<p1[y]){rot=360+rot}}}return rot},transformPath:function(path,transform){var i,controlPoint,result=[];for(i=0;i<path.length;i++){controlPoint=path[i];controlPoint=transform.transformPoint(controlPoint[0],controlPoint[1]);result.push([controlPoint.x,controlPoint.y])}return result},isOrtho:function(){return this._ortho},setOrtho:function(ortho){this._ortho=ortho;this.markDirty()},getInterpolationType:function(){return this._interpolationType},setInterpolationType:function(interpolationType){this._interpolationType=interpolationType;this.markDirty()},getCornerRadius:function(){return this._cornerRadius},setCornerRadius:function(cornerRadius){this._cornerRadius=cornerRadius;this.markDirty()},getPointAt:function(ratio){var linePoint;linePoint=_gliffy.candash.getPointInPathAtT(this._pointPath,ratio);linePoint=this.node.worldTransform.createInverse().transformPoint(linePoint.x,linePoint.y);return linePoint},getPathLength:function(){return this._length},getPointInPathAtDistance:function(distance){return _gliffy.candash.getPointInPathAtDistance(this._pointPath,distance,this._length)},getPointPath:function(){return this._pointPath},getDrawCommands:function(){return this._drawCommands},getQuadraticLineAngleAtStartPoint:function(){var a,b,c,angle,point=this.getPointInPathAtDistance(10);a=point.y-this._pointPath[0][0].y;b=point.x-this._pointPath[0][0].x;return this.__normalizeIncidenceAngle(Math.atan(a/b)*180/Math.PI,this.editable.getMagnitudeAndAxis("start"))},getQuadraticLineAngleAtEndPoint:function(){var a,b,c,angle,point=this.getPointInPathAtDistance(this.getPathLength().totalDistance-10);a=point.y-this._pointPath[this._pointPath.length-1][this._pointPath[this._pointPath.length-1].length-1].y;b=point.x-this._pointPath[this._pointPath.length-1][this._pointPath[this._pointPath.length-1].length-1].x;return this.__normalizeIncidenceAngle(Math.atan(a/b)*180/Math.PI,this.editable.getMagnitudeAndAxis("end"))},__normalizeIncidenceAngle:function(angle,magAxis){if(magAxis.axis==="y"){if(magAxis.mag===1&&angle<0){angle=angle+180}else{if(magAxis.mag===-1&&angle>0){angle=angle-180}}}else{if(magAxis.mag===-1&&magAxis.axis==="x"){angle=angle+180}}return angle},applyStyle:function(style){if(style.strokeWidth){this.setStrokeWidth(style.strokeWidth)}if(style.stroke){this.setStrokeColor(style.stroke)}this.setStartArrow(style.startArrow);this.setEndArrow(style.endArrow);if(!this._ortho){this.editable.setOrthoMode(_gliffy.Editor.ORTHO_MODE.straight)}else{if(style.orthoMode!==undefined&&style.orthoMode!==null){this.editable.setOrthoMode(style.orthoMode)}}if(style.fill&&this._strokeWidth>2){this.setFillColor(style.fill)}else{this.setFillColor(null)}if(style.dashStyle){this.setDashStyle(style.dashStyle)}},_generatePointPath:function(){var i,aPath=this._drawCommands,path=[];if(aPath===null||aPath===undefined){throw new Error("path is null")}for(i=0;i<aPath.length;i++){switch(aPath[i].name){case"M":var point=aPath[i].args.split(",");path.push([{x:parseFloat(point[0]),y:parseFloat(point[1])}]);break;case"L":var lastPoint=path[path.length-1][path[path.length-1].length-1];var point=aPath[i].args.split(",");path.push([lastPoint,{x:parseFloat(point[0]),y:parseFloat(point[1])}]);break;case"C":case"Q":var lastPoint=path[path.length-1][path[path.length-1].length-1];var currPath=[lastPoint];var points=aPath[i].args.split(" ");for(var j=0;j<points.length;j++){var p=points[j].split(",");currPath.push({x:parseFloat(p[0]),y:parseFloat(p[1])})}path.push(currPath);break;default:throw"We don't currently support "+aPath[i].name+" please add an implementation to candash.js"}}path.splice(0,1);return path},_generateDrawCommands:function(){if(this._controlPath.length>2&&this.getInterpolationType()===INTERPOLATION_TYPE.quadratic){return this._generateQuadratic(this.getWorldControlPath(),this.getCornerRadius())}else{return this._generateStraight(this.getWorldControlPath(),this.getCornerRadius())}},_generateStraight:function(controlPath,cornerRadius){var i,path=[],cur,next,offset0,offset0Mag,l,q1,q1Mag,prev;if(cornerRadius===null||cornerRadius===0||controlPath.length<3){for(i=0;i<controlPath.length;i++){path.push({name:(i===0?"M":"L"),args:this._controlPointToString(controlPath[i])})}}else{path.push({name:"M",args:this._controlPointToString(controlPath[0])});for(i=1;i<controlPath.length-1;i++){cur=new _gliffy.Vec2(controlPath[i][0],controlPath[i][1]);prev=new _gliffy.Vec2(controlPath[i-1][0],controlPath[i-1][1]);next=new _gliffy.Vec2(controlPath[i+1][0],controlPath[i+1][1]);offset0=cur.clone().subtract(prev);offset0Mag=offset0.magnitude();if(offset0Mag>cornerRadius*2){offset0.normalize().scale(cornerRadius)}else{offset0.safeNormalize().scale(offset0Mag/2)}l=cur.clone().subtract(offset0);q1=next.clone().subtract(cur);q1Mag=q1.magnitude();if(q1Mag>=cornerRadius*2){q1.normalize().scale(cornerRadius)}else{q1.safeNormalize().scale(q1Mag/2)}q1.add(cur);path.push({name:("L"),args:this._vec2ToString(l)});path.push({name:("Q"),args:this._vec2ToString(cur)+" "+this._vec2ToString(q1)})}path.push({name:"L",args:this._controlPointToString(controlPath[controlPath.length-1])})}return path},_generateQuadratic:function(controlPath,cornerRadius){if(controlPath.length<3){throw new Error("curved lines must have at least 3 points")}var len=controlPath.length,midPath,i,path;midPath=[controlPath[0]];for(i=1;i<len-2;i++){midPath.push(controlPath[i]);midPath.push([(controlPath[i][0]+controlPath[i+1][0])/2,(controlPath[i][1]+controlPath[i+1][1])/2])}midPath.push(controlPath[len-2]);midPath.push(controlPath[len-1]);path=[];path.push({name:"M",args:this._controlPointToString(midPath[0])});for(i=1;i<midPath.length-1;i+=2){path.push({name:"Q",args:this._controlPointToString(midPath[i])+" "+this._controlPointToString(midPath[i+1])})}return path},_controlPointToString:function(controlPoint){return(controlPoint[0])+","+(controlPoint[1])},_vec2ToString:function(vec2,offset){return(vec2.x)+","+(vec2.y)},__toObject:function(){this.update();return $.extend({strokeWidth:this.getStrokeWidth(),strokeColor:this.getStrokeColor(),fillColor:this.getFillColor(),dashStyle:this.getDashStyle(),startArrow:this.getStartArrow(),endArrow:this.getEndArrow(),startArrowRotation:this.getStartArrowRotation(),endArrowRotation:this.getEndArrowRotation(),ortho:this._ortho,interpolationType:INTERPOLATION_LOOKUP[this._interpolationType],cornerRadius:this._cornerRadius,controlPath:this._controlPath},this.editable.toObject())},__fromObject:function(object){if(object.strokeWidth!==undefined){this.setStrokeWidth(object.strokeWidth)}if(object.strokeColor!==undefined){this.setStrokeColor(object.strokeColor)}if(object.dashStyle!==undefined){this.setDashStyle(object.dashStyle)}if(object.startArrow!==undefined){this.setStartArrow(object.startArrow)}if(object.endArrow!==undefined){this.setEndArrow(object.endArrow)}if(object.startArrowRotation!==undefined){this.setStartArrowRotation(object.startArrowRotation)}if(object.endArrowRotation!==undefined){this.setEndArrowRotation(object.endArrowRotation)}if(object.fillColor!==undefined){this.setFillColor(object.fillColor)}if(object.interpolationType!==undefined){this._interpolationType=INTERPOLATION_TYPE[object.interpolationType]||INTERPOLATION_TYPE.linear}if(object.cornerRadius!==undefined){this._cornerRadius=object.cornerRadius}if(object.ortho!==undefined){this._ortho=object.ortho}if(object.controlPath!==undefined){this._controlPath=object.controlPath}if(this.editable.isEditable){this.editable.fromObject(object)}return this}});_gliffy.Line.INTERPOLATION_TYPE=INTERPOLATION_TYPE}());(function(){var DEFAULT_STYLE={zoom:1,stroke_linejoin:"miter"},TID="com.gliffy.shapes.image",CONNECTION_PT_PATTERN=["Midpoint","Octagon","Center"];_gliffy.Image=_gliffy.AbstractGeometry.extend({_url:null,style:null,node:null,svg:null,imgWidth:null,imgHeight:null,useOriginalDimensions:false,_dirty:true,init:function(node){this.node=node;this.style=$.extend({},DEFAULT_STYLE)},markDirty:function(){this._dirty=true;if(this.node){this.node.markDirty()}},setImgWidth:function(width){this.imgWidth=width},getImgWidth:function(){return this.imgWidth},setImgHeight:function(height){this.imgHeight=height},getImgHeight:function(){return this.imgHeight},resizeToOriginalDimensions:function(){this.useOriginalDimensions=true;this.markDirty();if(this.node){this.node.setFlag("skin")}},getTid:function(){return TID},setUrl:function(url){this._url=url;this.markDirty();if(this.node){this.node.setFlag("skin")}},getUrl:function(){return this._url},setShadowX:function(shadowX){this._shadowX=shadowX;this.markDirty()},getShadowX:function(){return this._shadowX},setShadowY:function(shadowY){this._shadowY=shadowY;this.markDirty()},getShadowY:function(){return this._shadowY},update:function(){if(this._dirty){var stage=null,width=0,height=0,shadow_offset;if(this.node){stage=this.node.stage;width=this.node.getWidth();height=this.node.getHeight();this.style.width=width;this.style.height=height}this.style.center_x=width/2;this.style.center_y=height/2;this.style.graphic_width=(this.node)?this.node.getWidth():0;this.style.graphic_height=(this.node)?this.node.getHeight():0;shadow_offset=this.calculateShadowOffset();this.style.shadow_x=shadow_offset.x;this.style.shadow_y=shadow_offset.y;this.style.graphic_width=this._dropShadow?Math.abs(this.style.shadow_x)+this.style.graphic_width:this.style.graphic_width;this.style.graphic_height=this._dropShadow?Math.abs(this.style.shadow_y)+this.style.graphic_height:this.style.graphic_height;this.style.graphic_x_offset=-1*Math.min(shadow_offset.x,0);this.style.graphic_y_offset=-1*Math.min(shadow_offset.y,0);this.style.line_offset_x=0;this.style.line_offset_y=0;this.style.stroke_offset=0;this.style.offset_x=this.style.graphic_x_offset+this.style.stroke_offset;this.style.offset_y=this.style.graphic_y_offset+this.style.stroke_offset;this._dirty=false;return true}return false},getClassName:function(){return"Image"},__toObject:function(){return{url:this.getUrl(),strokeWidth:this.getStrokeWidth(),strokeColor:this.getStrokeColor(),dropShadow:this.isDropShadow(),shadowX:this.getShadowX(),shadowY:this.getShadowY()}},__fromObject:function(object){if(object.url!==undefined){this.setUrl(object.url)}if(object.strokeWidth!==undefined){this.setStrokeWidth(object.strokeWidth)}if(object.strokeColor!==undefined){this.setStrokeColor(object.strokeColor)}if(object.dropShadow!==undefined){this.setDropShadow(object.dropShadow)}if(object.shadowX!==undefined){this.setShadowX(object.shadowX)}if(object.shadowY!==undefined){this.setShadowY(object.shadowY)}}})}());(function(){var DEFAULT_STYLE={zoom:1,stroke_linejoin:"miter"},TID="com.gliffy.shapes.proxy";_gliffy.Proxy=_gliffy.AbstractGeometry.extend({style:null,node:null,_dropShadow:false,_dirty:true,_createCommand:null,init:function(node){this.node=node;this.style=$.extend({},DEFAULT_STYLE)},markDirty:function(){this._dirty=true;if(this.node){this.node.markDirty()}},getTid:function(){return TID},replaceWith:function(graphic){var node=this.node;if(node){node.resetFlags();node.setSerializable(true);node.setGraphic(graphic);if(this._createCommand){this._createCommand.nodeObject=node.toObject()}this._createCommand=null;this.node=null}},getNode:function(){return this.node},activate:function(createCommand){if(this.node){this.node.setSerializable(false);this._createCommand=createCommand||null}},update:function(){if(this._dirty){var width=0,height=0;if(this.node){width=this.node.getWidth();height=this.node.getHeight();this.style.width=width;this.style.height=height}this.style.center_x=width/2;this.style.center_y=height/2;this.style.graphic_width=(this.node)?this.node.getWidth():0;this.style.graphic_height=(this.node)?this.node.getHeight():0;this.style.graphic_x_offset=0;this.style.graphic_y_offset=0;this.style.line_offset_x=0;this.style.line_offset_y=0;this.style.stroke_offset=0;this.style.offset_x=this.style.graphic_x_offset+this.style.stroke_offset;this.style.offset_y=this.style.graphic_y_offset+this.style.stroke_offset;this._dirty=false;return true}return false},getClassName:function(){return"Proxy"},__toObject:function(){return{}},__fromObject:function(object){}})}());(function(){var FLAGS=["bounds","skin","position","guide"];_gliffy.Node=_gliffy.Serializable.extend({_id:null,_x:0,_y:0,_rotation:0,_width:100,_height:100,_lockAspectRatio:false,_lockPosition:false,_scaleX:1,_scaleY:1,_order:null,worldTransform:null,_graphic:null,_domId:null,_uid:null,stage:null,children:null,parent:null,_dirty:true,_serialize:true,_dirty_flags:null,_current_bounds:null,_aspectRatio:null,_parentDirty:false,_activeGuides:null,_constraints:null,_selectable:true,aabb:null,worldAabb:null,overlayAabb:null,worldOverlayAabb:null,__defaultTextGraphic:null,__editTextOnInit:true,init:function(stage,parent){this.stage=stage||null;this.parent=parent||null;this.worldTransform=new _gliffy.AffineTransform(1,0,0,1,0,0);this.worldAabb=new _gliffy.BoundingBox();this.aabb=new _gliffy.BoundingBox();this.overlayAabb=new _gliffy.BoundingBox();this.worldOverlayAabb=new _gliffy.BoundingBox();this._connections=null;if(_gliffy.Constraints){this._constraints=new _gliffy.Constraints(this)}this.hideGuides();this.resetFlags()},notify:function(){if(!isNaN(parseInt(this.getId(),10))){$(window).trigger("gliffy-node-update-"+this.getId(),[this.getId()])}},notifyRemove:function(){if(!isNaN(parseInt(this.getId(),10))){$(window).trigger("gliffy-node-remove-"+this.getId(),[this.getId()])}},getId:function(){return this._id},setId:function(id){if(this.stage){if(id==="auto"){this._id=this.stage._node_index;if(this._order==="undefined"||this._order===null){this.setOrder(this.stage._node_index)}this.stage._node_index++}else{if(isNaN(parseInt(id,10))){throw new Error("node id is not a number:"+id)}this._id=id}this.stage._node_map[this._id]=this;this._domId="gliffy_node_"+this._id}else{this._id=id}},setUid:function(uid){this._uid=uid},getUid:function(){return this._uid},getDomElement:function(){if(this._domId){return $("#"+this._domId)}return null},getDomElements:function(){var selector=["#"+this._domId],children=this.flattenChildren(),i;for(i=0;i<children.length;i++){selector=selector.concat(["#"+children[i]._domId])}return $(selector.join(","))},getDomViewbox:function(){if(this._domId){return $("#"+this._domId+"viewbox")}return null},setOrder:function(order){if(order!==this._order){this._order=order;this.setFlag("position");this._markDirty()}},getOrder:function(){if(this._order==="auto"){return(this.parent)?this.parent.getOrder():0}else{return this._order}},setX:function(x){if(x!==this._x&&x!==undefined&&x!==null){this._x=x;this.setFlag("position");this._markDirty()}},getX:function(){return this._x},setY:function(y){if(y!==this._y&&y!==undefined&&y!==null){this._y=y;this.setFlag("position");this._markDirty()}},getY:function(){return this._y},__clampWidth:function(width){},__clampHeight:function(height){var ratio=this.getWidth()/this.getHeight();if(height<this.getHeight()){this.setHeight(height);this.setWidth(this.getHeight()*ratio)}},clampTo:function(boundingBox){var dimension=boundingBox.getDimension(),ratio;ratio=this.getHeight()/this.getWidth();if(dimension.x<this.getWidth()){this.setWidth(dimension.x);this.setHeight(this.getWidth()*ratio)}ratio=this.getWidth()/this.getHeight();if(dimension.y<this.getHeight()){this.setHeight(dimension.y);this.setWidth(this.getHeight()*ratio)}},getPosition:function(){return new _gliffy.Vec2(this._x,this._y)},getRotateOffsetX:function(){return this.getWidth()/2},getRotateOffsetY:function(){return this.getHeight()/2},getCenterPosition:function(){return new _gliffy.Vec2(this._x+this._width/2,this._y+this._height/2)},setRotation:function(rotation){rotation=_gliffy.Utils.wrapDegrees(rotation);if(rotation!==this._rotation){this._rotation=rotation;this.setFlag("position");this._markDirty();var graphic=this.getGraphic();if(graphic&&graphic.isDropShadow&&graphic.isDropShadow()){this.setFlag("skin")}}},supportsConstraints:function(){return _gliffy.Constraints&&this._constraints},subscribeAllConstraints:function(){var i;if(this.hasConstraints()){this.getConstraints().subscribeAll()}for(i=0;this.children&&i<this.children.length;i++){this.children[i].subscribeAllConstraints()}},hasConstraints:function(){return this.supportsConstraints()&&this._constraints.hasConstraints()},getConstraints:function(){return this._constraints},setConstraints:function(constraints){if(_gliffy.Constraints){if(this._constraints){this._constraints.unsubscribeAll()}this._constraints=constraints;this._constraints.subscribeAll()}},getRotation:function(){return _gliffy.Utils.wrapDegrees(this._rotation)},getWorldRotation:function(){var current=this,totalRotation=0;while(current){totalRotation+=current.getRotation();current=current.parent}return totalRotation},setWidth:function(width){if(width!==this._width){this._width=Math.min(Math.max(width,1),5000);this._markDirty();this.setFlag("bounds")}},getWidth:function(){return Math.min(Math.max(this._width,1),5000)},setHeight:function(height){if(height!==this._height){this._height=Math.min(Math.max(height,1),5000);this._dirty_flags.bounds=true;this.setFlag("bounds");this._markDirty()}},getHeight:function(){return Math.min(Math.max(this._height,1),5000)},setScaleXNoRatio:function(scaleX){if(scaleX!==this._scaleX){this._scaleX=scaleX;this.setFlag("bounds");this._markDirty()}},setScaleYNoRatio:function(scaleY){if(scaleY!==this._scaleY){this._scaleY=scaleY;this.setFlag("bounds");this._markDirty()}},setScaleX:function(scaleX){if(scaleX!==this._scaleX&&!isNaN(scaleX)){this._scaleX=scaleX;if(this._lockAspectRatio){this._scaleY=scaleX}this.setFlag("bounds");this._markDirty()}},setScaleY:function(scaleY){if(scaleY!==this._scaleY&&!isNaN(scaleY)){this._scaleY=scaleY;if(this._lockAspectRatio){this._scaleX=scaleY}this.setFlag("bounds");this._markDirty()}},getScaleX:function(){return this._scaleX},getScaleY:function(){return this._scaleY},_applyScale:function(){var i,child;if(this._scaleX!==1||this._scaleY!==1){this.setWidth(this.getWidth()*this._scaleX);this.setHeight(this.getHeight()*this._scaleY);if(this.children){for(i=0;i<this.children.length;i++){child=this.children[i];if((!child.isTextChild())||child.getGraphic().getOverflow()==="none"){if(!child.hasConstraints()||child.getConstraints().parentCanScaleWidth()){child.setX(child.getX()*this._scaleX);child.setScaleXNoRatio(this._scaleX)}if(!child.hasConstraints()||child.getConstraints().parentCanScaleHeight()){child.setY(child.getY()*this._scaleY);child.setScaleYNoRatio(this._scaleY)}}}}}},getAspectRatio:function(){if(this.getLockAspectRatio()){if(this._aspectRatio===null){this._aspectRatio=this._width/this._height}return this._aspectRatio}else{return this._width/this._height}},getLockAspectRatio:function(){return this._lockAspectRatio},setLockAspectRatio:function(lockAspectRatio){this._lockAspectRatio=lockAspectRatio;if(!this._lockAspectRatio){this._aspectRatio=null}},getLockPosition:function(){return this._lockPosition},setLockPosition:function(lockPosition){this._lockPosition=lockPosition},getDefaultTextGraphic:function(){return this.__defaultTextGraphic},setDefaultTextGraphic:function(defaultTextGraphic){this.__defaultTextGraphic=defaultTextGraphic},isEditTextOnInit:function(){return this.__editTextOnInit},setEditTextOnInit:function(b){this.__editTextOnInit=b},getMinDimensions:function(){var minWidth=15,minHeight=15;if(this.getShapeInformation().minWidth){minWidth=this.getShapeInformation().minWidth}if(this.getShapeInformation().minHeight){minHeight=this.getShapeInformation().minHeight}return{x:minWidth,y:minHeight}},setGraphic:function(graphic){if(this._graphic){this._graphic.node=null}this._graphic=graphic;if(this._graphic){this._graphic.node=this;if(this.getUid()===null){if(this._graphic instanceof _gliffy.Line){this.setUid("com.gliffy.shape.basic.basic_v1.default.line")}}this._graphic.markDirty()}else{if(this.stage){this.stage.removeDomNode(this)}}return this},getGraphic:function(){return this._graphic},updateProperty:function(prop,value){var graphic,props={};props[prop]=value;if(this.stage){this.stage.commandHistory.addAndExecuteCommand(new _gliffy.ModifyNodeCommand({node:this,props:props}))}else{graphic=this.getGraphic();if(this["set"+prop]!==undefined){this["set"+prop](value)}else{graphic=this.getGraphic();if(graphic){graphic.updateProperty(prop,value)}}}},getChildrenAabb:function(includeSelf){var i,child,aabb=(includeSelf===true)?this.aabb.clone():_gliffy.BoundingBox.SMALLEST.clone(),childTransform,graphic,offsetY;for(i=0;this.children&&i<this.children.length;i++){child=this.children[i];childTransform=child.getLocalTransform();if(child.getGraphic() instanceof _gliffy.Text){graphic=child.getGraphic();offsetY=(graphic.getValign()==="middle")?(child.getHeight()/2)-(graphic.getCalculatedHeight()/2):0;childTransform=childTransform.clone().translate(child.getGraphic().style.x,child.getGraphic().style.y+offsetY)}aabb.add(child.getChildrenAabb(true).transform(childTransform))}return aabb},getChildrenWorldAabb:function(includeSelf){var i,child,aabb;if(includeSelf===true){if(this.getGraphic() instanceof _gliffy.Text){aabb=new _gliffy.BoundingBox(0,0,this.getGraphic().getCalculatedWidth(),this.getGraphic().getCalculatedHeight());aabb.transform(this.__getTextWordTransform())}else{aabb=this.worldAabb.clone()}}else{if(this.children.length>0){aabb=_gliffy.BoundingBox.SMALLEST.clone()}else{aabb=new _gliffy.BoundingBox()}}for(i=0;this.children&&i<this.children.length;i++){child=this.children[i];aabb.add(child.getChildrenWorldAabb(true))}return aabb},getLocalTransform:function(){var local=new _gliffy.AffineTransform(1,0,0,1,0,0);local.translate(this._x,this._y).rotate(this._rotation*(Math.PI/180),this.getRotateOffsetX(),this.getRotateOffsetY());return local},updateWorldTransform:function(){this.worldTransform=(this.parent)?this.parent.worldTransform.clone():new _gliffy.AffineTransform(1,0,0,1,0,0);this.worldTransform.translate(this._x,this._y).rotate(this._rotation*(Math.PI/180),this.getRotateOffsetX(),this.getRotateOffsetY())},update:function(){try{if(this._dirty){if(this.stage&&(this._dirty_flags.bounds||this._dirty_flags.position)&&_gliffy.Tree){_gliffy.Tree.remove(this)}this._applyScale();var i,child,grow=false,updateChildren;if(this.stage&&this.hasConstraints()){this.getConstraints().executeConstraints()}if(this.stage&&this.getGraphic() instanceof _gliffy.Text){if(this.parent===null||this.parent.isGroup()||this.parent.isSelection()){if(this.getUid()===null){this.setUid("com.gliffy.shape.basic.basic_v1.default.text")}}else{if(this.getUid()!==null){this.setUid(null)}}}this.updateWorldTransform();if(this._graphic){this._graphic.update();if(this._graphic.aabb){this.aabb.copy(this._graphic.aabb)}else{this.aabb.setMinMax(0,0,0,0);this.aabb.grow(this.getWidth(),this.getHeight())}if(this._graphic.worldAabb){this.worldAabb.copy(this._graphic.worldAabb)}else{if(this.getGraphic() instanceof _gliffy.Text){this.worldAabb.copy(this.aabb).transform(this.__getTextWordTransform())}else{this.worldAabb.copy(this.aabb).transform(this.worldTransform)}}this.overlayAabb.copy(this.aabb)}else{this.aabb.setMinMax(0,0,0,0);this.aabb.grow(this.getWidth(),this.getHeight());grow=true}if(this.children){updateChildren=(this._dirty_flags.bounds||this._dirty_flags.position);for(i=0;i<this.children.length;i++){child=this.children[i];if(updateChildren){if(this._dirty_flags.bounds){child.setFlag("bounds")}if(this._dirty_flags.position){child.setFlag("position")}child._markDirty();child._parentDirty=true}child.update();if(child.worldAabb){if(grow){if(this.isGroup()||this.isMultipartShape()){this.overlayAabb.copy(child.overlayAabb).transform(child.getLocalTransform())}this.worldAabb.copy(child.worldAabb);grow=false}else{if(this.isGroup()||this.isMultipartShape()){this.overlayAabb.add(child.overlayAabb.clone().transform(child.getLocalTransform()))}this.worldAabb.add(child.worldAabb)}}}}this.worldOverlayAabb.copy(this.overlayAabb).transform(this.worldTransform);if(this.stage&&(this._dirty_flags.bounds||this._dirty_flags.position)&&_gliffy.Tree){_gliffy.Tree.add(this)}this.setScaleX(1);this.setScaleY(1);this._dirty=false}this._parentDirty=false}catch(e){_gliffy.Logger.error("Node "+this.getId()+" failed to update in node.js");if(this.stage){this.stage.removeNode(this)}_gliffy.handleError("com.gliffy.error.fatal_error",[],e)}},getBoundsOffset:function(){var worldPos=this.getWorldPosition();return _gliffy.Vec2.difference(worldPos,this.worldAabb.min)},getWorldPosition:function(){if(this.parent){return this.parent.worldTransform.transformPoint(this._x,this._y)}else{return{x:this._x,y:this._y}}},markDirty:function(){this._dirty=true;if(this.stage&&!isNaN(parseInt(this.getId(),10))&&this.stage.find(this.getId())===this){this.stage.addDirtyNode(this)}},_markDirty:function(){if(this.getGraphic()){this.getGraphic().markDirty()}else{this.markDirty()}},shouldBeDrawn:function(){if(this.stage&&!isNaN(parseInt(this.getId(),10))){return this.stage.dirty[this.getId()]===this.getId()}return true},isDirty:function(){return this._dirty},isAChildOf:function(n){if(this.parent===n){return true}else{if(this.parent===null){return false}else{this.parent.isAChildOf(n)}}},getRootParent:function(){var n=this;while(n.parent){n=n.parent}return n},setSerializable:function(serializable){this._serialize=serializable},toObjectNoGraphic:function(){return $.extend(true,{},this.__toObject(true))},__toObject:function(noGraphic){if(this._serialize){var i,object={x:this.getX(),y:this.getY(),rotation:this.getRotation(),id:this.getId(),uid:this.getUid(),width:this.getWidth(),height:this.getHeight(),lockAspectRatio:this.getLockAspectRatio(),lockShape:this.getLockPosition(),order:this._order,graphic:null,children:null},graphic=this.getGraphic(),childrenArray,child;if(!noGraphic&&this.hasConstraints()){object.constraints=this._constraints.toObject()}if(!noGraphic&&graphic!==null){if(graphic instanceof _gliffy.Graphic){object.graphic=_gliffy.Serializable.polymorphicToObject(graphic)}else{throw new Error("The graphic for this node is not an instance of Geometry")}}if(this.children){childrenArray=[];for(i=0;this.children&&i<this.children.length;i++){child=this.children[i].__toObject(noGraphic);if(child){childrenArray.push(child)}}object.children=childrenArray}if(!noGraphic&&this.stage&&this._uid!==null&&!this.isGroup()&&!this.isSelection()){object.linkMap=this.generateLinkMap()}return object}else{return null}},__getTextWordTransform:function(){var graphic,offsetY;if(this.getGraphic() instanceof _gliffy.Text){graphic=this.getGraphic();offsetY=(graphic.getValign()==="middle")?(this.getHeight()/2)-(graphic.getCalculatedHeight()/2):0;return new _gliffy.AffineTransform().concatenate(this.worldTransform).translate(graphic.style.x,graphic.style.y+offsetY)}else{return this.worldTransform}},generateLinkMap:function(){var nodes,node,domNode,links,boundingBox,css,cssNoTransform,linkMap=[],offset={x:0,y:0},container,i,handleLink;handleLink=function(index,link){boundingBox=_gliffy.Utils.getTextBoundingBox(link,offset);boundingBox.transform(node.__getTextWordTransform());linkMap.push({url:$(link).attr("href"),minX:Math.round(boundingBox.min.x),minY:Math.round(boundingBox.min.y),maxX:Math.round(boundingBox.max.x),maxY:Math.round(boundingBox.max.y)})};if(_gliffy.Mouse){container=_gliffy.Mouse.getContainerOffset();offset.x-=container.left;offset.y-=container.top}if(this.stage){offset.x-=this.stage.pan_x;offset.y-=this.stage.pan_y}nodes=this.findGraphic(_gliffy.Text);for(i=0;i<nodes.length;i++){node=nodes[i];domNode=node.getDomElement();if(domNode&&domNode.length>0){links=domNode.find("a");domNode=domNode.get(0);if(links.length>0){css=domNode.style.cssText;cssNoTransform=css.replace(/ *((left)|(top)|(((-moz-)|(-webkit-)|(ms-)|(-o-))transform(-origin)?)) *:[^;]*;/g,"")+" left: 0px; top: 0px;";domNode.style.cssText=cssNoTransform;links.each(handleLink);domNode.style.cssText=css}}}return linkMap},__fromObject:function(object,opt){var i,graphic=null,constraints,child,order,childOrder,options=$.extend({subscribeToConstraints:true},opt);if(object.uid!==undefined){this.setUid(object.uid)}if(object.x!==undefined){this.setX(object.x)}if(object.y!==undefined){this.setY(object.y)}if(object.rotation!==undefined){this.setRotation(object.rotation)}if(object.width!==undefined){this.setWidth(object.width)}if(object.height!==undefined){this.setHeight(object.height)}if(object.lockAspectRatio!==undefined){this.setLockAspectRatio(object.lockAspectRatio)}if(object.lockShape!==undefined){this.setLockPosition(object.lockShape)}if(object.id!==undefined){this.setId(object.id)}if(object.order!==undefined){this._order=object.order}if(_gliffy.Constraints&&object.constraints!==undefined){constraints=new _gliffy.Constraints(this,options.subscribeToConstraints);constraints.fromObject(object.constraints);this.setConstraints(constraints)}if(object.graphic){graphic=_gliffy.Serializable.polymorphicFromObject(object.graphic,this);if(graphic instanceof _gliffy.Graphic){this.setGraphic(graphic);graphic.markDirty()}else{throw new Error("The graphic "+object.graphicClass+" is not an instance of Geometry.")}}order=0;if(object.children){this.children=[];for(i=0;i<object.children.length;i++){child=new _gliffy.Node().fromObject(object.children[i]);this.appendChild(child);childOrder=child.getOrder();if(order<childOrder){order=childOrder}}}if(this.isGroup()&&this.getOrder()<childOrder){this.setOrder(childOrder+1)}this.markDirty();return this},appendChild:function(node){if(this.stage&&this.stage.find(this.getId())===this){this.stage.appendNode(node,this)}else{if(!this.children){this.children=[]}node.parent=this;this.children.push(node)}},insertChild:function(node,index){if(this.stage&&this.stage.find(this.getId())===this){this.stage.insertNode(node,this,index)}else{if(!this.children){this.children=[]}node.parent=this;this.children.splice(index,0,node)}},prependChild:function(node){if(this.stage&&this.stage.find(this.getId())===this){this.stage.prependNode(node,this)}else{if(!this.children){this.children=[]}node.parent=this;this.children.unshift(node)}},removeChild:function(node,markForDeletion){if(this.stage&&this.stage.find(this.getId())===this){this.stage.removeNode(node,markForDeletion)}else{node.parent=null;this.__removeFromArray(this.children,node)}},__removeFromArray:function(array,object){var index=-1,other,i;for(i=0;array.length;i++){other=array[i];if((object.getId()!==null&&other.getId()===object.getId())||other===object){index=i;break}}if(index>-1&&index<array.length){array.splice(index,1)}},getShapeInformation:function(){return _gliffy.shapeLibrary.getShape(this.getUid())||{}},resetFlags:function(){var i;this._dirty_flags={};for(i=0;i<FLAGS.length;i++){this._dirty_flags[FLAGS[i]]=false}},setFlag:function(flag){if($.inArray(flag,FLAGS)<0){throw new Error($.inArray(flag,FLAGS)>-1+" node does not have flag "+flag)}this._dirty_flags[flag]=true;if((flag==="position"||flag==="bounds")&&this.stage&&this.stage.setBoundsDirty){this.stage.setBoundsDirty()}},hasFlag:function(flag){var i;if(flag){return this._dirty_flags[flag]||false}else{for(i=0;i<FLAGS.length;i++){if(this._dirty_flags[FLAGS[i]]===true){return true}}}return false},hasRepositionCanvasFlag:function(){return this._dirty_flags.position||this._dirty_flags.bounds},hasRedrawCanvasFlag:function(){return this._dirty_flags.bounds||this._dirty_flags.skin},hasGuideFlag:function(){return this._dirty_flags.guide},closestGraphic:function(type){if(this.getGraphic() instanceof type){return this}else{if(this.parent){return this.parent.closestGraphic(type)}else{return null}}},closestGroup:function(){if(this.isGroup()){return this}else{if(this.parent){return this.parent.closestGroup()}else{return null}}},topGroup:function(){if(this.isGroup()&&(this.parent===null||this.parent.isSelection())){return this}else{if(this.parent){return this.parent.topGroup()}else{return null}}},getFirstNodeWithGraphic:function(){if(this.getGraphic()){return this}else{var i,node;for(i=0;i<this.children.length;i++){node=this.children[i].getFirstNodeWithGraphic();if(node){return node}}return null}},findGraphic:function(type){var list=[],i;if((type!==null&&this.getGraphic() instanceof type)||(this.getGraphic()===null&&type===null)){list.push(this)}if(this.children&&this.children.length>0){for(i=0;i<this.children.length;i++){list=list.concat(this.children[i].findGraphic(type))}}return list},findGraphics:function(types){var list=[],i;for(i=0;i<types.length;i++){if((types[i]!==null&&this.getGraphic() instanceof types[i])||(this.getGraphic()===null&&types[i]===null)){list.push(this);break}}if(this.children&&this.children.length>0){for(i=0;i<this.children.length;i++){list=list.concat(this.children[i].findGraphics(types))}}return list},getUidNode:function(){if(this.getUid()!==null){return this}else{if(this.parent){return this.parent.getUidNode()}else{return null}}},getLeafNodes:function(includeSelf){var list=[],i;if(includeSelf||(this.getUid()&&!(this.isGroup()||this.isSelection()))){list.push(this)}for(i=0;this.children&&i<this.children.length;i++){list=list.concat(this.children[i].getLeafNodes(false))}return list},findUid:function(uid){return this.findUidFunction(function(u){return u===uid})},findUidFunction:function(check){var list=[],i;if(check(this.getUid())){list.push(this)}if(this.children&&this.children.length>0){for(i=0;i<this.children.length;i++){list=list.concat(this.children[i].findUidFunction(check))}}return list},hasText:function(){var i=0;if(this.getGraphic() instanceof _gliffy.Text){return true}else{if(this.children&&this.children.length>0){for(i=0;i<this.children.length;i++){if(this.children[i].hasText()){return true}}}}return false},immediateChildrenHaveMixedRotation:function(){var i=0;if(this.children){for(i=0;i<this.children.length;i++){if(this.children[i].getRotation()!==0){return true}}}return false},isLine:function(){return this.getGraphic() instanceof _gliffy.Line&&!this.isGroup()&&!this.isSelection()&&!this.isMultipartShape()},isGroup:function(){return this.getUid()==="com.gliffy.shape.basic.basic_v1.default.group"},isSelection:function(){return this.getUid()==="com.gliffy.shape.basic.basic_v1.default.selection"},isShape:function(){return !this.isGroup()&&!this.isSelection()&&((this.getUid()&&this.getGraphic() instanceof _gliffy.Shape)||this.isMultipartShape())},isShapePart:function(){return !this.getUid()&&this.getGraphic() instanceof _gliffy.Shape},isSvg:function(){return this.getGraphic() instanceof _gliffy.Svg&&this.getUid()==="com.gliffy.shape.basic.basic_v1.default.svg"},isProxy:function(){return _gliffy.Proxy&&this.getGraphic() instanceof _gliffy.Proxy},isImage:function(){return this.getGraphic() instanceof _gliffy.Image&&this.getUid()==="com.gliffy.shape.basic.basic_v1.default.image"},isMultipartShape:function(){return !this.isGroup()&&!this.isSelection()&&this.getUid()&&this.findGraphics([_gliffy.Shape,null]).length>1},isStandAloneText:function(){return this.getUid()==="com.gliffy.shape.basic.basic_v1.default.text"&&this.getGraphic() instanceof _gliffy.Text},isGuideNode:function(){return(this.isShape()||this.isImage()||this.isStandAloneText())},isAnnotation:function(){return this.getUid()==="com.gliffy.shape.bpmn.bpmn_v1.data_artifacts.annotation"},isText:function(){return this.getGraphic() instanceof _gliffy.Text},isTextChild:function(){return this.getGraphic() instanceof _gliffy.Text&&this.getUid()===null&&this.parent!==null},isSwimlane:function(){return(this.getUid()&&this.getUid().indexOf("com.gliffy.shape.swimlanes")===0)===true},isContainer:function(){var info=this.getShapeInformation();return info&&info.defaults&&info.defaults.isContainer},isPartOfMultipartShape:function(){var parent=this.getUidNode();return(parent&&parent.isMultipartShape()&&this!==parent)===true},supportsConnections:function(){var info=this.getShapeInformation();return !this.isProxy()&&info.defaults&&info.defaults.connPtPattern!==null&&info.defaults.connPtPattern!==undefined},supportsLockAspect:function(){var i,info,supports=true,shapeNodes=this.findGraphics([_gliffy.Shape,_gliffy.Image]);for(i=0;i<shapeNodes.length;i++){info=shapeNodes[i].getShapeInformation();if($.inArray("lockAspectRatio",info.mutableProperties)===-1){supports=false;break}}return supports},flattenChildren:function(){var nodes=[],i=0;for(i=0;this.children&&i<this.children.length;i++){this.__preorder(this.children[i],nodes)}nodes=nodes.sort(function(n1,n2){var result=n1.getOrder()-n2.getOrder();if(result===0){if(n1.isAChildOf(n2)){return 1}else{if(n2.isAChildOf(n1)){return -1}else{return n1.getId()>n2.getId()?1:-1}}}else{return result}});return nodes},getGuideData:function(){return{x:[this.worldAabb.min.x,(this.worldAabb.min.x+this.worldAabb.max.x)/2,this.worldAabb.max.x],y:[this.worldAabb.min.y,(this.worldAabb.min.y+this.worldAabb.max.y)/2,this.worldAabb.max.y]}},__hasDirtyGuides:function(){var i,j;for(i=0;i<2;i++){for(j=0;j<3;j++){if(this._activeGuides[i===0?"x":"y"][j]){return true}}}return false},hideGuides:function(){if(this._activeGuides!==null){if(this.__hasDirtyGuides()){this.markDirty()}}this._activeGuides={x:[false,false,false],y:[false,false,false]}},showGuide:function(xOrY,which){if((xOrY==="x"||xOrY==="y")&&which<3){if(!this._activeGuides[xOrY][which]){this._activeGuides[xOrY][which]=true;this.setFlag("guide");this.markDirty()}}},shouldShowGuide:function(xOrY,which){if((xOrY==="x"||xOrY==="y")&&which<3){return this._activeGuides[xOrY][which]}return false},worldPointToRatio:function(x,y){var point=this.worldTransform.createInverse().transformPoint(x,y);point.x/=this.getWidth();point.y/=this.getHeight();return point},ratioToWorldPoint:function(xRatio,yRatio){return this.worldTransform.transformPoint(xRatio*this.getWidth(),yRatio*this.getHeight())},__preorder:function(node,array){var c;if(!node){return}array.push(node);for(c=0;node.children&&c<node.children.length;c++){this.__preorder(node.children[c],array)}},getSubLibraryId:function(){var subLibraryId;if(this._uid!==null){if(this._uid.lastIndexOf(".")>-1){subLibraryId=this._uid.substring(0,this._uid.lastIndexOf("."))}}return subLibraryId},getConnections:function(){var i,patternStrings,patternString,pattern;if(!this._connections&&this.supportsConnections()){this._connections=[];patternStrings=this.getShapeInformation().defaults.connPtPattern;if(patternStrings){for(i=0;i<patternStrings.length;i++){patternString=patternStrings[i];pattern=_gliffy.ConnectionPointPattern.patterns[patternString];if(pattern){this._connections=this._connections.concat(pattern)}}}}else{if(!this._connections){this._connections=[]}}return this._connections},updateGroupBounds:function(){var i,n,dimension,boundingBox;if(this.isGroup()||this.isSelection()){for(i=0;i<this.children.length;i++){n=this.children[i];n.updateGroupBounds();n.update()}boundingBox=this.getChildrenAabb();dimension=boundingBox.getDimension();this.setWidth(dimension.x);this.setHeight(dimension.y)}},getClosestConnectionPoint:function(point){point=this.worldTransform.createInverse().transformPoint(point.x,point.y);point.x/=this.getWidth();point.y/=this.getHeight();return this.getConnectionIndexByRatio(point)},hasConnectionIndices:function(){return this.getConnections()?true:false},getConnectionIndexByRatio:function(ratio){var connections=this.getConnections(),i,smallestDistance=Number.MAX_VALUE,index=0,distance;for(i=0;i<connections.length;i++){distance=_gliffy.Vec2.squaredDistance(ratio,connections[i].pos);if(distance<smallestDistance){index=i;smallestDistance=distance}}return index},getConnectionPointRatio:function(i){return this.getConnections()[i].pos},getConnectionPoint:function(i){var connLocal,xfm,pt;connLocal=this.getConnections()[i].pos;xfm=this.worldTransform.clone().translate(this.getWidth()*connLocal.x,this.getHeight()*connLocal.y);pt=xfm.transformPoint(0,0);return new _gliffy.Vec2(pt.x,pt.y)},getConnectionPointDom:function(i){return $("#cp"+i+"-"+this._domId)},getConnectionVector:function(i){var connections=this.getConnections();if(i<connections.length&&connections[i].vec){return(new _gliffy.Vec2(this.getConnections()[i].vec.x,this.getConnections()[i].vec.y)).rotate(this.getWorldRotation()*Math.PI/180)}else{return new _gliffy.Vec2(0,0)}},isSelectable:function(){return this._selectable},setSelectable:function(selectable){this._selectable=selectable}})}());(function(){var ZOOM_FIT_PADDING=20,MAX_ZOOM=8,MAX_WIDTH=5000,MAX_HEIGHT=5000;_gliffy.Stage=_gliffy.Serializable.extend({id:null,zoom:1,pan_x:0,pan_y:0,background:"#FFFFFF",__unsavedChanges:false,width:750,height:1000,maxWidth:MAX_WIDTH,maxHeight:MAX_HEIGHT,exportBorder:false,gridOn:true,snapToGrid:true,drawingGuidesOn:true,pageBreaksOn:false,printGridOn:false,printPaper:"LETTER",printShrinkToFit:false,printPortrait:true,shapeStyles:null,lineStyles:null,textStyles:null,themeData:null,objects:null,_node_map:null,_node_index:0,_calculate_bounds:true,_pan_dirty:true,deletes:null,dirty:null,autoFit:true,gon:null,document:null,commandHistory:null,worldAabb:null,options:{zoom:true,pan_x:true,pan_y:true,background:true,width:true,height:true,autoFit:true},init:function(options,id){var key;this.objects=[];this.shapeStyles={};this.lineStyles={};this.textStyles={};this._node_map={};this.deletes=[];this.dirty={};this.worldAabb=new _gliffy.BoundingBox();this.id=id||_gliffy.Utils.randomString(_gliffy.stages);_gliffy.stages[this.id]=this;if(_gliffy.Editor!==undefined){this.commandHistory=new _gliffy.CommandHistory(this)}if(options){for(key in options){if(options.hasOwnProperty(key)){if(this.options[key]){this[key]=options[key]}else{throw key+" is not a valid option for stage"}}}}},addDirtyNode:function(node){this.dirty[node.getId()]=node.getId()},removeDirtyNode:function(node){delete this.dirty[node.getId()]},update:function(){var i;for(i=0;i<this.objects.length;i++){this.objects[i].update()}this.updateBounds()},setBoundsDirty:function(){this._calculate_bounds=true},setBoundsClean:function(){this._calculate_bounds=false},updateBounds:function(){if(this._calculate_bounds){this.worldAabb=this.calculateBoundingBox();this.width=Math.ceil(Math.min(this.worldAabb.max.x,this.maxWidth));this.height=Math.ceil(Math.min(this.worldAabb.max.y,this.maxHeight));this.setBoundsClean()}},find:function(node_id){return this._node_map[node_id]||null},findGraphic:function(type){var list=[],i;for(i=0;i<this.objects.length;i++){list=list.concat(this.objects[i].findGraphic(type))}return list},iterateNodes:function(callback){$.each(this._node_map,function(key,node){callback(node)})},prependNode:function(new_node,parent){this.insertNode(new_node,parent,0)},insertNode:function(new_node,parent,index){this.removeNode(new_node,false);this.__resetNodeId(new_node);if(new_node&&parent){if(!parent.children){parent.children=[]}parent.children.splice(index,0,new_node);new_node.parent=parent;parent.markDirty()}else{this.objects.splice(index,0,new_node);new_node.markDirty()}if(new_node.supportsConstraints()){new_node.subscribeAllConstraints()}if(_gliffy.Editor&&new_node.isSelection()){_gliffy.Mouse.editor.overlayManager.addSelectionNodesToBreakup(new_node)}},appendNode:function(new_node,parent){var index;if(parent){if(parent.children){index=parent.children.length}else{index=0}}else{index=this.objects.length}this.insertNode(new_node,parent,index)},appendCopyNode:function(node){this.insertCopyNode(node,this.objects.length)},prependCopyNode:function(node){this.insertCopyNode(node,0)},insertCopyNode:function(node,index){var idMap={};this.__resetCopyNodeId(node,idMap);this.objects.splice(index,0,node);node.markDirty();if(node.supportsConstraints()){this.__updateConstraintIds(node,idMap)}if(node.isSelection()){_gliffy.Mouse.editor.overlayManager.addSelectionNodesToBreakup(node)}new _gliffy.BringToFrontCommand({node:node}).execute(this)},calculateBoundingBox:function(){if(this.objects.length>0){var i,bb=_gliffy.BoundingBox.SMALLEST.clone();for(i=0;i<this.objects.length;i++){bb.add(this.objects[i].getChildrenWorldAabb(true))}return bb}else{return new _gliffy.BoundingBox()}},__updateConstraintIds:function(node,idMap){var i;if(node.hasConstraints()){node.getConstraints().updateIds(idMap)}for(i=0;node.children&&i<node.children.length;i++){this.__updateConstraintIds(node.children[i],idMap)}},__resetNodeId:function(node){var i=0,id=node._id;node.stage=this;if(id===null||id===undefined||id<0){id="auto"}node.setId(id);for(i=0;node.children&&i<node.children.length;i++){this.__resetNodeId(node.children[i])}},__resetCopyNodeId:function(node,idMap){var i=0,id=node._id;node.stage=this;node.setId("auto");idMap[id]=node.getId();for(i=0;node.children&&i<node.children.length;i++){this.__resetCopyNodeId(node.children[i],idMap)}},removeNode:function(node,markForDeletion,isChild){var i,parent;this.setBoundsDirty();if(node){if(markForDeletion===undefined||markForDeletion===null){markForDeletion=true}node=this.find(node.getId());if(node){for(i=0;node.children&&i<node.children.length;i++){this.removeNode(node.children[i],markForDeletion,true)}if(markForDeletion){this.removeDomNode(node)}parent=node.parent;if(!isChild){if(parent===null){this.__removeFromArray(this.objects,node)}else{this.__removeFromArray(parent.children,node)}node.parent=null}if(markForDeletion){node.notifyRemove()}node.stage=null;delete this._node_map[node.getId()]}}return node},removeDomNode:function(node){if(node._domId){this.deletes.push("#"+node._domId)}},isDirty:function(){return this.deletes.length>0||Object.keys(this.dirty).length>0},hasUnsavedChanges:function(){return this.__unsavedChanges},setUnsavedChanges:function(hasChanges){if(_gliffy.Editor!==undefined&&hasChanges!==this.__unsavedChanges){this.__unsavedChanges=hasChanges;if(window.GliffyApp){GliffyApp.documentModel.update(this.document)}}},setBackground:function(color){this.background=color;if(window.GliffyApp){GliffyApp.documentModel.updateProperty("pageColor",color)}},__removeFromArray:function(array,object){var index=-1,other,i;for(i=0;i<array.length;i++){other=array[i];if(other.getId()===object.getId()){index=i;break}}if(index>-1&&index<array.length){array.splice(index,1)}},getStagePanX:function(){return -this.pan_x/this.zoom},getStagePanY:function(){return -this.pan_y/this.zoom},zoomAt:function(zoom,stageX,stageY,viewportWidth,viewportHeight){var stagePanX=this.getStagePanX(),stagePanY=this.getStagePanY(),zoomRatio;zoom=(zoom<MAX_ZOOM)?zoom:MAX_ZOOM;zoomRatio=zoom/this.zoom;stagePanX=(stagePanX-stageX)/(zoomRatio)+stageX;stagePanY=(stagePanY-stageY)/(zoomRatio)+stageY;viewportWidth=viewportWidth/zoomRatio;viewportHeight=viewportHeight/zoomRatio;this.setZoom(zoom);this.setStagePan(stagePanX,stagePanY,viewportWidth,viewportHeight)},setPanX:function(x){this.pan_x=x;this._pan_dirty=true},setPanY:function(y){this.pan_y=y;this._pan_dirty=true},setStagePan:function(x,y,viewportWidth,viewportHeight){this.setPan(-x*this.zoom,-y*this.zoom,viewportWidth,viewportHeight)},setPan:function(x,y,viewportWidth,viewportHeight){this.setPanX(x);this.setPanY(y);this.clampPanning(viewportWidth,viewportHeight)},offsetPan:function(x,y,viewportWidth,viewportHeight){this.setPan(this.pan_x+x,this.pan_y+y,viewportWidth,viewportHeight)},clampPanning:function(viewportWidth,viewportHeight){var stageWidth=(this.autoFit||this.width>this.maxWidth)?this.maxWidth:this.width,stageHeight=(this.autoFit||this.height>this.maxHeight)?this.maxHeight:this.height,minWidth=Math.ceil((viewportWidth-stageWidth)*this.zoom),minHeight=Math.ceil((viewportHeight-stageHeight)*this.zoom);if(minWidth>0){minWidth=0}if(minHeight>0){minHeight=0}if(this.pan_x>0){this.pan_x=0}else{if(this.pan_x<minWidth){this.pan_x=minWidth}}if(this.pan_y>0){this.pan_y=0}else{if(this.pan_y<minHeight){this.pan_y=minHeight}}this.pan_x=Math.ceil(this.pan_x);this.pan_y=Math.ceil(this.pan_y)},centerAt:function(stageX,stageY,viewportWidth,viewportHeight){this.setStagePan(stageX-viewportWidth/2,stageY-viewportHeight/2,viewportWidth,viewportHeight)},zoomToCenter:function(zoom,viewportWidth,viewportHeight){var zoomRatio,stageX=this.getStagePanX()+viewportWidth/2,stageY=this.getStagePanY()+viewportHeight/2;zoom=(zoom<MAX_ZOOM)?zoom:MAX_ZOOM;zoomRatio=this.zoom/zoom;this.setZoom(zoom);this.centerAt(stageX,stageY,viewportWidth*zoomRatio,viewportHeight*zoomRatio)},zoomToBox:function(boundingBox,viewportWidth,viewportHeight){var dimension,xZoom,yZoom,zoom,zoomRatio,center;dimension=boundingBox.getDimension();xZoom=viewportWidth*this.zoom/dimension.x;yZoom=viewportHeight*this.zoom/dimension.y;zoom=(xZoom<yZoom)?xZoom:yZoom;zoom=(zoom<MAX_ZOOM)?zoom:MAX_ZOOM;zoomRatio=this.zoom/zoom;viewportWidth=viewportWidth*zoomRatio;viewportHeight=viewportHeight*zoomRatio;center=boundingBox.getCenter();this.setZoom(zoom);this.centerAt(center.x,center.y,viewportWidth,viewportHeight)},zoomToFit:function(viewportWidth,viewportHeight){var i,aabb=new _gliffy.BoundingBox().copy(_gliffy.BoundingBox.SMALLEST);if(this.objects.length===0){this.pan_x=0;this.pan_y=0;this.setZoom(1)}else{for(i=0;i<this.objects.length;i++){aabb.add(this.objects[i].worldAabb)}aabb.extend(ZOOM_FIT_PADDING);this.zoomToBox(aabb,viewportWidth,viewportHeight)}},getZoom:function(){return this.zoom},setZoom:function(value){this.zoom=(value<MAX_ZOOM)?value:MAX_ZOOM;$(document).trigger("gliffy.zoom",value)},isGridVisible:function(){return this.gridOn},setGridVisible:function(b){this.gridOn=b},isPageBreaksVisible:function(){return this.pageBreaksOn},setPageBreaksVisible:function(b){this.pageBreaksOn=b},isSnapToGrid:function(){return this.snapToGrid},setSnapToGrid:function(b){this.snapToGrid=b},isDrawingGuideOn:function(){return this.drawingGuidesOn},setDrawingGuideOn:function(b){this.drawingGuidesOn=b},isExportBorder:function(){return this.exportBorder},setExportBorder:function(b){this.exportBorder=b},setMaxWidth:function(w){this.maxWidth=w;if(window.GliffyApp){GliffyApp.documentModel.updateProperty("maxWidth",w)}},setMaxHeight:function(h){this.maxHeight=h;if(window.GliffyApp){GliffyApp.documentModel.updateProperty("maxHeight",h)}},updateProperty:function(prop,value){if(this["set"+prop]!==undefined){this["set"+prop](value)}},__toObject:function(){var i,node,objects=[],object,type;for(i=0;i<this.objects.length;i++){object=this.objects[i];if(object instanceof _gliffy.Node){node=object.toObject();if(node){objects.push(object.toObject())}}else{throw new Error("Stage contains an unknown object type.")}}return{objects:objects,background:this.background,width:this.width,height:this.height,maxWidth:this.maxWidth,maxHeight:this.maxHeight,nodeIndex:this._node_index,autoFit:this.autoFit,exportBorder:this.exportBorder,gridOn:this.gridOn,snapToGrid:this.snapToGrid,drawingGuidesOn:this.drawingGuidesOn,pageBreaksOn:this.pageBreaksOn,printGridOn:this.printGridOn,printPaper:this.printPaper,printShrinkToFit:this.printShrinkToFit,printPortrait:this.printPortrait,shapeStyles:this.shapeStyles,lineStyles:this.lineStyles,textStyles:this.textStyles,themeData:this.themeData}},getAnalyticsData:function(){var data={nodeType:{nodes:0,lines:0,groups:0,shapes:0,shapeParts:0,textChildren:0,standaloneTexts:0,images:0,multipartShapes:0,rotatedNodes:0},categories:{},diagramCategory:"none"},split,category,uid,max=0;$.each(this._node_map,function(key,node){data.nodeType.nodes++;if(node.isLine()){data.nodeType.lines++}if(node.isGroup()){data.nodeType.groups++}if(node.isShape()){data.nodeType.shapes++;uid=node.getUid();if(uid){split=uid.split(".");if(split.length>=4){category=split[3];if(!data.categories[category]){data.categories[category]=0}data.categories[category]++}}}if(node.isShapePart()){data.nodeType.shapeParts++}if(node.isImage()){data.nodeType.images++}if(node.isMultipartShape()){data.nodeType.multipartShapes++}if(node.isTextChild()){data.nodeType.textChildren++}if(node.isStandAloneText()){data.nodeType.standaloneTexts++}if(node.getRotation()!==0){data.nodeType.rotatedNodes++}});$.each(data.categories,function(category,num){if(num>max){data.diagramCategory=category;max=num}});return data},__fromObject:function(object,opt){this.objects.length=0;this._node_index=0;this._node_map={};this.dirty={};if(object.nodeIndex!==undefined){this._node_index=object.nodeIndex}var i,node,o,options=$.extend({subscribeToConstraints:true},opt);for(i=0;i<object.objects.length;i++){o=object.objects[i];node=new _gliffy.Node(this);node.fromObject(o,options);this.objects.push(node)}if(object.background!==undefined){this.background=object.background}if(object.width!==undefined){this.width=object.width}if(object.height!==undefined){this.height=object.height}if(object.autoFit!==undefined){this.autoFit=object.autoFit}if(object.exportBorder!==undefined){this.exportBorder=object.exportBorder}if(object.gridOn!==undefined){this.gridOn=object.gridOn}if(object.snapToGrid!==undefined){this.snapToGrid=object.snapToGrid}if(object.themeData!==undefined){this.themeData=object.themeData}if(object.drawingGuidesOn!==undefined){this.drawingGuidesOn=object.drawingGuidesOn}if(object.pageBreaksOn!==undefined){this.pageBreaksOn=object.pageBreaksOn}if(object.printGridOn!==undefined){this.printGridOn=object.printGridOn}if(object.printPaper!==undefined){this.printPaper=object.printPaper}if(object.printShrinkToFit!==undefined){this.printShrinkToFit=object.printShrinkToFit}if(object.printPortrait!==undefined){this.printPortrait=object.printPortrait}if(object.maxHeight!==undefined){this.maxHeight=object.maxHeight||MAX_WIDTH}if(object.maxWidth!==undefined){this.maxWidth=object.maxWidth||MAX_HEIGHT}if(_gliffy.Editor!==undefined){if(object.shapeStyles!==undefined){this.shapeStyles=this.__buildStyles(object.shapeStyles,"ShapeStyle")}if(object.lineStyles!==undefined){this.lineStyles=this.__buildStyles(object.lineStyles,"LineStyle")}if(object.textStyles!==undefined){this.textStyles=this.__buildStyles(object.textStyles,"TextStyle")}}return this},__buildStyles:function(stylesObject,type){var key,styles={};for(key in stylesObject){if(stylesObject.hasOwnProperty(key)){styles[key]=new _gliffy[type]();styles[key].fromObject(stylesObject[key])}}return styles},bringToFront:function(node){var nodes,sendList;if(node!==null){nodes=this.flattenNodes(false);sendList=this.__separateNodeSendToList(node,nodes);nodes=nodes.concat(sendList);return this.reorderNodes(nodes)}},sendToBack:function(node){var nodes,sendList;if(node!==null){nodes=this.flattenNodes(false);sendList=this.__separateNodeSendToList(node,nodes);nodes=sendList.concat(nodes);return this.reorderNodes(nodes)}},reorderNodes:function(nodes){var i,n,orderList=[];for(i=0;i<nodes.length;i++){n=nodes[i];if(n._order!=="auto"){orderList.push({id:n.getId(),order:n.getOrder(),newOrder:i});n.setOrder(i)}}return orderList},__separateNodeSendToList:function(node,flatNodeList){var ids,i,j,n,childrenList,sendList=[];ids=(node instanceof _gliffy.Node)?[node]:node;for(i=0;i<ids.length;i++){n=ids[i];flatNodeList.splice($.inArray(n,flatNodeList),1);if(ids.length===1&&n.children&&n.children.length>0){childrenList=n.flattenChildren();for(j=0;j<childrenList.length;j++){flatNodeList.splice($.inArray(childrenList[j],flatNodeList),1)}sendList=sendList.concat(childrenList)}sendList.push(n)}return sendList},flattenNodes:function(forceUpdate){var nodes=[],i=0;for(i=0;i<this.objects.length;i++){this.__preorder(this.objects[i],nodes,forceUpdate)}this.updateBounds();nodes=nodes.sort(function(n1,n2){var result=n1.getOrder()-n2.getOrder();if(result===0){if(n1.isAChildOf(n2)){return 1}else{if(n2.isAChildOf(n1)){return -1}else{return n1.getId()>n2.getId()?1:-1}}}else{return result}});return nodes},__preorder:function(node,array,forceUpdate){var c=0;if(!node){return}if(forceUpdate){if(node.getGraphic()){node.getGraphic().markDirty()}node.markDirty()}if(node.isDirty()){node.update()}array.push(node);for(c=0;node.children&&c<node.children.length;c++){this.__preorder(node.children[c],array,forceUpdate)}},detachSelectionFromGroup:function(parentNode){var stage=this,childNode,childTransform,childPos,parentParentNode,selectedNodeIds=[],children=[],i;while(parentNode.children.length){childNode=parentNode.children[0];selectedNodeIds.push(childNode.getId());parentParentNode=childNode.parent.parent;childTransform=childNode.worldTransform.clone();childPos=childTransform.transformPoint(childNode.getWidth()/2,childNode.getHeight()/2);childNode.setX(childPos.x-childNode.getWidth()/2);childNode.setY(childPos.y-childNode.getHeight()/2);childNode.setRotation(childNode.getRotation()+parentNode.getRotation());stage.removeNode(childNode,false);stage.appendNode(childNode,parentParentNode);children.push(childNode)}return selectedNodeIds},attachSelectionToGroup:function(group,nodes){var boundingBox=_gliffy.BoundingBox.SMALLEST.clone(),i,node,stage=this;group.update();this.__updateGroupAndBounds(group,nodes,boundingBox);for(i=0;i<nodes.length;i++){node=nodes[i];if(!node.isProxy()){node.setX(node.getX()-group.getX());node.setY(node.getY()-group.getY());stage.removeNode(node,false);stage.appendNode(node,group)}}},__updateGroupAndBounds:function(group,nodes,boundingBox){var i,node,dimension,stage=this;for(i=0;i<nodes.length;i++){node=nodes[i];if(!node.isProxy()){node.update();boundingBox.add(node.worldOverlayAabb)}}group.setX(boundingBox.min.x);group.setY(boundingBox.min.y);dimension=boundingBox.getDimension();group.setWidth(dimension.x);group.setHeight(dimension.y)},addSelectionToGroup:function(group,nodes){var i,node,stage=this,point,inverse,lastBB;group.update();lastBB=group.worldAabb.clone();this.__updateGroupAndBounds(group,nodes,group.worldAabb.clone());group.update();for(i=0;group.children&&i<group.children.length;i++){node=group.children[i];node.setX(node.getX()-(group.worldAabb.min.x-lastBB.min.x));node.setY(node.getY()-(group.worldAabb.min.y-lastBB.min.y))}for(i=0;i<nodes.length;i++){node=nodes[i];if(!node.isProxy()){node.update();stage.removeNode(node,false);stage.appendNode(node,group);node.setX(node.getX()-group.getX());node.setY(node.getY()-group.getY())}}},hasObjects:function(){return(this.objects!==null&&this.objects.length>0)}})}());(function(){var MIN_VERSION="1",CURRENT_VERSION="1.1",ROOT_URL="/",CONTENT_TYPE="application/gliffy+json";function isValidVersion(version){var min=parseInt(MIN_VERSION,10),max=parseInt(CURRENT_VERSION,10);version=parseInt(version,10);return min<=version&&version<=max}_gliffy.Gon=_gliffy.Serializable.extend({version:null,stage:null,metadata:null,embeddedResources:null,init:function(options){this.stage=new _gliffy.Stage(options);this.stage.gon=this;this.metadata=this.getDefaultMetadata();this.embeddedResources=new _gliffy.EmbeddedResources()},getDefaultMetadata:function(){return{title:"untitled",revision:0,exportBorder:false}},getMetadata:function(){return this.metadata},setMetadata:function(o){this.metadata=$.extend(this.getDefaultMetadata(),o)},getEmbeddedResources:function(){return this.embeddedResources},updateProperty:function(prop,value){if(this["set"+prop]!==undefined){this["set"+prop](value)}else{this.stage.updateProperty(prop,value)}},__toObject:function(){var object=null,self=this,embeddedResources=null;_gliffy.Utils.tryCatch(function(){object=self.stage.toObject();embeddedResources=self.embeddedResources.toObject()},function(e){_gliffy.handleError("com.gliffy.error.file_save_malformed",[],e,self.errorTarget)});if(object!==null){return{contentType:CONTENT_TYPE,version:CURRENT_VERSION,metadata:this.metadata,embeddedResources:embeddedResources,stage:object}}else{return null}},fromObject:function(object,opt){if(!object.version||!isValidVersion(object.version)){_gliffy.Logger.error("gon.fromObject failed. The file being loaded is not a valid version:"+object.version);throw new Error("The file being loaded is not a valid version: "+object.version)}else{this.setMetadata(object.metadata);this.stage.fromObject(object.stage,opt);this.embeddedResources.fromObject(object.embeddedResources)}return this},__populateUids:function(nodes,uids){var i,uid,node;for(i=0;i<nodes.length;i++){node=nodes[i];uid=node.getUid();if($.inArray(uid,uids)===-1&&uid){uids.push(uid)}if(node.children){this.__populateUids(node.children,uids)}}},loadEditableProperties:function(callback){if(!_gliffy.shapeLibrary){throw new Error("the shapeLibrary instance has not been initialized.")}var uids=[];this.__populateUids(this.stage.objects,uids);_gliffy.shapeLibrary.loadShapes(uids,this.errorTarget).done(callback)},__registerShapes:function(callBack){var i,tids=[],nodes,graphic,tid,deferred=[],svg,resource;if(!_gliffy.shapeLibrary){throw new Error("the shapeLibrary instance has not been initialized.")}nodes=this.__flattenNodes(this.stage);for(i=0;i<nodes.length;i++){graphic=nodes[i].getGraphic();if(graphic){if(graphic instanceof _gliffy.Svg&&graphic.getTid()==="com.gliffy.stencil.custom.svg.static"){resource=this.getEmbeddedResources().getResource(graphic.getEmbeddedResourceId());svg=resource.getData();deferred.push(_gliffy.shapeLibrary.loadSvgStencil(svg,resource,true))}else{if(graphic instanceof _gliffy.Shape&&$.inArray(graphic.getTid(),tids)===-1){tids.push(graphic.getTid())}else{if(graphic instanceof _gliffy.Line){tid=graphic.getStartArrowTid();if(tid&&$.inArray(graphic.getTid(),tids)===-1){tids.push(tid)}tid=graphic.getEndArrowTid();if(tid&&$.inArray(graphic.getTid(),tids)===-1){tids.push(tid)}}}}}}deferred.push(_gliffy.shapeLibrary.loadStencils(tids,this.errorTarget));$.when.apply(null,deferred).done(callBack)},__flattenNodes:function(stage){var i,nodes=[];for(i=0;i<stage.objects.length;i++){this.__preorder(stage.objects[i],nodes)}return nodes},__preorder:function(node,array){var c;if(!node){return}array.push(node);for(c=0;node.children&&c<node.children.length;c++){this.__preorder(node.children[c],array)}}})}());(function(){_gliffy.Document=_gliffy.Serializable.extend({__gon:null,__image:null,__title:"untitled",__revision:0,__urls:null,editable:null,errorTarget:null,init:function(options){this.__gon=new _gliffy.Gon(options);this.__gon.stage.document=this;this.__urls={};this.editable=_gliffy.Editor!==undefined},getUrls:function(){return this.__urls},getGon:function(){return this.__gon},getStage:function(){return this.__gon.stage},getImage:function(){return this.__image},setImage:function(image){this.__image=image},getMetadata:function(){return this.__gon.getMetadata()},getEmbeddedResources:function(){return this.__gon.getEmbeddedResources()},setMetadata:function(metadata){this.__gon.setMetadata(metadata)},setTitle:function(title){this.__title=title},getTitle:function(){return this.__title||"untitled"},getCurrentRevision:function(){return this.__revision||0},setCurrentRevision:function(rev){this.__revision=rev},loadFromObject:function(object,callback){try{this.fromObject(object);var self=this;this.__gon.__registerShapes(function(){if(self.editable){self.__gon.loadEditableProperties(function(){self.getStage().update();if(callback){callback()}})}else{if(callback){callback()}}})}catch(e){if(callback){callback()}_gliffy.handleError("com.gliffy.error.file_malformed",[],e)}},loadFromText:function(text,callback){this.loadFromObject($.parseJSON(text),callback)},updateProperty:function(prop,value){this.__gon.updateProperty(prop,value)},refreshFromObject:function(object){this.__urls=object.urls||{};this.__title=object.title;this.__revision=object.revision;return this},isNewNotDirty:function(){return(this.getCurrentRevision()===0&&!this.getStage().isDirty())},convertToTemplate:function(){this.__title="untitled";this.__revision=0},__toObject:function(){var object=null,self=this;_gliffy.Utils.tryCatch(function(){object=self.__gon.toObject()},function(e){_gliffy.handleError("com.gliffy.error.file_save_malformed",[],e,self.errorTarget)});if(object!==null){return{gon:object,image:this.__image,urls:this.__urls,title:this.__title,revision:this.__revision}}else{return null}},fromObject:function(object){if(object.gon){this.__gon.fromObject(object.gon);this.__image=object.image;this.__urls=object.urls||{};this.__title=object.title;this.__revision=object.revision;return this}else{this.__gon.fromObject(object);this.__image=null;this.__urls=object.urls||{};this.__title=object.title;this.__revision=object.revision;return this}}})}());(function(){_gliffy.IntegrationHandler=_gliffy.Class.extend({closeLastTab:function(edtior){throw new Error("The integration point 'closeLastTab' is not defined and is required.")},checkDraft:function(document,successCallback,errorCallback){throw new Error("The integration point 'checkDraft' is not defined and is required.")},saveDraft:function(document,successCallback,errorCallback){throw new Error("The integration point 'saveDraft' is not defined and is required.")},getDraft:function(url,successCallback,errorCallback){throw new Error("The integration point 'getDraft' is not defined and is required.")},deleteDraft:function(document,successCallback,errorCallback){throw new Error("The integration point 'deleteDraft' is not defined and is required.")}});_gliffy.IntegrationHandler.validate=function(integration){var key,integrationHandle;for(key in _gliffy.IntegrationHandler.prototype){integrationHandle=integration[key];if(integrationHandle===_gliffy.IntegrationHandler.prototype){throw new Error("The integration handle interface was not defined: "+key)}else{if(typeof(integrationHandle)!=="function"){throw new Error("The integration handler must be a function: "+key)}}}}}());(function(){_gliffy._UndoStateManager=_gliffy.Class.extend({__undo:null,__documentManager:null,__overlayManager:null,init:function(){this.__undo=new _gliffy.PrototypeUndo()},setContext:function(o){if(!o){throw new Error("undoManager setContext needs options")}if(!o.target){throw new Error("undoManager needs target")}if(!o.documentManager){throw new Error("undoManager needs documentManager")}if(!o.overlayManager){throw new Error("undoManager needs overlayManager")}this.__documentManager=o.documentManager;this.__target=o.target;this.__overlayManager=o.overlayManager},__renderJson:function(j){if(this.__documentManager&&this.__target){this.__documentManager.render({jsonObj:j,target:this.__target})}},undo:function(){if(this.__undo.getIdx()!==0){var u=this.__undo.undo();if(u!==null){this.__renderJson(u.doc)}}},redo:function(){var r=this.__undo.redo();if(r!==null){this.__renderJson(r.doc)}},record:function(selectedNode){if(this.__documentManager){var r=this.__undo.record({doc:this.__documentManager.getActiveDocument().toObject(),selected:selectedNode?selectedNode.getId():null})}}})}());(function(){_gliffy.EditableLine=_gliffy.Editable.extend({__lockSegments:null,__overridePoints:null,__adjustedPath:null,_startContraintUpdate:null,_endContraintUpdate:null,__CURVELENGTH:10,__OFFSET:40,allowComputeBestPath:false,allowClearLocks:true,__updateNum:0,__previousWorldControlPath:null,__previousEndPoint:null,__previousStartPoint:null,__TABLE:[[[["sp","tl","tr","br"],["sp","tl","tr","br","ep"],["sp","tl","tc","bc","br","ep"],["sp","tl","tc","bc","br"],["sp","tl","tr","br"]],[["tl","tr","br"],["tl","tr","br","ep"],["tl","tc","bc","br","ep"],["tl","tc","bc","br"],{path1:["tl","tc","bc","br"],path2:["tl","tr","br"]}],[["tl","cl","cr","br"],["tl","cl","cr","br","ep"],["tl","bl","br","ep"],["tl","bl","br"],{path1:["tl","bl","br"],path2:["tl","cl","cr","br"]}],[["sp","tl","cl","cr","br"],["sp","tl","cl","cr","br","ep"],["sp","tl","bl","br","ep"],["sp","tl","bl","br"],["sp","tl","bl","br"]],[{path1:["tl","tr","br"],path2:["tl","cl","cr","br"]},["tl","tr","br","ep"],["tl","bl","br","ep"],{path1:["tl","tc","bc","br"],path2:["tl","bl","br"]},null]],[[["sp","tr","tl","bl"],["sp","tr","tc","bc","bl"],["sp","tr","tc","bc","bl","ep"],["sp","tr","tl","bl","ep"],["sp","tr","tl","bl"]],[["sp","tr","cr","cl","bl"],["sp","tr","br","bl"],["sp","tr","br","bl","ep"],["sp","tr","cr","cl","bl","ep"],["sp","tr","br","bl"]],[["tr","cr","cl","bl"],["tr","br","bl"],["tr","br","bl","ep"],["tr","cr","cl","bl","ep"],{path1:["tr","br","bl"],path2:["tr","cr","cl","bl"]}],[["tr","tl","bl"],["tr","tc","bc","bl"],["tr","tc","bc","bl","ep"],["tr","tl","bl","ep"],{path1:["tr","tc","bc","bl"],path2:["tr","tl","bl"]}],[{path1:["tr","tl","bl"],path2:["tr","cr","cl","bl"]},{path1:["tr","tc","bc","bl"],path2:["tr","br","bl"]},["tr","br","bl","ep"],["tr","tl","bl","ep"],null]]],init:function(o){this._super(o);this.isEditable=true;this.__lockSegments={}},isSegmentHorizontal:function(index){return _gliffy.Utils.isHorizontal(this.__graphic.getWorldControlPoint(index),this.__graphic.getWorldControlPoint(index+1))},scaleControlPath:function(scaleX,scaleY){var i,controlPoint,controlPath;if(scaleX!==1||scaleY!==1){controlPath=this.__graphic.getControlPath();for(i=0;i<controlPath.length;i++){controlPoint=controlPath[i];controlPoint[0]*=scaleX;controlPoint[1]*=scaleY}this.__graphic.setControlPath(controlPath)}},setLockSegment:function(index,value){if(value){this.__lockSegments[index]=value}else{delete this.__lockSegments[index]}this.__graphic.markDirty()},getLockSegments:function(){return $.extend({},this.__lockSegments)},setLockSegments:function(lockSegments){this.__lockSegments=$.extend({},lockSegments)},isLockSegment:function(index){return this.__lockSegments[index]||false},clearLockSegments:function(){this.__lockSegments={};this.__graphic.markDirty()},setStartPoint:function(sp){this.__graphic.setControlPoint(0,sp)},setEndPoint:function(ep){this.__graphic.setControlPoint(this.__graphic.getControlPointCount()-1,ep)},setWorldStartPoint:function(sp){if(this.__graphic.getStartConnectionId()!==null){this.__graphic.setWorldControlPoint(0,sp)}},setWorldEndPoint:function(ep){if(this.__graphic.getEndConnectionId()!==null){this.__graphic.setWorldControlPoint(this.__graphic.getControlPointCount()-1,ep)}},setConnectionStart:function(graphicNode,graphicConnectionIdx){var ratio=null;if(graphicNode){if(!graphicNode.supportsConnections()){throw new Error("line.editable.setConnectionStart expects graphicNode to support connections")}ratio=graphicNode.getConnectionPointRatio(graphicConnectionIdx)}this.__graphic.setStartConnection(graphicNode,ratio)},clearConnectionStart:function(){this.__graphic.setStartConnection(null)},setConnectionEnd:function(graphicNode,graphicConnectionIdx){var ratio=null;if(graphicNode){if(!graphicNode.supportsConnections()){throw new Error("line.editable.setConnectionEnd expects graphicNode to support connections")}ratio=graphicNode.getConnectionPointRatio(graphicConnectionIdx)}this.__graphic.setEndConnection(graphicNode,ratio)},clearConnectionEnd:function(){this.__graphic.setEndConnection(null)},getConnectionStart:function(){var startConnection=this.__graphic.getStartConnection();if(startConnection){return{node:startConnection,index:startConnection.getConnectionIndexByRatio(this.__graphic.getStartConnectionRatio())}}else{return null}},getConnectionEnd:function(){var endConnection=this.__graphic.getEndConnection();if(endConnection){return{node:endConnection,index:endConnection.getConnectionIndexByRatio(this.__graphic.getEndConnectionRatio())}}else{return null}},getWorldStartPoint:function(){return this.__graphic.getWorldControlPoint(0)},getStartPoint:function(){return this.__graphic.getControlPoint(0)},getWorldEndPoint:function(){return this.__graphic.getWorldControlPoint(this.__graphic.getControlPointCount()-1)},getEndPoint:function(){return this.__graphic.getControlPoint(this.__graphic.getControlPointCount()-1)},__getOrthoBoundingBox:function(sp,ep,sv,ev,offset){var spPlusOffset=_gliffy.Vec2.sum(sp,sv.clone().scale(offset)),epPlusOffset=_gliffy.Vec2.sum(ep,ev.clone().scale(offset)),lp,rp,lv,rv,lpPlusOffset,rpPlusOffset,boundingBox;if(sp.x<ep.x){lp=sp;rp=ep;lv=sv;rv=ev;lpPlusOffset=spPlusOffset;rpPlusOffset=epPlusOffset}else{lp=ep;rp=sp;lv=ev;rv=sv;lpPlusOffset=epPlusOffset;rpPlusOffset=spPlusOffset}if(lv.x===1&&(lpPlusOffset.x>rp.x)){lpPlusOffset.x=rp.x}if(rv.x===-1&&(rpPlusOffset.x<lp.x)){rpPlusOffset.x=lp.x}if(ev.y===-1&&(epPlusOffset.y<sp.y)){epPlusOffset.y=sp.y}if(sv.y===1&&(spPlusOffset.y>sp.y)){spPlusOffset.y=ep.y}boundingBox=_gliffy.BoundingBox();boundingBox.fit([sp.x,sp.y,spPlusOffset.x,spPlusOffset.y,ep.x,ep.y,epPlusOffset.x,epPlusOffset.y]);return boundingBox},__isZero:function(vec){return vec.x===vec.y&&vec.x===0},__getMidpoint:function(sp,ep){return _gliffy.Vec2.sum(sp,ep).scale(0.5)},__orthoLine:function(entry,rect,sp,ep){var line=[],i=0,pt,mp=rect.getCenter(),points={sp:sp,ep:ep,tl:rect.min,br:rect.max,tr:new _gliffy.Vec2(rect.max.x,rect.min.y),bl:new _gliffy.Vec2(rect.min.x,rect.max.y),cl:new _gliffy.Vec2(rect.min.x,mp.y),cr:new _gliffy.Vec2(rect.max.x,mp.y),tc:new _gliffy.Vec2(mp.x,rect.min.y),bc:new _gliffy.Vec2(mp.x,rect.max.y)};for(i=0;i<entry.length;i++){pt=points[entry[i]];line.push([pt.x,pt.y])}return line},__enumCardinalUnitVec:function(vec){if(vec.x===0&&vec.y===0){return 4}if(vec.y===-1){return 0}if(vec.x===1){return 1}if(vec.y===1){return 2}if(vec.x===-1){return 3}},__getZigZag:function(sp,ep,bVertical){var mid=this.__getMidpoint(sp,ep);if(bVertical){return[[sp.x,sp.y],[mid.x,sp.y],[mid.x,ep.y],[ep.x,ep.y]]}else{return[[sp.x,sp.y],[sp.x,mid.y],[ep.x,mid.y],[ep.x,ep.y]]}},__sign:function(num){if(num<0){return -1}if(num>0){return 1}return 0},__toCardinalUnit:function(vec){if(this.__isZero(vec)){return vec}vec.normalize();if(Math.abs(vec.x)>Math.abs(vec.y)){return new _gliffy.Vec2(this.__sign(vec.x),0)}else{return new _gliffy.Vec2(0,this.__sign(vec.y))}},__facingVectors:function(entry){var valid={"020":true,"013":true,"120":true,"131":true,"014":true,"141":true,"124":true,"024":true,"134":true,"043":true,"040":true,"140":true};return valid[entry]===true},computeBestPath:function(){var worldControlPath=this.__graphic.getWorldControlPath(),sp_=new _gliffy.Vec2(worldControlPath[0][0],worldControlPath[0][1]),ep_=new _gliffy.Vec2(worldControlPath[worldControlPath.length-1][0],worldControlPath[worldControlPath.length-1][1]),sv_=new _gliffy.Vec2(0,0),ev_=new _gliffy.Vec2(0,0),sc=this.getConnectionStart(),ec=this.getConnectionEnd(),shapeGraphic,p,q,r,sp,ep,sv,ev,swapped,rect,entry,path,strEntry,dims,distance,snapData,snapDegrees,xInterp,yInterp,i;if(sc){shapeGraphic=sc.node.getGraphic();sv_=sc.node.getConnectionVector(sc.index)}if(ec){shapeGraphic=ec.node.getGraphic();ev_=ec.node.getConnectionVector(ec.index)}sv_=this.__toCardinalUnit(sv_);ev_=this.__toCardinalUnit(ev_);if(this.__graphic.isOrtho()){swapped=false;if(sp_.y<ep_.y){sp=sp_;sv=sv_;ep=ep_;ev=ev_}else{sp=ep_;sv=ev_;ep=sp_;ev=sv_;swapped=true}rect=this.__getOrthoBoundingBox(sp,ep,sv,ev,this.__OFFSET);p=(sp.x<ep.x)?0:1;q=this.__enumCardinalUnitVec(sv);r=this.__enumCardinalUnitVec(ev);entry=this.__TABLE[p][q][r];if(entry===null){dims=rect.getDimension();path=this.__getZigZag(sp,ep,dims.x>dims.y);strEntry=(dims.x>dims.y)?"z0":"z1"}else{if(entry instanceof Array){path=this.__orthoLine(this.__TABLE[p][q][r],rect,sp,ep);strEntry=[p,q,r].join("")}else{path=this.__orthoLine(this.__TABLE[p][q][r].path1,rect,sp,ep);if(Math.abs(path[path.length-1][0]-path[0][0])>Math.abs(path[path.length-1][1]-path[0][1])){strEntry=[p,q,r].join("")}else{path=this.__orthoLine(this.__TABLE[p][q][r].path2,rect,sp,ep)}}}if((sc||ec)&&this.__facingVectors(strEntry)){distance=(_gliffy.Vec2.distance(ep,sp));if(distance>15){snapDegrees=_gliffy.Utils.SNAP_DEGREES_MULTIPLIER/distance;snapData=_gliffy.Utils.calculateLineSnap(ep,sp,snapDegrees);if(snapData.snapped){this.allowComputeBestPath=true;this.__previousWorldControlPath=this.__graphic.getWorldControlPath();path[path.length-1][0]=snapData.point.x;path[path.length-1][1]=snapData.point.y;xInterp=(path[path.length-1][0]-path[0][0])/(path.length-1);yInterp=(path[path.length-1][1]-path[0][1])/(path.length-1);for(i=1;i<path.length-1;i++){path[i][0]=path[0][0]+xInterp*i;path[i][1]=path[0][1]+yInterp*i}}}}if(swapped){path.reverse()}if(this.__previousWorldControlPath!==undefined&&this.__previousWorldControlPath!==null&&this.allowClearLocks){if(this.__previousWorldControlPath.length!==path.length){this.__lockSegments={}}else{for(i=0;i<this.__graphic.getSegmentCount();i++){if(this.__isHorizontal(this.__previousWorldControlPath[i],this.__previousWorldControlPath[i+1])!==this.__isHorizontal(path[i],path[i+1])){this.__lockSegments={};break}}}}for(i=0;i<worldControlPath.length-1;i++){if(this.isLockSegment(i)){if(this.isSegmentHorizontal(i)){if(path[i]&&path[i].length>1&&worldControlPath[i]&&worldControlPath[i].length>1){path[i][1]=worldControlPath[i][1]}if(path[i+1]&&path[i+1].length>1&&worldControlPath[i+1]&&worldControlPath[i+1].length>1){path[i+1][1]=worldControlPath[i+1][1]}}else{if(path[i]&&path[i].length>0&&worldControlPath[i]&&worldControlPath[i].length>0){path[i][0]=worldControlPath[i][0]}if(path[i+1]&&path[i+1].length>0&&worldControlPath[i+1]&&worldControlPath[i+1].length>0){path[i+1][0]=worldControlPath[i+1][0]}}}}}else{path=[[sp_.x,sp_.y],[ep_.x,ep_.y]]}if(this.allowComputeBestPath&&this.__previousWorldControlPath!==null){this.__previousWorldControlPath=path;this.__graphic.setWorldControlPath(path)}if(this.__previousWorldControlPath===null){if(this.__updateNum>0){this.__previousWorldControlPath=this.__graphic.getWorldControlPath()}this.__updateNum++}},hasChangedStartPoint:function(){var hasChanged=false;if(this.__previousStartPoint){if(!_gliffy.Utils.equalPoints(this.__previousStartPoint,this.__graphic.getWorldControlPath()[0],0.1)){hasChanged=true}}this.__previousStartPoint=[this.__graphic.getWorldControlPath()[0][0],this.__graphic.getWorldControlPath()[0][1]];return hasChanged},hasChangedEndPoint:function(){var hasChanged=false,worldPath=this.__graphic.getWorldControlPath();if(this.__previousEndPoint){if(!_gliffy.Utils.equalPoints(this.__previousEndPoint,worldPath[worldPath.length-1],0.1)){hasChanged=true}}this.__previousEndPoint=[worldPath[worldPath.length-1][0],worldPath[worldPath.length-1][1]];return hasChanged},__isHorizontal:function(startPoint,endPoint){if(startPoint&&endPoint){return Math.abs(startPoint[1]-endPoint[1])<0.001}else{return false}},getMagnitudeAndAxis:function(pos){var mag=1,axis="x",rot=null,points=this.__graphic.getControlPath();if(this.__graphic.isOrtho()){if(pos==="start"){axis=this.getSegmentAxis(0);mag=this.getSegmentMagnitude(0,axis)}else{axis=this.getSegmentAxis(points.length-2);mag=this.getSegmentMagnitude(points.length-2,axis)}return{mag:mag,axis:axis}}else{rot=this.__graphic.getNormalizedSegmentAngle(points[0],points[1]);if(rot>45&&rot<135){mag=1;axis="y"}else{if(rot>135&&rot<225){mag=-1;axis="x"}else{if(rot>225&&rot<315){mag=-1;axis="y"}}}}return{mag:mag,axis:axis}},getSegmentAxis:function(segment){return this.isSegmentHorizontal(segment)?"x":"y"},getSegmentMagnitude:function(segment,axis){var path=this.__graphic.getControlPath(),idx=(axis==="y")?1:0;if(path[segment][idx]<path[segment+1][idx]){return 1}else{return -1}},setOrthoMode:function(orthoMode){switch(orthoMode){case _gliffy.Editor.ORTHO_MODE.bezel:this.__graphic.setInterpolationType(_gliffy.Line.INTERPOLATION_TYPE.linear);this.__graphic.setCornerRadius(10);break;case _gliffy.Editor.ORTHO_MODE.curved:this.__graphic.setInterpolationType(_gliffy.Line.INTERPOLATION_TYPE.quadratic);this.__graphic.setCornerRadius(null);break;default:this.__graphic.setInterpolationType(_gliffy.Line.INTERPOLATION_TYPE.linear);this.__graphic.setCornerRadius(null);break}},getOrthoMode:function(){if(this.__graphic.getInterpolationType()===_gliffy.Line.INTERPOLATION_TYPE.quadratic){return _gliffy.Editor.ORTHO_MODE.curved}else{if(this.__graphic.getCornerRadius()){return _gliffy.Editor.ORTHO_MODE.bezel}else{return _gliffy.Editor.ORTHO_MODE.straight}}},__toObject:function(){return{lockSegments:this.__lockSegments}},__fromObject:function(obj){if(obj.lockSegments!==undefined){this.__lockSegments=obj.lockSegments;if(this.__lockSegments===null){this.__lockSegments={}}}}})}());(function(){_gliffy.EditableText=_gliffy.Editable.extend({__editMode:false,__focusNextFrame:false,__selectNextFrame:false,__setCursorEndNextFrame:false,__keyEvent:null,__dMode:false,__prevDragMode:"none",init:function(o){this._super(o);this.isEditable=true},setEditMode:function(bool){if(this.__editMode!==bool){this.__editMode=bool;this.__graphic.markDirty()}},applyTheme:function(o){var ed,options=$.extend({color:null,bold:null,italic:null,underline:null},o),anyOptions=false,displayCSS;$.each(options,function(key,value){if(value){anyOptions=true}return false});if(anyOptions){var node=this.__graphic;$.each(options,function(key,value){if(value!==null){if(key==="color"){GLIFFY.editor.overlayManager.textControl.setActiveObject(node);GLIFFY.editor.overlayManager.textControl.setActiveObjectColor(value)}}})}},getEditMode:function(){return this.__editMode},focus:function(){this.__focusNextFrame=true},setCursorEnd:function(){this.__setCursorEndNextFrame=true},setKeyEvent:function(event){this.__keyEvent=event},getKeyEvent:function(){return this.__keyEvent},select:function(){this.__selectNextFrame=true},shouldFocus:function(){return this.__focusNextFrame},shouldSelect:function(){return this.__selectNextFrame},shouldSetCursorEnd:function(){return this.__setCursorEndNextFrame},clearModifiers:function(){this.__focusNextFrame=false;this.__selectNextFrame=false;this.__setCursorEndNextFrame=false;this.__keyEvent=null},__checkDMode:function(content,callback){var self=this,hsv,interval,prevBg;if($(content).text()==="D!sco Gl!ffy"){if(self.__dMode){self.__dMode=false}else{hsv={hue:0,sat:100,val:100};self.__dMode=true;prevBg=self.__graphic.node.stage.background;interval=setInterval(function(){if(self.__dMode){hsv.hue=(hsv.hue+1)%360;self.__graphic.node.stage.background=_gliffy.Utils.hsv2rgb(hsv)}else{clearInterval(interval);self.__graphic.node.stage.background=prevBg}if(callback){callback()}},16)}}},registerBlurHandler:function(callback){}})}());(function(){_gliffy._ConnectionPointPattern=_gliffy.Class.extend({patterns:{Midpoint:[{pos:{x:0.5,y:0},vec:{x:0,y:-1}},{pos:{x:0,y:0.5},vec:{x:-1,y:0}},{pos:{x:1,y:0.5},vec:{x:1,y:0}},{pos:{x:0.5,y:1},vec:{x:0,y:1}}],Center:[{pos:{x:0.5,y:0.5},vec:[{x:0,y:0}]}]},computePolyPoints:function(polygonSides){var halfAngle=Math.PI/polygonSides;var angle=2*halfAngle;var radius=0.5/Math.cos(halfAngle);var points=[];for(var i=0;i<polygonSides;i++){points.push(new _gliffy.Vec2(Math.cos(i*angle)*radius,Math.sin(i*angle)*radius))}var transform=new _gliffy.AffineTransform();if((polygonSides&1)==1){transform.rotate(-Math.PI/2,0.5,0.5)}else{transform.rotate(halfAngle-Math.PI/2,0.5,0.5)}var transformedPointsX=[];var transformedPointsY=[];for(var i=0;i<points.length;i++){var transformed=transform.transformPoint(points[i].x,points[i].y);transformedPointsX.push(transformed.x);transformedPointsY.push(transformed.y)}var transformedPoints=[];var maxPoint=new _gliffy.Vec2(_gliffy.Utils.maxInArray(transformedPointsX),_gliffy.Utils.maxInArray(transformedPointsY));var minPoint=new _gliffy.Vec2(_gliffy.Utils.minInArray(transformedPointsX),_gliffy.Utils.minInArray(transformedPointsY));for(var i=0;i<transformedPointsX.length&&i<transformedPointsY.length;i++){var x=_gliffy.Utils.convertRanges(transformedPointsX[i],minPoint.x,maxPoint.x,0,1);var y=_gliffy.Utils.convertRanges(transformedPointsY[i],minPoint.y,maxPoint.y,0,1);transformedPoints.push(new _gliffy.Vec2(x,y))}return transformedPoints},createPolyPattern:function(name,numSides){var almostPoint5=function(vec2){return vec2.x>0.49999999&&vec2.x<0.50000001&&vec2.y>0.49999999&&vec2.y<0.50000001};var points=this.computePolyPoints(numSides);this.patterns[name]=[];for(var i=0;i<points.length;i++){var vec=new _gliffy.Vec2(0,0);var point=points[i];if(!almostPoint5(point)){vec.x=point.x-0.5;vec.y=point.y-0.5;vec=vec.normalize()}this.patterns[name].push({pos:point,vec:vec})}},init:function(o){this.createPolyPattern("Triangle",3);this.createPolyPattern("Pentagon",5);this.createPolyPattern("Hexagon",6);this.createPolyPattern("Octagon",8);this.patterns.LeftRight=[$.extend(true,{},this.patterns.Midpoint[1]),$.extend(true,{},this.patterns.Midpoint[2])];this.createPolyPattern("RightTriangle",4);this.patterns.RightTriangle=this.patterns.RightTriangle.slice(1,4);this.patterns.LeftMidpoint=[$.extend(true,{},this.patterns.Midpoint[1])];this.patterns.TopMidpoint=[$.extend(true,{},this.patterns.Midpoint[0])];this.patterns.BottomMidpoint=[$.extend(true,{},this.patterns.Midpoint[3])]}});_gliffy.ConnectionPointPattern=new _gliffy._ConnectionPointPattern()})();(function(){var _tempBB=new _gliffy.BoundingBox();function __sort(node1,node2){return node2.getOrder()-node1.getOrder()}_gliffy.Tree={tree:new _gliffy.RTree(5000),clear:function(){this.tree=new _gliffy.RTree(5000);if(_gliffy.Debug.SHOW_RTREE){$(".gliffy-stage").find(".rtree").remove()}},searchPoint:function(x,y,padding){var rect=padding?{x:x-padding,y:y-padding,w:padding*2,h:padding*2}:{x:x,y:y,w:0,h:0};return this.tree.search(rect)},searchSelection:function(bb){var rect=this.createRectFromBB(bb);return this.tree.search(rect)},createRect:function(node,grow){if(node.parent===null&&(node.isSelection()||node.isGroup()||node.isStandAloneText()||node.isMultipartShape())){return this.createRectFromNode(node)}else{return this.createRectFromBB(node.worldAabb,grow)}},createRectFromBB:function(bb,grow){if(grow){bb=bb.clone().extend(grow)}var d=bb.getDimension(),rect={x:Math.max(bb.min.x,0),y:Math.max(bb.min.y,0),w:d.x,h:d.y};if(bb.min.x<0){rect.w+=bb.min.x}if(bb.min.y<0){rect.h+=bb.min.y}return rect},createRectFromNode:function(node){var rect={x:Math.max(node.getX(),0),y:Math.max(node.getY(),0),w:node.getWidth(),h:node.getHeight()},bb,dim;if(node.getX()<0){rect.w+=node.getX()}if(node.getY()<0){rect.h+=node.getY()}if(node.getRotation()>0){bb=new _gliffy.BoundingBox(0,0,rect.w,rect.h);bb.transform(node.worldTransform);dim=bb.getDimension();return{x:bb.min.x,y:bb.min.y,w:dim.x,h:dim.y}}else{return rect}},add:function(node,addChildren){var i,rect,grow;if(node.isSelectable()){if(node.getGraphic()&&node.getGraphic().getStrokeWidth){grow=node.getGraphic().getStrokeWidth()}rect=this.createRect(node,grow);if(_gliffy.Debug.SHOW_RTREE){$(".gliffy-stage").append($("<div/>",{id:"rtree"+node.getId(),"class":"rtree"}).css({top:rect.y,left:rect.x,width:rect.w,height:rect.h,background:"green",border:"1px solid red",position:"absolute",opacity:0.25,zIndex:7000}).text(node.getId()+" "+node.getUid()))}this.tree.insert(rect,""+node.getId());if(addChildren&&node.children&&node.children.length>0){for(i=0;i<node.children.length;i++){this.add(node.children[i],addChildren)}}}},remove:function(node,removeChildren){var rect=this.createRect(node),removed,i;removed=this.tree.remove(rect,""+node.getId());if(_gliffy.Debug.SHOW_RTREE){$(".gliffy-stage").find("#rtree"+node.getId()).remove()}if(!removed||removed.length===0){this.tree.remove({x:0,y:0,w:5000,h:5000},""+node.getId())}if(removeChildren&&node.children&&node.children.length>0){for(i=0;i<node.children.length;i++){this.remove(node.children[i],removeChildren)}}}};_gliffy.Pick={pickAllNodesInside:function(nodes,boundingBox){var result=this.__pickAllNodesInsideTree(nodes,boundingBox);return result},pickAllNodesAt:function(nodes,x,y,padding){var result=this.__pickAllNodesAtLinear(nodes,x,y,padding);return result},selectNodesInclusive:function(nodes,boundingBox){var i,search,node,result=[],stage;if(nodes.length>0){stage=nodes.length>0?nodes[0].stage:null;search=_gliffy.Tree.searchSelection(boundingBox);for(i=0;i<search.length;i++){node=stage.find(search[i]);if(node){result.push(node)}}result=$.grep(result,function(n,i){return $.inArray(n,nodes)!==-1});result.sort(__sort)}return result},__pickAllNodesInsideTree:function(nodes,boundingBox){var i,search,node,result=[],stage;if(nodes.length>0){stage=nodes.length>0?nodes[0].stage:null;search=_gliffy.Tree.searchSelection(boundingBox);for(i=0;i<search.length;i++){node=stage.find(search[i]);if(node&&this.isNodeInside(node,boundingBox)){result.push(node)}}result=$.grep(result,function(n,i){return $.inArray(n,nodes)!==-1});result.sort(__sort)}return result},__pickAllNodesInsideLinear:function(nodes,boundingBox){var i,node,result=[];for(i=0;i<nodes.length;i++){node=nodes[i];if(this.isNodeInside(node,boundingBox)){result.push(node)}}result.sort(__sort);return result},__isNodePicked:function(child,x,y,padding){if(child.getGraphic() instanceof _gliffy.Text){if(this.isNodePicked(child,x-child.getGraphic().style.x,y-child.getGraphic().style.y,padding)){return child}}else{if(this.isNodePicked(child,x,y,padding)){return child}}return null},__pickAllNodesAtLinear:function(nodes,x,y,padding){var i,j,k,node,child,child2,result=[];for(i=0;i<nodes.length;i++){node=nodes[i];if(node.children){for(j=0;j<node.children.length;j++){child=node.children[j];if(this.__isNodePicked(child,x,y,padding)){result.push(child)}for(k=0;child.children&&k<child.children.length;k++){child2=child.children[k];if(this.__isNodePicked(child2,x,y,padding)){result.push(child2)}}}}if(this.isNodePicked(node,x,y,padding)){result.push(node)}}result.sort(__sort);return result},flattenNodes:function(objects){var nodes=[],i;for(i=0;i<objects.length;i++){this.__preorder(objects[i],nodes)}return nodes},__preorder:function(node,array,forceUpdate){var c;if(!node){return}array.push(node);for(c=0;node.children&&c<node.children.length;c++){this.__preorder(node.children[c],array,forceUpdate)}},__pickAllNodesAtTree:function(nodes,x,y,padding){var i,search,node,result=[],flattenedNodes,stage,filter;if(nodes.length>0){stage=nodes.length>0?nodes[0].stage:null;filter=stage&&!(nodes.length===stage.objects.length&&nodes[0].getId()===stage.objects[0].getId()&&nodes[nodes.length-1].getId()===stage.objects[stage.objects.length-1].getId());search=_gliffy.Tree.searchPoint(x,y,padding);for(i=0;i<search.length;i++){node=stage.find(search[i]);if(node&&this.__isNodePicked(node,x,y,Math.max(padding,5))){result.push(node)}}if(filter){flattenedNodes=this.flattenNodes(nodes);result=$.grep(result,function(n,i){return $.inArray(n,flattenedNodes)!==-1})}result.sort(__sort)}return result},pickFirstTextChildNode:function(nodes,x,y){var i,node;if(nodes){nodes=this.pickAllNodesAt(nodes,x,y,0);for(i=0;i<nodes.length;i++){if(nodes[i].isTextChild()){return nodes[i]}}}return null},isNodePicked:function(node,x,y,padding){var point;if(node.isSelectable()){point=node.worldTransform.createInverse().transformPoint(x,y);if(padding){return _tempBB.copy(node.aabb).extend(padding).pointInside(point.x,point.y)}else{return node.aabb.pointInside(point.x,point.y)}}else{return false}},isNodeInside:function(node,boundingBox){return boundingBox.boundingBoxInside(node.worldOverlayAabb)},isNodePartiallyInside:function(node,boundingBox){return boundingBox.inBoundingBox(node.worldOverlayAabb)},shouldBeSelected:function(node,x,y){return this.getAlphaAtPixel(node,x,y)>0||node.getGraphic() instanceof _gliffy.Text||node.getShapeInformation().boundingBoxSelect||node.getUid()===null},nearEdge:function(node,x,y){var bb=node.worldAabb.clone(),diff=10;if(Math.abs(bb.min.x-x)<diff){return true}else{if(Math.abs(bb.max.x-x)<diff){return true}else{if(Math.abs(bb.min.y-y)<diff){return true}else{if(Math.abs(bb.max.y-y)<diff){return true}}}}return false},_hasText:function(nodes){var i;for(i=0;i<nodes.length;i++){if(nodes[i].getGraphic() instanceof _gliffy.Text){return true}}return false},getNodeAt:function(nodes,x,y,doNotIncludeGroup){var i,node,parent,group,swimlaneNodes,tmp,bestSoFar=null;if(nodes){nodes=this.pickAllNodesAt(nodes,x,y,0);for(i=0;i<nodes.length;i++){node=nodes[i];if(!node.isSwimlane()){if(this.shouldBeSelected(node,x,y)){if(node.getUid()===null){parent=node.getUidNode();if(parent&&parent.isSwimlane()&&parent.children){swimlaneNodes=this.pickAllNodesAt(parent.children,x,y,10);if(this._hasText(swimlaneNodes)){tmp=parent}else{if(swimlaneNodes.length>0&&swimlaneNodes[0].getGraphic()&&this.nearEdge(node,x,y)){tmp=parent}else{node=null}}}else{tmp=parent}}if(node){if(!doNotIncludeGroup){group=node.topGroup()}if(group&&node.getId()!==group.getId()){tmp=group}else{if(node.getUid()===null){tmp=parent}else{tmp=node}}if((node.getShapeInformation().boundingBoxSelect&&!(node.getShapeInformation().defaults&&node.getShapeInformation().defaults.isContainer))||node.getGraphic() instanceof _gliffy.Text||node.isMultipartShape()||this.isNodeOpaqueAt(node,x,y)||node.isSelection()){return tmp}bestSoFar=bestSoFar||tmp}}}}}return bestSoFar},getAlphaAtPixel:function(node,x,y){var element,alphaAtPixel,point,scale;element=node.getDomElement();if(element&&element.is("canvas")){scale=element.data("scale");point=element.data("transform").createInverse().transformPoint(x*scale,y*scale);alphaAtPixel=element[0].getContext("2d").getImageData(point.x,point.y,1,1).data[3];return alphaAtPixel}else{return 0}},isNodeOpaqueAt:function(node,x,y){if(node.isLine()){return this.getAlphaAtPixel(node,x,y)>0}else{return this.getAlphaAtPixel(node,x,y)>_gliffy.MIN_VISIBLE_VALUE||node.getGraphic() instanceof _gliffy.Text}},pickConnectionPoint:function(node,point,radius){var i,connectionPoint;if(node.supportsConnections()){radius*=radius;for(i=0;i<node.getConnections().length;i++){connectionPoint=node.getConnectionPoint(i);if(_gliffy.Vec2.squaredDistance(connectionPoint,point)<radius){return i}}}return null}}}());(function(){var PIXEL_SNAP_OFFSET=0.5;_gliffy.Grid=_gliffy.Class.extend({__documentManager:null,__buffer:null,majorColor:"#ebebff",minorColor:"#f6f7fd",__prevZoom:null,__prevMajorColor:null,__prevMinorColor:null,__prevSpacing:null,__enabled:true,spacing:10,init:function(options){var self=this;this.__documentManager=options.documentManager;this.__buffer=document.createElement("canvas");this.spacing=options.spacing||this.spacing;this.majorColor=options.majorColor||this.majorColor;this.minorColor=options.minorColor||this.minorColor;_gliffy.RenderLoop.appendTask(function(){self.__draw()})},setEnabled:function(enabled){this.__enabled=enabled;if(!this.__enabled&&this.__documentManager.target!==null){this.__documentManager.target.find(".gliffy-stage").css({backgroundImage:""});this.__prevZoom=null}},__isDirty:function(){return this.__documentManager.getZoom()!==this.__prevZoom||this.majorColor!==this.__prevMajorColor||this.minorColor!==this.__prevMinorColor||this.spacing!==this.__prevSpacing},__markClean:function(){this.__prevZoom=this.__documentManager.getZoom();this.__prevMajorColor=this.majorColor;this.__prevMinorColor=this.minorColor;this.__prevSpacing=this.spacing},__draw:function(){var zoom,ctx,spacing,size,imageData,stage;stage=$(".gliffy-stage");if(this.__enabled&&stage.length>0&&this.__isDirty()){zoom=this.__documentManager.getZoom();ctx=this.__buffer.getContext("2d");spacing=zoom*this.spacing;size=spacing*2;this.__buffer.width=size;this.__buffer.height=size;ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(PIXEL_SNAP_OFFSET,0);ctx.lineTo(PIXEL_SNAP_OFFSET,size);ctx.moveTo(0,PIXEL_SNAP_OFFSET);ctx.lineTo(size,PIXEL_SNAP_OFFSET);ctx.strokeStyle=this.majorColor;ctx.stroke();ctx.closePath();ctx.beginPath();ctx.moveTo(PIXEL_SNAP_OFFSET+spacing,0);ctx.lineTo(PIXEL_SNAP_OFFSET+spacing,size);ctx.moveTo(0,PIXEL_SNAP_OFFSET+spacing);ctx.lineTo(size,PIXEL_SNAP_OFFSET+spacing);ctx.strokeStyle=this.minorColor;ctx.stroke();ctx.closePath();imageData="url("+this.__buffer.toDataURL()+")";if(this.__documentManager.target){this.__documentManager.target.find(".gliffy-stage").css({backgroundImage:imageData})}this.__markClean()}}})}());(function(){_gliffy.AbstractStyle=_gliffy.Serializable.extend({__toObject:function(object){if(this._serialize){return{}}else{return null}},__fromObject:function(object){return this}});_gliffy.LineStyle=_gliffy.AbstractStyle.extend({strokeWidth:2,stroke:"#000000",fill:null,dashStyle:null,startArrow:0,endArrow:0,orthoMode:1,__fromObject:function(object){if(object.fill){this.fill=object.fill}if(object.stroke){this.stroke=object.stroke}if(object.strokeWidth){this.strokeWidth=object.strokeWidth}if(object.dashStyle){this.dashStyle=object.dashStyle}if(object.startArrow){this.startArrow=object.startArrow}if(object.endArrow){this.endArrow=object.endArrow}if(object.orthoMode!==undefined&&object.orthoMode!==null){this.orthoMode=object.orthoMode}return this},fromTheme:function(theme){var translate={fill:"fillColor",stroke:"strokeColor",strokeWidth:"strokeWidth"},self=this;$.each(translate,function(key,value){if(theme[value]){self[key]=theme[value]}});if(this.startArrow!==0){this.startArrow=theme.arrowType}if(this.endArrow!==0){this.endArrow=theme.arrowType}if(theme.interpolationType==="linear"){if(theme.cornerRadius===0){this.orthoMode=0}else{this.orthoMode=1}}else{if(theme.interpolationType==="quadratic"){this.orthoMode=2}}return this}});_gliffy.ShapeStyle=_gliffy.AbstractStyle.extend({fill:"#D1D1D1",stroke:"#000000",strokeWidth:2,dashStyle:null,gradient:false,shadow:false,__fromObject:function(object){if(object.fill){this.fill=object.fill}if(object.stroke){this.stroke=object.stroke}if(object.strokeWidth!==undefined&&object.strokeWidth!==null&&object.strokeWidth!=="null"){this.strokeWidth=object.strokeWidth}if(object.dashStyle){this.dashStyle=object.dashStyle}if(object.gradient){this.gradient=object.gradient}if(object.shadow){this.shadow=object.shadow}return this},fromTheme:function(theme){var translate={fill:"fillColor",stroke:"strokeColor",strokeWidth:"strokeWidth",gradient:"gradient",shadow:"dropShadow"},self=this;$.each(translate,function(key,value){if(theme[value]){self[key]=theme[value]}});return this}});_gliffy.TextStyle=_gliffy.AbstractStyle.extend({bold:false,italic:false,underline:false,face:"Arial",size:"12px",color:"#000000",__fromObject:function(object){if(object.bold){this.bold=object.bold}if(object.italic){this.italic=object.italic}if(object.underline){this.underline=object.underline}if(object.face){this.face=object.face}if(object.size){this.size=object.size}if(object.color){this.color=object.color}},fromTheme:function(theme){var copy=["color","bold","italic","underline"],i,attr;for(i=0;i<copy.length;i++){attr=copy[i];if(theme[attr]){this[attr]=theme[attr]}}return this}})}());(function(){_gliffy.Command=_gliffy.Serializable.extend({action:"base_action",init:function(){throw new Error("init for command is not implemented")},execute:function(){throw new Error("execute for command is not implemented")},toString:function(){return JSON.stringify(this.toObject())},shortToString:function(){return this.action},__toObject:function(){return{action:this.action}},__fromObject:function(){}})}());(function(){_gliffy.UndoableCommand=_gliffy.Command.extend({undo:function(){throw new Error("undo is not implemented")}})}());(function(){_gliffy.CollapsibleCommand=_gliffy.UndoableCommand.extend({collapse:function(){throw new Error("collapse is not implemented")}})}());(function(){_gliffy.AddNodeCommand=_gliffy.CollapsibleCommand.extend({action:"add_node",node:null,target:null,textCollapse:false,init:function(o){var options=$.extend({node:null,target:null,prepend:false},o);this.node=options.node;this.nodeObject=this.node.toObject();this.targetId=options.target?options.target.getId():null;this.prepend=options.prepend;this.textCollapse=false;if(!this.node){throw new Error("Node must be defined")}if(this.node.isProxy()){this.node.getGraphic().activate(this)}},execute:function(stage){var node=this.nodeObject.id!==null?new _gliffy.Node().fromObject(this.nodeObject):this.node,target,i,nodeObject;if(this.targetId===null){if(this.prepend){stage.prependNode(node)}else{stage.appendNode(node)}}else{target=stage.find(this.targetId);if(this.prepend){target.prependChild(node)}else{target.appendChild(node)}}this.nodeId=node.getId();this.updateNodeObject(node);node.markDirty();if(node.getGraphic()){node.getGraphic().markDirty()}},undo:function(stage){var node=stage.find(this.nodeObject.id);if(node){_gliffy.Tree.remove(node,true);if(this.targetId===null){this.updateNodeObject(node);stage.removeNode(node)}else{stage.find(this.targetId).removeChild(node)}}else{stage.commandHistory.undoCommand(stage);stage.commandHistory.removeCommand(this)}},updateNodeObject:function(node){var nodeObject=node.toObject();if(nodeObject){this.nodeObject=nodeObject}else{this.nodeObject.id=this.nodeId}},collapse:function(command,stage){if(this.nodeId===command.nodeId&&this.nodeObject.uid!=="com.gliffy.shape.basic.basic_v1.default.text"){if(command instanceof _gliffy.MoveNodeCommand){this.nodeObject.x=command.x;this.nodeObject.y=command.y;return true}else{if(command instanceof _gliffy.SetScaleCommand){this.nodeObject.scaleX=command.scaleX;this.nodeObject.scaleY=command.scaleY;this.nodeObject.x=command.x;this.nodeObject.y=command.y;return true}else{if(command instanceof _gliffy.SetWidthAndHeightCommand){this.nodeObject.width=command.width;this.nodeObject.height=command.height;return true}else{if(command instanceof _gliffy.SetTextCommand&&!this.textCollapse){this.nodeObject.graphic.Text.html=command.text;this.textCollapse=true;return true}else{if(command instanceof _gliffy.RemoveNodeCommand){stage.commandHistory.removeCommand(this);return true}}}}}}return false},__toObject:function(){return{action:this.action,nodeObject:this.nodeObject,targetId:this.targetId,prepend:this.prepend,textCollapse:this.textCollapse}}})}());(function(){_gliffy.AddCopyNodeCommand=_gliffy.CollapsibleCommand.extend({action:"add_copy_node",node:null,textCollapse:false,init:function(o){var options=$.extend({node:null},o);this.node=options.node;this.firstExecute=true;this.nodeObject=this.node.toObject();this.actionList=[];this.textCollapse=false;if(!this.node){throw new Error("Node must be defined")}},execute:function(stage){var node=this.firstExecute?this.node:new _gliffy.Node().fromObject(this.nodeObject),i;if(this.firstExecute){stage.appendCopyNode(node);if(this.actionList.length>0){for(i=0;i<this.actionList.length;i++){this.actionList[i](node)}node.getGraphic().editable.computeBestPath()}this.nodeId=node.getId();this.nodeObject=node.toObject();this.firstExecute=false}else{stage.appendNode(node)}node.markDirty()},undo:function(stage){var node=stage.find(this.nodeObject.id);if(node){this.nodeObject=node.toObject();new _gliffy.RemoveNodeCommand({node:node}).execute(stage)}},collapse:function(command,stage){if(this.nodeId===command.nodeId&&this.nodeObject.uid!=="com.gliffy.shape.basic.basic_v1.default.text"){if(command instanceof _gliffy.MoveNodeCommand){this.nodeObject.x=command.x;this.nodeObject.y=command.y;return true}else{if(command instanceof _gliffy.SetScaleCommand){this.nodeObject.scaleX=command.scaleX;this.nodeObject.scaleY=command.scaleY;this.nodeObject.x=command.x;this.nodeObject.y=command.y;return true}else{if(command instanceof _gliffy.SetWidthAndHeightCommand){this.nodeObject.width=command.width;this.nodeObject.height=command.height;return true}else{if(command instanceof _gliffy.SetTextCommand&&!this.textCollapse){this.nodeObject.graphic.Text.html=command.text;this.textCollapse=true;return true}else{if(command instanceof _gliffy.RemoveNodeCommand){stage.commandHistory.removeCommand(this);return true}}}}}}return false},__toObject:function(){return{action:this.action,nodeObject:this.nodeObject,firstExecute:this.firstExecute,actionList:this.actionList,textCollapse:this.textCollapse}}})}());(function(){_gliffy.CopyCommand=_gliffy.Command.extend({action:"copy",nodeObject:null,transformCopy:null,embeddedResources:null,init:function(o){var i,svg,id,options=$.extend({node:null,transformCopy:null,embeddedResources:null},o);this.nodeObject=options.node.toObject();this.transformCopy=options.transformCopy;svg=options.node.findGraphic(_gliffy.Svg);if(options.embeddedResources&&svg.length>0){this.embeddedResourceMap={};for(i=0;i<svg.length;i++){id=svg[i].getGraphic().getEmbeddedResourceId();this.embeddedResourceMap[id]=options.embeddedResources.getResource(id).toObject()}}},execute:function(stage){stage.commandHistory.setClipboard(this)},__toObject:function(){return{action:this.action,nodeObject:this.nodeObject,transformCopy:this.transformCopy,embeddedResources:this.embeddedResources}}})}());(function(){_gliffy.CutCommand=_gliffy.UndoableCommand.extend({action:"cut",init:function(o){var i,svg,id,options=$.extend({node:null,embeddedResource:null},o);this.nodeId=options.node.getId();this.nodeObject=options.node.toObject();this.removeNodeCommands=[];svg=options.node.findGraphic(_gliffy.Svg);if(options.embeddedResources&&svg.length>0){this.embeddedResourceMap={};for(i=0;i<svg.length;i++){id=svg[i].getGraphic().getEmbeddedResourceId();this.embeddedResourceMap[id]=options.embeddedResources.getResource(id).toObject()}}},execute:function(stage){var overlayManager=_gliffy.Mouse.editor.overlayManager,node,children,i;stage.commandHistory.setClipboard(this);if(this.removeNodeCommands.length===0){node=stage.find(this.nodeId);if(node.isSelection()){children=[].concat(node.children);overlayManager.deselectAll();for(i=0;i<children.length;i++){this.removeNodeCommands.push(new _gliffy.RemoveNodeCommand({node:children[i]}))}}else{this.removeNodeCommands.push(new _gliffy.RemoveNodeCommand({node:node}))}}for(i=0;i<this.removeNodeCommands.length;i++){this.removeNodeCommands[i].execute(stage)}overlayManager.deselectAll()},undo:function(stage){var i;for(i=0;i<this.removeNodeCommands.length;i++){this.removeNodeCommands[i].undo(stage)}},__toObject:function(){return{action:this.action,nodeObject:this.nodeObject}}})}());(function(){_gliffy.GroupCommand=_gliffy.UndoableCommand.extend({action:"group",init:function(o){var i,options=$.extend({selectedNodeIds:[],node:null},o);this.selectedNodeIds=[];if(options.node&&options.node.isSelection()){for(i=0;i<options.node.children.length;i++){this.selectedNodeIds.push(options.node.children[i].getId())}this.groupNodeId=options.node.getId()}else{this.selectedNodeIds=options.selectedNodeIds}},execute:function(stage){var groupNode=new _gliffy.Node(),i=0,node,nodes=[];if(this.groupNodeId&&stage.find(this.groupNodeId)){groupNode=stage.find(this.groupNodeId);groupNode.setUid("com.gliffy.shape.basic.basic_v1.default.group");groupNode.setOrder(groupNode.getId())}else{if(this.groupNodeId){groupNode.setId(this.groupNodeId);groupNode.setOrder(groupNode.getId())}groupNode.setUid("com.gliffy.shape.basic.basic_v1.default.group");stage.appendNode(groupNode);for(i=0;i<this.selectedNodeIds.length;i++){node=stage.find(this.selectedNodeIds[i]);nodes.push(node)}stage.attachSelectionToGroup(groupNode,nodes);this.groupNodeId=groupNode.getId()}groupNode.markDirty()},undo:function(stage){var parentNode=stage.find(this.groupNodeId);stage.detachSelectionFromGroup(parentNode);new _gliffy.RemoveNodeCommand({node:parentNode}).execute(stage)},__toObject:function(){return{action:this.action,selectedNodeIds:this.selectedNodeIds}}})}());(function(){_gliffy.PasteCommand=_gliffy.UndoableCommand.extend({action:"paste",offset:10,nodeId:null,nodeObject:null,init:function(o){var options=$.extend({offset:10,selectedNode:null},o);this.offset=options.offset;this.selectedNodeId=(options.selectedNode)?options.selectedNode.getId():null},__updateStaticPosition:function(stage,node,x,y){if(this.position.x<0||this.position.y<0){this.__setNodePosition(stage,node,x+this.offset,y+this.offset);node.update();return node.worldTransform.clone()}else{this.__setNodePosition(stage,node,this.position.x+this.offset-node.getWidth()/2-10,this.position.y+this.offset-node.getHeight()/2-10);return null}},__setNodePosition:function(stage,node,x,y){if(x<0){x=0}if(y<0){y=0}if(x+node.getWidth()>stage.maxWidth){x=stage.maxWidth-node.getWidth()}if(y+node.getHeight()>stage.maxHeight){y=stage.maxHeight-node.getHeight()}node.setX(x);node.setY(y)},getNode:function(stage,callback){var node=new _gliffy.Node(),command=stage.commandHistory.getClipboard();if(command!==null&&command!==undefined){node.fromObject(command.nodeObject);callback(node)}else{callback(null)}},execute:function(stage){var command=stage.commandHistory.getClipboard(),node,x,y,selectedNode,p1,p2,p3,transform,children,i,overlayManager=_gliffy.Mouse.editor.overlayManager,resource,resourceIdMap,keys,id,svg,self=this;if(command&&command.embeddedResourceMap){resourceIdMap={};keys=Object.keys(command.embeddedResourceMap);for(i=0;i<keys.length;i++){resource=new _gliffy.EmbeddedResource();resource.fromObject(command.embeddedResourceMap[keys[i]]);id=resource.getId();resource=stage.document.getEmbeddedResources().add(resource.getMimeType(),resource.getData());resourceIdMap[id]=resource.getId()}}if(this.nodeObject){node=new _gliffy.Node();node=node.fromObject(this.nodeObject);svg=node.findGraphic(_gliffy.Svg);if(svg.length>0){for(i=0;i<svg.length;i++){svg[i].getGraphic().setEmbeddedResourceId(resourceIdMap[svg[i].getGraphic().getEmbeddedResourceId()])}}stage.appendNode(node)}else{node=this.getNode(stage,function(node){if(node===null){return}self.lastCommand=command||null;self.position=_gliffy.Mouse.lastMouseUpPosition();svg=node.findGraphic(_gliffy.Svg);if(svg.length>0){for(i=0;i<svg.length;i++){svg[i].getGraphic().setEmbeddedResourceId(resourceIdMap[svg[i].getGraphic().getEmbeddedResourceId()])}}node.update();transform=node.worldTransform.clone();x=node.getX();y=node.getY();if(self.selectedNodeId!==null&&command instanceof _gliffy.CopyCommand&&command.transformCopy){selectedNode=stage.find(self.selectedNodeId);p1=selectedNode.worldTransform.clone().transformPoint(0,0);p2=command.transformCopy.clone().transformPoint(0,0);if(node.parent!==null){p3=node.parent.worldTransform.clone().createInverse().transformPoint(p1.x-p2.x,p1.y-p2.y)}else{p3={x:p1.x-p2.x,y:p1.y-p2.y}}if(p3.x===0&&p3.y===0){transform=self.__updateStaticPosition(stage,node,x,y)}else{self.__setNodePosition(stage,node,selectedNode.getX()+p3.x,selectedNode.getY()+p3.y);transform=selectedNode.worldTransform.clone()}}else{if(!self.__updateStaticPosition(stage,node,x,y)){transform=null}}stage.appendCopyNode(node);node.update();self.nodeId=node.getId();self.nodeObject=node.toObject();if(node.isSelection()){children=[].concat(node.children);overlayManager.deselectAll();node=overlayManager.selectNodes(children);self.childrenIds=[];for(i=0;i<children.length;i++){self.childrenIds.push(children[i].getId())}}else{overlayManager.deselectAll();overlayManager.selectNode(node)}GliffyApp.contextualPropertiesController.showControls(overlayManager.getActiveOverlay());stage.commandHistory.setClipboard(new _gliffy.CopyCommand({node:node,transformCopy:transform,embeddedResource:resource}));_gliffy.Mouse.resetMouseUpPosition()})}},undo:function(stage){var i;if(this.nodeId!==null&&this.nodeId!==undefined&&stage.find(this.nodeId)){new _gliffy.RemoveNodeCommand({node:stage.find(this.nodeId)}).execute(stage);if(this.lastCommand){stage.commandHistory.setClipboard(this.lastCommand)}}else{if(this.childrenIds){for(i=0;i<this.childrenIds.length;i++){if(stage.find(this.childrenIds[i])){new _gliffy.RemoveNodeCommand({node:stage.find(this.childrenIds[i])}).execute(stage)}}if(this.lastCommand){stage.commandHistory.setClipboard(this.lastCommand)}}}},__toObject:function(){return{action:this.action,offset:this.offset,selectedNodeId:this.selectedNodeId}}})}());(function(){_gliffy.RemoveNodeCommand=_gliffy.CollapsibleCommand.extend({action:"remove_node",node:null,target:null,init:function(o){var options=$.extend({node:null},o),n=null;if(!options.node){throw new Error("Node must be defined")}this.nodeId=options.node.getId();this.nodeObject=options.node.toObject();this.targetId=options.node.parent?options.node.parent.getId():null},execute:function(stage){var node=stage.find(this.nodeId);this.nodeObject=node.toObject();_gliffy.Tree.remove(node,true);if(this.target===null){stage.removeNode(node)}else{stage.find(this.targetId).removeChild(node)}},undo:function(stage){var node=new _gliffy.Node().fromObject(this.nodeObject);if(this.target===null){stage.appendNode(node)}else{stage.find(this.targetId).appendChild(node)}this.nodeId=node.getId()},collapse:function(command){return false},__toObject:function(){return{action:this.action,nodeObject:this.nodeObject,targetId:this.targetId}}})}());(function(){function getXform(node){var xform=node.toObject();xform.children=null;return xform}function setXform(node,xform){var children=node.children;node.children=null;node.fromObject(xform);node.children=children}_gliffy.UngroupCommand=_gliffy.UndoableCommand.extend({action:"ungroup",init:function(o){var options=$.extend({node:null},o),child,i;this.nodeId=options.node.getId();this.xform=getXform(options.node);this.childrenXform={};for(i=0;i<options.node.children.length;i++){child=options.node.children[i];this.childrenXform[child.getId()]=getXform(child)}},execute:function(stage){var parentNode=stage.find(this.nodeId);this.selectedNodeIds=stage.detachSelectionFromGroup(parentNode);new _gliffy.RemoveNodeCommand({node:parentNode}).execute(stage)},undo:function(stage){var groupNode=new _gliffy.Node(),i=0,node,nodes=[];if(this.nodeId){groupNode.setId(this.nodeId)}stage.appendNode(groupNode);for(i=0;i<this.selectedNodeIds.length;i++){node=stage.find(this.selectedNodeIds[i]);nodes.push(node)}stage.attachSelectionToGroup(groupNode,nodes);groupNode.setRotation(this.undoRotation);setXform(groupNode,this.xform);for(i=0;i<groupNode.children.length;i++){node=groupNode.children[i];setXform(node,this.childrenXform[node.getId()]);node.update()}this.nodeId=groupNode.getId()},__toObject:function(){return{action:this.action,nodeId:this.nodeId,xform:this.xform,childrenXform:this.childrenXform}}})}());(function(){_gliffy.BundledCommand=_gliffy.UndoableCommand.extend({action:"bundled_command",init:function(o){var options=$.extend({commands:null},o);if(!(options.commands&&options.commands.length>0)){throw new Error("no commands specified")}this.commands=options.commands},execute:function(stage){var i=0,c;for(i=0;i<this.commands.length;i++){c=this.commands[i];if(c instanceof _gliffy.Command){c.execute(stage)}else{throw new Error("bundled command is not a command:"+c)}}},undo:function(stage){var i=0,c;for(i=this.commands.length-1;i>=0;i--){c=this.commands[i];if(c instanceof _gliffy.UndoableCommand){c.undo(stage)}}},shortToString:function(){var shortString="",i;for(i=0;i<this.commands.length;i++){shortString+=this.commands[i].shortToString();if(i+1<this.commands.length){shortString+=","}}return this.action+"["+shortString+"]"},toString:function(){return"{ action:"+this.action+",commands:["+this.commands.join(",")+"] }"}})}());(function(){_gliffy.MoveNodeCommand=_gliffy.CollapsibleCommand.extend({action:"move_node",init:function(o){var options=$.extend({node:null,x:0,y:0},o);this.isSelection=options.node.isSelection();this.nodeId=options.node.getId();this.undoX=options.node.getX();this.undoY=options.node.getY();this.x=options.x;this.y=options.y},execute:function(stage){var node=stage.find(this.nodeId),i,child,selection,childNode,childTransform,childPos;if(node){if(this.isSelection&&!this.lastSelection){this.lastSelection=node.toObjectNoGraphic()}node.setX(this.x);node.setY(this.y)}else{if(this.isSelection){selection=new _gliffy.Node().fromObject(this.lastSelection);selection.setX(this.x);selection.setY(this.y);selection.update();for(i=0;i<selection.children.length;i++){child=selection.children[i];childNode=stage.find(child.getId());childTransform=child.worldTransform.clone();childPos=childTransform.transformPoint(child.getWidth()/2,child.getHeight()/2);childNode.setX(childPos.x-child.getWidth()/2);childNode.setY(childPos.y-child.getHeight()/2);childNode.setRotation(child.getRotation()+selection.getRotation())}}}},undo:function(stage){var node=stage.find(this.nodeId),i,child,selection,childNode,childTransform,childPos;if(node){node.setX(this.undoX);node.setY(this.undoY)}else{selection=new _gliffy.Node().fromObject(this.lastSelection);selection.update();for(i=0;i<selection.children.length;i++){child=selection.children[i];childNode=stage.find(child.getId());childTransform=child.worldTransform.clone();childPos=childTransform.transformPoint(child.getWidth()/2,child.getHeight()/2);childNode.setX(childPos.x-child.getWidth()/2);childNode.setY(childPos.y-child.getHeight()/2);childNode.setRotation(child.getRotation()+selection.getRotation())}}},collapse:function(command){if(command instanceof _gliffy.MoveNodeCommand&&this.nodeId===command.nodeId){this.x=command.x;this.y=command.y;command.lastSelection=this.lastSelection;return true}else{return false}},__toObject:function(){return{action:this.action,isSelection:this.isSelection,nodeId:this.nodeId,x:this.x,y:this.y,undoX:this.undoX,undoY:this.undoY}}})}());(function(){_gliffy.ModifyNodeCommand=_gliffy.UndoableCommand.extend({action:"modify_node",node:null,target:null,init:function(o){var properties,prop,graphic,i,options=$.extend({node:null,props:{}},o),n=null;if(!options.node){throw new Error("Node must be defined")}this.nodeId=options.node.getId();this.props=options.props;properties=Object.keys(this.props);this.redoProps={};graphic=options.node.getGraphic();for(i=0;i<properties.length;i++){prop=properties[i];if(options.node["get"+prop]){this.redoProps[prop]=options.node["get"+prop]()}else{if(options.node["is"+prop]){this.redoProps[prop]=options.node["is"+prop]()}else{if(graphic&&graphic["get"+prop]){this.redoProps[prop]=graphic["get"+prop]()}else{if(graphic&&graphic["is"+prop]){this.redoProps[prop]=graphic["is"+prop]()}}}}}},execute:function(stage){var node=stage.find(this.nodeId),properties=Object.keys(this.props),graphic=node.getGraphic(),prop,i;for(i=0;i<properties.length;i++){prop=properties[i];if(node["set"+prop]){node["set"+prop](this.props[prop])}else{if(graphic&&graphic["set"+prop]){graphic["set"+prop](this.props[prop])}}}},undo:function(stage){var node=stage.find(this.nodeId),properties=Object.keys(this.redoProps),graphic,prop,i;if(node){graphic=node.getGraphic();for(i=0;i<properties.length;i++){prop=properties[i];if(node["set"+prop]){node["set"+prop](this.redoProps[prop])}else{if(graphic&&graphic["set"+prop]){graphic["set"+prop](this.redoProps[prop])}}}}},__toObject:function(){return{action:this.action,target:this.target,props:this.props,redoProps:this.redoProps}}})}());(function(){_gliffy.ModifyLineCommand=_gliffy.CollapsibleCommand.extend({action:"modify_line",init:function(o){var options=$.extend({node:null},o),graphic=options.node.getGraphic();this.nodeId=options.node.getId();this.startSnapShot=this._createSnapShot(options.node);this.endSnapShot=this.startSnapShot},_createSnapShot:function(node){try{if(node){node.update();var graphic=node.getGraphic(),startConnection=graphic.getStartConnection(),endConnection=graphic.getEndConnection(),startConnectionIndex=null,endConnectionIndex=null;if(startConnection!==null){startConnection=startConnection.getId();startConnectionIndex=graphic.editable.getConnectionStart().index}if(endConnection!==null){endConnection=endConnection.getId();endConnectionIndex=graphic.editable.getConnectionEnd().index}return{controlPath:graphic.getControlPath(),segmentLocks:graphic.editable.getLockSegments(),startConnectionId:startConnection,startConnectionIndex:startConnectionIndex,endConnectionId:endConnection,endConnectionIndex:endConnectionIndex}}}catch(e){_gliffy.Logger.warn("Could not create line snapshot in modifyLineCommand:"+e.toString())}},_applySnapShot:function(node,snapShot){try{if(node&&snapShot){var graphic=node.getGraphic(),startConnection=node.stage.find(snapShot.startConnectionId),endConnection=node.stage.find(snapShot.endConnectionId);node.update();graphic.setControlPath(snapShot.controlPath);graphic.editable.setLockSegments(snapShot.segmentLocks);if(startConnection){graphic.editable.setConnectionStart(startConnection,snapShot.startConnectionIndex)}else{graphic.editable.clearConnectionStart()}if(endConnection){graphic.editable.setConnectionEnd(endConnection,snapShot.endConnectionIndex)}else{graphic.editable.clearConnectionEnd()}node.update()}}catch(e){_gliffy.Logger.warn("Could not apply line snapshot in modifyLineCommand:"+e.toString())}},takeSnapShot:function(stage){this.endSnapShot=this._createSnapShot(stage.find(this.nodeId))},execute:function(stage){var node=stage.find(this.nodeId);this._applySnapShot(node,this.endSnapShot)},undo:function(stage){var node=stage.find(this.nodeId);this._applySnapShot(node,this.startSnapShot)},collapse:function(command){return false},__toObject:function(){return{action:this.action,startSnapShot:this.startSnapShot,endSnapShot:this.endSnapShot,nodeId:this.nodeId}}})}());(function(){_gliffy.SetLineTypeCommand=_gliffy.CollapsibleCommand.extend({action:"set_line_type",init:function(o){var options=$.extend({node:null,ortho:false,interpolation:null,cornerRadius:null},o);this.nodeId=options.node.getId();this.ortho=options.ortho;this.interpolation=options.interpolation;this.cornerRadius=options.cornerRadius;this.previousOrtho=options.node.getGraphic().isOrtho();this.previousInterpolation=options.node.getGraphic().getInterpolationType();this.previousCornerRadius=options.node.getGraphic().getCornerRadius()},execute:function(stage){var node=stage.find(this.nodeId);node.getGraphic().setOrtho(this.ortho);node.getGraphic().setInterpolationType(this.interpolation);node.getGraphic().setCornerRadius(this.cornerRadius)},undo:function(stage){var node=stage.find(this.nodeId);node.getGraphic().setOrtho(this.previousOrtho);node.getGraphic().setInterpolationType(this.previousInterpolation);node.getGraphic().setCornerRadius(this.previousCornerRadius)},collapse:function(command){return false},__toObject:function(){return{action:this.action,nodeId:this.nodeId,ortho:this.ortho,interpolation:this.interpolation,cornerRadius:this.cornerRadius,previousOrtho:this.previousOrtho,previousInterpolation:this.previousInterpolation,previousCornerRadius:this.previousCornerRadius}}})}());(function(){_gliffy.SetFillColorCommand=_gliffy.CollapsibleCommand.extend({action:"fill_color",init:function(o){if(Ember&&Ember.isArray(o)&&o.length>0){o=o[0]}var options=$.extend({node:null,fillColor:"none"},o);this.nodeId=options.node.getId();this.undoFillColor=options.node.getGraphic().getFillColor();this.fillColor=options.fillColor},execute:function(stage){var node=stage.find(this.nodeId);node.getGraphic().setFillColor(this.fillColor)},undo:function(stage){var node=stage.find(this.nodeId);node.getGraphic().setFillColor(this.undoFillColor)},collapse:function(command){if(command instanceof _gliffy.SetFillColorCommand&&this.nodeId===command.nodeId){this.fillColor=command.fillColor;return true}else{return false}},__toObject:function(){return{action:this.action,nodeId:this.nodeId,undoFillColor:this.undoFillColor,fillColor:this.fillColor}}})}());(function(){_gliffy.SetScaleCommand=_gliffy.CollapsibleCommand.extend({action:"scale_node",init:function(o){var options=$.extend({node:null,scaleX:1,scaleY:1,x:0,y:0},o);this.nodeId=options.node.getId();this.isSelection=options.node.isSelection();this.scaleX=options.scaleX;this.scaleY=options.scaleY;this.x=options.x;this.y=options.y;this.undoX=options.node.getX();this.undoY=options.node.getY()},execute:function(stage){var node=stage.find(this.nodeId),i,child,selection,childNode,childTransform,childPos;if(node){if(this.isSelection&&!this.lastSelection){this.lastSelection=node.toObjectNoGraphic()}node.setScaleX(this.scaleX);node.setScaleY(this.scaleY);node.setX(this.x);node.setY(this.y)}else{selection=new _gliffy.Node().fromObject(this.lastSelection);selection.setScaleX(this.scaleX);selection.setScaleY(this.scaleY);selection.setX(this.x);selection.setY(this.y);if(this.rotation){selection.setRotation(this.rotation)}selection.update();for(i=0;i<selection.children.length;i++){child=selection.children[i];childNode=stage.find(child.getId());childTransform=child.worldTransform.clone();childPos=childTransform.transformPoint(child.getWidth()/2,child.getHeight()/2);childNode.setScaleX(this.scaleX);childNode.setScaleY(this.scaleY);childNode.setX(childPos.x-child.getWidth()/2);childNode.setY(childPos.y-child.getHeight()/2);childNode.setRotation(child.getRotation()+selection.getRotation())}}},undo:function(stage){var node=stage.find(this.nodeId),i,child,selection,childNode,childTransform,childPos;if(node){node.setScaleX(1/this.scaleX);node.setScaleY(1/this.scaleY);node.setX(this.undoX);node.setY(this.undoY)}else{selection=new _gliffy.Node().fromObject(this.lastSelection);selection.update();for(i=0;i<selection.children.length;i++){child=selection.children[i];childNode=stage.find(child.getId());childTransform=child.worldTransform.clone();childPos=childTransform.transformPoint(child.getWidth()/2,child.getHeight()/2);childNode.setScaleX(child.getWidth()/childNode.getWidth());childNode.setScaleY(child.getHeight()/childNode.getHeight());childNode.setX(childPos.x-child.getWidth()/2);childNode.setY(childPos.y-child.getHeight()/2);childNode.setRotation(child.getRotation()+selection.getRotation());childNode.markDirty()}}},collapse:function(command){if(command instanceof _gliffy.SetScaleCommand&&this.nodeId===command.nodeId){this.scaleX*=command.scaleX;this.scaleY*=command.scaleY;this.x=command.x;this.y=command.y;command.lastSelection=this.lastSelection;return true}else{if(command instanceof _gliffy.SetRotationCommand&&this.nodeId===command.nodeId){this.rotation=command.rotation;command.lastSelection=this.lastSelection;return true}else{return false}}},__toObject:function(){return{action:this.action,nodeId:this.nodeId,isSelection:this.isSelection,scaleX:this.scaleX,scaleY:this.scaleY,x:this.x,y:this.y,undoX:this.undoX,undoY:this.undoY}}})}());(function(){_gliffy.SetRotationCommand=_gliffy.CollapsibleCommand.extend({action:"rotate_node",lastSelection:null,init:function(o){var i,options=$.extend({node:null,rotation:0},o);this.isSelection=options.node.isSelection();this.nodeId=options.node.getId();this.undoRotation=options.node.getRotation();this.rotation=options.rotation},execute:function(stage){var node=stage.find(this.nodeId),selection,child,childNode,childTransform,childPos,i;if(node){if(this.isSelection&&!this.lastSelection){this.lastSelection=node.toObjectNoGraphic()}node.setRotation(this.rotation)}else{selection=new _gliffy.Node().fromObject(this.lastSelection);selection.setRotation(this.rotation);selection.update();for(i=0;i<selection.children.length;i++){child=selection.children[i];childNode=stage.find(child.getId());childTransform=child.worldTransform.clone();childPos=childTransform.transformPoint(child.getWidth()/2,child.getHeight()/2);childNode.setX(childPos.x-child.getWidth()/2);childNode.setY(childPos.y-child.getHeight()/2);childNode.setRotation(child.getRotation()+selection.getRotation())}}},__updateLine:function(stage,node){var i;if(node.isLine()){for(i=0;i<node.getGraphic().editable.getSegmentCount();i++){stage.commandHistory.addAndExecuteCommand(new _gliffy.SetLockSegmentCommand({node:node,value:false,segment:i}))}}},undo:function(stage){var node=stage.find(this.nodeId),i,selection,childTransform,child,childNode,childPos;if(node){node.setRotation(this.undoRotation)}else{if(this.isSelection){selection=new _gliffy.Node().fromObject(this.lastSelection);selection.update();for(i=0;i<selection.children.length;i++){child=selection.children[i];childNode=stage.find(child.getId());childTransform=child.worldTransform.clone();childPos=childTransform.transformPoint(child.getWidth()/2,child.getHeight()/2);childNode.setX(childPos.x-child.getWidth()/2);childNode.setY(childPos.y-child.getHeight()/2);childNode.setRotation(child.getRotation()+selection.getRotation())}}}},collapse:function(command){if(command instanceof _gliffy.SetRotationCommand&&this.nodeId===command.nodeId){this.rotation=command.rotation;command.lastSelection=this.lastSelection;return true}else{return false}},__toObject:function(){return{action:this.action,isSelection:this.isSelection,nodeId:this.nodeId,rotation:this.rotation,undoRotation:this.undoRotation}}})}());(function(){_gliffy.SetStrokeColorCommand=_gliffy.CollapsibleCommand.extend({action:"stroke_color",init:function(o){if(Ember&&Ember.isArray(o)&&o.length>0){o=o[0]}var options=$.extend({node:null,strokeColor:"none"},o);this.nodeId=options.node.getId();this.undoStrokeColor=options.node.getGraphic().getStrokeColor();this.strokeColor=options.strokeColor},execute:function(stage){var node=stage.find(this.nodeId);node.getGraphic().setStrokeColor(this.strokeColor)},undo:function(stage){var node=stage.find(this.nodeId);node.getGraphic().setStrokeColor(this.undoStrokeColor)},collapse:function(command){if(command instanceof _gliffy.SetStrokeColorCommand&&this.nodeId===command.nodeId){this.strokeColor=command.strokeColor;return true}else{return false}},__toObject:function(){return{action:this.action,nodeId:this.nodeId,strokeColor:this.strokeColor,undoStrokeColor:this.undoStrokeColor}}})}());(function(){_gliffy.SetWidthAndHeightCommand=_gliffy.CollapsibleCommand.extend({action:"width_and_height",init:function(o){var options=$.extend({node:null,width:0,height:0},o);this.nodeId=options.node.getId();this.width=options.width;this.height=options.height;this.undoWidth=options.node.getWidth();this.undoHeight=options.node.getHeight()},execute:function(stage){var node=stage.find(this.nodeId);node.setWidth(this.width);node.setHeight(this.height)},undo:function(stage){var node=stage.find(this.nodeId);node.setWidth(this.undoWidth);node.setHeight(this.undoHeight)},collapse:function(command){if(command instanceof _gliffy.SetWidthAndHeightCommand&&this.nodeId===command.nodeId){this.width=command.width;this.height=command.height;return true}else{return false}},__toObject:function(){return{action:this.action,nodeId:this.nodeId,width:this.width,height:this.height,undoWidth:this.undoWidth,undoHeight:this.undoHeight}}})}());(function(){_gliffy.SetTextCommand=_gliffy.CollapsibleCommand.extend({action:"text",init:function(o){var options=$.extend({node:null,text:null},o);this.nodeId=options.node.getId();this.undoText=options.node.getGraphic().getHTML();this.text=options.text},execute:function(stage){var node=stage.find(this.nodeId);if(node.getGraphic().getHTML()===this.text){stage.commandHistory.removeCommand(this)}node.getGraphic().setHTML(this.text)},undo:function(stage){var node=stage.find(this.nodeId);node.getGraphic().setHTML(this.undoText)},collapse:function(command){return false},__toObject:function(){return{action:this.action,nodeId:this.nodeId,text:this.text,undoText:this.undoText}}})}());(function(){_gliffy.BringToFrontCommand=_gliffy.UndoableCommand.extend({action:"bring_to_front",init:function(o){var i,children,options=$.extend({node:null},o);this.isSelection=options.node.isSelection();if(this.isSelection){children=options.node.flattenChildren();this.selectionIds=[];for(i=0;i<children.length;i++){this.selectionIds.push(children[i].getId())}}this.nodeId=options.node.getId()},execute:function(stage){var node=stage.find(this.nodeId),i=0,nodes=[];if(this.isSelection){for(i=0;i<this.selectionIds.length;i++){nodes.push(stage.find(this.selectionIds[i]))}this.orderList=stage.bringToFront(nodes)}else{this.orderList=stage.bringToFront(node)}},undo:function(stage){var i,orderInfo,node;for(i=0;i<this.orderList.length;i++){orderInfo=this.orderList[i];node=stage.find(orderInfo.id);if(node){node.setOrder(orderInfo.order)}}},__toObject:function(){return{action:this.action,nodeId:this.nodeId,isSelection:this.isSelection,selectionIds:this.selectionIds}}})}());(function(){_gliffy.SendToBackCommand=_gliffy.UndoableCommand.extend({action:"send_to_back",init:function(o){var i,children,options=$.extend({node:null},o);this.isSelection=options.node.isSelection();if(this.isSelection){children=options.node.flattenChildren();this.selectionIds=[];for(i=0;i<children.length;i++){this.selectionIds.push(children[i].getId())}}this.nodeId=options.node.getId()},execute:function(stage){var node=stage.find(this.nodeId),i=0,nodes=[];if(this.isSelection){for(i=0;i<this.selectionIds.length;i++){nodes.push(stage.find(this.selectionIds[i]))}this.orderList=stage.sendToBack(nodes)}else{this.orderList=stage.sendToBack(node)}},undo:function(stage){var i,orderInfo,node;for(i=0;i<this.orderList.length;i++){orderInfo=this.orderList[i];node=stage.find(orderInfo.id);if(node){node.setOrder(orderInfo.order)}}},__toObject:function(){return{action:this.action,isSelection:this.isSelection,nodeId:this.nodeId,selectionIds:this.selectionIds}}})}());(function(){var THRESHOLD=0.05;_gliffy.UpdateLaneCommand=_gliffy.CollapsibleCommand.extend({action:"update_lane",init:function(o){var options=$.extend({selectedNode:null,node:null,sibling:null,nextSibling:null,mousePosition:null},o);this.selectedNodeId=options.selectedNode.getId();this.nodeId=options.node.getId();this.siblingId=options.sibling.getId();this.nextSiblingId=options.nextSibling?options.nextSibling.getId():null;this.mousePosition=options.mousePosition;this.lastNodeWidth=options.node.getWidth();this.lastSiblingWidth=options.sibling.getWidth();this.lastNodeConstraint=options.node.getConstraints().getConstraint(_gliffy.PositionConstraint).px},execute:function(stage){var node=stage.find(this.nodeId),sibling=stage.find(this.siblingId),selectedNode=stage.find(this.selectedNodeId),newValue,width=selectedNode.getWidth(),siblingConstraint,nodeConstraint,sibWidth,nodeWidth,nextSibling=stage.find(this.nextSiblingId),nextSiblingConstraintVal;newValue=selectedNode.worldPointToRatio(this.mousePosition.x,this.mousePosition.y).x;nodeConstraint=node.getConstraints().getConstraint(_gliffy.PositionConstraint);siblingConstraint=sibling.getConstraints().getConstraint(_gliffy.PositionConstraint);nextSiblingConstraintVal=nextSibling?nextSibling.getConstraints().getConstraint(_gliffy.PositionConstraint).px:1;if(newValue>0&&newValue<1&&newValue>siblingConstraint.px+THRESHOLD&&newValue<nextSiblingConstraintVal-THRESHOLD){sibWidth=(newValue-siblingConstraint.px)*width;nodeWidth=((node.getWidth()/width)+(nodeConstraint.px-newValue))*width;sibling.setWidth(sibWidth);if(sibling.children[0]){sibling.children[0].setWidth(sibWidth)}node.setWidth(nodeWidth);if(node.children[0]){node.children[0].setWidth(nodeWidth)}nodeConstraint.px=newValue}},undo:function(stage){var node=stage.find(this.nodeId),sibling=stage.find(this.siblingId);node.setWidth(this.lastNodeWidth);if(node.children[0]){node.children[0].setWidth(this.lastNodeWidth)}node.getConstraints().getConstraint(_gliffy.PositionConstraint).px=this.lastNodeConstraint;sibling.setWidth(this.lastSiblingWidth);if(sibling.children[0]){sibling.children[0].setWidth(this.lastSiblingWidth)}},collapse:function(command){if(command instanceof _gliffy.UpdateLaneCommand&&this.nodeId===command.nodeId){this.mousePosition=command.mousePosition;return true}else{return false}},__toObject:function(){return{action:this.action,nodeId:this.nodeId,siblingId:this.siblingId,nextSiblingId:this.nextSiblingId,mousePosition:this.mousePosition,lastNodeWidth:this.lastNodeWidth,lastSiblingWidth:this.lastSiblingWidth,lastNodeConstraint:this.lastNodeConstraint}}})}());(function(){_gliffy.UpdateLaneNumberCommand=_gliffy.UndoableCommand.extend({action:"update_lane_number",init:function(o){var options=$.extend({node:null,lanes:1},o);options.node.update();this.nodeId=options.node.getId();this.lanes=options.lanes;this.origWidth=options.node.getWidth();this.origHeight=options.node.getHeight();this.worldTransform=options.node.worldTransform.clone();this.nodeObject=options.node.toObject()},__distanceFromOrigin:function(point,transform,height,width){var p=transform.transformPoint(point.x*width,point.y*height);return Math.sqrt(Math.pow(p.x,2)+Math.pow(p.y,2))},updatePosition:function(node){var points=[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:0,y:1}],topLeft=0,minDistance,i,distance,point,currentPoint,topLeftPoint;node.update();for(i=0;i<points.length;i++){distance=this.__distanceFromOrigin(points[i],node.worldTransform,this.origHeight,this.origWidth);if(!minDistance){minDistance=distance}else{if(distance<minDistance){topLeft=i;minDistance=distance}}}point=this.worldTransform.transformPoint(points[topLeft].x*this.origWidth,points[topLeft].y*this.origHeight);currentPoint=node.worldTransform.transformPoint(points[topLeft].x*node.getWidth(),points[topLeft].y*node.getHeight());node.setX(node.getX()+(point.x-currentPoint.x));node.setY(node.getY()+(point.y-currentPoint.y))},updateLanes:function(stage,reverseOrder){var node=stage.find(this.nodeId),lanes,i,nodes,width,constraint,graphic,laneObject,lane,text,index;if(node.isSwimlane()){lanes=node.children.length-1;if(lanes<this.lanes){width=node.getWidth()/lanes;node.setWidth(width*this.lanes);node.children[0].setWidth(width*this.lanes);node.children[0].children[0].setWidth(width*this.lanes);index=(reverseOrder)?1:node.children.length-1;laneObject=node.children[index].toObject();text=new _gliffy.Node().fromObject(node.getShapeInformation().defaults.copyObject).children[0].children[0].getGraphic().getHTML();for(i=lanes;i<this.lanes;i++){lane=new _gliffy.Node().fromObject(laneObject);lane.setId("auto");lane.children[0].setId("auto");lane.children[0].getGraphic().setHTML(text);lane.setWidth(width);lane.children[0].setWidth(width);if(reverseOrder){node.insertChild(lane,1)}else{node.appendChild(lane)}}width=0;for(i=1;i<node.children.length;i++){constraint=node.children[i].getConstraints().getConstraint(_gliffy.PositionConstraint);constraint.px=width/node.getWidth();width+=node.children[i].getWidth()}}else{if(lanes>this.lanes){if(reverseOrder){nodes=node.children.slice(1,(node.children.length-this.lanes))}else{nodes=node.children.slice(this.lanes+1,node.children.length)}for(i=0;i<nodes.length;i++){new _gliffy.RemoveNodeCommand({node:nodes[i]}).execute(stage)}width=0;for(i=1;i<node.children.length;i++){width+=node.children[i].getWidth()}node.setWidth(width);node.children[0].setWidth(width);node.children[0].children[0].setWidth(width);width=0;for(i=1;i<node.children.length;i++){constraint=node.children[i].getConstraints().getConstraint(_gliffy.PositionConstraint);constraint.px=width/node.getWidth();width+=node.children[i].getWidth()}}}this.updatePosition(node)}},execute:function(stage){var node=stage.find(this.nodeId),reverseOrder=(node.getRotation()>135&&node.getRotation()<315);if(node.isSwimlane()){this.updateLanes(stage,reverseOrder)}},undo:function(stage){var node=stage.find(this.nodeId);while(node.children.length>1){if(node.children[node.children.length-1]){new _gliffy.RemoveNodeCommand({node:node.children[node.children.length-1]}).execute(stage)}}node.fromObject(this.nodeObject)},__toObject:function(){return{action:this.action,nodeId:this.nodeId,lanes:this.lanes,origWidth:this.origWidth,origHeight:this.origHeight,worldTransform:this.worldTransform,nodeObject:this.nodeObject}}})}());(function(){function recompute(group,newBoundingBox){var i,child,offset=_gliffy.Vec2.difference(group.aabb.min,newBoundingBox.min),dimension;for(i=0;i<group.children.length;i++){child=group.children[i];child.setX(child.getX()+offset.x);child.setY(child.getY()+offset.y)}dimension=newBoundingBox.getDimension();group.setX(group.getX()-offset.x);group.setY(group.getY()-offset.y);group.setWidth(dimension.x);group.setHeight(dimension.y)}_gliffy.UpdateGroupBoundsCommand=_gliffy.UndoableCommand.extend({action:"update_group_bounds",init:function(o){var options=$.extend({node:null},o);this.nodeId=options.node.getId();this.startAabb=options.node.aabb.clone();this.endAabb=options.node.getChildrenAabb()},execute:function(stage){var group=stage.find(this.nodeId);recompute(group,this.endAabb)},undo:function(stage){var group=stage.find(this.nodeId);recompute(group,this.startAabb)},__toObject:function(){return{action:this.action,nodeId:this.nodeId,startAabb:this.startAabb,endAabb:this.endAabb}}})}());(function(){var THRESHOLD=20;_gliffy.ScaleSwimlaneCommand=_gliffy.CollapsibleCommand.extend({action:"scale_swimlane",init:function(o){var options=$.extend({node:null,scaleX:1,scaleY:1,x:0,y:0,overlayCoords:{x:0,y:0}},o);this.nodeId=options.node.getId();this.overlayCoords=options.overlayCoords;this.scaleX=options.scaleX;this.scaleY=options.scaleY;this.width=options.node.getWidth();this.height=options.node.getHeight();this.x=options.x;this.y=options.y;this.undoX=options.node.getX();this.undoY=options.node.getY();this.originalLaneWidth=this.overlayCoords.x===0?options.node.children[1].getWidth():options.node.children[options.node.children.length-1].getWidth()},execute:function(stage){var node=stage.find(this.nodeId),width=this.scaleX*node.getWidth(),diff=width-node.getWidth(),i,child,positionConstraint,widthCounter=0,laneToUpdate=this.overlayCoords.x===0?node.children[1]:node.children[node.children.length-1],laneSize=laneToUpdate.getWidth()+diff;if(node&&laneSize>THRESHOLD){node.setWidth(width);node.children[0].setWidth(width);node.children[0].children[0].setWidth(width);node.setScaleY(this.scaleY);node.setX(this.x);node.setY(this.y);laneToUpdate.setWidth(laneSize);if(laneToUpdate.children[0]){laneToUpdate.children[0].setWidth(laneSize)}for(i=1;i<node.children.length;i++){child=node.children[i];positionConstraint=child.getConstraints().getConstraint(_gliffy.PositionConstraint);if(positionConstraint){positionConstraint.px=widthCounter/width}widthCounter+=child.getWidth()}}},undo:function(stage){var node=stage.find(this.nodeId),laneToUpdate=this.overlayCoords.x===0?node.children[1]:node.children[node.children.length-1],child,positionConstraint,widthCounter=0,i;if(node){node.setWidth(this.width);node.children[0].setWidth(this.width);node.children[0].children[0].setWidth(this.width);node.setScaleY(1/this.scaleY);node.setX(this.undoX);node.setY(this.undoY);laneToUpdate.setWidth(this.originalLaneWidth);if(laneToUpdate.children[0]){laneToUpdate.children[0].setWidth(this.originalLaneWidth)}for(i=1;i<node.children.length;i++){child=node.children[i];positionConstraint=child.getConstraints().getConstraint(_gliffy.PositionConstraint);if(positionConstraint){positionConstraint.px=widthCounter/this.width}widthCounter+=child.getWidth()}}},collapse:function(command,stage){if(command instanceof _gliffy.ScaleSwimlaneCommand&&this.nodeId===command.nodeId&&command.overlayCoords.x===this.overlayCoords.x&&command.overlayCoords.y===this.overlayCoords.y){var node=stage.find(command.nodeId),width=command.scaleX*node.getWidth(),diff=width-node.getWidth(),i,laneToUpdate=command.overlayCoords.x===0?node.children[1]:node.children[node.children.length-1],laneSize=laneToUpdate.getWidth()+diff;if(node&&laneSize>THRESHOLD){this.scaleX*=command.scaleX;this.scaleY*=command.scaleY;this.x=command.x;this.y=command.y}return true}else{return false}},__toObject:function(){return{action:this.action,nodeId:this.nodeID,overlayCoords:this.overlayCoords,scaleX:this.scaleX,scaleY:this.scaleY,width:this.width,height:this.height,x:this.x,y:this.y,undoX:this.undoX,undoY:this.undoY,originalLaneWidth:this.originalLaneWidth}}})}());(function(){_gliffy.SetPageColorCommand=_gliffy.UndoableCommand.extend({action:"page_color",init:function(o){if(Ember&&Ember.isArray(o)&&o.length>0){o=o[0]}var options=$.extend({stage:null,background:"#FFFFFF"},o);this.undoBackground=options.stage.background;this.background=options.background},execute:function(stage){stage.setBackground(this.background);this.__markLinesDirty(stage)},undo:function(stage){stage.setBackground(this.undoBackground);this.__markLinesDirty(stage)},__markLinesDirty:function(stage){var lines,line,i;lines=stage.findGraphic(_gliffy.Line);for(i=0;i<lines.length;i++){line=lines[i];if(line.getGraphic().getStartArrowTid()!==null||line.getGraphic().getEndArrowTid()!==null||(line.children&&line.children.length>0)){line.getGraphic().markDirty()}}},__toObject:function(){return{action:this.action,background:this.background,undoBackground:this.undoBackground}}})}());(function(){_gliffy.SetPageWidthCommand=_gliffy.UndoableCommand.extend({action:"page_width",init:function(o){if(Ember&&Ember.isArray(o)&&o.length>0){o=o[0]}var options=$.extend({stage:null,width:0},o);this.width=options.width;this.undoWidth=options.stage.maxWidth},execute:function(stage){stage.setMaxWidth(this.width)},undo:function(stage){stage.setMaxWidth(this.undoWidth)},__toObject:function(){return{action:this.action,width:this.width,undoWidth:this.undoWidth}}})}());(function(){_gliffy.SetPageHeightCommand=_gliffy.UndoableCommand.extend({action:"page_height",init:function(o){if(Ember&&Ember.isArray(o)&&o.length>0){o=o[0]}var options=$.extend({stage:null,height:0},o);this.height=options.height;this.undoHeight=options.stage.maxHeight},execute:function(stage){stage.setMaxHeight(this.height)},undo:function(stage){stage.setMaxHeight(this.undoHeight)},__toObject:function(){return{action:this.action,height:this.height,undoHeight:this.undoHeight}}})}());(function(){_gliffy.CleanSwimlanePositions=_gliffy.Command.extend({action:"clean_swimlane_positions",init:function(o){var i,options=$.extend({nodes:null},o);this.nodeIds=[];for(i=0;i<options.nodes.length;i++){this.nodeIds.push(options.nodes[i].getId())}},execute:function(stage){var node,n,i,currentLane,sibling,siblingConstraint,rounded,width;for(n=0;n<this.nodeIds.length;n++){node=stage.find(this.nodeIds[n]);if(node.isSwimlane()){width=0;for(i=1;i<node.children.length;i++){currentLane=node.children[i];sibling=(i+1<node.children.length)?node.children[i+1]:null;rounded=Math.round(currentLane.getWidth());if(currentLane.getWidth()!==rounded){if(sibling){siblingConstraint=sibling.getConstraints().getConstraint(_gliffy.PositionConstraint);siblingConstraint.px=(width+rounded)/node.getWidth()}else{rounded=node.getWidth()-width}currentLane.setWidth(rounded);currentLane.children[0].setWidth(rounded)}width+=currentLane.getWidth()}}}},__toObject:function(){return{action:this.action,nodeIds:this.nodeIds}}})}());(function(){_gliffy.UpdateThemeCommand=_gliffy.UndoableCommand.extend({action:"update_theme",stageObject:null,stageUndoObject:null,init:function(o){if(Ember&&Ember.isArray(o)&&o.length>0){o=o[0]}var options=$.extend({stageObject:null,stageUndoObject:null},o);this.stageObject=options.stageObject;this.stageUndoObject=options.stageUndoObject},execute:function(stage){stage.fromObject(this.stageObject)},undo:function(stage){stage.fromObject(this.stageUndoObject)},__toObject:function(){return{action:this.action,stageObject:this.stageObject,stageUndoObject:this.stageUndoObject}}})}());(function(){var MAX_STORED_COMMANDS=1000;_gliffy.clipboard=null;_gliffy.CommandHistory=_gliffy.Class.extend({_commands:null,_redo:null,_bundle:null,_bundleStackCount:0,stage:null,init:function(stage){this.stage=stage;this._commands=[];this._redo=[]},addAndExecuteCommand:function(command){var commandStack=this._bundle||this._commands,lastCommand,collapsed=false,tmp,i;if(!(command instanceof _gliffy.Command)){throw new Error("cannot add non-command to command history: "+command)}if(commandStack.length>0){lastCommand=commandStack[commandStack.length-1];if(command instanceof _gliffy.RemoveNodeCommand&&lastCommand instanceof _gliffy.BundledCommand){tmp=lastCommand.commands[lastCommand.commands.length-1];if(tmp instanceof _gliffy.AddNodeCommand){lastCommand=tmp}}else{if(command instanceof _gliffy.SetTextCommand&&lastCommand!==_gliffy.AddNodeCommand){for(i=commandStack.length-1;i>=0;i--){lastCommand=commandStack[i];if(lastCommand instanceof _gliffy.AddNodeCommand){break}}}}if(lastCommand instanceof _gliffy.CollapsibleCommand&&command instanceof _gliffy.CollapsibleCommand){collapsed=lastCommand.collapse(command,this.stage)}}if(!collapsed&&!(command instanceof _gliffy.CopyCommand)){commandStack.push(command)}while(this._commands.length>MAX_STORED_COMMANDS){this._commands.shift()}if(!this._bundle&&!(command instanceof _gliffy.CopyCommand)){this.stage.setUnsavedChanges(true)}command.execute(this.stage);this._redo=[]},undoCommand:function(){this.forceFinalizeCommandBundle();var command=this._commands.pop();if(command){if(command instanceof _gliffy.UndoableCommand){this._redo.push(command);command.undo(this.stage);this.stage.setUnsavedChanges(true)}else{this.undoCommand()}}},removeAndUndoLastCommand:function(){var command=this._commands.pop();if(command){if(command instanceof _gliffy.UndoableCommand){command.undo(this.stage)}else{this.removeAndUndoLastCommand()}}},removeCommand:function(command){var index=$.inArray(command,this._commands);if(index>-1){this._commands.splice(index,1)}else{if(this._bundle!==null){index=$.inArray(command,this._bundle);this._bundle.splice(index,1)}else{index=$.inArray(command,this._redo);if(index>-1){this._redo.splice(index,1)}}}},redoCommand:function(){this.forceFinalizeCommandBundle();var command=this._redo.pop();if(command){if(!command instanceof _gliffy.Command){throw new Error("cannot add non-command to command history: "+command)}this._commands.push(command);command.execute(this.stage);this.stage.setUnsavedChanges(true)}},pushCommandBundle:function(){if(this._bundle===null){this._bundle=[];this._bundleStackCount=0}this._bundleStackCount++},popCommandBundle:function(){if(this._bundle!==null){this._bundleStackCount--;if(this._bundleStackCount===0){if(this._bundle.length>0){this._commands.push(new _gliffy.BundledCommand({commands:this._bundle}));this.stage.setUnsavedChanges(true)}this._bundle=null}}},forceFinalizeCommandBundle:function(){var badCommands=[],i;if(this._bundle!==null&&this._bundle.length>0){for(i=0;i<this._bundle.length;i++){badCommands.push(this._bundle[i].toString())}_gliffy.Logger.warn("Was forced finalize to command bundle in commandHistory.js: "+badCommands.join(","))}while(this._bundle!==null){this.popCommandBundle()}},setClipboard:function(command){_gliffy.clipboard=command},getClipboard:function(){return _gliffy.clipboard},getSize:function(){return this._commands.length},getReport:function(maxLength){var i,commands=[],command,report="";report+="\n====Summary Command Report["+maxLength+"]====\n";report+=this.getShortReport(maxLength);report+="\n\n====Detailed Command Report["+maxLength+"]====\n";try{for(i=0;i<this._commands.length&&i<maxLength;i++){command=this._commands[this._commands.length-1-i];commands.unshift(command.toString())}report+="[ "+commands.join(",")+"]"}catch(e){report+="\nProblems generating Detailed command report: "+e}return report},getShortReport:function(maxLength){var shortString=[],i,addComma=false;for(i=0;i<this._commands.length&&i<maxLength;i++){addComma=i+1<this._commands.length&&i+1<maxLength;shortString=(addComma?",\n":"")+this._commands[this._commands.length-i-1].shortToString()+shortString}return shortString}})}());(function(){_gliffy.Constraint=_gliffy.Serializable.extend({UPDATE_EVENT:"gliffy-node-update-",REMOVE_EVENT:"gliffy-node-remove-",init:function(){throw new Error("init for constraint is not implemented")},execute:function(self,stage){throw new Error("execute for constraint is not implemented")},updateIdsForCopy:function(nodeIdMap){throw new Error("update ids for copy is not implemented")},subscribe:function(self,stage){throw new Error("subscribe is not implemented")},unsubscribe:function(self,stage){throw new Error("unsubscribe is not implemented")},getClassName:function(){throw new Error("classname is not provided")}})}());(function(){_gliffy.PositionConstraint=_gliffy.Constraint.extend({nodeId:null,px:null,py:null,init:function(node,px,py){if(node){this.nodeId=node.getId();this.px=px;this.py=py}},execute:function(self,stage){var constraintNode=stage.find(this.nodeId),transform,point;transform=constraintNode.worldTransform.clone();point=transform.transformPoint(this.px*constraintNode.getWidth(),this.py*constraintNode.getHeight());if(self.parent!==null){point=self.parent.worldTransform.clone().createInverse().transformPoint(point.x,point.y)}self.setX(point.x);self.setY(point.y)},updateIdsForCopy:function(nodeIdMap){if(nodeIdMap[this.nodeId]!==undefined){this.nodeId=nodeIdMap[this.nodeId]}},subscribe:function(self,stage){var constraint=this;this.unsubscribe(self,stage);$(window).bind([this.UPDATE_EVENT,this.nodeId,".","pos-",self.getId()].join(""),function(event,id){if(stage.find(self.getId())===self){constraint.execute(self,stage)}});$(window).bind([this.REMOVE_EVENT,this.nodeId,".","pos-",self.getId()].join(""),function(event,id){self.getConstraints().remove(constraint)})},unsubscribe:function(self,stage){$(window).unbind([this.UPDATE_EVENT,this.nodeId,".","pos-",self.getId()].join(""));$(window).unbind([this.REMOVE_EVENT,this.nodeId,".","pos-",self.getId()].join(""))},__toObject:function(){return{nodeId:this.nodeId,px:this.px,py:this.py}},__fromObject:function(object){this.nodeId=object.nodeId;this.px=object.px;this.py=object.py},getClassName:function(){return"PositionConstraint"}})}());(function(){_gliffy.WidthConstraint=_gliffy.Constraint.extend({widthInfo:null,isMin:null,minWidth:null,growParent:false,padding:0,init:function(widthArray,isMin,growParent){var i=0;this.isMin=isMin===true;this.growParent=growParent===true;if(widthArray){this.widthInfo=[];for(i=0;i<widthArray.length;i++){this.widthInfo.push({id:widthArray[i].node.getId(),magnitude:widthArray[i].magnitude})}}},execute:function(self,stage){var width=0,i,info,diff,parent;if(this.widthInfo&&this.widthInfo.length>0){for(i=0;i<this.widthInfo.length;i++){info=this.widthInfo[i];width+=stage.find(info.id).getWidth()*info.magnitude}width=width+this.padding;if(!this.isMin||(this.isMin&&self.getWidth()<width)){if(this.minWidth&&width<this.minWidth){width=this.minWidth}if(self.getWidth()!==width){if(this.growParent){parent=self.getUidNode();diff=width-self.getWidth();parent.setWidth(parent.getWidth()+diff)}self.setWidth(width)}}}},updateIdsForCopy:function(nodeIdMap){var i;for(i=0;i<this.widthInfo.length;i++){if(nodeIdMap[this.widthInfo[i].id]!==undefined){this.widthInfo[i].id=nodeIdMap[this.widthInfo[i].id]}}},subscribe:function(self,stage){var i,info,node,constraint=this,updateHandler,removeHandler;this.unsubscribe(self,stage);updateHandler=function(){if(stage.find(self.getId())===self){constraint.execute(self,stage)}};removeHandler=function(event,id){var i;if(stage.find(self.getId())===self){if(constraint.widthInfo.length>1){for(i=0;i<constraint.widthInfo.length;i++){if(constraint.widthInfo[i].id===id){constraint.widthInfo.splice(i,1);break}}}else{self.getConstraints().remove(constraint)}}};for(i=0;i<this.widthInfo.length;i++){info=this.widthInfo[i];$(window).bind([this.UPDATE_EVENT,info.id,".","width-",self.getId()].join(""),updateHandler);$(window).bind([this.REMOVE_EVENT,info.id,".","width-",self.getId()].join(""),removeHandler)}},unsubscribe:function(self,stage){var i,info,node;for(i=0;i<this.widthInfo.length;i++){info=this.widthInfo[i];$(window).unbind([this.UPDATE_EVENT,info.id,".","width-",self.getId()].join(""));$(window).unbind([this.REMOVE_EVENT,info.id,".","width-",self.getId()].join(""))}},__toObject:function(){return{isMin:this.isMin,widthInfo:this.widthInfo,minWidth:this.minWidth,growParent:this.growParent,padding:this.padding}},__fromObject:function(object){this.isMin=object.isMin===true;this.widthInfo=object.widthInfo;this.minWidth=object.minWidth;this.growParent=object.growParent===true;this.padding=object.padding||0},getClassName:function(){return"WidthConstraint"}})}());(function(){_gliffy.MinWidthConstraint=_gliffy.Constraint.extend({width:null,init:function(width){this.width=width},execute:function(self,stage){if(self.getWidth()<this.width){self.setWidth(this.width)}},updateIdsForCopy:function(nodeIdMap){},subscribe:function(self,stage){},unsubscribe:function(self,stage){},__toObject:function(){return{width:this.width}},__fromObject:function(object){this.width=object.width},getClassName:function(){return"MinWidthConstraint"}})}());(function(){_gliffy.HeightConstraint=_gliffy.Constraint.extend({heightInfo:null,isMin:null,minHeight:null,growParent:false,padding:0,init:function(heightArray,isMin,growParent){var i=0;this.isMin=isMin===true;this.growParent=growParent===true;if(heightArray){this.heightInfo=[];for(i=0;i<heightArray.length;i++){this.heightInfo.push({id:heightArray[i].node.getId(),magnitude:heightArray[i].magnitude})}}},execute:function(self,stage){var height=0,i,info,diff,parent;if(this.heightInfo&&this.heightInfo.length>0){for(i=0;i<this.heightInfo.length;i++){info=this.heightInfo[i];height+=stage.find(info.id).getHeight()*info.magnitude}height=height+this.padding;if(!this.isMin||(this.isMin&&self.getHeight()<height)){if(this.minHeight&&height<this.minHeight){height=this.minHeight}if(self.getHeight()!==height){if(this.growParent){parent=self.getUidNode();diff=height-self.getHeight();parent.setHeight(parent.getHeight()+diff)}self.setHeight(height)}}}},updateIdsForCopy:function(nodeIdMap){var i;for(i=0;i<this.heightInfo.length;i++){if(nodeIdMap[this.heightInfo[i].id]!==undefined){this.heightInfo[i].id=nodeIdMap[this.heightInfo[i].id]}}},subscribe:function(self,stage){var i,info,node,constraint=this,updateHandler,removeHandler;this.unsubscribe(self,stage);updateHandler=function(){if(stage.find(self.getId())===self){constraint.execute(self,stage)}};removeHandler=function(event,id){var i;if(stage.find(self.getId())===self){if(constraint.heightInfo.length>1){for(i=0;i<constraint.heightInfo.length;i++){if(constraint.heightInfo[i].id===id){constraint.heightInfo.splice(i,1);break}}}else{self.getConstraints().remove(constraint)}}};for(i=0;i<this.heightInfo.length;i++){info=this.heightInfo[i];$(window).bind([this.UPDATE_EVENT,info.id,".","height-",self.getId()].join(""),updateHandler);$(window).bind([this.REMOVE_EVENT,info.id,".","height-",self.getId()].join(""),removeHandler)}},unsubscribe:function(self,stage){var i,info,node;for(i=0;i<this.heightInfo.length;i++){info=this.heightInfo[i];$(window).unbind([this.UPDATE_EVENT,info.id,".","height-",self.getId()].join(""));$(window).unbind([this.REMOVE_EVENT,info.id,".","height-",self.getId()].join(""))}},__toObject:function(){return{isMin:this.isMin,heightInfo:this.heightInfo,minHeight:this.minHeight,growParent:this.growParent,padding:this.padding}},__fromObject:function(object){this.isMin=object.isMin===true;this.heightInfo=object.heightInfo;this.minHeight=object.minHeight;this.growParent=object.growParent===true;this.padding=object.padding||0},getClassName:function(){return"HeightConstraint"}})}());(function(){_gliffy.MinHeightConstraint=_gliffy.Constraint.extend({height:null,init:function(height){this.height=height},execute:function(self,stage){if(self.getHeight()<this.height){self.setHeight(this.height)}},updateIdsForCopy:function(nodeIdMap){},subscribe:function(self,stage){},unsubscribe:function(self,stage){},__toObject:function(){return{height:this.height}},__fromObject:function(object){this.height=object.height},getClassName:function(){return"MinHeightConstraint"}})}());(function(){_gliffy.EndPositionConstraint=_gliffy.Constraint.extend({nodeId:null,px:null,py:null,deleted:false,init:function(node,px,py){if(node){this.nodeId=node.getId();this.px=px;this.py=py}},execute:function(self,stage){var constraintNode=stage.find(this.nodeId),point,line;if(constraintNode){this.deleted=false;constraintNode.updateWorldTransform();point=constraintNode.ratioToWorldPoint(this.px,this.py);self.updateWorldTransform();if(self.isLine()){line=self.getGraphic();if(line.editable&&line.editable.hasChangedEndPoint()){line.editable.allowComputeBestPath=true}}self.getGraphic().setWorldControlPoint(self.getGraphic().getControlPointCount()-1,point)}else{this.deleted=true}},updateIdsForCopy:function(nodeIdMap){if(nodeIdMap[this.nodeId]!==undefined){this.nodeId=nodeIdMap[this.nodeId]}},getRatio:function(){return new _gliffy.Vec2(this.px,this.py)},subscribe:function(self,stage){var constraint=this;this.unsubscribe(self,stage);$(window).bind([this.UPDATE_EVENT,this.nodeId,".","ep-",self.getId()].join(""),function(event,id){if(stage.find(self.getId())===self){constraint.execute(self,stage)}});$(window).bind([this.REMOVE_EVENT,this.nodeId,".","ep-",self.getId()].join(""),function(event,id){constraint.deleted=true})},unsubscribe:function(self,stage){$(window).unbind([this.UPDATE_EVENT,this.nodeId,".","ep-",self.getId()].join(""));$(window).unbind([this.REMOVE_EVENT,this.nodeId,".","ep-",self.getId()].join(""))},__toObject:function(){if(!this.deleted){return{nodeId:this.nodeId,px:this.px,py:this.py}}else{return null}},__fromObject:function(object){this.nodeId=object.nodeId;this.px=object.px;this.py=object.py},getClassName:function(){return"EndPositionConstraint"}})}());(function(){_gliffy.StartPositionConstraint=_gliffy.Constraint.extend({nodeId:null,px:null,py:null,deleted:false,init:function(node,px,py){if(node){this.nodeId=node.getId();this.px=px;this.py=py}},execute:function(self,stage){var constraintNode=stage.find(this.nodeId),point,line;if(constraintNode){this.deleted=false;constraintNode.updateWorldTransform();point=constraintNode.ratioToWorldPoint(this.px,this.py);self.updateWorldTransform();if(self.isLine()){line=self.getGraphic();if(line.editable&&line.editable.hasChangedStartPoint()){line.editable.allowComputeBestPath=true}}self.getGraphic().setWorldControlPoint(0,point)}else{this.deleted=true}},getRatio:function(){return new _gliffy.Vec2(this.px,this.py)},updateIdsForCopy:function(nodeIdMap){if(nodeIdMap[this.nodeId]!==undefined){this.nodeId=nodeIdMap[this.nodeId]}},subscribe:function(self,stage){var constraint=this;this.unsubscribe(self,stage);$(window).bind([this.UPDATE_EVENT,this.nodeId,".","sp-",self.getId()].join(""),function(event,id){if(stage.find(self.getId())===self){constraint.execute(self,stage)}});$(window).bind([this.REMOVE_EVENT,this.nodeId,".","sp-",self.getId()].join(""),function(event,id){constraint.deleted=true})},unsubscribe:function(self,stage){$(window).unbind([this.UPDATE_EVENT,this.nodeId,".","sp-",self.getId()].join(""));$(window).unbind([this.REMOVE_EVENT,this.nodeId,".","sp-",self.getId()].join(""))},__toObject:function(){if(!this.deleted){return{nodeId:this.nodeId,px:this.px,py:this.py}}else{return null}},__fromObject:function(object){this.nodeId=object.nodeId;this.px=object.px;this.py=object.py},getClassName:function(){return"StartPositionConstraint"}})}());(function(){_gliffy.ConstHeightConstraint=_gliffy.Constraint.extend({height:null,init:function(height){this.height=height},execute:function(self,stage){self.setHeight(this.height)},updateIdsForCopy:function(nodeIdMap){},subscribe:function(self,stage){},unsubscribe:function(self,stage){},__toObject:function(){return{height:this.height}},__fromObject:function(object){this.height=object.height},getClassName:function(){return"ConstHeightConstraint"}})}());(function(){_gliffy.ConstWidthConstraint=_gliffy.Constraint.extend({width:null,init:function(width){this.width=width},execute:function(self,stage){self.setWidth(this.width)},updateIdsForCopy:function(nodeIdMap){},subscribe:function(self,stage){},unsubscribe:function(self,stage){},__toObject:function(){return{width:this.width}},__fromObject:function(object){this.width=object.width},getClassName:function(){return"ConstWidthConstraint"}})}());(function(){_gliffy.Constraints=_gliffy.Serializable.extend({node:null,stage:null,_subscribe_to_constraints:true,_constraints:null,_start_constraint:null,_end_constraint:null,init:function(node,subscribeToConstraints){this.node=node;if(node!==null){this.stage=node.stage}if(subscribeToConstraints===true||subscribeToConstraints===false){this._subscribe_to_constraints=subscribeToConstraints}this._constraints=[]},add:function(constraint){if(constraint instanceof _gliffy.Constraint){if(constraint instanceof _gliffy.EndPositionConstraint){if(this._end_constraint&&this._subscribe_to_constraints){this._end_constraint.unsubscribe(this.node,this.node.stage)}this._end_constraint=constraint}else{if(constraint instanceof _gliffy.StartPositionConstraint){if(this._start_constraint&&this._subscribe_to_constraints){this._start_constraint.unsubscribe(this.node,this.node.stage)}this._start_constraint=constraint}else{this._constraints.push(constraint)}}if(this.node.stage&&this._subscribe_to_constraints){constraint.subscribe(this.node,this.node.stage)}}else{throw new Error("object is not a constraint!"+constraint)}},remove:function(constraint){var index=$.inArray(constraint,this._constraints),removed;if(index>-1){removed=this._constraints.splice(index,1)[0];if(this.node.stage&&this._subscribe_to_constraints){removed.unsubscribe(this.node,this.node.stage)}}else{if(this._end_constraint===constraint){if(this.node.stage&&this._subscribe_to_constraints){this._end_constraint.unsubscribe(this.node,this.node.stage)}this._end_constraint=null}else{if(this._start_constraint===constraint){if(this.node.stage&&this._subscribe_to_constraints){this._start_constraint.unsubscribe(this.node,this.node.stage)}this._start_constraint=null}}}},updateIds:function(nodeIdMap){var i;this.unsubscribeAll();for(i=0;i<this._constraints.length;i++){this._constraints[i].updateIdsForCopy(nodeIdMap)}if(this._start_constraint){if(nodeIdMap[this._start_constraint.nodeId]!==undefined){this._start_constraint.updateIdsForCopy(nodeIdMap)}else{this.removeStartConstraint()}}if(this._end_constraint){if(nodeIdMap[this._end_constraint.nodeId]!==undefined){this._end_constraint.updateIdsForCopy(nodeIdMap)}else{this.removeEndConstraint()}}this.subscribeAll()},executeConstraints:function(){var i;if(this.node.stage){for(i=0;i<this._constraints.length;i++){this._constraints[i].execute(this.node,this.node.stage)}if(this._start_constraint){this._start_constraint.execute(this.node,this.node.stage)}if(this._end_constraint){this._end_constraint.execute(this.node,this.node.stage)}}},unsubscribeAll:function(){var i;if(this._subscribe_to_constraints&&this.node.stage){for(i=0;i<this._constraints.length;i++){this._constraints[i].unsubscribe(this.node,this.node.stage)}if(this._start_constraint){this._start_constraint.unsubscribe(this.node,this.node.stage)}if(this._end_constraint){this._end_constraint.unsubscribe(this.node,this.node.stage)}}},subscribeAll:function(){var i;if(this._subscribe_to_constraints&&this.node.stage){for(i=0;i<this._constraints.length;i++){this._constraints[i].subscribe(this.node,this.node.stage)}if(this._start_constraint){this._start_constraint.subscribe(this.node,this.node.stage)}if(this._end_constraint){this._end_constraint.subscribe(this.node,this.node.stage)}}},parentCanScaleHeight:function(){var i,constraint;if(!this.node.getUid()){for(i=0;i<this._constraints.length;i++){constraint=this._constraints[i];if(constraint instanceof _gliffy.MinHeightConstraint||constraint instanceof _gliffy.HeightConstraint||constraint instanceof _gliffy.ConstHeightConstraint){return false}}}return true},parentCanScaleWidth:function(){var i,constraint;if(!this.node.getUid()){for(i=0;i<this._constraints.length;i++){constraint=this._constraints[i];if(constraint instanceof _gliffy.MinWidthConstraint||constraint instanceof _gliffy.WidthConstraint){return false}}}return true},__toObject:function(){var i,constraint,constraints=[],obj,toObject;for(i=0;i<this._constraints.length;i++){constraint=this._constraints[i];obj=_gliffy.Serializable.polymorphicToObject(constraint);constraints.push(obj)}toObject={constraints:constraints};if(this._start_constraint&&!this._start_constraint.deleted){toObject.startConstraint=_gliffy.Serializable.polymorphicToObject(this._start_constraint)}if(this._end_constraint&&!this._end_constraint.deleted){toObject.endConstraint=_gliffy.Serializable.polymorphicToObject(this._end_constraint)}return toObject},__fromObject:function(object){var i,constraint;if(object.constraints){for(i=0;i<object.constraints.length;i++){constraint=_gliffy.Serializable.polymorphicFromObject(object.constraints[i]);this._constraints.push(constraint)}}if(object.startConstraint){constraint=_gliffy.Serializable.polymorphicFromObject(object.startConstraint);if(constraint.px>=0&&constraint.py>=0&&constraint.px<=1&&constraint.px<=1){this._start_constraint=constraint}}if(object.endConstraint){constraint=_gliffy.Serializable.polymorphicFromObject(object.endConstraint);if(constraint.px>=0&&constraint.py>=0&&constraint.px<=1&&constraint.px<=1){this._end_constraint=constraint}}},getConstraint:function(type){var i;if(this._start_constraint&&this._start_constraint instanceof type){return this._start_constraint}else{if(this._end_constraint&&this._end_constraint instanceof type){return this._end_constraint}else{for(i=0;i<this._constraints.length;i++){if(this._constraints[i] instanceof type){return this._constraints[i]}}}}},hasConstraints:function(){return this._start_constraint!==null||this._end_constraint!==null||this._constraints.length>0},removeStartConstraint:function(){if(this._start_constraint){this.remove(this._start_constraint)}},removeEndConstraint:function(){if(this._end_constraint){this.remove(this._end_constraint)}},getStartConstraint:function(){return this._start_constraint},getEndConstraint:function(){return this._end_constraint}})}());(function(){_gliffy.Renderer=_gliffy.Class.extend({id:null,target:null,init:function(){throw"this is the renderer interface"},render:function(options){throw"check for renderer options later"}})})();(function(){var TID=null,OVERFLOW={name:"overflow",values:["left","none","right","both"],left:"left",right:"right",both:"both",none:"none"},VALIGN={name:"valign",values:["top","middle","bottom"],top:"top",middle:"middle",bottom:"bottom"},VPOSITION={name:"vposition",values:["above","none","below"],above:"above",none:"none",below:"below"},HPOSITION={name:"hposition",values:["left","none","right"],left:"left",none:"none",right:"right"},FONT_FIXES={Arial:{normal:{9:1,10:1,11:1,12:2,13:2.5,14:2.5,18:3,24:3,36:5,48:5,64:8,72:8,96:10,110:12,127:16},bold:{9:1,10:1,11:1,12:2,13:2.5,14:2.5,18:3,24:3,36:5,48:5,64:8,72:8,96:10,110:12,127:16},ascender:{9:2,10:2,11:2,12:3,13:2,14:2,18:6,24:6,36:8,48:10,64:14,72:15,96:20,110:23,127:27},ptag:{9:0,10:0,11:0,12:0,13:0,14:0,18:0,24:0,36:0,48:0,64:0,72:0,96:0,110:0,127:0}},Verdana:{normal:{9:2.5,10:2.5,11:2.5,12:2.5,13:3.5,14:3,18:4,24:5,36:8,48:10,64:12,72:15,96:21,110:24,127:28},bold:{9:2.5,10:2.5,11:2.5,12:2.5,13:3.5,14:3.5,18:4,24:5,36:8,48:10,64:12,72:15,96:21,110:24,127:28},ascender:{9:0,10:2,11:2,12:2,13:3,14:1,18:4,24:5,36:7,48:10,64:12,72:15,96:21,110:24,127:28},ptag:{9:0,10:0,11:0,12:0,13:0,14:0,18:0,24:0,36:0,48:0,64:0,72:0,96:0,110:0,127:0}},Helvetica:{normal:{9:0,10:0,11:0,12:0,13:0,14:0,18:0,24:0,36:0,48:0,64:0,72:0,96:0,110:0,127:0},bold:{9:0,10:0,11:0,12:0,13:0,14:0,18:0,24:0,36:0,48:0,64:0,72:0,96:0,110:0,127:0},ascender:{9:1.5,10:1.5,11:2,12:2,13:2,14:2,18:3,24:5,36:8,48:10,64:14,72:16,96:22,110:26,127:30},ptag:{9:0,10:0,11:0,12:0,13:0,14:0,18:0,24:0,36:0,48:0,64:0,72:0,96:0,110:0,127:0}},Courier:{normal:{9:0,10:0,11:0,12:0,13:0,14:0,18:0,24:0,36:0,48:0,64:0,72:0,96:0,110:0,127:0},bold:{9:0,10:0,11:0,12:0,13:0,14:0,18:0,24:0,36:0,48:0,64:0,72:0,96:0,110:0,127:0},ascender:{9:2,10:2,11:3,12:2,13:3,14:3,18:4,24:6,36:9,48:13,64:16,72:19,96:23,110:28,127:30},ptag:{9:0,10:0,11:0,12:0,13:0,14:0,18:0,24:0,36:0,48:0,64:0,72:0,96:0,110:0,127:0}},Times:{normal:{9:0,10:0,11:0,12:0,13:0,14:0,18:0,24:0,36:0,48:0,64:0,72:0,96:0,110:0,127:0},bold:{9:0,10:0,11:0,12:0,13:0,14:0,18:0,24:0,36:0,48:0,64:0,72:0,96:0,110:0,127:0},ascender:{9:1,10:2,11:2,12:2,13:2,14:2,18:3,24:6,36:10,48:11,64:16,72:18,96:25,110:26,127:30},ptag:{9:0,10:0,11:0,12:0,13:0,14:0,18:0,24:0,36:0,48:0,64:0,72:0,96:0,110:0,127:0}},"Times New Roman":{normal:{9:0,10:0,11:0,12:0,13:0,14:0,18:0,24:0,36:0,48:0,64:0,72:0,96:0,110:0,127:0},bold:{9:0,10:0,11:0,12:0,13:0,14:0,18:0,24:0,36:0,48:0,64:0,72:0,96:0,110:0,127:0},ascender:{9:1,10:2,11:2,12:2,13:2,14:2,18:3,24:6,36:10,48:11,64:16,72:18,96:25,110:26,127:30},ptag:{9:0,10:0,11:0,12:0,13:0,14:0,18:0,24:0,36:0,48:0,64:0,72:0,96:0,110:0,127:0}}},TextData=_gliffy.Class.extend({init:function(){this.lines=[];this._currentLine=null;this._styleStack=[];this._styleStack.push({});this.defaultStyle={}},parseText:function(text){var root,i,children,textData=new TextData();root=document.createElement("div");root.innerHTML=text;children=root.childNodes;this.defaultStyle=null;for(i=0;i<children.length;i++){this.__parseTextNode(children[i],textData)}if(this.defaultStyle===null){this.defaultStyle={}}return this},__parseTextNode:function(node){var children,i;this._styleStack.push($.extend({},this.getCurrentStyle()));if(node.nodeType===1){if(node.tagName==="P"||node.tagName==="BR"){this.appendLine();this.__parseCss(node.style.cssText)}else{if(node.tagName==="SPAN"){this.__parseCss(node.style.cssText);if(this.defaultStyle===null){this.defaultStyle=$.extend({},this.getCurrentStyle())}}else{if(node.tagName==="A"){this.setCurrentStyle("color","blue");this.setCurrentStyle("text-decoration","underline");this.__parseCss(node.style.cssText)}else{_gliffy.Logger.warn("TextCanvas.js invalid text element="+node.tagName)}}}}else{if(node.nodeType===3){this.appendText(node.textContent)}else{_gliffy.handleError("com.gliffy.error.invalid_text_element")}}children=node.childNodes;for(i=0;i<children.length;i++){this.__parseTextNode(children[i])}this._styleStack.pop()},__parseCss:function(cssText){if(cssText&&cssText.length>0){var styles=cssText.split(";"),i;for(i=0;i<styles.length;i++){this.__parseCssStyle(styles[i])}}},__parseCssStyle:function(cssStyle){var name,value;if(cssStyle&&cssStyle.length>0){cssStyle=cssStyle.split(":");if(cssStyle[0]&&cssStyle[1]){name=cssStyle[0].trim();value=cssStyle[1].trim();this.setCurrentStyle(name,value)}}},appendLine:function(){this._currentLine={textBlocks:[],style:{}};this.lines.push(this._currentLine)},setCurrentStyle:function(name,value){this.getCurrentStyle()[name]=value},appendText:function(text){this._currentLine.textBlocks.push({text:text,style:$.extend({text:text},this.getCurrentStyle())})},getCurrentStyle:function(){return this._styleStack[this._styleStack.length-1]},getOldStyleLines:function(){var i,j,lines=[],line,textBlock,startIndex;for(i=0;i<this.lines.length;i++){if(this.lines[i].textBlocks.length>0){line={};line.align=this.lines[i].textBlocks[0].style["text-align"]||"center";line.text="";line.formats=[];startIndex=0;for(j=0;j<this.lines[i].textBlocks.length;j++){textBlock=this.lines[i].textBlocks[j];line.formats.push({startIndex:startIndex,bold:textBlock.style["font-weight"]==="bold",italic:textBlock.style["font-style"]==="italic",underline:textBlock.style["text-decoration"]==="underline",color:textBlock.style.color||"#000000",size:parseInt(textBlock.style["font-size"],10)||12,face:(textBlock.style["font-family"]||"Arial").replace(/['"]/g,"")});line.text+=textBlock.text;startIndex+=textBlock.text.length}lines.push(line)}}return lines}});_gliffy.Renderer.TextCanvas=_gliffy.Renderer.extend({id:"Gliffy.Renderer.TextCanvas",target:null,init:function(){_gliffy.renderers[this.id]=this},render:function(o){if(!o){throw"text renderer needs options"}if(!o.target){throw"needs a target canvas context"}if(!(o.object&&o.object instanceof _gliffy.Text)){throw"needs a text object to render!"}var options=$.extend({},{renderCallback:null},o),context=options.target,object=options.object,textData=new TextData(),lines,textResult,transform,result,textXOffset,textVOffset,j,padding_left,padding_right,padding_top,padding_bottom,underline_offset,i,offsetY,scale;lines=textData.parseText(object.getHTML()).getOldStyleLines();textResult=this.__calculateResult(lines,object);if(object.getOverflow()==="none"){textResult=this.__calculateResult(lines,object)}offsetY=(object.getValign()==="middle")?(object.node.getHeight()/2)-(object.getCalculatedHeight()/2):0;context.save();transform=object.node.worldTransform.getValues();if(!o.ignorePan){context.translate(object.node.stage.pan_x,object.node.stage.pan_y)}scale=object.node.stage.zoom;if(o.ignoreZoom){scale=1}context.scale(scale,scale);context.transform(transform[0],transform[1],transform[2],transform[3],transform[4],transform[5]);context.translate(object.style.x,object.style.y+offsetY);for(i=0;i<textResult.length;i++){result=textResult[i].result;textXOffset=textResult[i].textXOffset;textVOffset=textResult[i].textVOffset;for(j=0;j<result.value.fragments.length;j++){context.font=result.value.fragments[j].fontString;if(object.style.text_background_fill){context.save();context.fillStyle=object.node.stage.background;padding_left=(j===0)?2:0;padding_right=(j===result.value.fragments.length-1)?4:0;padding_top=(i===0)?0:-2;padding_bottom=(i===textResult.length-1)?4:2;context.fillRect(textXOffset-padding_left,textVOffset-result.value.fragments[j].height-padding_top,result.value.fragments[j].width+padding_right,result.value.fragments[j].height+padding_bottom);context.restore()}context.fillStyle=result.value.fragments[j].fillStyle;context.fillText(result.value.fragments[j].text,textXOffset,textVOffset);if(result.value.fragments[j].underline){context.strokeStyle=result.value.fragments[j].fillStyle;context.lineWidth=1;context.beginPath();underline_offset=result.value.fragments[j].height*0.07;context.moveTo(textXOffset,textVOffset+underline_offset);context.lineTo(textXOffset+result.value.fragments[j].width,textVOffset+underline_offset);context.stroke()}textXOffset+=result.value.fragments[j].width}}context.restore();if(options.renderCallback){options.renderCallback()}},__buildCanvasFontString:function(format){var font="";if(format.italic){font+="italic "}if(format.bold){font+="bold "}if(font.length===0){font+="normal "}font+=format.size+"px "+format.face;return font},__measureFormattedText:function(text,hardTextLine,formatOffset,textGraphic){var measure={width:0,height:0,fragments:[],baseline:0,lineHeight:0,ascender:null,ptag:null},i=0,format,endIndex,startIndex,fragment,width,height,baselineDiff,style,browser,font,fontFix;do{format=hardTextLine.formats[i];endIndex=(i+1<hardTextLine.formats.length)?hardTextLine.formats[i+1].startIndex:-1;if(endIndex===-1||endIndex>=formatOffset){startIndex=format.startIndex-formatOffset;endIndex=(endIndex===-1)?text.length:endIndex-formatOffset;font=this.__buildCanvasFontString(hardTextLine.formats[i]);this.__tcontext.font=font;fragment=text.substring(startIndex,endIndex);width=this.__tcontext.measureText(fragment).width;style=((format.bold)?"bold":"normal");if(!FONT_FIXES[format.face]){format.face="Arial"}if(FONT_FIXES[format.face]&&FONT_FIXES[format.face][style]&&FONT_FIXES[format.face][style][format.size]){fontFix=FONT_FIXES[format.face][style][format.size]}else{fontFix=0}height=format.size+fontFix;measure.width+=width;measure.height=Math.max(measure.height,height);if(fragment.length>0){measure.lineHeight=Math.max(measure.lineHeight,format.size+fontFix+"px");if(measure.ascender===null){measure.ascender=FONT_FIXES[format.face].ascender[format.size]||0}else{measure.ascender=Math.max(measure.ascender,FONT_FIXES[format.face].ascender[format.size]||0)}if(measure.ptag===null){measure.ptag=FONT_FIXES[format.face].ptag[format.size]||0}else{measure.ptag=Math.max(measure.ptag,FONT_FIXES[format.face].ptag[format.size]||0)}measure.fragments.push({text:fragment,width:width,height:height,format:format,fontString:font,fillStyle:format.color,underline:format.underline})}}else{endIndex=endIndex-formatOffset}i++}while(i<hardTextLine.formats.length&&endIndex<text.length);return measure},__binarySearch:function(text,hardTextLine,target,low,high,formatOffset,max,textGraphic){var mid,value,width,current;if(high>=low){mid=low+Math.floor((high-low)/2);value=this.__measureFormattedText(text.substring(0,mid+1),hardTextLine,formatOffset,textGraphic);width=value.width;current={index:mid,value:value};if(max===null){max=current}if(width>target){return this.__binarySearch(text,hardTextLine,target,low,mid-1,formatOffset,max,textGraphic)}else{if(width<target){return this.__binarySearch(text,hardTextLine,target,mid+1,high,formatOffset,current,textGraphic)}else{mid=this.__findBreak(text,mid);return(mid<0||mid===current.index||current.index===text.length-1)?current:{index:mid,value:this.__measureFormattedText(text.substring(0,mid+1),hardTextLine,formatOffset,textGraphic)}}}}else{mid=this.__findBreak(text,max.index);return(mid<0||mid===max.index||max.index===text.length-1)?max:{index:mid,value:this.__measureFormattedText(text.substring(0,mid+1),hardTextLine,formatOffset,textGraphic)}}},__findBreak:function(text,max){var breakIndexSpace=text.lastIndexOf(" ",max),breakIndexHyphen=text.lastIndexOf("-",max);return Math.max(breakIndexSpace,breakIndexHyphen)},__calculateResult:function(lines,textGraphic){this.__tcontext=_gliffy.Utils.getContext($('<canvas style="display:none;white-space: nowrap;"></canvas>').appendTo("body").get(0));var textVOffset=0,textXOffset=0,i=0,text,increment,formatOffset,result,h,canvasVOffset;this.__cachedResult=[];for(i=0;i<lines.length;i++){text=lines[i].text;if(text.length===0){increment=lines[i].formats[0].size;textGraphic.style.height+=increment;textVOffset+=increment}else{formatOffset=0;while(text.length>0){if(textGraphic.getOverflow()===OVERFLOW.none){result=this.__binarySearch(text,lines[i],textGraphic.style.width,0,text.length-1,formatOffset,null,textGraphic)}else{result={index:text.length-1,value:this.__measureFormattedText(text,lines[i],formatOffset,textGraphic)}}if(lines[i].align==="right"){textXOffset=(textGraphic.style.width-result.value.width)}else{if(lines[i].align==="center"){textXOffset=(textGraphic.style.width-result.value.width)/2}else{textXOffset=0}}h=parseInt(result.value.height,10);textVOffset=textVOffset+h;canvasVOffset=textVOffset-result.value.ascender;textVOffset+=result.value.ptag;this.__cachedResult.push({textXOffset:textXOffset,textVOffset:canvasVOffset,height:h,lineHeight:result.value.lineHeight,result:result});text=text.substring(result.index+1);textGraphic.style.height=textVOffset;if(textGraphic.getOverflow()!==OVERFLOW.none){textGraphic.style.width=Math.max(textGraphic.style.width,result.value.width)}formatOffset+=result.index+1}}}$(this.__tcontext.canvas).remove();return this.__cachedResult}});_gliffy.TextData=TextData}());(function(){_gliffy.Renderer.TextDom=_gliffy.Renderer.extend({id:"Gliffy.Renderer.TextDom",target:null,__vertical_offset:0,__middle_valign_offset:0,init:function(){_gliffy.renderers[this.id]=this},render:function(o){if(!o){throw new Error("text renderer needs options")}if(!o.container){throw new Error("needs a target container")}if(!(o.object&&o.object instanceof _gliffy.Text)){throw new Error("needs a text object to render!")}var options=$.extend({},{renderCallback:null},o),object=options.object,container=options.container,domStage=options.stage,stage=object.node.stage,zIndex=options.zIndex,offsetY,transform,padding,bounds,createTextNodes;if(!(object.editable.isEditable&&object.editable.getEditMode())&&(object.node.hasRepositionCanvasFlag()||object.node.hasRedrawCanvasFlag())){createTextNodes=!object.__cachedDomResult||object.node.hasRepositionCanvasFlag();if(createTextNodes){object.node.getDomElement().remove();object.__cachedDomResult=this.__buildDomObject(object);domStage.append(object.__cachedDomResult)}object.__cachedDomResult.data("node",object.node);if(!options.zIndex){zIndex=0}this.__middle_valign_offset=(object.node.getHeight()/2)-(object.getCalculatedHeight()/2);offsetY=(object.getValign()==="middle")?this.__middle_valign_offset+this.__vertical_offset:this.__vertical_offset;transform=object.node.worldTransform;transform=new _gliffy.AffineTransform(1,0,0,1,0,0).scale(object.node.stage.zoom,object.node.stage.zoom).concatenate(transform).translate(object.style.x,object.style.y+offsetY);padding=(object.style.text_background_fill||object.style.overflow!=="none")?2:0;if(createTextNodes||object.node.hasRepositionCanvasFlag()){object.__cachedDomResult.css($.extend(_gliffy.Utils.transformCss(transform,{roundTranslate:true}),{width:object.style.width+padding,height:object.style.height+padding,visibility:"visible",position:"absolute",zIndex:zIndex,display:"block",margin:0,padding:0}))}if(object.isComputePositioning()){object.markDirty();object.update();object.node.getDomElement().remove();object.__cachedDomResult=this.__buildDomObject(object);object.__cachedDomResult.data("node",object.node);transform=object.node.worldTransform;transform=new _gliffy.AffineTransform(1,0,0,1,0,0).scale(object.node.stage.zoom,object.node.stage.zoom).concatenate(transform).translate(object.style.x,object.style.y+offsetY);padding=(object.style.text_background_fill)?2:0;object.__cachedDomResult.css($.extend(_gliffy.Utils.transformCss(transform,{roundTranslate:true}),{width:object.style.width+padding,height:object.style.height+padding,visibility:"visible",position:"absolute",zIndex:zIndex,display:"block",margin:0,padding:0}));domStage.append(object.__cachedDomResult);object.positionComputed()}object.__cachedDomResult.data("transform",transform);if(stage.autoFit){bounds=_gliffy.Utils.maxBounds(transform,object.style.width+padding,object.style.height+padding,stage);object.node.current_bounds=bounds;if(bounds.x>stage.width||bounds.y>stage.height){stage.width=Math.max(stage.width,bounds.x);stage.height=Math.max(stage.height,bounds.y)}}object.node.resetFlags();if(options.renderCallback){options.renderCallback()}}},__buildDomObject:function(object){var textNode,class_,bgcolor="transparent",shapeInfo,themeType;class_="gliffy-text gliffy-graphic gliffy-rte-text";if(object.node.parent){if(object.node.parent.isLine()){class_+=" gliffy-text-with-line-parent";bgcolor=object.node.stage.background==="transparent"?"#ffffff":object.node.stage.background}else{if(object.node.parent.isShape()){shapeInfo=object.node.parent.getShapeInformation();themeType=(shapeInfo&&shapeInfo.defaults&&shapeInfo.defaults.themeType)?shapeInfo.defaults.themeType:null;if(themeType){class_+=" gliffy-text-with-shape-parent-"+themeType}}}}else{class_+=" gliffy-text-standalone"}textNode=$("<div/>",{id:object.node._domId,"class":class_}).css({width:object.style.width,height:object.style.height,visibility:"hidden",overflow:"visible",display:"block",margin:0,padding:0,backgroundColor:bgcolor}).append(object.getHTML());return textNode}})}());(function(){_gliffy.Renderer.ShapeCanvas=_gliffy.Renderer.extend({id:"Gliffy.Renderer.ShapeCanvas",target:null,init:function(){_gliffy.renderers[this.id]=this},render:function(o){if(!o){throw new Error("shape renderer needs options")}if(!o.target){throw new Error("needs a target canvas context")}if(!o.object){throw new Error("no shape to render")}var ctx=o.target,object=o.object,renderCallback=o.renderCallback,transform,values,offsetX,offsetY,scale=object.node.stage.zoom,data,shadow_scale_x,shadow_scale_y,originalFill,pan_x,pan_y;originalFill=object.style.fill;if(originalFill==="none"){object.style.fill="rgba(255,255,255,"+_gliffy.MIN_OPACITY+")"}if(object.style.single_canvas){if(o.ignoreZoom){scale=1}pan_x=(o.ignorePan)?0:object.node.stage.pan_x;pan_y=(o.ignorePan)?0:object.node.stage.pan_y;transform=new _gliffy.AffineTransform(1,0,0,1,0,0).translate(pan_x,pan_y).scale(scale,scale).concatenate(object.node.worldTransform);values=transform.getValues();object.style.matrix_a=values[0];object.style.matrix_b=values[1];object.style.matrix_c=values[2];object.style.matrix_d=values[3];object.style.matrix_e=values[4];object.style.matrix_f=values[5]}offsetX=(object.style.single_canvas)?0:object.style.offset_x;offsetY=(object.style.single_canvas)?0:object.style.offset_y;data=object.style;ctx.save();ctx.translate(offsetX*scale,offsetY*scale);ctx.transform(data.matrix_a,data.matrix_b,data.matrix_c,data.matrix_d,data.matrix_e,data.matrix_f);if(object.isDropShadow()&&!(object.getFillColor()==="none"&&object.getStrokeWidth()===0)){ctx.save();if(originalFill!=="none"){shadow_scale_x=(object.style.width+object.style.stroke_width/2)/object.style.width;shadow_scale_y=(object.style.height+object.style.stroke_width/2)/object.style.height;ctx.translate(object.style.shadow_x,object.style.shadow_y);ctx.scale(shadow_scale_x,shadow_scale_y);_gliffy.shapeLibrary.drawStencil(object.getTid(),ctx,$.extend({},object.style,{fill:"#000000",opacity:0.294117647,stroke:"none",gradient:false}),_gliffy)}else{if(object.style.stroke_width>0){ctx.translate(object.style.shadow_x,object.style.shadow_y);_gliffy.shapeLibrary.drawStencil(object.getTid(),ctx,$.extend({},object.style,{opacity:0.294117647,fill:"none",gradient:false}))}}ctx.restore()}if(_gliffy.shapeLibrary.canDrawStencil(object.getTid())){_gliffy.shapeLibrary.drawStencil(object.getTid(),ctx,data);object.node.resetFlags()}ctx.restore();object.style.fill=originalFill;if(renderCallback){renderCallback()}}})}());(function(){_gliffy.Renderer.SvgCanvas=_gliffy.Renderer.extend({id:"Gliffy.Renderer.SvgCanvas",target:null,init:function(){_gliffy.renderers[this.id]=this},render:function(o){if(!o){throw new Error("svg renderer needs options")}if(!o.target){throw new Error("needs a target canvas context")}if(!o.object){throw new Error("no svg to render")}var ctx=o.target,object=o.object,renderCallback=o.renderCallback,transform,values,offsetX,offsetY,scale=object.node.stage.zoom,data,originalFill,pan_x,pan_y,dim,svg;originalFill=object.style.fill;if(originalFill==="none"){object.style.fill="rgba(255,255,255,"+_gliffy.MIN_OPACITY+")"}if(object.style.single_canvas){if(o.ignoreZoom){scale=1}pan_x=(o.ignorePan)?0:object.node.stage.pan_x;pan_y=(o.ignorePan)?0:object.node.stage.pan_y;transform=new _gliffy.AffineTransform(1,0,0,1,0,0).translate(pan_x,pan_y).scale(scale,scale).concatenate(object.node.worldTransform);values=transform.getValues();object.style.matrix_a=values[0];object.style.matrix_b=values[1];object.style.matrix_c=values[2];object.style.matrix_d=values[3];object.style.matrix_e=values[4];object.style.matrix_f=values[5]}offsetX=(object.style.single_canvas)?0:object.style.offset_x;offsetY=(object.style.single_canvas)?0:object.style.offset_y;data=object.style;ctx.save();ctx.translate(offsetX*scale,offsetY*scale);ctx.transform(data.matrix_a,data.matrix_b,data.matrix_c,data.matrix_d,data.matrix_e,data.matrix_f);svg=object.node.stage.gon.getEmbeddedResources().getResource(object.getEmbeddedResourceId()).getData();dim=_gliffy.shapeLibrary.svgDim[svg];ctx.scale(object.style.width/dim.width,object.style.height/dim.height);ctx.translate(-dim.x,-dim.y);if(_gliffy.shapeLibrary.canDrawStencil(svg)){_gliffy.shapeLibrary.drawStencil(svg,ctx,data);object.node.resetFlags()}ctx.restore();object.style.fill=originalFill;if(renderCallback){renderCallback()}}})}());(function(){_gliffy.Renderer.LineCanvas=_gliffy.Renderer.extend({id:"Gliffy.Renderer.LineCanvas",target:null,init:function(){_gliffy.renderers[this.id]=this},render:function(o){if(!o){throw new Error("line renderer needs options")}if(!o.target){throw new Error("needs a target canvas context")}if(!o.object){throw new Error("no line to render")}var context=o.target,object=o.object,callback=o.renderCallback,self=this;if(object.getFillColor()&&object.getFillColor()!=="none"&&object.getFillColor()!==object.getStrokeColor()){o.renderCallback=function(){o.renderCallback=function(){if(callback){callback()}};self._renderFillLine(o)}}this._render(o)},_render:function(o){if(!o){throw new Error("line renderer needs options")}if(!o.target){throw new Error("needs a target canvas context")}if(!o.object){throw new Error("no line to render")}var style,context=o.target,line,object=o.object,data=object.style,callback=o.renderCallback,scale=object.node.stage.zoom,c,tmpCtx,transform,values,pan_x,pan_y;line=new _gliffy.Linevg(object.getDrawCommands());if(!object.style.single_canvas){this._pushContextMatrix(context,data,scale);if(object.editable.isEditable){style=$.extend({},data,{stroke:object.node.stage.background==="transparent"?"#ffffff":object.node.stage.background,stroke_width:data.stroke_width+object.OVERLAY_EXTEND,opacity:0.008,stroke_dasharray:null,start_arrow:"none",end_arrow:"none"});line.drawPath(context,style)}if(object.getOverlay()){style=$.extend({},data,{stroke_width:data.stroke_width+object.OVERLAY_DISPLAY_EXTEND,stroke:"#97bfe0",stroke_dasharray:null,start_arrow:"none",end_arrow:"none"});line.drawPath(context,style)}line.drawPath(context,data);this._popContextMatrix(context)}else{if(o.ignoreZoom){scale=1}object.style.matrix_a=scale;object.style.matrix_b=0;object.style.matrix_c=0;object.style.matrix_d=scale;object.style.matrix_e=0;object.style.matrix_f=0;c=document.createElement("canvas");c.width=object.style.graphic_width*scale;c.height=object.style.graphic_height*scale;tmpCtx=_gliffy.Utils.getContext(c);this._pushContextMatrix(tmpCtx,data,scale);line.drawPath(tmpCtx,data);this._popContextMatrix(tmpCtx);transform=new _gliffy.AffineTransform(1,0,0,1,0,0).scale(scale,scale).translate(object.style.pos_x,object.style.pos_y).translate(-object.style.offset_x,-object.style.offset_y).scale(1/scale,1/scale);values=transform.getValues();context.save();context.transform(values[0],values[1],values[2],values[3],values[4],values[5]);context.drawImage(c,0,0);context.restore()}if(callback){callback()}},_pushContextMatrix:function(context,style,scale){context.save();context.translate(-style.pos_x*scale,-style.pos_y*scale);context.translate(style.offset_x*scale,style.offset_y*scale);context.transform(style.matrix_a,style.matrix_b,style.matrix_c,style.matrix_d,style.matrix_e,style.matrix_f)},_popContextMatrix:function(context){context.restore()},_renderFillLine:function(o){if(!o){throw new Error("line renderer needs options")}if(!o.target){throw new Error("needs a target canvas context")}if(!o.object){throw new Error("no line to render")}var context=o.target,object=o.object,callback=o.renderCallback,scale=object.node.stage.zoom,fillStyle=$.extend({},object.style),c,tmpCtx,fillLine,transform,values,offset,strokeScale=[1,2,3,17];fillStyle.stroke=object.style.fill;this.generateArrowMarkerAttributes("start",fillStyle,fillStyle.start_arrow);this.generateArrowMarkerAttributes("end",fillStyle,fillStyle.end_arrow);if(object.style.stroke_width===6&&((fillStyle.start_arrow&&strokeScale.indexOf(fillStyle.start_arrow)!==-1)||(fillStyle.end_arrow&&strokeScale.indexOf(fillStyle.end_arrow)!==-1))){fillStyle.stroke_width=object.style.stroke_width-0.3;offset=1}else{fillStyle.stroke_width=object.style.stroke_width>3?object.style.stroke_width-2:object.style.stroke_width;offset=2}fillStyle.offset_y-=2;fillStyle.path=this._calculatePath(object,fillStyle,offset);c=document.createElement("canvas");c.width=object.style.graphic_width*scale;c.height=object.style.graphic_height*scale;tmpCtx=_gliffy.Utils.getContext(c);this._pushContextMatrix(tmpCtx,object.style,object.node.stage.zoom);fillLine=new _gliffy.Linevg(fillStyle.path);fillLine.drawPath(tmpCtx,fillStyle);this._popContextMatrix(tmpCtx);if(object.style.single_canvas){context.save();transform=new _gliffy.AffineTransform(1,0,0,1,0,0).scale(object.node.stage.zoom,object.node.stage.zoom).translate(object.style.pos_x,object.style.pos_y).translate(-object.style.offset_x,-object.style.offset_y).scale(1/scale,1/scale);values=transform.getValues();context.transform(values[0],values[1],values[2],values[3],values[4],values[5]);context.drawImage(c,0,0);context.restore()}else{context.drawImage(c,0,0)}if(callback){callback()}},generateArrowMarkerAttributes:function(arrowPos,style,arrowType){if(arrowType===17){switch(style.stroke_width){case 4:style["marker_"+arrowPos+"_width"]+=7;style["marker_"+arrowPos+"_height"]+=7;break;case 5:style["marker_"+arrowPos+"_width"]+=4;style["marker_"+arrowPos+"_height"]+=4;break;case 7:style["marker_"+arrowPos+"_width"]+=1;style["marker_"+arrowPos+"_height"]+=1;break;case 9:style["marker_"+arrowPos+"_width"]+=0.5;style["marker_"+arrowPos+"_height"]+=0.5;break}}else{if(arrowType<4){switch(style.stroke_width){case 4:style["marker_"+arrowPos+"_width"]+=7.6;style["marker_"+arrowPos+"_height"]+=7.6;break;case 5:style["marker_"+arrowPos+"_width"]+=5;style["marker_"+arrowPos+"_height"]+=5;break;case 7:style["marker_"+arrowPos+"_width"]+=2.9;style["marker_"+arrowPos+"_height"]+=2.9;break;case 9:style["marker_"+arrowPos+"_width"]+=2.1;style["marker_"+arrowPos+"_height"]+=2.1;break}}else{switch(style.stroke_width){case 4:style["marker_"+arrowPos+"_width"]-=6;style["marker_"+arrowPos+"_height"]-=6;break;case 5:style["marker_"+arrowPos+"_width"]-=6;style["marker_"+arrowPos+"_height"]-=6;break;case 7:style["marker_"+arrowPos+"_width"]-=8;style["marker_"+arrowPos+"_height"]-=8;break;case 9:style["marker_"+arrowPos+"_width"]-=10;style["marker_"+arrowPos+"_height"]-=10;break}}}},_calculatePath:function(object,fillStyle,offset){var distance,startDistance,endDistance,startPoint,endPoint;distance=object.getPathLength();startDistance=0;if(fillStyle.start_arrow>0){startDistance=offset}endDistance=distance.totalDistance;if(fillStyle.end_arrow>0){endDistance=distance.totalDistance-offset}startPoint=object.getPointInPathAtDistance(startDistance);endPoint=object.getPointInPathAtDistance(endDistance);return this._buildStylePath(object.getDrawCommands(),startPoint,endPoint)},_buildStylePath:function(path,start,end){var newPath=[],i=0,args;for(i=0;i<path.length;i++){newPath.push({name:path[i].name,args:path[i].args})}if(start){newPath[0].args=start.x+","+start.y}if(end){args=newPath[newPath.length-1].args.split(" ");args.pop();args.push(end.x+","+end.y);newPath[newPath.length-1].args=args.join(" ")}return newPath}})}());(function(){var imageNotAvailable="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZAAAAGQCAYAAACAvzbMAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNui8sowAAAAWdEVYdENyZWF0aW9uIFRpbWUAMTEvMjAvMTL51e9HAAAgAElEQVR4nO3dOXAbV7YG4L+xA1ywL6TElA6HE1KpUjnVhKPslSdV5rKjp3KmeplcL5NDK6VSpVQyVUNHU48pKRLERuw70C/gnOsGCIAg2EB3A/8X2WMOcUkC+HHuuYv2z3/+UwcREdEjeeQfXC6XleMgIiKHGA6HAP4TIC6XC3/961/RbrfRbrcRCAQQCAQsHSAREdmPruv497//DV3X/6xAAKDdbuP29hYejwfJZJIhQkREiq7rKBQKCAQCGA6HGJm3CgQC8Hg86PV6yGaz6HQ6Vo2TiIhsZDAYoFAooFarAQC63e79AEkmk3C5XBgOh8jlcmi325YMloiI7EPCQ9M0dLtdtNtt3OucBwIB7O3twev1shIhItpwUkw0Gg0AQDgcRqvVgq7r9wMEAPx+/0glcnNzw0qEiGjD6LqOfD6Per0OANjd3UU0GlX/feraXalEPB4P+v0+crkcut3u8kdMRESWGw6HyOfzaDQa0DQN0WgU8Xgcmqapr5m5+cPv9yOVSsHtdqPf7+P6+prTWUREa24wGCCXy6nKY2dnB9FodCQ8gAcCBLirRNLpNFwul/qmrESIiNZXoVBAs9mEpmmIRCKIx+MTv26u7ecSIrLE9+rqiiFCRLRmBoMBstmsmraKRCKIxWL3Kg8x9/klwWAQqVQKmqapxjqns4iI1kc+n0ez2QQARCIRRCKRmV//qAOwAoEAMpmMqkRubm5YiRAROdxgMMDNzY0Kj3g8PrHnMe7RJygGg0Ekk0nVWOc+ESIi55q02iocDs/1/13oCF4JEZfLhX6/j3w+z0qEiMhhZJ+HsWH+0LSV0cJnuIdCIdVY73a7bKwTETmITFvJDvNIJDLXtJXRky4BkUpEGuu5XI7TWUREDvCUykM8+RapYDCozs7qdrvIZrOsRIiIbEqW6kp4xGKxmUt1ZzHlGsJAIIBEIqE2G3KJLxGR/QyHQ7VJELg722rehvkkpt1jK/tEZIkvd6wTEdmH8VRdY+XxFKZehB4KhdQS316vh+vra4YIEZHF5EBcqTzC4TAikchC01ZGpgYIMLrEV87O6vV6Zj8MERHNQdd1FR7SMDceyf4UpgcIcFeJyCm+ssS33+8v46GIiGiKfr+v7nN6asN8kqUECHAXIolEApqmqa4/p7OIiFZj0ibB3d1dUx9jaQECAFtbW0in06oS4XQWEdHyyYf2VqsFTdPmPtvqsZYaIMCfjXWXy4Vut8vGOhHREknvWcJjGZWHWHqAAKPTWXJ2FisRIiJzScO81WrB5XIhHo8vtMN8XisJEADY3t5WZ2d1Oh1cXV0xRIiITCKno49XHmZPWxmtLECAu0pELmXn9bhERObQdR2FQkGFRywWe9IO83mtNECAu8a67FjvdDrIZrOsRIiIFtTv93F9fa1WW8XjcYTD4aVWHmLlAQLchYixJ8KbDYmIHm8wGKBQKKh9HstsmE9iSYAA91dn5XI5bjYkIprTcDhU19C6XC7EYrGlNswnsSxAgLvGunHH+rdv3zidRUT0ADnbqt1uA7i7DGpV01ZGlgYIcH/HOjcbEhFNp+u6us9DKo9VNMwnsTxAgD8b6263WzXWB4OB1cMiIrIVaZh3u1212sqMU3UXZYsAAe5CRJb49no9rs4iIjKQGRrjwYirbJhPYpsAAe56ItJY73Q6uLm5ga7rVg+LiMhScrZVu92Gy+VCMpm0bNrKyFYBAvwZIpqmodvt4vLykpUIEW0s2erQ6XSgaRqi0Si2t7etHhYAGwYIcDedJSEi1+NyiS8RbRpd19V9Hi6XC4lEwhaVh7BlgACjS3w7nQ6ur68ZIkS0MeRacKk84vE4dnZ2rB7WCNsGCDC6Y73X6+Hm5obTWUS09uQyKGmY2zE8AJsHCPBniBgb61ziS0Trqt/v4+rqSoVHIpGwfLXVNLYPEADY2dkZaaxfX1+zEiGitSNLde08bWXkiAABRqezut0u8vk8eyJEtDbGl+raufIQjgkQ4K4SkcZ6u93G9fU1p7OIyPHGl+ravfIQjgoQ4K4SicViI411ViJE5FTGHeZytpUTwgNwYIAAd5WINNbb7TZ3rBORI8lSXWPD3E77PB7iyAAB7kJEzs6SfSJsrBORU/T7feTz+ZGDEe2yw3xejg0QYDRE2u028vk8KxEisj1j5eF2u5FKpRxVeQhHBwgA7O7uqtVZ7XYbV1dX7IkQkW31ej3k83n0ej1VeWxtbVk9rIU4PkCA+9NZuVyOq7OIyHaMS3XdbjeSyaRjGuaTrEWAAH9WItJY56VURGQnxuOYpGHutJ7HuLUJEOB+JcIlvkRkB+NLdROJhGOnrYzWKkCAuxCJxWKqEsnlcmysE5Fler0erq6u0Ol01GVQTp62Mlq7AAGAcDg80lj/9u0bKxEiWjm5z0imreLx+FpUHmItAwS4u09EdqzL2VnsiRDRqkjDvNPpqKW661J5iLUNEOCuEpE71lutFs/OIqKV6PV6yGazIw3zdao8xFoHCHC/EuH1uES0TIPBAPl8XvU81jU8gA0IEODP1VlSibCxTkTL0O128e3bN7Xaap0a5pNsRIBomobd3V1Eo1HVWOcSXyIyk+ww7/f7a9kwn2QjAkTs7u4iEolA0zQ0m02enUVEpjAu1fV4PEin02tdeYiNChBN0xCNRtVmw1arxR3rRPQk0lsdDAaq8giFQlYPayU2KkCEsRKRnghDhIgeS1ZbSeWRSqXWftrKaCMDBAAikQgb60S0sG63q3qp67xUd5aNDRBprBsrkWw2y8Y6ET2o3+8jl8uh2+2q1VabMm1ltLEBIsLhsNonIpUIEdE0vV4P3759Q7fbVTvMnX6q7qI2PkA0TUM4HB652fD6+pqVCBHdI9NW0jBPJBIbWXmIjQ8QYdwn0mq1UCgU2FgnImUwGOD6+lpVHplMZuN6HuMYIAYyneVyudBsNnFzc4PhcGj1sIjIYt1uV52lp2kakskkgsGg1cOyHAPEQKazIpEIAKj7RFiJEG0uuQxKGubpdHqjp62MGCATGBvrsmOdiDZPt9vF5eWlCo9UKsXwMGCATKBpGiKRCKLRKACg2WxyxzrRhhlvmDM87mOAzBAOhxEOh3l2FtGG6Xa7uLq6Qq/Xg9vt5rTVFAyQGeRcG+N0Vi6XY2OdaI11Oh21gEbTNIbHDB6rB+AE4XAYg8EAlUoFjUYDuq4jmUzC7XZbPTQiMpHxeBKPx4NkMolAIGD1sGyLFcicotHoyFHwhULB6iERkYk6nY46zsjtdnOp7hwYIHOSo+AlRBqNBhvrRGui2+2qy6DkbCuGx8MYII8UiUTUPhEu8SVyPmmYd7tddRkUex7zYYA8kvFSKgBqxzorESLn6XQ6amEMd5g/HpvoCwqHwxgOhyiXy6qxnkql4HIxk4mcoNvtqmlor9fLhvkC+G73BDKdxX0iRM4iS3UHgwFcLhcSiQTDYwEMkCcwNtYBoNFocDqLyOZ6vR5yuRx6vZ66hpbTVothgJhgvBLhEl8ie+p2u/j27ZvaYb6pNwmahQFiAk3TEIvF1NlZrESI7Kfb7Y40zNPpNCuPJ2IT3UThcBj9fh/VahWNRkPNrWqaZvXQiDZau91GNpvFcDhU01bseTwdKxATydlZMp1Vq9WQz+d5dhaRheRen+FwqI5kZ3iYgwFiMpnO2tnZAQDU63UUi0WGCJEFJDzkbKtMJsPwMBEDZEni8bg6Cr5Wq7GxTrRi7XZ75GBEVh7mYw9kSWQ6CwAqlQrq9Tp0XUcikeApvkRL1ul0kM/nMRgM4Ha7GR5LwgBZslgsBgDqKHgASKfTVg6JaK11Oh1cXV1B13XuMF8yTmEtmfREjJsN2VgnWg7peei6rq6hZXgsDyuQFZAQ0XUdlUoFtVoNw+EQyWSSZ2cRmUR6HnK2VSqVgt/vt3pYa43vXisUi8VUY73RaKBYLFo9JKK1IJWH9DySySTDYwUYICskjfVwOAwAqNVq3LFO9ETjS3XT6TSnrVaEAWKBaDSK3d1dAHc9kVKpZPGIiJzJeA0tl+quHnsgFtA0DYlEAi6XC+VyGfV6HcDd3hH2RIjm02631YIU7jC3BgPEQtFoFIPBALVaDbVaTU1x8ewsotmMZ1uxYW4dBoiFpBKR3erVahUAGCJEM7RarZGzrdgwtw4DxGISIrquj4RILBbjdBbRGAkPWaqbTqfh8/msHtbG4juUTcTjcezs7EDTNFSrVS7xJRrTarXUqkVpmDM8rMUKxCakFJcAqdfragMiKxHadMaGudvtxt7eHrxer9XD2ngMEJuJx+Mj01m6riOZTFo9LCLLtFotZLNZdbZVKpVieNgEP9rajPREjJsNi8UidF23eGREq9dqtZDP56HrOlwuF9LpNBvmNsIAsSFZzru9vQ3g7iTfQqHAEKGN0mw21Q5zr9eL/f199jxshgFiY4lEAru7u2qZLxvrtCmMq63YMLcvBoiNuVwuJBIJVYnwjnXaBDJtNRwO1TW0nLayJzbRHUA2FlarVbVjPZFIWD0sItPJDnNd1+Hz+ZBMJll52BgDxAFcLtfI6iwJkVgsxh3rtDbGG+actrI/BohDGO9Yr9VqqFQq6o51IqeTTYJythV3mDsDeyAOIpWI9ESq1Spub28tHhXR0zSbTRUebreblYeDsAJxGCntAaBer+P29hbD4ZDTWeRIslRXGubcYe4sDBCHkp5Io9FApVJR/xuRU0jlIQ1z7jB3Hk5hOZTb7UY6ncbOzg6Au+msUqnEzYbkCMaGuZxtxWkr52EF4nDxeBzD4RCNRgPlchnD4ZCNdbK1RqOBXC43Unm43W6rh0ULYAXicHKKr7ESYWOd7KrZbKpjeaSKZuXhXKxA1oCEiFQit7e3GAwGvNmQbKVer6NQKGA4HMLn8yGTycDj4VuQk7ECWSPGY0+kJ0JkB81mUx1PItNWDA/n419wjcgaeuDu057xelxWImSVRqOhriTweDxIp9NcbbUmGCBrKJFIqBN8uWOdrGRsmPv9fiSTSYbHGuEU1hoa37Feq9VQLpe5xJdWqtlsqsqDO8zXEyuQNSWNddlsWCqVVGOdaNnq9bra5+H3+7lJcE2xAlljcux7KBQCcNdYl13rRMtiXKrr8Xg4bbXGGCBrzu12I5PJIBQKQdd1lEol7linpanVaupsK5/Pxx3ma44BsiGSyaQKkUqlgnK5bPWQaM00Go2RfR6ctlp/DJANIbt+t7a2oOs6yuUybm9vWYmQKWSToK7r8Hq9rDw2BJvoG0TTNNVYbzabqgqJRqMWj4ycbFLDnGdbbQZWIBtGVmdJJXJ7e8vGOi1Mpq2k8uC01WZhgGwgmc6S1VnFYpHTWfRo9XpdNcz9fj/29/cZHhuGAbLBpLEOAOVymY11mluj0VDTVjySfXMxQDaYLPFlY50eY3za6tmzZ6w8NhSb6IREIqEa6xIgsVjM6mGRDdVqNRUe0jDnQZ2bixUIqXOKtra2AACVSkWd5EskjKfqer1enqpLDBC643K5kEql1GZDaawTAaM7zP1+P/b29nifBzFA6E9ydlYgEFA9EVYiZOx58DIoMmKA0AiPx4P9/X0Eg0FVifAo+M1VrVZHVlvt7e1x2ooUBghNlEwmVYjc3t6yEtlAtVoNxWJRTVul02ku1aURDBCaSK4elRAplUrqdkNafxIeUnmwYU6TMEBoKpfLNTFEaL1Vq1V1qm4gEGDDnKZigNBMcnYWp7M2g7Hy4MGI9BAGCD3I4/Fgb29Prc4qFouczlpDUnnouo5AIID9/X1WHjQTA4TmlkqlRqazWImsD2PlEQgEkEwmucOcHsQAobl5PB5kMpl7IcJKxNnGp624VJfmxQChR9E0baQSkX0i5EyVSmWkYZ5Op1l50NwYIPRocnaWhAh3rDtTvV5Xh2fKPg/2POgxGCC0EDkK3liJcImvc1QqFeTzeVV5ZDIZrraiR2OA0MLkjnVZnVUqlVCv160eFj2gXq+jVCqphjmX6tKiGCD0JLLE1+fzQdd1FAoFNtZtStf1kaW6crYVp61oUQwQejJN09R01nA4RLFYRK1Ws3pYNKZaraqzrYLBIDKZDBvm9CQMEDKFx+NBKpVSlQins+xD13VUKhXVMOeR7GQWBgiZxu12Y29vT1Ui+XyejXUbKJfLKJVKGA6HCIVC2NvbY8+DTMEAIVO53W4kk0lWIjZRrVbVfS6BQACJRILhQaZhgJDpPB4Pnj17plZnFQoFViIrJgdfyg5zqTw4bUVmYoDQUsiO9UAggOFwiFKpxMb6CtVqNVV5BINBJBIJNszJdAwQWhq5lMrv96vNhpzOWi5pmMs+D1ltxcqDloEBQkslO9alEmFjfbmq1apqmAeDQaRSKVYetDQMEFo6OTtLKhFOZy2HhIdUHtxhTsvGAKGV8Hg82N/fH7mUiiFiDjnQUhrmMm3F8KBlY4DQyhjPzhoOhygUCmg0GlYPy/Gq1araJMjLoGiVGCC0Ul6vF+l0Gl6vVy3xZWN9MZMa5ryGllaJAUIrZ2ysDwYD5PN5TmctYDw8ksmk1UOiDcMAIUt4vV4kk0lViZRKJU5nzUl6HjJtFQwGeRkUWYIBQpbxer3Y29tTlUgul2MlModSqaQqj1AohHQ6DZeLL2VaPT7ryFIej2fk7Cw21merVCrq+uBQKIRkMsnwIMvwmUeWk0pEQoQ9kftkms9YeXCpLlmNAUK24Ha71bEnXOJ7X7lcRqVSUeHBhjnZAQOEbGPSEt9NDxE5VVcORtza2kI6nWblQbbAACFbkTvW/X6/aqxv8j6RcrmswkMqD24SJLtggJDtyPW4Uonk8/mNrESM19BubW2xYU62w2cj2ZLX68Xz589HGuubUokYL4MCoJbqctqK7IYBQraladpIYz2fz6PZbFo9rKWTaSsAbJiTrXHrKtma1+vFs2fPrB7GSkWjUUSjUauHQfQgViBERLQQBggRES2EAUJERAthgBAR0UIYIEREtBAGCBERLYQBQkREC2GAEBHRQhggRES0EAYIEREthAFCREQLYYAQEdFCGCBERLSQjTqN97/+67/UP799+xaHh4cWjmZznZyc4PPnz+rfH/O3OD8/x/v37wEAr169wvfff7+UMS7LxcUF3r17p/7diT+DvI4ODw/x9u3buf+bGcz8+y97rJuAFQhZ7uPHj7a756NYLOL8/Bzn5+emju3Lly8j//7161fTvjfRqjFAyHLFYvHeG6vVTk9P8f79e7x//x6Xl5emfd+zs7ORfy8Wi7i4uDDt+xOt0kZNYZF9ff78GUdHRzg4OLB6KEtzdnaGVqsFAHj+/LkKpq9fvzrq5/7f//1fq4dANsEKhCx1fHys/vnTp08WjmT5Tk9P1T+/efMGwWAQwP2qhMgpWIHMoVgsolgsAsDUZm+z2VSfKOPxOOLx+KMf5/z8XP3zot/DOI7nz58jFAo9+nsI48/91O81zYsXL0b6DV++fMHLly9NfYyLi4uRT/7L+Dke0mw28ccffwC4+9seHBzg6OgIX79+RbFYxNnZGY6OjlY+LjOec3Z5fOPfeRkLZFbxenAaBoiBrO44ODjA69evcX5+jo8fP6onDQAEg0G8fPlSrf64uLjAp0+fRl4IwN0T7M2bNw9OTVxcXODk5ES9uRjF43EcHR3h1atXDz5Zp43j8PAQr1+/xsHBwb2fb5Jms4kvX77gy5cv6sVo/JlevnyJFy9ezBzLY7158wY//vgjgLsVWsfHx09+cTabTXz69Glk2kjM+jk+ffqEi4uLkb/577//rsYjv8vHMlYZEhQSIPLfpwXI6emp+rpZfztRLBbx8ePHqV//1OfcPM+jWcx6zgOzn6/Hx8f4/vvvnxRKVrwenIQBYmB88z09PcVvv/1272tarRY+f/6MVquFo6MjfPjw4d4TCwAuLy/x/v17vH37duobzrTHENJcPj09Xfj7nJ+f4927d/j73/9+L1zGXVxc4Ndffx158xz/mX777Td8/foVP/zwg2mfwOLxOF69eqV+rx8/fsQ//vGPhb/fxcUF3r9/P/HvAsz+OS4uLu79noxN9Gnf8yHGRQJSYR0dHSEYDKLVas2cxvruu+/U3/f8/PzBN9fT01P1MxinCOW/PfU599DzaBaznvPA3d9i1iKHr1+/4uzs7MHvM41VrwcnYYBMIG8iwWAQL168UJ8MjZ8E5UnearVweHiI4+NjJBIJFAoFfP36Fefn52i1Wjg5OZn4ZlgsFkdeSMbvIWP48uULisUiWq0Wfv31V/zyyy/3vs/5+fnI9zk+PsbR0RFCodDIWB7qLzSbzZE33fHxnJ2dqZ/3/Pwcv/76q6lr57///ns1nfPHH3/g/Px8oWmIYrE48+f4v//7P/U4sqfg559/Vv9/eaOZNl0hfYvHjsk4rWj8RCxViITIpCokHo+PNN3Pzs5mfuo1Lg02fj+znnOLMvvxjaE8/rz//Pmz+j7v37/HL7/88qg3eKtfD07BAJmg1WohGAze++Qib2jyAm21Wjg+PsabN29GvubFixf48ccf1ZvhJMaG6vj3kO9zfHyMd+/eqTezi4uLe5+kZKoCAH744YeRNwwZy8ePHx/cb/Dx40f1Yvn73/9+7w3q8PAQr169Up/4zs/PcXp6amr5/ubNGzU98vHjR/z000+P/lRn/DkmbTQ7PDzEy5cv1c9xeXmJk5MT9XUyJWPc7Pi3v/3tSXPqxje68d+XcRrr9PR06jTWixcv1IeAWQFinH4bnwo06zm3qGU8/rTX6YsXL/D+/Xv1Qe7Tp0/3Hm8WO7wenICrsKaYNtdtfIEHg8Gpc8DGqYNJJb/xf5u2mzYUCo18n/Hpk9PTU/Vm8erVq6lvPm/evJn5BnhxcaGC7tWrV1NfBKFQaORFaPbqIXkDARbbG2Kcfjo8PJz5e3379q2qJpa9B2VS/8P47zKOP/74Y+qmRePzYNbXTas+AHOec0+xjMef1Wdc9Llql9eDE7ACmWLWk0ZIybyI169fqxfHok0+4wvyoU8+x8fHU+eujW86D62AOjg4UNMp06qrp3j9+rVqfD92b8hjfo5QKDQyfbTolNlDzs/PR6bCJv2tx5vpk/6WoVAIf/nLX9TvfNrXyZuYNKONzHjOPYXZjz/pZxz/7/I7e8zf2E6vB7tjBTLB8+fP5/q6p7wIDg4OcHh4OPUJLSXxrE/HsoM5GAw+OJbvvvvuwe9zeHg4VyAav9e0BuOiQqHQSFX3mL0hxh3d8yyJNf7ul7Ub3DhtM+3NyDjWWZ9ijYEx6evOzs7U32PSz2/Gc+4pzH78ecLA+Fyd929sp9eD3bECmWCVqykuLi5wdnamqoPHrHCRpuo8n9BnBYzxsY0HTs6jWCya/mn2xYsXqvn/mL0h8nPM+wFAGqIAlnYWl/GN/suXLw/2ov7444+pv1Pjqi2ZxjI+V42PNev39ZTnnBnMevx5nnfG18a8f2O7vR7sjAFikWaziY8fP84se2Vj1apf4HYwvjfk6Oho7hemXZZTyiodMe+ZWmdnZzOrlWnTXRIgh4eHE39XVj/nrH58Mh8DxCLj69dlqebBwYHaqXxwcICTk5OVvZji8fi9fQPz/H+WNRbj3pDff//9SXtDrLBoU/X09HRqgLx8+XJigBg3TE77G1r9nLP68R/LTq8Hu2KAWOD09HTk2JOHVklNI9MZ88y7znpByvcJBoO2uptifG/I2dnZzOriMb8P4G5PiDD7MEPj0SUA8D//8z8PVkay9Pvy8nLqVIi82crvRKaxpNcSDAYn9j/Mes4tahmPP09Pw/g18/6N7fp6sCM20S1g/GT60Atp1jLGSZve5nnMad/n8vJyrnliWS67ik+JxmWSnz59mjm+x/w+gMXeXOZl7HXMezSL8Y1/ViPZWJ2cnZ2NhNW0lYFmPecWtYzHn2dKcJG/sZ1fD3bDALGA8QXy0KewWW/8xjcc42qfccViceZ/n3cVkHyvd+/e4f379/j9999nfq0ZZOOfPPbJycnUr5339yHfS950py2vfQrj4897SKJxumTev/vZ2dnI105bzm3Wc25Ry3h8OU1gmmazObKsed6/sZ1fD3bDALGA8TiMWS+A8YMcxxmf6J8/f574plksFqee1yWOj4/VmGZ9ym82m/jw4YP6d7NPzZ3m1atXanyzPnWOf4KfNcVhfLE/9HM8doWW8eiSaVNKk8j0lHyPaeOX/Q3A3fPH+CY57c3ZrOfcopb1+L///vvUv8+nT59GTiWYl91fD3bCALGA8Q3lw4cPI2/8sgP7xx9/xNevX0deeONP5Hg8PrJn4rfffsN///d/4+TkBCcnJ/jw4QN+/PFHXF5ezlzaGgqF1Fxvq9XCu3fvcHp6qh6v2WyqG/qMZzqt6tiG8R2/00jjHfjzoL2Tk5ORN6SzszO8f/9+pPp46Of49OmT+p3O8+ZmnH567BHtxq+fteRXvk6W9ALTm+fj3/cpz7lFLevx5dBSY6VwcXGBDx8+qN/fY5+rdn892Amb6BZ48eIFvnz5gsvLS7RaLfz2228TTyh9/vw5/va3v6nzoX799VcAozfCyace2XAn5zsZSdPy3bt3U8f08uVLXFxcqKb1tDHJuFZ9cNzR0REODw8fnGf+/vvvUSwW1Q7zz58/qzOtxsXj8akru46OjtT/r1gsqn/+7rvvHpwKmWdKaZrj42MVQKenp1OPyjk6Ohr5hP3QY5n5nFvEMh7/5cuXODs7w+Xlpfq6ccFg8FFnYBm/t51fD3bBCsQib9++VdMQ44LBIF69eoWff/4Zh4eHD26Me/nyJX755RccHx+PvLk9f/4cr169wk8//TRXA/HNmzf44YcfZr5BHh8f4+3bt5bstTDe4vfQ171+/Xrm1x4fH+Onn36a+rMeHBw8atpDGI8umTWlNI1xGmvWMe9yFIuYtvfDyMzn3CLMfnw5SHHa7/jw8BA///zzwgsk7P56sAPtn//8p/zm7vgAABVESURBVO5yufDXv/7V6rFsJLmNTsrj77777t4Lotls4uvXr2g2m+omu8e6uLhQFchf/vKXB/dUnJ+f31vmOu/RDnby1J/DeMNjMBh01N3l06zqObfKx5fd7cBduB4eHpr6t1qX14NZ/vWvf2E4HDJANoXxIp9Jx5wTEc1LAoQ9EAeT61cBPHgj2qxjvomIFsEeiIPJmUGzbhyU84ek+SxHRhARPRUrEAc7Pj7GyckJWq2WOr3W2EyVuWbjSp0ffvjBquES0ZphD8ThLi4u8Ouvvz64PyEYDOIf//jHSs8/IqL1xB7Imjg4OMBPP/2kjrSQO6CBP1cNHR0dzX0eExHRvBggayAUCuHFixcbuROWiKzDJjoRES2EAUJERAthgBAR0UIYIEREtBAGCBERLYQBQkREC2GAEBHRQrgPhBwtm82i2WxC0zSEw2FEo1Fommb1sGZqNpvI5/MYDAZwu93Y39+H1+u1elhEj8YKhByp3+/j+vpahUcsFkMsFrN9eAB3Gz+TySQ0TcNgMMDNzQ263a7VwyJ6NAYIOc5wOEShUFBHtuzu7iIcDls8qscJhUJIpVJwu93odru4ublBr9ezelhEj8IAIUcZDAZq2srlciEejyMWi1k9rIVsbW0hmUzC5XKh1+shm82yEiFHYYCQY/T7feTzebTbbWiahkgkgnA47Ihpq2lCoRASiYQKkXw+j36/b/WwiObCACFH0HUduVxOVR7RaNRx01bTbG9vq+msTqeDb9++sRIhR2CAkO31+33c3NyoyiMajSISiTi68hgnlYg01vP5PEOEbI8BQram6zry+bxabRWJRLC7u2v1sJZia2sL6XQaHo8HnU4H19fXnM4iW2OAkG1Jw7zVakHTNMTjcUfs83iK8UqEq7PIzhggZEuDwQC5XE6FxzpXHuOMS3w7nQ5ubm4wGAysHhbRPQwQsh1pmLdaLbVUNxKJWD2sldra2lKVSLfbxfX1NSsRsh0GCNlKv98fmbaSymOdp62mGQ+RXC7HngjZCgOEbMU4bRWLxdZmqe6idnZ2kEql4HK52Fgn22GAkC3I2VayVDcejzt+k6BZtra2EI/HoWkaer0eG+tkGwwQstx4wzwajW5Mw3xeUolIYz2bzULXdauHRRuOAUKWkqW6Unlw2mo6Y0+k1+vh27dvrETIUgwQsky/30cul0On04GmaUgkEpy2eoAcwGhsrHOJL1mFAUKW0HVdrbaSpbrb29tWD8sR5OwsaaxfXV2xEiFLMEBo5aRh3u12VeWxqUt1FzU+nZXP5xkitHIMEFopaZgbex6sPBazvb2NZDIJt9uNdruNbDbL6SxaKQYIrYyxYe5yuZBMJtkwf6Lt7e2RSoRLfGmVGCC0EnIkuzTMo9EoKw+TyHSWy+VCu91GPp/nEl9aCQYILZ2u6+o+D5fLpVZbkXl2dnbUZsN2u42rqyvuWKelY4DQUvV6PVxfX6vKIx6PY2dnx+phraWdnR3EYjFomoZOp8MlvrR0DBBaGrkMyng8CcNjucLhMJLJpJrOYmOdlokBQkvR7/dxdXWlwkOW6tLybW9vj1QiNzc3nM6ipWCAkOlkqS6nrayzs7Mz0li/ubmxeki0hhggZCpj5SENc1Yeq6dpmgoRqUS+ffvGSoRMxQAh0xj3IbDysIft7W21OouNdTIbA4RMMRgM1D4PqTwYHvawu7vLxjotBQOEnkyW6srZVslkkuFhM+OVCBvrZAYGCD1Jv99HPp8fORhxa2vL6mHRBBIixsY6d6zTUzBAaGFSebTbbbjdbqRSKVYeNqZpGnZ3d0ca67xjnZ6CAUILMR4hLqfqsvJwBuM+kXa7jUKhwEqEFsIAoUcznqrrdrvZ83CgcDiseiLNZpOVCC2EAUKPMr5UN5FI8FRdh9rd3UUkEhmpRLg6ix6DAUJzM14GJUt1OW3lbJFIBLFYDC6XC81mEzc3NxgOh1YPixyCAUJz6fV6uLq6Uvs8OG21HjRNQzgcRiQSAQC0223kcjlOZ9FcGCD0oF6vh1wuN7LDnJXHegmHwyOVSC6Xs3pI5AAMEJqp3+8jm82i0+lwqe4a0zRNTWdJT4SNdXoIA4Sm6na7yGazrDw2yO7uLqLRKDRNQ6vVQj6fZ0+EpmKA0EQybdXtdlXlwdVWm0GmsyRE2FinaRggdE+321VnW0nDnJXH5pDG+niIcDqLxjFAaITsMO/3+2qfRygUsnpYZIFJ01lERgwQUoxLdT0eD9LpNKetNpg01mXHeqvVwtXVFSsRUhggBOBu2kouG5KGOSsPAv7csQ6AZ2fRCAYIodfrqaW6Ho8HqVSKPQ8aEY1G1Sm+smOdx54QA2TDdbtd1SDlfR40y+7uLsLhMACg2Wzy7CxigGyyfr+vlurKaitOW9Es0WhUNdYbjQby+TynszYYA2RD9Xo9fPv2jfs86FE0TUM0GlU9ETn2hJXIZmKAbCCZtpKGOZfq0mNFIhF1FLxUIrR5GCAbZjAYqE2CbrcbmUyGPQ96NLmFMhaLAQAb6xuKAbJBOp0Orq6uVOWRTCYRDAatHhY5WDgcRjgcHqlEeOzJ5mCAbAjjTYIulwvpdJrTVmSKWCymGuvNZpON9Q3CANkAUnn0+3243W6GB5lKdqzLEt9Go8HprA3BAFlzxh3mLpcLqVSK01a0FMYlvlKJ0HpjgKyxbreLq6sr9Ho9dbYVw4OWRZb4GkMkm82yElljDJA11el01D0Omqax8qCVkTvWWYmsPwbIGpJ9HlJ5ZDIZBAIBq4dFG0J6ItFoFABUiHB11vphgKyZTqeDbDarGuZcqktWGG+s12o1hsgaYoCskW63qy6DkrOtGB5kpVgsNrJPpFgsWj0kMpHH6gGQOaRhPhwO4fF4GB5kC3K3jKZpKJfLqNVq0HUd8Xgcbrfb6uHRE7ECWQOdTge5XE41zBkeZDfRaBS7u7sAgHq9jkKhYPGIyAwMEIfrdrvIZrPodrvwer3Y29tjeJDtyKGd0ljnsSfrgQHiYLJUVzYJJhIJrrYiWzNWImysOx97IA7VbrdVeHg8HiQSCVYe5AjxeBwulwuVSgWNRkMt+CDnYQXiQMbwkKW6PNuKnEKOgjdWIjw7y5kYIA7T6XSQz+dVePB4EnIqWeIL3PVE2Fh3HgaIg7TbbVxfX6PX68Hr9SKdTrPnQY4lS3zHr8dlT8Q5GCAO0W631YtLTtVleNA6iEajCIfD0HUd9Xqd94k4CAPEASQ8+v2+OtvK7/dbPSwiU0hPZHzHOkPE/hggNicNcwkPVh60jmQ6a2dnBwBQrVZRKBQYIjbHALGx8YY5w4PWXSwWw87ODjRNQ61WQ6lUsnpINAP3gdiUXEOr6zq8Xi+SySTDg9ae7AmRfSKVSgXD4VDtHSF74V/EhqTnoeu6ugyK4UGbRCoRAKxEbIwViM0YNwl6vV6kUik2zGnjyNlZUolUq1UAUCf7kj2wArERqTyMO8wZHrSppLG+vb0N4K6xztVZ9sIKxCZarZa6DIqrrYj+lEgkoGka6vW6qkQSiYTFoyKAAWILMm0ll0ExPIj+ZDxssVaroVqtqkup2Fi3Fn/7FjPuMOdSXaLpjPtEarUar8e1AVYgFpKzrXRdh8/nQyqVgs/ns3pYRLY0vsS3Xq/D5XIhFouxsW4RViAWabVauLm5ga7r6mwrhgfRw2SJr67rqFQq3LFuIQaIBVqtllpt5fV68ezZM4YH0Zxkia8cBV+r1XB7e2vxqDYTA2TFpPKQmwRTqRS8Xq/VwyJylPGzs8rlMisRCzBAVqjdbqs7oN1uN/b29rjPg+gJYrEYtra2ANztE2ElsloMkBVptVq4vr5Gv9+H1+tFJpNh5UH0RHIrp1QilUqFmw1XiAGyArJJUBrm6XSalQeRieLxOLa2tlRjnWdnrQaX8S5Zs9lUR7LLNbRsmBOZy7jEt1aroVKpQNM0RKNRLvFdIlYgS2RcbSUNc4YH0XJIiEhPpFwuo1QqcTpriViBLIlMW8nxJJlMhuFBtAJyTlaz2USlUgFwN8VF5mMFsgTNZhPZbBb9fh8+n4/TVkQrJI114+osNtaXgwFismazqdajyw5zNsyJVi+RSIw01nl2lvkYICZqNBq4ublBv9+H3+/H/v4+Kw8ii8gHOOMBjLe3t6xETMQAMYmx8pDLoBgeRNaSY0+kErm9veV0lonYRDdBs9lUR7L7/X6k02l4PPzVEtmBpmlIJpMjl1J5PB5EIhGrh+Z4rECeqNlsqsugfD4fkskkw4PIZmQ6Sxrrt7e3XOJrAr7TPYFxh7mcbeV2u60eFhFNIUt8G40GyuWy2mxIi2EFsqBGo4FsNovBYACfz8fwIHIAufUzFAoBuNtsyMb64hggCxhvmHOfB5FzSE/E2FjnKb6L4RTWI9XrdRQKBdXzyGQy7HkQOYzb7UYikYCu62rHutvtVpdU0XxYgTyCHIwo4ZFKpRgeRA5l3LGu6zqKxSKX+D4SA2ROjUZDTVt5PB5OWxGtAdknIj2RarWqzs+ihzFA5tBoNJDL5dQOc14GRbQ+3G43MpnMSE+ES3znwwB5gLHykBUcrDyI1o9UIrquo1wuo1wuWz0k22OAzFCr1dR9HnK2FSsPovUkHxCN94lwOms2BsgUjUZDNdS8Xi9SqRTDg2jNyY51qURKpRIb6zMwQCao1WpqtVUgEGDlQbRBZJ+IhEilUmElMgUDZIz0PORgxGQyyR3mRBtGGuuyOuv29hblcpmVyBgGiIFsEpRpK662Itpsxkrk9vYW1WrV6iHZCgPkP+r1OvL5vGqYZzIZVh5EG04a64FAQIVIpVJhJfIfDBCMLtVlw5yIjFwuF9LpNEKhEIbDIUqlEpf4/sfGB0i9Xh+5DIoNcyIaJ2dnSSVSLpc5nYUND5BGo6Hu85CzrThtRUSTeDwe7O3tqZ5IsVjc+KPgNzZAxqetnj17xsqDiGaSs7OCwaCqRGq1mtXDssxGBsj4DvNMJgNN06weFhE5gMfjQSaTUSEiPZFNrEQ2LkDGd5in02lWHkT0KJqmIZVKIRgMYjgcbuwS340KkEqlMtIw39vb430eRLQQWeJrrEQ2LUQ2JkBqtZo6opmXQRGRGWTHuoRIsVjcqOmsjQiQSqWipq0CgQAb5kRkGjk7y7jZcFMqkbUPEKk8hsMhgsEgkskkG+ZEZCqPx4P9/f2R6axarbb2lchaB0itVlOVh9/v5w5zIloqYyVSKBTWfonv2gZItVpVp+oGAgGebUVES+fxeJBOp+H3+1UlUq/XrR7W0qxlgEyqPBgeRLQK0lgPBAIYDofI5/Nre5/I2gWIVB7SMN/f3+dqKyJaKVnia6xE1nE6a60CxFh5BAIBNsyJyDLSWJeeSLFYXLtKZG0CZHzaam9vjw1zIrKULPGVHevrVomsRYBUKpWRhnk6nWblQUS2IHcMyXRWsVhcmxBxfIDU63V1pLLf70c6nWbPg4hsZbyxXigU1mKzoaMD5Pb2Fvl8nkt1icj2xhvr61CJODZAqtWqqjwCgQCX6hKR7Y031p1eiTguQOQSl1KpBAAIBAI8VZeIHGP87CwnVyKOCxCpPIbDIUKhEFKpFBvmROQoXq8Xe3t7jp/OckyA6LqOSqVyb9qKlQcROZGmaUin0yONdaeFiGMCRKatpPJIp9NwuRwzfCKie+TsLK/XqyqRRqNh9bDm5oh34Gq1qi5pCQQCSCQSbJgT0Vpwu91qOms4HCKXyzmmErF1gMjlLLLDPBQKsWFORGvH4/EglUrB5/Op1VlOqERsHSC1Wk1VHsFgEIlEgg1zIlpL0lg3hojdKxFbBog0zOUO82AwiEwmw8qDiNaa2+1WjfXBYIBCoWDr+0RsGSDVanXkGlou1SWiTSFnZzmhsW67AJHwkMqDO8yJaNN4PB51dtZgMLBtY902ASI7zKVhLtNWDA8i2kRerxfJZNLWlYhtAsTY8+BlUEREdyEiZ2fJ9bh2qkQsDxBZqnt7ewsACAaDvIaWiOg/3G43ksmk2idipyW+lgfI7e2tWqorZ1sREdGfvF4vMpmMms6yy+osywJEeh6VSgW6rmNrawvpdJo9DyKiCeRSKr/fj8FggHw+j2azaemYLAuQUqmkDkYMhULseRARPUCW+Lrdbui6bnmIWBIglUoF1WpVVR7JZJIHIxIRzcHr9eLZs2fw+Xxqia9V01krfdfWdR2lUkmttpJTdTltRUQ0P+PZWbI6y4pKZKUBYux5yLQVERE9ns/nQzqdhsfjsewAxpUEiCzVldVWbJgTET2drM7y+/3o9/vI5XIrDZGVBEi5XB5ZqsuGORGROXw+30hjvVgsrmw6a+kBYryGlg1zIiLzyY51qURubm5W0lhf2ju58TIoAGyYExEtkZydZeyJLLsSWVqAyLQVADbMiYhWwOfzqUupZHXWMnsipgeIzMEZG+Y8VZeIaDVks6Fxn0ir1VrKY5keIMVicWSpbiKRMPshiIhoBp/Ppz6467qOXC63lOks0wJEeh5y1PDOzg57HkREFvF4PNjf31eVyM3NDdrttqmPYUqAyLSVcbVVIpHgUl0iIgvJdJbL5YKu67i5uTF1OsuUALm9vUW1WgUAbG9vc58HEZFN+Hw+PHv2DF6v1/SeyJMCRJaKVSoVAMDW1pZKOyIisgepRDwej5rOMiNEnvROXyqV1Km629vbbJgTEdmU3+/H3t4e3G63WuL71J7IQgEiPY/xaSs2zImI7Mt4s2G/38f19fWTKpGFAsS4VHdnZ4cNcyIih/D7/Uin06qxns/nFw6RRwfIeMM8Ho+z50FE5CA+nw/7+/uqEll0n8jc7/zSML+9vQVwFx5smBMROZOc4iuN9UVWZ8397m+sPLa2thCPxx83WiIishW/349MJgOPx6Ma648JkQcDZDgcjizV5Q5zIqL1ITcb+nw+9Pt9ZLPZuVdnPRggxqW6rDyIiNaP3+8f2bE+byUyNUCk5yHTVru7u7wMiohoTUlj3efzodfrzXV21sQ0mLTPI5FIMDyIiNaYz+dTe/qGwyFyudzMEJmYCBIemqapfR5ERLT+ZMe6x+NRS3w7nc7Erx0JEGmYj+8wZ+VBRLQ5jEt8Zcf6pEpkJBnGp63YMCci2kyBQEDtWJclvuOVyEiAyE7EcDjMTYJERBtO9ol4vV70er17lchIQsRiMSQSCcRisZUPlIiI7CcQCKiCQhrrHo8HAOAB7nof//rXvywdJBER2Zfb7UYoFEK/31eH53rkPw6HQ8sGRkRE9jYcDtFoNOB2u9Hv9wEA/w9ZPyqYyhmyLwAAAABJRU5ErkJggg==";_gliffy.Renderer.ImageCanvas=_gliffy.Renderer.extend({id:"Gliffy.Renderer.ImageCanvas",target:null,init:function(){_gliffy.renderers[this.id]=this},getUrl:function(object){return object.getUrl()},render:function(o){if(!o){throw new Error("shape renderer needs options")}if(!o.target){throw new Error("needs a target canvas context")}if(!o.object){throw new Error("no shape to render")}var context=o.target,object=o.object,renderCallback=o.renderCallback,scale,transform,offsetX,self=this,offsetY,image,url=this.getUrl(object);scale=object.node.stage.zoom;offsetX=(object.style.single_canvas)?0:object.style.offset_x;offsetY=(object.style.single_canvas)?0:object.style.offset_y;if(url===undefined||url===null){url=imageNotAvailable}if(object.node.hasFlag("skin")){if(url===imageNotAvailable){_gliffy.Logger.error("image does not have a valid url.");_gliffy.handleError("com.gliffy.error.file_malformed",[],new Error("image does not have a valid url"))}image=new Image();image.onload=function(){if(url===self.getUrl(object)||url===imageNotAvailable){object.imgWidth=image.width;object.imgHeight=image.height;if(object.node&&object.useOriginalDimensions){object.node.setWidth(object.imgWidth);object.node.setHeight(object.imgHeight);object.node.clampTo(_gliffy.Mouse.editor.getDocumentManager().getActiveStageViewPort());object.node.update();object.useOriginalDimensions=false}context.save();if(object.style.single_canvas){transform=object.node.worldTransform.getValues();if(!o.ignorePan){context.translate(object.node.stage.pan_x,object.node.stage.pan_y)}if(!o.ignoreZoom){context.scale(scale,scale)}context.transform(transform[0],transform[1],transform[2],transform[3],transform[4],transform[5])}else{context.canvas.width=object.style.graphic_width*scale;context.canvas.height=object.style.graphic_height*scale;context.scale(scale,scale);$(context.canvas).css({width:"",height:""})}if(object.isDropShadow()===true){context.save();context.translate(object.style.shadow_x,object.style.shadow_y);context.fillStyle="rgba(0,0,0,0.294117647)";context.fillRect(0,0,object.style.width,object.style.height);context.restore()}context.drawImage(image,offsetX,offsetY,object.style.width,object.style.height);context.restore();object.node.resetFlags();if(renderCallback){renderCallback()}}};image.onerror=function(){_gliffy.Logger.error("image did not load.");_gliffy.handleError("com.gliffy.error.file_malformed",[],new Error("image did not load"));image.src=imageNotAvailable};image.src=url}else{$(context.canvas).css({width:object.style.graphic_width*scale,height:object.style.graphic_height*scale});object.node.resetFlags();if(renderCallback){renderCallback()}}}});_gliffy.Renderer.ImageCanvas.imageNotAvailable=imageNotAvailable}());(function(){_gliffy.Renderer.NodeCanvas=_gliffy.Renderer.extend({id:"Gliffy.Renderer.NodeCanvas",target:null,init:function(){_gliffy.renderers[this.id]=this},render:function(o){var ctx=o.target,object=o.object,callback=o.renderCallback,renderers=o.renderers,singleCanvas=o.singleCanvas,container=o.container,viewbox=o.viewboxDom,loadImage=singleCanvas||o.loadImage,graphic=object.getGraphic(),nodeCallback,ignorePan=o.ignorePan||false,ignoreZoom=o.ignoreZoom||false;_gliffy.Utils.tryCatch(function(){if(!o){throw new Error("shape renderer needs options")}if(!o.target&&!o.container){throw new Error("needs a target")}if(!o.object){throw new Error("no shape to render")}if(!o.renderers){throw new Error("no renderers defined for node")}nodeCallback=function(){if(!object.isProxy()&&object.supportsConnections()&&renderers.controls){_gliffy.renderers[renderers.controls.prototype.id].render({target:object,renderCallback:callback,viewboxDom:viewbox})}else{if(callback){callback()}}};if(graphic&&(singleCanvas||graphic.node.hasRedrawCanvasFlag()||(graphic instanceof _gliffy.Text&&graphic.node.hasFlag()))){graphic.style.single_canvas=singleCanvas;if(graphic instanceof _gliffy.Line){_gliffy.renderers[renderers.line.prototype.id].render({target:ctx,object:graphic,renderCallback:nodeCallback,ignorePan:ignorePan,ignoreZoom:ignoreZoom})}else{if(graphic instanceof _gliffy.Image){if(singleCanvas){object.setFlag("skin")}_gliffy.renderers[renderers.image.prototype.id].render({target:ctx,object:graphic,renderCallback:nodeCallback,loadImage:loadImage,ignorePan:ignorePan,ignoreZoom:ignoreZoom})}else{if(graphic instanceof _gliffy.Svg){_gliffy.renderers[renderers.svg.prototype.id].render({target:ctx,object:graphic,renderCallback:nodeCallback,ignorePan:ignorePan,ignoreZoom:ignoreZoom})}else{if(graphic instanceof _gliffy.Shape){_gliffy.renderers[renderers.shape.prototype.id].render({target:ctx,object:graphic,renderCallback:nodeCallback,ignorePan:ignorePan,ignoreZoom:ignoreZoom})}else{if(graphic instanceof _gliffy.Text){_gliffy.renderers[renderers.text.prototype.id].render({target:ctx,object:graphic,renderCallback:nodeCallback,stage:o.stage,container:o.container,zIndex:o.zIndex,ignorePan:ignorePan,ignoreZoom:ignoreZoom})}else{if(graphic instanceof _gliffy.Proxy){if(singleCanvas){object.setFlag("skin")}_gliffy.renderers[renderers.proxy.prototype.id].render({target:ctx,object:graphic,renderCallback:nodeCallback,loadImage:loadImage,ignorePan:ignorePan,ignoreZoom:ignoreZoom})}else{throw"draw not implemented for "+graphic.getClassName()}}}}}}}else{nodeCallback()}},function(e){if(graphic){_gliffy.Logger.error("Node "+graphic.node.getId()+" failed to render. "+JSON.stringify(graphic.node.toObject()))}else{_gliffy.Logger.error("Node failed to render.")}throw e})}})}());(function(){_gliffy.Renderer.StageSingleCanvas=_gliffy.Renderer.extend({id:"Gliffy.Renderer.StageSingleCanvas",target:null,init:function(){_gliffy.renderers[this.id]=this},render:function(o){if(!o){throw"stage renderer needs options"}if(!o.target){throw"needs a target container"}if(!(o.object&&o.object instanceof _gliffy.Stage)){throw"needs a stage object to render!"}var options=$.extend({},{renderCallback:null,textRenderer:_gliffy.Renderer.TextCanvas,shapeRenderer:_gliffy.Renderer.ShapeCanvas,svgRenderer:_gliffy.Renderer.SvgCanvas,lineRenderer:_gliffy.Renderer.LineCanvas,imageRenderer:_gliffy.Renderer.ImageCanvas,forceUpdate:false,whitespace_x_padding:20,whitespace_y_padding:20,show_progress_bar:false,ignorePan:true,ignoreZoom:true,boundingBoxFit:false},o),i=0,stage=options.object,container=options.target,ctx=o.context,forceUpdate=options.forceUpdate,nodeRenderer,c,width,height,objects,renderers={text:options.textRenderer,shape:options.shapeRenderer,line:options.lineRenderer,image:options.imageRenderer,svg:options.svgRenderer},bb,scale,offsetX=0,offsetY=0,bounds;if(!_gliffy.renderers[options.textRenderer.prototype.id]){_gliffy.renderers[options.textRenderer.prototype.id]=new options.textRenderer()}if(!_gliffy.renderers[options.shapeRenderer.prototype.id]){_gliffy.renderers[options.shapeRenderer.prototype.id]=new options.shapeRenderer()}if(!_gliffy.renderers[options.svgRenderer.prototype.id]){_gliffy.renderers[options.svgRenderer.prototype.id]=new options.svgRenderer()}if(!_gliffy.renderers[options.lineRenderer.prototype.id]){_gliffy.renderers[options.lineRenderer.prototype.id]=new options.lineRenderer()}if(!_gliffy.renderers[options.imageRenderer.prototype.id]){_gliffy.renderers[options.imageRenderer.prototype.id]=new options.imageRenderer()}if(!_gliffy.renderers[_gliffy.Renderer.NodeCanvas.prototype.id]){_gliffy.renderers[_gliffy.Renderer.NodeCanvas.prototype.id]=new _gliffy.Renderer.NodeCanvas()}nodeRenderer=_gliffy.renderers[_gliffy.Renderer.NodeCanvas.prototype.id];if(options.show_progress_bar){GliffyApp.progressBarController.show($.i18n._("EDITOR_EXPORTING_TO_IMAGE"))}if(!ctx){c=$("<canvas/>");stage.update();bb=stage.calculateBoundingBox();scale=stage.zoom;if(options.ignoreZoom){scale=1}bounds=new _gliffy.BoundingBox();bounds.min.x=Math.max(0,bb.min.x-options.whitespace_x_padding)*scale;bounds.min.y=Math.max(0,bb.min.y-options.whitespace_y_padding)*scale;bounds.max.x=Math.min(bb.max.x+options.whitespace_x_padding,stage.maxWidth)*scale;bounds.max.y=Math.min(bb.max.y+options.whitespace_y_padding,stage.maxHeight)*scale;if(options.boundingBoxFit){width=bounds.getDimension().x;height=bounds.getDimension().y;offsetX=-bounds.min.x;offsetY=-bounds.min.y}else{width=bounds.max.x;height=bounds.max.y}c.get(0).width=width;c.get(0).height=height;container.append(c);ctx=_gliffy.Utils.getContext(c.get(0))}ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height);ctx.save();ctx.fillStyle=stage.background;ctx.fillRect(0,0,ctx.canvas.width,ctx.canvas.height);ctx.restore();ctx.translate(offsetX,offsetY);ctx.save();stage.update();objects=stage.flattenNodes(forceUpdate);for(i=0;i<objects.length;i++){_gliffy.workQueue.delay(1).queue(this.__createWorkQueueFunction(nodeRenderer,objects,i,ctx,renderers,container,options))}_gliffy.workQueue.delay(1).queue(function(next){if(options.show_progress_bar){GliffyApp.progressBarController.getBar().animate({width:"100%"})}ctx.restore();if(options.renderCallback){options.renderCallback()}next()})},__createWorkQueueFunction:function(nodeRenderer,objects,i,ctx,renderers,container,options){return function(next){_gliffy.Utils.tryCatch(function(){nodeRenderer.render({object:objects[i],target:ctx,renderCallback:function(){if(options.show_progress_bar){GliffyApp.progressBarController.getBar().queue(function(n){$(this).width(Math.floor(((i+1)/objects.length)*100)+"%");n()})}next()},renderers:renderers,container:container,singleCanvas:true,ignorePan:options.ignorePan,ignoreZoom:options.ignoreZoom})},function(e){_gliffy.workQueue.clearQueue();if(options.renderCallback()){options.renderCallback()}_gliffy.handleError("com.gliffy.error.render_failed",[],e,options.target)})}}})}());(function(){var AUTOFIT_PADDING=25;_gliffy.Renderer.StageMultiCanvas=_gliffy.Renderer.extend({id:"Gliffy.Renderer.StageMultiCanvas",target:null,__bindToScroll:true,__setupScrollEvent:false,init:function(){_gliffy.renderers[this.id]=this},disableScroll:function(){this.__bindToScroll=false},enableScroll:function(){this.__bindToScroll=true},__fixWebkitIframeFlicker:function(){if($.browser.webkit){var chromeFix,transform,canvasStyle;chromeFix=$("#gliffy-webkit-fix");if(chromeFix.length===0){transform=new _gliffy.AffineTransform(1,0,0,1,0,0);canvasStyle=$.extend(_gliffy.Utils.transformCss(transform),{visibility:"hidden",position:"absolute",zIndex:1});chromeFix=$("<canvas />",{id:"gliffy-webkit-fix"}).css(canvasStyle).addClass("gliffy-graphic");$(".gliffy-stage").append(chromeFix);chromeFix.get(0).width=1000;chromeFix.get(0).height=1000;_gliffy.Utils.getContext(chromeFix.get(0)).fillRect(0,0,1000,1000)}}},render:function(o){if(!o){throw new Error("stage renderer needs options")}if(!o.target){throw new Error("needs a target container")}if(!(o.object&&o.object instanceof _gliffy.Stage)){throw new Error("needs a stage object to render!")}var options=$.extend({},{renderCallback:null,useTimer:false,textRenderer:_gliffy.Renderer.TextDom,shapeRenderer:_gliffy.Renderer.ShapeCanvas,lineRenderer:_gliffy.Renderer.LineCanvas,imageRenderer:_gliffy.Renderer.ImageCanvas,svgRenderer:_gliffy.Renderer.SvgCanvas,proxyRenderer:_gliffy.Renderer.ProxyRenderer||false,controlRenderer:_gliffy.Renderer.ControlRenderer||false,cssPan:false,panOnly:false,scrollForPan:_gliffy.Editor!==undefined,forceUpdate:false,queueRender:false,delayEvery:1,resizeTarget:true,pointerEvents:"auto",showGrid:_gliffy.Editor!==undefined,fixedDrawingSpace:_gliffy.Editor!==undefined,useImages:false,renderViewbox:_gliffy.Editor!==undefined,renderGuides:_gliffy.Editor!==undefined,autoFitPadding:false},o),stage=options.object,container=options.target,renderers,stageInfo,canvasInfo,contexts,nodeRenderer,render_complete,flattenedNodes,j,node,object,currentStage,stageMulti=this;renderers=options.renderers={text:options.textRenderer,shape:options.shapeRenderer,line:options.lineRenderer,image:options.imageRenderer,controls:options.controlRenderer,svg:options.svgRenderer,proxy:options.proxyRenderer};if(_gliffy.Editor&&!this.__setupScrollEvent){container.bind("scroll.gliffy_pan",function(){if(stageMulti.__bindToScroll){currentStage=_gliffy.Mouse.editor.getDocumentManager().getActiveStage();currentStage.pan_x=-container.scrollLeft();currentStage.pan_y=-container.scrollTop()}});this.__setupScrollEvent=true}stageInfo=this.__setupStageAndPan(options);this.__fixWebkitIframeFlicker();contexts=container.data("contexts");if(!contexts){contexts={}}this.__deleteNodes(stage,stageInfo.domStage,contexts);if(options.cssPan){$(options.target).css({position:"absolute",left:stage.pan_x+"px",top:stage.pan_y+"px"})}if(!options.panOnly){render_complete=this.__afterRenderComplete(container,stage,stageInfo,contexts,options);if(!_gliffy.renderers[options.textRenderer.prototype.id]){_gliffy.renderers[options.textRenderer.prototype.id]=new options.textRenderer()}if(!_gliffy.renderers[options.shapeRenderer.prototype.id]){_gliffy.renderers[options.shapeRenderer.prototype.id]=new options.shapeRenderer()}if(!_gliffy.renderers[options.svgRenderer.prototype.id]){_gliffy.renderers[options.svgRenderer.prototype.id]=new options.svgRenderer()}if(!_gliffy.renderers[options.lineRenderer.prototype.id]){_gliffy.renderers[options.lineRenderer.prototype.id]=new options.lineRenderer()}if(!_gliffy.renderers[options.imageRenderer.prototype.id]){_gliffy.renderers[options.imageRenderer.prototype.id]=new options.imageRenderer()}if(options.proxyRenderer&&!_gliffy.renderers[options.proxyRenderer.prototype.id]){_gliffy.renderers[options.proxyRenderer.prototype.id]=new options.proxyRenderer()}if(options.controlRenderer&&!_gliffy.renderers[options.controlRenderer.prototype.id]){_gliffy.renderers[options.controlRenderer.prototype.id]=new options.controlRenderer()}if(!_gliffy.renderers[_gliffy.Renderer.NodeCanvas.prototype.id]){_gliffy.renderers[_gliffy.Renderer.NodeCanvas.prototype.id]=new _gliffy.Renderer.NodeCanvas()}nodeRenderer=_gliffy.renderers[_gliffy.Renderer.NodeCanvas.prototype.id];if(!options.forceUpdate){this.__notifyNodes(stage);this.__notifyNodes(stage)}if(options.forceUpdate){stage.setBoundsDirty()}flattenedNodes=this.__flattenNodes(stage,options.forceUpdate);if(flattenedNodes.length===0){render_complete()}else{$(".gliffy-drawing-guide:hidden").remove();for(j=0;j<flattenedNodes.length;j++){node=flattenedNodes[j];object=node.getGraphic();canvasInfo=this.__setupNodeCanvas(node,object,contexts,stage,stageInfo,container,options);container.data("contexts",contexts);if(options.queueRender){if(j%options.delayEvery===0){_gliffy.workQueue.delay(1)}_gliffy.workQueue.queue(this.__createWorkQueueFunction(j,node,canvasInfo,options,flattenedNodes,render_complete,nodeRenderer,container,stageInfo))}else{_gliffy.Utils.tryCatch(function(){if(options.fixedDrawingSpace||canvasInfo.bounds.inViewport){nodeRenderer.render({object:node,target:canvasInfo.ctx,renderCallback:stageMulti.__createSimpleLoopCallback(canvasInfo,options,node),renderers:renderers,singleCanvas:false,container:container,stage:stageInfo.domStage,zIndex:node.getOrder(),viewboxDom:canvasInfo.viewbox,loadImage:!canvasInfo.ctx||options.forceUpdate||options.useImages})}else{stage.removeDirtyNode(node)}if(j===flattenedNodes.length-1){render_complete()}},function(e){render_complete();_gliffy.RenderLoop.stop();_gliffy.handleError("com.gliffy.error.render_failed",[],e,options.target)})}}}}else{if(options.renderCallback){options.renderCallback()}}},__createWorkQueueFunction:function(j,node,canvasInfo,options,flattenedNodes,render_complete,nodeRenderer,container,stageInfo){return function(next){_gliffy.Utils.tryCatch(function(){var callback=function(){node.stage.removeDirtyNode(node);if(options.useImages&&canvasInfo.canvas&&canvasInfo.ctx){canvasInfo.canvas.attr("src",canvasInfo.ctx.canvas.toDataURL())}next();if(j===flattenedNodes.length-1){render_complete()}};if(options.fixedDrawingSpace||canvasInfo.bounds.inViewport){nodeRenderer.render({object:node,target:canvasInfo.ctx,renderCallback:callback,renderers:options.renderers,singleCanvas:false,container:container,stage:stageInfo.domStage,zIndex:node.getOrder(),viewboxDom:canvasInfo.viewbox,loadImage:!canvasInfo.ctx||options.forceUpdate||options.useImages})}else{callback()}},function(e){_gliffy.workQueue.clearQueue();render_complete();_gliffy.RenderLoop.stop();_gliffy.handleError("com.gliffy.error.render_failed",[],e,options.target)})}},__createSimpleLoopCallback:function(canvasInfo,options,node){return function(){delete node.stage.dirty[node.getId()];if(options.useImages&&canvasInfo.canvas&&canvasInfo.ctx){canvasInfo.canvas.attr("src",canvasInfo.ctx.canvas.toDataURL())}}},__setupNodeCanvas:function(node,object,contexts,stage,stageInfo,container,options){var ctx,canvas,viewbox,guides=new Array(6),bounds={inViewport:true},scale,transform,dirtyWidth,dirtyHeight,canvasStyle,i,j,guideData,show,xOrY,viewboxStyles,chromeFix;if((node.isGroup()||(!object&&node.isMultipartShape()))&&options.renderViewbox){viewbox=$("#"+node._domId+"viewbox");if(viewbox.length===0){viewbox=$("<div/>",{id:node._domId+"viewbox"}).addClass("gliffy-viewbox");if(node.isGroup()){viewbox.addClass("gliffy-group")}}viewbox.css($.extend({position:"absolute",zIndex:node.getOrder()+1,width:node.getWidth(),height:node.getHeight()},_gliffy.Utils.transformCss(new _gliffy.AffineTransform(1,0,0,1,0,0).scale(stage.zoom,stage.zoom).concatenate(node.worldTransform))));stageInfo.domStage.append(viewbox)}else{if(!(object instanceof _gliffy.Text)){ctx=contexts[node._domId];canvas=$("#"+node._domId);viewbox=(options.renderViewbox)?$("#"+node._domId+"viewbox"):null;if(options.forceUpdate||!ctx){node.setFlag("bounds");node.setFlag("skin")}if(!ctx){if(options.renderViewbox){viewbox=$("<div/>",{id:node._domId+"viewbox"}).addClass("gliffy-viewbox")}if(options.useImages){canvas=$("<img/>",{id:node._domId}).addClass("gliffy-graphic");ctx=_gliffy.Utils.getContext(document.createElement("canvas"))}else{canvas=$("<canvas/>",{id:node._domId}).addClass("gliffy-graphic");ctx=_gliffy.Utils.getContext(canvas.get(0))}if(options.renderViewbox){stageInfo.domStage.append(viewbox)}stageInfo.domStage.append(canvas);contexts[node._domId]=ctx;container.data(contexts)}$("#"+node._domId).data("node",node);scale=stage.zoom;dirtyWidth=object.style.graphic_width*scale;dirtyHeight=object.style.graphic_height*scale;if(object instanceof _gliffy.Line){transform=new _gliffy.AffineTransform(1,0,0,1,0,0).scale(stage.getZoom(),stage.getZoom()).translate(object.style.pos_x,object.style.pos_y).translate(-object.style.offset_x,-object.style.offset_y).scale(1/scale,1/scale)}else{transform=new _gliffy.AffineTransform(1,0,0,1,0,0).scale(stage.getZoom(),stage.getZoom()).concatenate(object.node.worldTransform).translate(-object.style.offset_x,-object.style.offset_y).scale(1/scale,1/scale)}if(node.hasRedrawCanvasFlag()){if(!(object instanceof _gliffy.Image||(_gliffy.Proxy&&object instanceof _gliffy.Proxy))){ctx.canvas.width=Math.min(dirtyWidth,32767);ctx.canvas.height=Math.min(dirtyHeight,32767)}}bounds=_gliffy.Utils.maxBounds(transform,dirtyWidth,dirtyHeight,stage);node._current_bounds=bounds;object.style.matrix_a=scale;object.style.matrix_b=0;object.style.matrix_c=0;object.style.matrix_d=scale;object.style.matrix_e=0;object.style.matrix_f=0;if(node.hasRepositionCanvasFlag()){canvasStyle=$.extend(_gliffy.Utils.transformCss(transform),{"pointer-events":options.pointerEvents,visibility:"visible",position:"absolute",zIndex:node.getOrder()});canvas.css(canvasStyle).data("transform",transform).data("scale",scale);if(options.renderViewbox){viewboxStyles={position:"absolute",zIndex:node.getOrder()+1,width:0,height:0};viewbox.css($.extend(viewboxStyles,_gliffy.Utils.transformCss(new _gliffy.AffineTransform(1,0,0,1,0,0).scale(stage.zoom,stage.zoom).concatenate(object.node.worldTransform))))}}}}if(node.hasGuideFlag()&&options.renderGuides&&node.isGuideNode()){for(i=0;i<6;i++){guides[i]=$("#"+node._domId+"guide"+i);if(guides[i].length===0){guides[i]=$("<div/>",{id:node._domId+"guide"+i}).addClass("gliffy-drawing-guide "+node._domId+"guide");stageInfo.domStage.append(guides[i])}}for(i=0;i<6;i++){guides[i].css({position:"absolute",width:(i<3)?"1px":"100%",height:(i<3)?"100%":"1px",backgroundColor:(i===1||i===4)?"red":"green",zIndex:10000})}guideData=node.getGuideData();for(j=0;j<2;j++){xOrY=j===0?"x":"y";for(i=0;i<3;i++){show=node.shouldShowGuide(xOrY,i);transform=_gliffy.AffineTransform.getScaleInstance(stage.zoom,stage.zoom).translate(j===0?guideData[xOrY][i]:-stage.pan_x/stage.zoom,j===0?-stage.pan_y/stage.zoom:guideData[xOrY][i]);guides[i+(j===0?0:3)].css({top:transform.getTranslateY()+"px",left:transform.getTranslateX()+"px",display:show||_gliffy.Debug.DISPLAY_GUIDES?"block":"none",opacity:show?"0.3":"0.1"})}}}else{$("."+node._domId+"guide").remove()}return{canvas:canvas,viewbox:viewbox,ctx:ctx,bounds:bounds}},__setupStageAndPan:function(options){var stageWidth,stageHeight,domStage,stageBackground,panTransform,stage=options.object,container=options.target,self=this;if(options.fixedDrawingSpace){stageWidth=stage.maxWidth*stage.zoom;stageHeight=stage.maxHeight*stage.zoom}else{stageWidth=stage.width*stage.zoom;stageHeight=stage.height*stage.zoom}domStage=container.find(".gliffy-stage");if(domStage.length===0){domStage=$('<div class="gliffy-stage"/>');container.append(domStage)}stageBackground=stage.background;domStage.css({backgroundColor:stageBackground,width:stageWidth,height:stageHeight});if(options.scrollForPan){if(stage._pan_dirty){container.scrollTop(-stage.pan_y).scrollLeft(-stage.pan_x);stage._pan_dirty=false}}else{panTransform=new _gliffy.AffineTransform(1,0,0,1,stage.pan_x,stage.pan_y);domStage.css(_gliffy.Utils.transformCss(panTransform,{roundTranslate:true}))}return{domStage:domStage,stageWidth:stageWidth,stageHeight:stageHeight}},__afterRenderComplete:function(container,stage,stageInfo,contexts,options){return function(){var autoFitWidth,autoFitHeight;if(options.fixedDrawingSpace){stageInfo.domStage.css({width:stageInfo.stageWidth,height:stageInfo.stageHeight})}else{if(options.resizeTarget){autoFitWidth=(options.autoFitPadding)?stage.width+AUTOFIT_PADDING:stage.width;autoFitHeight=(options.autoFitPadding)?stage.height+AUTOFIT_PADDING:stage.height;autoFitWidth=Math.min(autoFitWidth,stage.maxWidth);autoFitHeight=Math.min(autoFitHeight,stage.maxHeight);container.css({width:autoFitWidth*stage.getZoom(),height:autoFitHeight*stage.getZoom()});stageInfo.domStage.css({width:autoFitWidth*stage.getZoom(),height:autoFitHeight*stage.getZoom()})}}if(options.renderCallback){options.renderCallback()}}},__flattenNodes:function(stage,forceUpdate){var nodes=[],i,dirtyNodes,node;if(forceUpdate){dirtyNodes=stage.objects}else{dirtyNodes=Object.keys(stage.dirty)}for(i=0;i<dirtyNodes.length;i++){node=dirtyNodes[i];if(!forceUpdate){node=stage.find(dirtyNodes[i]);if(!node){delete stage.dirty[dirtyNodes[i]]}}this.__preorder(node,nodes,forceUpdate)}stage.updateBounds();return nodes},__preorder:function(node,array,forceUpdate){var c;if(!node){return}if(node.shouldBeDrawn()||forceUpdate){if(forceUpdate){node.setFlag("bounds");if(node.getGraphic()){node.getGraphic().markDirty()}node.markDirty()}if(node.isDirty()){node.update()}if(node.getGraphic()||(node.supportsConnections()&&node.isMultipartShape())){array.push(node)}else{node.stage.removeDirtyNode(node)}}else{node.stage.removeDirtyNode(node)}for(c=0;node.children&&c<node.children.length;c++){this.__preorder(node.children[c],array,forceUpdate)}},__preorderNotify:function(node){var c;if(!node){return}if(node.shouldBeDrawn()){if(node.isDirty()){node.update()}node.notify()}for(c=0;node.children&&c<node.children.length;c++){this.__preorderNotify(node.children[c])}},__notifyNodes:function(stage){var i,dirtyNodes,node;dirtyNodes=Object.keys(stage.dirty);for(i=0;i<dirtyNodes.length;i++){node=dirtyNodes[i];node=stage.find(dirtyNodes[i]);this.__preorderNotify(node)}},__deleteNodes:function(stage,domStage,contexts){var removeNodeSel="",i,j;for(i=0;i<stage.deletes.length;i++){removeNodeSel+=stage.deletes[i]+","+stage.deletes[i]+"viewbox,";for(j=0;j<6;j++){removeNodeSel+=stage.deletes[i]+"guide"+j+(j<5?",":"")}removeNodeSel+=(i<stage.deletes.length-1)?",":"";delete contexts[stage.deletes[i].substr(1)]}domStage.find(removeNodeSel).remove();stage.deletes=[]}})}());(function(){var PROXY_IMAGE_URL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIIAAABsCAYAAACmTWoPAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNui8sowAAAAUdEVYdENyZWF0aW9uIFRpbWUAMy8xLzEzaGTUYwAACmpJREFUeJztnU1W2zoYhp/23DnsgBQt4HJXQLoC0mFGDTPPoCto7gpKZ55hRhk2rICwgqYLUGtWcMMKegeSEuPmx/qx5QQ/5+QAcSSL+LVe6dOP33DASCl7wJl+AfQLh883JPsBLPTvs8LPhRBiHrSALeD3798AvIlcjqBIKfvAgNXFPwp8imdgjhLGTAgxC5x/4xyEEKSUx8AIdfE33eF1cw9MgakQYrHrw21jb4WgL/5Avy4iF6fMPZAJIaaxC1KVvROC9vsRcE34Kj80z8ANShR55LJsZW+EoAUwBj7GLYkzd8C4rYJovRAOQABlWimIVgtBSjlmPyzAlmfgRggxjl0QQyuFoLt/GXAStyS18wSM2tD9bJUQdE9gDFxFLkrTfEXZRbRuZ2uEoEUwA/6OXJRYPAGDWFFLI4S3MU5eYsrrFQEoG/wupRzFLERUIeg2QayIYNu4lVJmsU7+V6wTa0YNnCNHjQ+Y1wJ42tSNk1KaMYqefplxi17dBQU+6m7zoOl2Q9Q2gpRyRvgaIUe1OabAY6gvVF+gc9QIZp96hfED6DchhlY0FgMKYYG68HdNdcmklBesxjyOazhFI2JoixAy/CKHOarbeR+rC6Z7PRe6HL3A2dcuhrYIYQTcOiTNUf3vu6AF8kRK+ZHwgqhVDK0QAoCU8jurGUS7WADXbRNAGSnlFUoQoSzjUQjRD5TXC9oUR/jAamrYNqbAu7aLAEAI8RV4hypzCM7r7lpGrxFg6bPfeDmn0JADn/ZpskcRKeUAZX8haodPQoibAPksaY01FNF9+HNWX9pcCHEfsUhB0F3Pb1S3wG28D9kzaqUQDhld633BP4j2DPRCNR7b1EZ4FQghFkKIS1Qj0ocj1FB9ULoaIQIe3eYiH0K0mzpriEwAMTwBZ74W0VlDZIQQGfDJI4sT/G1mSVcjREZKeYtfA/Kdz4TYYDWClPJYzyvocEA3IH1mJwWJK4Swhgx40IGTDjeqRlfXcRHiRvQSgr74ZtlZpvvKHZboqv3SI4uxbxmchaAvelZ4q5b+7WtBdwVdx1HOdVTWGZ8aIePPBSgXnUV4cY27RVz7nNip16Av9rcNh4OGQF8bnvEF6x6Ec69hjSWU6SzCAx1fcO1FONfGLtaQsXtNYmcRfrgGmpztwcoadlhCmc4iPJBSPrB+fsYu/rFZNWVtDRUsoUxnEX649iBGLolsrCHDfpl6ZxGO6LZC7pDU6fuuJIRS4MiWLtDkjkutcOISU9gpBAdLKNNZhDuZY7q+bYIqNUKG/84lnUU4oGMCLl3Jvm2CrULwtIQynUW44TJ5t2+bYKMQAlhCmc4i3HCZjnakZ05XZluNkBF+M6vOIizRMQGXWIxVg3GtEAJbQpnOIuz54ZDGTwg1WEKZziLsmTmk6dl8eF2NkFH//oaVLSJJhjdJMgy6zGvbOZo4nwMuPYeezYdfbJ1TsyWUyaSUVcYiQiwT20XxHG18JoNLG6Fn8+GlEBqwhDLGIrwaj0ky7LPqLmVpOsk3HJun6WRaODZCfVkL1FrLP75s/RlDD8jTdJJtyANgUTweEBdxWm1aWrSGjOa3vPXqRSTJcAw8oAZaRsCvJBkO1hwbAN/0e+aYmUY+5uX2fiYv8/staqbwALgt5HGjjw10HiHWNa6liRHct9C4JZRx6kUkyfAY+Azcp+mkh6ren1hN7z4G7tJ00kvTyRl655E16fo7TvUM9HUeT4U8rnQeZxXyiILN9/o2giWUce1FGF/PANJ0suDlPs6m8TdLkuGC1V1/VjyeppM58LjlPHP9GViNBtrmEQKX/Cu3r94SxxLK+FhEsdos3gEzVLU9R83cKffFQ8Qyjjf8vnf8JYSodAH0IooHy/xr2/uHVQPqGpjp6nrA6oKfAF/TdHKdJMMzVKNuXkg3Aqb62Dl2d9wyjyQZznRef1vmYTvjy4UHKeXWD/z8+RNgWvfOq6HukvMkGf4uvfcetbv5VZIM5/pcJ6wabI/6mLnQz6iqclBK17MtTJpOFkkyvEQ1Fv8rH9cNys9pOnmz7W8hxBsp5RTPnpMnC+CyshCEELNd6lpDiM22r1kvqHmaTmb6jly2FwrdxwFKFMcoL8/1e3maTrKCCHJeds+uN/xe/jtHiRFWG34am8p4GQ3c9vclqrEZy1ouT09PF7aTV8t35U6EEAe54jpJhjkrkfVRtc6lSxyhAYvYxPT09PQDNLA/wgEPMA1QtUBf/+0kAlgud3MZbvZhQWG9pW2N8At7Tw26C9ihom+YXzRnER+EEFPXlU5PDifsOaR5dejooc+KaBum5f2XbIWQO5y0iUGjg6Ahi1gruE4I7eMS9xXRlfJfN3ZhKwSXUbDuUT0W1GwRf1iCoQkhmKhkR0VqsoitArMSgp5n71JtxYyc7SuhLWKtJRhc4gguo2CdECwJbBEbLcHgIoSZQ5oT23n2HUuL+OqZTSVBNSUE8Nzj5xUzxq23ZthqCQZrIegFF7lDgUYOaV49nhaRVd2423WswWU93lHsx97uKzpEb2sRORZb8LgKIXNMN3ZM12FvEZUsweAkBA97OOlqBTcsLeKr7UCfzzC0a2t27HHOV01Fi8hx+I59hOAa+TqRUnY9CHfGbK+NrSzB4CwEHWV03flrfMATVmplh0VYW4LBd4bS2DFdtyLagw0WkeNhu15C0LXCzDF5t2mGH2NeWoSTJRhCzFn81yNt1oWe3ShZhLMlGLyFoAvg2lY4ovlJmweD/u5DPEsyzMO99F39yyOLOyHEKERZOuwI+rg/3VbwGSX7KKUchyhLhxsh1zWM8Rsl+9xFHeMRTAiBJlLcdmKIQ9CVTp4NR8OtlDLzL02HDcHXJeqI4Xf8F7bcAdfdgz/qpdaHhOtt4r8HyOoHMPB55G1b0MEzs8ZjAcxsnrRSF7U/LT7A09ANz6iaIQuQV+NoAdywfpezR2AUU+i1CwGCPAC7yD1KEHmg/GpFx1Zu2L1J2TPQj1U7BI0jbEI/ADtU5PACmO9DvEGXcU61nepaMQBX+yYWuvH4QNg1kE/AuG12oe1wjOVml5rLGP9PI9ZgqEkMoASRATexehf6fxuhpuu7CMBwX3Vjs5A0KgSoVQyGOyqs6AmFbgSaV4jtCevcgW4jjQsBGhEDqMbXFDVPYhaqcakbf339CnXxi7weIcBSDGYP4yZ4Qo2BzPTPXL8/X2cnhZXbPf3q658+1X4VoozARhOCQUr5hW4ZXJEoe0010n3chhDiE/XvDrIvzGJvOBZNCLB87O172vmwjKaYAx9iF6I1m2G+Uqu4Af6NObAWvY2wDt1Q+8Lhb8A1Bz7FtgNoqRAMUsorVITu0BbBLFDBL5+Z30FptRBg2c2s7fE4EchQtUCrGsetF4JBB3I+s7+CyFDtgDxyOdayN0Iw6Briis3b9reJBaoheNdWARj2TghFpJQXrJ7H0CbM/oj3bbOATey1EAy6ljCi6BOnpjDjGnf7cvGLHIQQyui5kuesBofqEMYM1f2bCSFc9pJqFQcphDK6oXmCikscs3rIxjGbYxU5q4Gpmf45B3603e9dMEL4H5gPYf/2gra6AAAAAElFTkSuQmCC",PROXY_IMAGE;PROXY_IMAGE=new Image();PROXY_IMAGE.src=PROXY_IMAGE_URL;_gliffy.Renderer.ProxyRenderer=_gliffy.Renderer.extend({id:"Gliffy.Renderer.ProxyRenderer",target:null,init:function(){_gliffy.renderers[this.id]=this},render:function(o){if(!o){throw new Error("shape renderer needs options")}if(!o.target){throw new Error("needs a target canvas context")}if(!o.object){throw new Error("no shape to render")}var context=o.target,object=o.object,renderCallback=o.renderCallback,scale,transform,offsetX,offsetY;scale=object.node.stage.zoom;offsetX=(object.style.single_canvas)?0:object.style.offset_x;offsetY=(object.style.single_canvas)?0:object.style.offset_y;if(object.node.hasFlag("skin")){if(object.node){object.node.setWidth(PROXY_IMAGE.width);object.node.setHeight(PROXY_IMAGE.height);object.node.update();object.node.resetFlags()}context.save();if(object.style.single_canvas){transform=object.node.worldTransform.getValues();if(!o.ignorePan){context.translate(object.node.stage.pan_x,object.node.stage.pan_y)}if(!o.ignoreZoom){context.scale(scale,scale)}context.transform(transform[0],transform[1],transform[2],transform[3],transform[4],transform[5])}else{context.canvas.width=object.style.graphic_width*scale;context.canvas.height=object.style.graphic_height*scale;context.scale(scale,scale);$(context.canvas).css({width:"",height:""})}context.drawImage(PROXY_IMAGE,offsetX,offsetY,object.style.width,object.style.height);context.restore();if(renderCallback){renderCallback()}}else{$(context.canvas).css({width:object.style.graphic_width*scale,height:object.style.graphic_height*scale});if(object.node){object.node.resetFlags()}if(renderCallback){renderCallback()}}}})}());(function(){_gliffy.Renderer.ControlRenderer=_gliffy.Renderer.extend({id:"Gliffy.Renderer.ControlRenderer",target:null,init:function(){_gliffy.renderers[this.id]=this},render:function(o){if(!o){throw new Error("control renderer needs options")}if(!o.target){throw new Error("needs a target node to render controls for")}var viewboxDom=o.viewboxDom,node=o.target,renderCallback=o.renderCallback,connectionPoints,i,id,connectionId,connectionPoint,connection;viewboxDom.css("z-index",node.getOrder()+1);if(node.supportsConnections()){connectionPoints=viewboxDom.data("connectionPoints")||{};for(i=0;i<node.getConnections().length;i++){id=node._domId;connectionId=this.cpId(i,id);connectionPoint=connectionPoints[connectionId];if(!connectionPoint){connectionPoint=$("<div/>",{id:connectionId}).addClass("gliffy-connection-point gliffy-icon-overlay-plus");viewboxDom.append(connectionPoint)}connectionPoints[connectionId]=connectionPoint;connection=node.getConnections()[i];connectionPoint.data({i:i,id:node.getId()});connectionPoint.css({top:connection.pos.y*node.getHeight()-7+"px",left:connection.pos.x*node.getWidth()-7+"px"})}viewboxDom.data({connectionPoints:connectionPoints})}if(renderCallback){renderCallback()}},cpId:function(idx,nodeId){return"cp"+idx+"-"+nodeId}})})();(function(){_gliffy.FileHandler=_gliffy.Class.extend({init:function(){throw new Error("init for filehandler is not implemented")},handle:function(file){throw new Error("not implemented")},canHandleFile:function(){throw new Error("not implemented")}})}());(function(){_gliffy.FileHandlerRegister=_gliffy.Class.extend({fileHandlers:null,drawManager:null,init:function(drawManager){this.fileHandlers=[];this.drawManager=drawManager;this.DEFAULT_FILE_HANDLER=new _gliffy.DefaultFileHandler(drawManager);this.IMAGE_FILE_HANDLER=new _gliffy.ImageFileHandler(drawManager);this.SVG_FILE_HANDLER=new _gliffy.SvgFileHandler(drawManager);this.register(this.drawManager)},register:function(drawManager){this.add(this.SVG_FILE_HANDLER);this.add(this.IMAGE_FILE_HANDLER);this.add(this.DEFAULT_FILE_HANDLER)},add:function(fileHandler){this.fileHandlers.push(fileHandler)},getFileHandlers:function(){return this.fileHandlers}})}());(function(){_gliffy.DefaultFileHandler=_gliffy.FileHandler.extend({init:function(){},handle:function(file){},canHandleFile:function(file){return true}})}());(function(){_gliffy.ImageFileHandler=_gliffy.FileHandler.extend({init:function(drawManager){this.drawManager=drawManager},handle:function(file,index){var reader=new window.FileReader(),position=_gliffy.Mouse.getPosition(),node,params,self=this,OFFSET=100;if(index&&index>0){position.x+=index%5*OFFSET;position.y+=Math.floor(index/5)*OFFSET}reader.onload=function(event){node=new _gliffy.Node();params={name:file.name,thumbnail:event.target.result,doNotProxyImage:true,image:event.target.result,uid:"com.gliffy.shape.basic.basic_v1.default.image",tid:"com.gliffy.stencil.image",useOriginalDimensions:true};_gliffy.Utils.analyticsEvent("trackEvent",{category:"fileDragAndDrop",action:"image"});self.drawManager.setupShape(node,params,position)};reader.readAsDataURL(file)},canHandleFile:function(file){return file.type==="image/jpeg"||file.type==="image/png"||file.type==="image/gif"}})}());(function(){_gliffy.SvgFileHandler=_gliffy.FileHandler.extend({init:function(drawManager){this.drawManager=drawManager},handle:function(file,index){var reader=new FileReader(),position=_gliffy.Mouse.getPosition(),node,params,dim,self=this,OFFSET=100;if(index&&index>0){position.x+=index%5*OFFSET;position.y+=Math.floor(index/5)*OFFSET}reader.onload=function(event){node=new _gliffy.Node();if(file.type.indexOf("svg")!==-1){params={name:file.name,svg:event.target.result,uid:"com.gliffy.shape.basic.basic_v1.default.svg",tid:"com.gliffy.stencil.custom.svg.static"};_gliffy.Utils.analyticsEvent("trackEvent",{category:"fileDragAndDrop",action:"svg"});self.drawManager.setupShape(node,params,position)}};reader.readAsText(file)},canHandleFile:function(file){return file.type==="image/svg+xml"}})}());(function(){_gliffy.CustomLibraryDrop=_gliffy.Class.extend({init:function(){throw new Error("init for shapeDrop is not implemented")},setupShape:function(node,addCommand){throw new Error("not implemented")},afterDrop:function(node,palletteShape){throw new Error("not implemented")},getUid:function(){throw new Error("not implemented")}})}());(function(){_gliffy.DefaultLibraryDrop=_gliffy.CustomLibraryDrop.extend({init:function(editor){this.editor=editor},setupShape:function(node,addCommand){},afterDrop:function(node,palletteShape){var overlayManager=this.editor.overlayManager,overlay=null;if(node.isLine()){overlay=overlayManager.lineOverlay;overlay.isNewlyCreatedLine=false;GliffyApp.contextualPropertiesController.showControls(this.editor.overlayManager.lineOverlay);overlay.showConnectionPoints(true,true)}else{overlay=overlayManager.overlay;overlay.hideActiveGuides();if(node.isStandAloneText()){overlay.makeTextEditable()}else{if(overlay.getSelectedNode().isEditTextOnInit()&&!node.isMultipartShape()){overlay.initText()}overlayManager.selectNode(node);overlay.showControls();if(!node.isMultipartShape()&&node.children&&node.children.length===1){overlay.getTextControl().removeEmptyText(node.children[0])}GliffyApp.contextualPropertiesController.showControls(overlay);overlay.configControlsDisplay();overlay.hideActiveGuides()}}},getUid:function(){return""}})}());(function(){_gliffy.AnnotationLibraryDrop=_gliffy.DefaultLibraryDrop.extend({init:function(editor){this.editor=editor},setupShape:function(node,addCommand){if(addCommand){this.editor.getDocumentManager().getActiveStage().commandHistory.pushCommandBundle()}},afterDrop:function(node){this.createBPMNAnnotationLine(node);this.editor.getDocumentManager().getActiveStage().commandHistory.popCommandBundle();this._super(node)},getUid:function(){return"com.gliffy.shape.bpmn.bpmn_v1.data_artifacts.annotation"},createBPMNAnnotationLine:function(node){var annoLineNode,ratio,graphic;ratio=node.getConnectionPointRatio(0);graphic=new _gliffy.Line();graphic.setDashStyle("4.0,4.0");graphic.setStrokeWidth(1);graphic.setControlPath([[0,50],[100,0]]);annoLineNode=new _gliffy.Node();annoLineNode.setUid("com.gliffy.shape.basic.basic_v1.default.line");annoLineNode.setGraphic(graphic);annoLineNode.setX(node.getX()-100);annoLineNode.setY(node.getY()+15);annoLineNode.getGraphic().setEndConnection(node,ratio);this.editor.getDocumentManager().addAndExecuteCommand(new _gliffy.AddNodeCommand({node:annoLineNode}))}})}());(function(){_gliffy.ImageLibraryDrop=_gliffy.CustomLibraryDrop.extend({init:function(editor){this.editor=editor},setupShape:function(node,addCommand){},afterDrop:function(node,palletteShape){node.setLockAspectRatio(true);GliffyApp.contextualPropertiesController.showControls(this.editor.overlayManager.overlay);this.editor.overlayManager.overlay.configControlsDisplay();this.editor.overlayManager.overlay.hideActiveGuides()},getUid:function(){return"com.gliffy.shape.basic.basic_v1.default.image"}})}());(function(){_gliffy.CustomLibraryDropRegister=_gliffy.Class.extend({libraryDropHandlers:null,init:function(editor){this.libraryDropHandlers={};this.editor=editor;this.ANNOTATION_LIBRARY_DROP=new _gliffy.AnnotationLibraryDrop(editor);this.IMAGE_LIBRARY_DROP=new _gliffy.ImageLibraryDrop(editor);this.DEFAULT_LIBRARY_DROP=new _gliffy.DefaultLibraryDrop(editor);this.register()},register:function(){this.add(this.ANNOTATION_LIBRARY_DROP);this.add(this.IMAGE_LIBRARY_DROP)},add:function(libraryDrop){this.libraryDropHandlers[libraryDrop.getUid()]=libraryDrop},getCustomHandler:function(node){return this.libraryDropHandlers[node.getUid()]||this.DEFAULT_LIBRARY_DROP}})}());(function(){_gliffy._Mouse=_gliffy.Class.extend({super_ui_blocker:$("<div class='gliffy-super-ui-blocker'></div>"),_states:null,_state:null,_clickMode:null,_dragging:false,_did_drag:false,_begin_initial_drag:false,_clickModeMap:null,__mousePos:null,__lastMouseUp:null,__mouseDelta:null,__staticOffset:null,__offset:null,__mouseDown:false,__mouseVelocity:0,__mouseTravel:0,__contextMenuMouseDownPosition:null,editor:null,documentManager:null,__touchHandler:function(event){var touches=event.changedTouches,first=touches[0],type="";switch(event.type){case"touchstart":type="mousedown";break;case"touchmove":type="mousemove";break;case"touchend":type="mouseup";break;default:return}var simulatedEvent=document.createEvent("MouseEvent");simulatedEvent.initMouseEvent(type,true,true,window,1,first.screenX,first.screenY,first.clientX,first.clientY,false,false,false,false,0,null);first.target.dispatchEvent(simulatedEvent);event.preventDefault()},init:function(o){var self=this,blocker;this.editor=o.editor;this.documentManager=this.editor.getDocumentManager();this.__mousePos={x:0,y:0};this.__lastMouseUp={x:-1,y:-1};this.__mouseDelta={x:0,y:0};this._states={};this._state={};this._clickModeMap={};document.addEventListener("touchstart",this.__touchHandler,true);document.addEventListener("touchmove",this.__touchHandler,true);document.addEventListener("touchend",this.__touchHandler,true);document.addEventListener("touchcancel",this.__touchHandler,true);$(function(){$(document).mousemove(function(event){self.updatePosition(event);self.__mousemove(event)}).mouseup(function(event){self.updatePosition(event);self.__mouseDown=false;if(self.getClickMode()==="stage"){self.__lastMouseUp=self.getPosition()}else{self.__lastMouseUp={x:-1,y:-1}}self.__mouseup(event)}).mousedown(function(event){self.__mouseDown=true}).bind("mousewheel",function(ev,delta,deltaX,deltaY){if(ev.metaKey||ev.ctrlKey||ev.altKey){$("#gliffy-edit-text").trigger("customblur.gliffy-edit-text");self.editor.overlayManager.deselectAll();if(deltaY<0){self.editor.zoomOverlay.keyboardZoom(false)}else{if(deltaY>0){self.editor.zoomOverlay.keyboardZoom(true)}}ev.stopImmediatePropagation();ev.preventDefault();return false}return true});self.mouseVelocityUpdate();$("body").on("click",".ember-view",function(event){$("body").click()});if(_gliffy.BrowserDetect.OS==="Mac"&&$.browser.webkit){$("body").on("mousedown",function(event){if(_gliffy.KeyManager.macCtrlKeyDown){event.stopImmediatePropagation();return false}})}});blocker=$(".gliffy-super-ui-blocker");if(blocker.length===0){this.super_ui_blocker.appendTo("body").hide()}else{this.super_ui_blocker=blocker}this.__autoPanUpdate=function(position){self.setPosition(position);self.__autoPanDrag()}},mouseVelocityUpdate:function(){var currentTime=new Date().getTime(),self=this;if(this.lastVelocityTime&&currentTime!==this.lastVelocityTime){this.__mouseVelocity=Math.round(this.__mouseTravel/(currentTime-this.lastVelocityTime)*1000);this.__mouseTravel=0}this.lastVelocityTime=currentTime;setTimeout(function(){self.mouseVelocityUpdate()},250)},registerClickState:function(o){this._clickModeMap[o.name]=o.modes;$("body").on("mousedown",o.target,function(event){event.preventDefault();if(event.which===1){o.mouseDown(event)}})},__mousedown:function(event){var self=this;self._dragging=true;self._did_drag=false;self.disableUI();_gliffy.Utils.tryCatch(function(){self.__dragStart(event)},function(e){_gliffy.Logger.error("Error in Mouse Drag Start. clickmode:"+self.getClickMode()+" state:"+self.getState()+" error:"+e.message);_gliffy.handleError("com.gliffy.error.mouse_drag_failed",[],e)})},__mousemove:function(event){var self=this;if(self._dragging){self._did_drag=true;_gliffy.Utils.tryCatch(function(){self.__drag(event)},function(e){_gliffy.Logger.error("Error in Mouse Drag. clickmode: "+self.getClickMode()+" state: "+self.getState()+" error:"+e.message);_gliffy.handleError("com.gliffy.error.mouse_drag_failed",[],e)})}},__mouseup:function(event){var self=this;if(self._dragging){self._dragging=false;_gliffy.Utils.tryCatch(function(){self.__dragEnd(event)},function(e){_gliffy.Logger.error("Error in Mouse Drag End. clickmode: "+self.getClickMode()+" state: "+self.getState()+" error:"+e.message);_gliffy.handleError("com.gliffy.error.mouse_drag_failed",[],e)});$("body").click()}self.enableUI()},registerDragState:function(states){var state,i,j,autoPan;for(i=0;i<states.length;i++){state=states[i];for(j=0;j<state.modes.length;j++){if(state.autoPan){if(!(state.autoPan instanceof (_gliffy.AutoPan))){if(state.autoPan===true){autoPan={editor:this.editor,callback:this.__autoPanUpdate}}else{autoPan=$.extend(true,{editor:this.editor,callback:this.__autoPanUpdate},state.autoPan)}state.autoPan=new _gliffy.AutoPan(autoPan)}}this._states[state.modes[j]]=state}}},__dragStart:function(event){var state;this._begin_initial_drag=false;if(this.getState()&&this._states[this.getState()]){state=this._states[this.getState()];if(state.autoPan){state.autoPan.start(event)}state.dragStart(event)}},__drag:function(event){var state;if(this.getState()&&this._states[this.getState()]){state=this._states[this.getState()];if(state.autoPan){state.autoPan.update(event)}state.drag(event)}},__autoPanDrag:function(){var state;if(this.getState()&&this._states[this.getState()]){state=this._states[this.getState()];state.drag()}},__dragEnd:function(event){var state;if(this.getState()&&this._states[this.getState()]){state=this._states[this.getState()];if(state.autoPan){state.autoPan.stop()}state.dragEnd(event,this._did_drag,this._begin_initial_drag)}},isDragging:function(){return this._dragging},lockDragUI:function(cursorStyle){this.disableUI();_gliffy.CursorManager.setCursor(cursorStyle||null,this.super_ui_blocker)},setCursor:function(cursorStyle){_gliffy.CursorManager.setCursor(cursorStyle||null,this.super_ui_blocker)},disableUI:function(){GliffyApp.contextMenuController.clearAll();this.super_ui_blocker.show()},enableUI:function(){if(this.super_ui_blocker.is(":visible")){this.super_ui_blocker.hide();_gliffy.CursorManager.clearCursor(this.super_ui_blocker)}},setState:function(state){var keys,i;if($.inArray(state,this._clickModeMap[this.getClickMode()])!==-1){this._state[this.getClickMode()]=state}else{keys=Object.keys(this._clickModeMap);for(i=0;i<keys.length;i++){if($.inArray(state,this._clickModeMap[keys[i]])!==-1){this._state[keys[i]]=state}}}},getState:function(){return this._state[this.getClickMode()]},getClickMode:function(){return this._clickMode},setClickMode:function(name){this._clickMode=name},beginInitialDrag:function(clickMode,state){this.setClickMode(clickMode);this.setState(state);var s=this._states[this.getState()];if(s.autoPan){s.autoPan.start()}this._dragging=true;this._did_drag=false;this._begin_initial_drag=true},setPosition:function(position){this.__mouseDelta={x:position.x-this.__mousePos.x,y:position.y-this.__mousePos.y};this.__mousePos={x:position.x,y:position.y}},updatePosition:function(event){var x,y,self=this,zoom;if(self.documentManager){zoom=self.documentManager.getZoom();self.updateOffset();x=(event.pageX-self.__offset.left)/zoom;y=(event.pageY-self.__offset.top)/zoom;self.__mouseDelta={x:x-self.__mousePos.x,y:y-self.__mousePos.y};self.__mousePos={x:x,y:y};if(!self.__mouseTravel){self.__mouseTravel=0}self.__mouseTravel+=Math.sqrt(self.__mouseDelta.x*self.__mouseDelta.x+self.__mouseDelta.y*self.__mouseDelta.y)*zoom}},getVelocity:function(){return this.__mouseVelocity},updateOffset:function(){var offset;offset={left:0,top:0};this.__staticOffset={left:this.editor.containerBounds.min.x,top:this.editor.containerBounds.min.y};offset.left=this.__staticOffset.left+this.documentManager.getActiveStage().pan_x;offset.top=this.__staticOffset.top+this.documentManager.getActiveStage().pan_y;this.__offset=offset},reset:function(){this.__mousePos.x=0;this.__mousePos.x=0;this.__mouseDelta.x=0;this.__mouseDelta.y=0},resetMouseUpPosition:function(){this.__lastMouseUp={x:-1,y:-1}},lastMouseUpPosition:function(){return $.extend({},this.__lastMouseUp)},setLastMouseUpPosition:function(pos){this.__lastMouseUp=pos},getPosition:function(){return $.extend({},this.__mousePos)},getDelta:function(){return $.extend({},this.__mouseDelta)},getContainerOffset:function(){return $.extend({},this.__staticOffset)},getStageOffset:function(){return $.extend({},this.__offset)},getLocalDelta:function(node){return _gliffy.Utils.getLocalOffset(_gliffy.Vec2.difference(this.getPosition(),this.getDelta()),this.getPosition(),node)},isUp:function(){return this.__mouseDown},isDown:function(){return this.__mouseDown},getContextMenuMouseDownPosition:function(){return this.__contextMenuMouseDownPosition},setContextMenuMouseDownPosition:function(pos){this.__contextMenuMouseDownPosition=pos}})}());(function(){var DEFAULTS={threshold:5,distance:50,multiplier:[0,100,100,100,200,200,400,800,1600],intervalTime:1000/20,callback:null,renderCallback:null,minMoveDistance:20};_gliffy.AutoPan=_gliffy.Class.extend({threshold:null,distance:null,multiplier:null,intervalTime:null,minMoveDistance:null,__documentManager:null,__autoPanCallback:null,__renderCallback:null,__autoPanId:null,__autoPanOffset:null,__position:null,__enabled:true,__moveThreshold:null,__startTime:0,__offsetX:0,__offsetY:0,__previousGuides:null,init:function(o){var options=$.extend({},DEFAULTS,o),self=this;if(!options.editor){throw new Error("Invalid options: a editor is required.")}this.__editor=options.editor;this.__autoPanCallback=options.callback;this.__renderCallback=options.renderCallback;this.threshold=options.threshold;this.distance=options.distance;this.multiplier=options.multiplier;this.__intervalCallback=function(){self.__pan()};this.__moveThreshold=new _gliffy.MoveThreshold(this.minMoveDistance)},__pan:function(){if(this.__isEnabled()){var stage,deltaTime,offsetX,offsetY,originalX,originalY,currentTime,dimension=this.__editor.getDocumentManager().getActiveStageViewPort().getDimension(),zoom=this.__editor.getDocumentManager().getActiveStage().getZoom();stage=this.__editor.getDocumentManager().getActiveStage();originalX=stage.pan_x;originalY=stage.pan_y;currentTime=this.__getCurrentTime();deltaTime=currentTime-this.__startTime;this.__startTime=currentTime;this.__offsetX+=this.__autoPanOffset.x*deltaTime;this.__offsetY+=this.__autoPanOffset.y*deltaTime;offsetX=this.__offsetX>0?Math.floor(this.__offsetX):Math.ceil(this.__offsetX);offsetY=this.__offsetY>0?Math.floor(this.__offsetY):Math.ceil(this.__offsetY);this.__offsetX-=offsetX;this.__offsetY-=offsetY;stage.offsetPan(offsetX,offsetY,dimension.x,dimension.y);offsetX=originalX-stage.pan_x;offsetY=originalY-stage.pan_y;if(Math.abs(offsetX)>0||Math.abs(offsetY)>0){this.__position.x+=offsetX/zoom;this.__position.y+=offsetY/zoom;if(this.__autoPanCallback){this.__autoPanCallback(this.__position)}this.__editor.getDocumentManager().redraw(this.__renderCallback)}}},__isEnabled:function(){return this.__enabled},__getCurrentTime:function(){return(new Date()).getTime()/1000},start:function(event,position){position=position||_gliffy.Mouse.getPosition();if(this.__getStageViewPort().pointInside(position.x,position.y)){this.__moveThreshold.setAbove(true)}else{if(event){this.__moveThreshold.reset(event)}}this.__previousGuides=GliffyApp.documentModel.drawingGuides},enable:function(){this.__enabled=true},disable:function(){this.__enabled=false},__getStageViewPort:function(){var zoom=this.__editor.getDocumentManager().getActiveStage().getZoom();return this.__editor.getDocumentManager().getActiveStageViewPort().clone().extend(-this.distance/zoom)},update:function(event,position){if(this.__moveThreshold.above(event)){var stageViewPort=this.__getStageViewPort(),offset,x,y,xMag,yMag,zoom=this.__editor.getDocumentManager().getActiveStage().getZoom();position=position||_gliffy.Mouse.getPosition();this.__position=new _gliffy.Vec2(position.x,position.y);if(!stageViewPort.pointInside(this.__position.x,this.__position.y)){offset=stageViewPort.pointDistance(this.__position.x,this.__position.y);x=offset.x*zoom/this.threshold;y=offset.y*zoom/this.threshold;xMag=x>0?-1:1;yMag=y>0?-1:1;x=Math.ceil(Math.abs(x));y=Math.ceil(Math.abs(y));offset.x=xMag*(x<this.multiplier.length?this.multiplier[x]:this.multiplier[this.multiplier.length-1]);offset.y=yMag*(y<this.multiplier.length?this.multiplier[y]:this.multiplier[this.multiplier.length-1]);this.__autoPanOffset=offset;if(this.__autoPanId===null){this.__editor.getDocumentManager().renderer.disableScroll();_gliffy.Utils.setSnapToGrid(false);this.__editor.overlayManager.overlay.hideActiveGuides();GliffyApp.documentModel.set("drawingGuides",false);this.__startTime=this.__getCurrentTime();this.__autoPanId=setInterval(this.__intervalCallback,this.intervalTime)}}else{this.stop()}}},stop:function(){if(this.__autoPanId!==null){clearInterval(this.__autoPanId);this.__autoPanId=null;this.__autoPanOffset=null;this.__offsetX=0;this.__offsetY=0;this.__startTime=0;this.__editor.getDocumentManager().renderer.enableScroll();GliffyApp.documentModel.set("drawingGuides",this.__previousGuides);this.__editor.overlayManager.overlay.cacheGuideNodes()}_gliffy.Utils.setSnapToGrid(true)}})}());(function(){var GLIFFY_KEY_NAMESPACE=".gliffyKey";_gliffy._KeyManager=_gliffy.Class.extend({__container:null,__editor:null,__enabled:true,__bindings:null,__onEnterState:null,__onExitState:null,__keyMap:null,__state:null,__lastState:null,__metaCtrlKeyCode:17,shiftKeyDown:false,metaCtrlKeyDown:false,macCtrlKeyDown:false,__registerEvents:function(){var self=this,panDownPrevMode=null;$(document).keydown(function(e){if(!$("#gliffy-edit-text_ifr").is(":visible")){if(e.which===16){self.shiftKeyDown=true}if(e.which===self.__metaCtrlKeyCode){$(".gliffy-stage").addClass("gliffy-control-key-down");self.metaCtrlKeyDown=true}if(_gliffy.BrowserDetect.OS==="Mac"&&e.which===17){self.macCtrlKeyDown=true}}});$(document).keyup(function(e){if(e.which===16){self.shiftKeyDown=false}if(e.which===self.__metaCtrlKeyCode){$(".gliffy-stage").removeClass("gliffy-control-key-down");self.metaCtrlKeyDown=false}if(_gliffy.BrowserDetect.OS==="Mac"&&e.which===17){self.macCtrlKeyDown=false}});$(document).on("focus","input",function(event){self.setState("input")});$(document).on("blur","input",function(event){if(self.getState()==="input"){self.setLastState()}});$(window).on("blur",function(e){if($(document.activeElement).is("body")){self.resetModifierKeys()}});$(window).on("focus",function(){self.resetModifierKeys()})},init:function(o){var self=this,panDownPrevMode=null;this.__container=o.container;this.__editor=o.editor;this.__bindings={};this.__onEnterState={};this.__onExitState={};this.__keyMap={};this.__fixEmberPropogation();if(_gliffy.BrowserDetect.OS==="Mac"){this.__metaCtrlKeyCode=91;if(_gliffy.BrowserDetect.browser==="Firefox"){this.__metaCtrlKeyCode=224}}setTimeout(function(){self.__registerEvents()},1);this.registerState("default",null,[{action:"blur",keydown:function(e){e.stopImmediatePropagation();self.handleEscKeypress()}},{action:"selectAll",keydown:function(e){e.stopImmediatePropagation();e.preventDefault();self.handleEscKeypress();_gliffy.toolbarController.doSelectAll()}},{action:"toggleFrameRate",keydown:function(e){e.stopImmediatePropagation();e.preventDefault();_gliffy.RenderLoop.toggleFrameRate()}},{action:"toggleVersionInfo",keydown:function(e){e.stopImmediatePropagation();e.preventDefault();_gliffy.toolbarController.toggleVersionInfo()}},{action:"undo",keydown:function(e){e.stopImmediatePropagation();e.preventDefault();_gliffy.toolbarController.doUndo()}},{action:"redo",keydown:function(e){e.stopImmediatePropagation();e.preventDefault();_gliffy.toolbarController.doRedo()}},{action:"textMode",keydown:function(e){e.stopImmediatePropagation();e.preventDefault();$("#gliffy-toolbar-button-textTool").click()}},{action:"ellipseMode",keydown:function(e){e.stopImmediatePropagation();e.preventDefault();$("#gliffy-toolbar-button-ellipseTool").click()}},{action:"rectMode",keydown:function(e){e.stopImmediatePropagation();e.preventDefault();$("#gliffy-toolbar-button-rectangleTool").click()}},{action:"connectMode",keydown:function(e){e.stopImmediatePropagation();e.preventDefault();$("#gliffy-toolbar-button-connectorTool").click()}},{action:"lineMode",keydown:function(e){e.stopImmediatePropagation();e.preventDefault();$("#gliffy-toolbar-button-lineTool").click()}},{action:"dumpFile",keydown:function(e){e.stopImmediatePropagation();e.preventDefault();self.__editor.viewActiveDocumentSource()}},{action:"doNothing",keydown:function(e){e.stopImmediatePropagation();e.preventDefault()}},{action:"save",keydown:function(e){e.stopImmediatePropagation();e.preventDefault();_gliffy.toolbarController.doSave();return false}},{action:"delete",keydown:function(e){e.preventDefault()}},{action:"zoomIn",keydown:function(e){if((_gliffy.BrowserDetect.browser==="Explorer"&&e.ctrlKey)||(_gliffy.BrowserDetect.browser!=="Explorer"&&e.altKey)){if(_gliffy.BrowserDetect.browser==="Explorer"){_gliffy.Dialog.showAlertDialog({content:$.i18n._("DIALOG_IE9_ZOOM_ERROR_DESCRIPTION"),title:$.i18n._("DIALOG_IE9_ZOOM_ERROR")})}return true}self.__editor.overlayManager.deselectAll();self.__editor.zoomOverlay.keyboardZoom(true);e.stopImmediatePropagation();e.preventDefault();return false}},{action:"zoomOut",keydown:function(e){if((_gliffy.BrowserDetect.browser==="Explorer"&&e.ctrlKey)||(_gliffy.BrowserDetect.browser!=="Explorer"&&e.altKey)){if(_gliffy.BrowserDetect.browser==="Explorer"){_gliffy.Dialog.showAlertDialog({content:$.i18n._("DIALOG_IE9_ZOOM_ERROR_DESCRIPTION"),title:$.i18n._("DIALOG_IE9_ZOOM_ERROR")})}return true}self.__editor.overlayManager.deselectAll();self.__editor.zoomOverlay.keyboardZoom(false);e.stopImmediatePropagation();e.preventDefault();return false}},{action:"pan",keydown:function(e){if(!_gliffy.Mouse.isDown()&&panDownPrevMode===null){panDownPrevMode=self.__editor.getDrawMode();_gliffy.toolbarController.updateDrawMode(_gliffy.Editor.DRAW_MODE.pan)}e.stopImmediatePropagation();e.preventDefault();return false},keyup:function(e){if(panDownPrevMode!==null){_gliffy.toolbarController.updateDrawMode(panDownPrevMode);panDownPrevMode=null}e.stopImmediatePropagation();e.preventDefault();return false}}]);this.registerState("stage","default",[{action:"nudgeStageLeft",keydown:function(e){return self.__moveStage(e,10,0)}},{action:"nudgeStageRight",keydown:function(e){return self.__moveStage(e,-10,0)}},{action:"nudgeStageUp",keydown:function(e){return self.__moveStage(e,0,10)}},{action:"nudgeStageDown",keydown:function(e){return self.__moveStage(e,0,-10)}},{action:"jumpStageLeft",keydown:function(e){return self.__moveStage(e,10000,0)}},{action:"jumpStageRight",keydown:function(e){return self.__moveStage(e,-10000,0)}},{action:"jumpStageUp",keydown:function(e){return self.__moveStage(e,0,10000)}},{action:"jumpStageDown",keydown:function(e){return self.__moveStage(e,0,-10000)}},{action:"paste",keydown:function(e){e.stopImmediatePropagation();e.preventDefault();_gliffy.toolbarController.doPaste()}}]);this.registerState("input",null,[]);this.setState("stage")},resetModifierKeys:function(){this.metaCtrlKeyDown=false;this.shiftKeyDown=false;this.macCtrlKeyDown=false},__moveStage:function(e,x,y){var dimension=this.__editor.getDocumentManager().getActiveStageViewPort().getDimension();e.stopImmediatePropagation();e.preventDefault();this.__editor.getDocumentManager().getActiveStage().offsetPan(x,y,dimension.x,dimension.y);this.__editor.getDocumentManager().redraw();return false},__fixEmberPropogation:function(){var lastEmberKeydownEvent,lastEmberKeyupEvent,lastEmberKeypressEvent,lastEmberFocus,lastEmberBlur,self=this,$document=$(document);$("body").on({keydown:function(e){if(lastEmberKeydownEvent!==e.originalEvent){$document.trigger(self.__copyKeyEvent(e))}lastEmberKeydownEvent=e.originalEvent},keypress:function(e){if(lastEmberKeypressEvent!==e.originalEvent){$document.trigger(self.__copyKeyEvent(e))}lastEmberKeypressEvent=e.originalEvent},keyup:function(e){if(lastEmberKeyupEvent!==e.originalEvent){$document.trigger(self.__copyKeyEvent(e))}lastEmberKeyupEvent=e.originalEvent},focus:function(e){var event=$.Event(e.type);if(lastEmberFocus!==e.originalEvent){event.originalEvent=e.originalEvent;$document.trigger(e)}lastEmberFocus=e.originalEvent},blur:function(e){var event=$.Event(e.type);if(lastEmberBlur!==e.originalEvent){event.originalEvent=e.originalEvent;$document.trigger(e)}lastEmberBlur=e.originalEvent}},".ember-view")},__copyKeyEvent:function(e){var propsToCopy=["altKey","which","charCode","ctrlKey","keyCode","metaKey","shiftKey","originalEvent"],event,i;event=$.Event(e.type);for(i=0;i<propsToCopy.length;i++){event[propsToCopy[i]]=e[propsToCopy[i]]}return event},addKeyBindings:function(keyBindings){this.__keyMap=$.extend(this.__keyMap,keyBindings);this.__bindState(null,this.__state);this.__bindState(this.__state,null)},isControlKey:function(ev){return ev.charCode===0||ev.metaKey||ev.ctrlKey||ev.altKey},registerState:function(state,baseState,bindings,onEnterState,onExitState){if(baseState){baseState=this.__bindings[baseState];if(baseState){bindings=baseState.concat(bindings)}}if(bindings!==undefined){this.__bindings[state]=bindings}if(onEnterState!==undefined){this.__onEnterState[state]=onEnterState}if(onExitState!==undefined){this.__onExitState[state]=onExitState}},__getKeyNameSpace:function(state){return GLIFFY_KEY_NAMESPACE+state},wrapAction:function(handler,state,binding){var self=this;return function(e){if(!(_gliffy.Mouse.isDragging()||self.__editor.overlayManager.overlay.isDragging||self.__editor.overlayManager.lineOverlay.isDragging)){_gliffy.Utils.analyticsEvent("trackEvent",{category:"keyboard."+state,action:binding.action});handler(e)}else{e.preventDefault()}}},__bindState:function(state,previousState){var $document=$(document),bindings,i,binding,id,keys=null;if(state===previousState){return}if(previousState!==null){$document.unbind(this.__getKeyNameSpace(previousState))}if(state!==null){bindings=this.__bindings[state];if(bindings){id=this.__getKeyNameSpace(state);for(i=0;i<bindings.length;i++){binding=bindings[i];if(binding.action){keys=this.__keyMap[binding.action];if(keys){if(binding.keydown){$document.bind("keydown"+id,keys,this.wrapAction(binding.keydown,state,binding))}if(binding.keypress){$document.bind("keypress"+id,keys,this.wrapAction(binding.keypress,state,binding))}if(binding.keyup){$document.bind("keyup"+id,keys,this.wrapAction(binding.keyup,state,binding))}}}else{if(binding.keydown){$document.bind("keydown"+id,this.wrapAction(binding.keydown,state,binding))}if(binding.keypress){$document.bind("keypress"+id,this.wrapAction(binding.keypress,state,binding))}if(binding.keyup){$document.bind("keyup"+id,this.wrapAction(binding.keyup,state,binding))}}}}}},getState:function(){return this.__state},setState:function(state){this.__bindState(state,this.__state);if(this.__state!==state){if(this.__onExitState[this.__state]!==undefined){this.__onExitState[this.__state]()}if(this.__onEnterState[state]!==undefined){this.__onEnterState[state]()}}if(this.__lastState!==this.__state){this.__lastState=this.__state}this.__state=state},setLastState:function(){this.setState(this.__lastState)},handleEscKeypress:function(){$("#gliffy-toolbar-button-pointer").click()},getActionNames:function(){var names={},i,key,binding,action,result=[];for(key in this.__bindings){if(this.__bindings.hasOwnProperty(key)){binding=this.__bindings[key];for(i=0;i<binding.length;i++){action=binding[i];if(action&&!names[action]){result.push(action);names[action]=true}}}}return result}})}());(function(){_gliffy.DocumentManager=_gliffy.Class.extend({__documents:null,__activeDocument:null,__editor:null,target:null,renderer:null,__pan_on:false,__beforeRenderCallback:null,__panDragInitFunc:null,__panDragFunc:null,__renderCallbacks:null,__forceUpdate:false,__render:false,__draftManager:null,init:function(o){var options=$.extend({},{rootServiceURL:_gliffy.shapeLibrary.rootServiceURL},o),self=this,__loop;this.__documents=[];this.__editor=o.editor;_gliffy.shapeLibrary.setup({rootServiceURL:this.__editor.rootServiceUrl});this.__renderCallbacks=[];this.__fireRenderCallbacks2=function(){self.__fireRenderCallbacks()};_gliffy.RenderLoop.appendTask(function(){if(self.__render){self.__deferredRender();self.__render=false}});this.__draftManager=new _gliffy.DraftManager({editor:this.__editor})},getDraftManager:function(){return this.__draftManager},__fireRenderCallbacks:function(){var i;for(i=0;i<this.__renderCallbacks.length;i++){this.__renderCallbacks[i](this)}this.__renderCallbacks.length=0},__addRenderCallback:function(callback){if(callback&&this.__renderCallbacks.indexOf(callback)===-1){this.__renderCallbacks.push(callback)}},__setForceUpdate:function(forceUpdate){if(forceUpdate){this.__forceUpdate=true}},__renderFunc:function(renderer){var self=this,guideNode;renderer.render({object:self.getActiveStage(),target:self.target,renderCallback:function(){if(self.__fireRenderCallbacks2){self.__fireRenderCallbacks2()}if(self.__forceUpdate){self.__forceUpdate=false}_gliffy.Spinner.hide({context:"forceUpdate"})},forceUpdate:self.__forceUpdate,queueRender:self.__forceUpdate,delayEvery:30,fixedDrawingSpace:true,renderGuides:GliffyApp.documentModel.drawingGuides})},__deferredRender:function(){var renderer=this.renderer,self=this;if(this.renderer){if(this.__forceUpdate){_gliffy.Spinner.show({context:"forceUpdate"});setTimeout(function(){self.__renderFunc(renderer)},1)}else{this.__renderFunc(renderer)}}},setActiveDocument:function(document){var i,tempDocumentMatch=null;$("#gliffy-tabs-container li").removeClass("active");for(i=0;i<this.__documents.length;i++){if(this.__documents[i]===document){tempDocumentMatch=this.__documents[i];this.__documents[i].tabDomElement.parent().addClass("active")}}if(tempDocumentMatch===null&&document!==null){this.__documents.push(document);GliffyApp.documentTabsController.createNewTab(document)}this.__activeDocument=document;this.getDraftManager().enable();this.redrawActiveDocument()},redrawActiveDocument:function(){if(this.__activeDocument!==null){GliffyApp.documentModel.update(this.__activeDocument);if(this.renderer!==null){this.__editor.overlayManager.deselectAll();_gliffy.KeyManager.handleEscKeypress();this.__editor.container.removeData("contexts").find(".gliffy-viewbox, .gliffy-graphic").remove();this.redraw(null,true)}}this.__editor.grid.setEnabled(this.getActiveStage().gridOn);_gliffy.toolbarController.syncButtons(this.getActiveStage())},addAndExecuteCommand:function(command){this.getActiveStage().commandHistory.addAndExecuteCommand(command)},pushCommandBundle:function(){this.getActiveStage().commandHistory.pushCommandBundle()},popCommandBundle:function(){this.getActiveStage().commandHistory.popCommandBundle()},undoCommand:function(){this.getActiveStage().commandHistory.undoCommand()},redoCommand:function(){this.getActiveStage().commandHistory.redoCommand()},forceFinalizeCommandBundle:function(){this.getActiveStage().commandHistory.forceFinalizeCommandBundle()},getActiveStage:function(){return this.getActiveDocument().getStage()},getActiveDocument:function(){return this.__activeDocument},getDocumentCount:function(){return this.__documents.length},removeDocument:function(document){var i,currentIdx=-1;for(i=0;i<this.__documents.length;i++){if(this.__documents[i]===document){this.__documents.splice(i,1);currentIdx=i;GliffyApp.documentTabsController.removeTab(document);this.getDraftManager().removeDraftState(document);break}}if(currentIdx>-1&&document===this.__activeDocument){if(this.__documents.length>0){if(currentIdx<this.__documents.length){this.setActiveDocument(this.__documents[currentIdx])}else{this.setActiveDocument(this.__documents[currentIdx-1])}}else{this.setActiveDocument(null)}}},getDocuments:function(){return this.__documents},setBeforeRenderCallback:function(cb){this.__beforeRenderCallback=cb},render:function(o){var self,loadedCallback,readyCallback,contents,draftManager=this.getDraftManager(),options=$.extend({},{renderer:_gliffy.Renderer.StageMultiCanvas,url:null,json:null,jsonObj:null,target:null,iframe:false,callback:null,scale:1,textId:null,fixedDrawingSpace:true,pan:false,dirty:false,checkForDrafts:true,useShapeStyles:true},o);if(!options.target){throw new Error("No target specified")}if(!options.url&&!options.json&&!options.jsonObj&&!options.textId){throw new Error("No diagram to view. Pass in a url or json string.")}if(this.__beforeRenderCallback!==null){this.__beforeRenderCallback()}this.target=options.target;if(!_gliffy.renderers[options.renderer.prototype.id]){_gliffy.renderers[options.renderer.prototype.id]=new options.renderer()}this.renderer=_gliffy.renderers[options.renderer.prototype.id];self=this;draftManager.disable();if(options.checkForDrafts){draftManager.hideNotifications();draftManager.removeDraftState(this.getActiveDocument())}loadedCallback=function(){_gliffy.Spinner.show({context:"loaded"});_gliffy.Spinner.hide({context:"preload"});setTimeout(function(){_gliffy.Utils.tryCatch(function(){if(!options.useShapeStyles){self.getActiveStage().shapeStyles={};self.getActiveStage().lineStyles={};self.getActiveStage().textStyles={}}self.getActiveStage().setUnsavedChanges(options.dirty);self.getActiveStage().setZoom(options.scale);self.cleanTarget();if(self.getActiveStage().objects&&self.getActiveStage().objects.length>0){_gliffy.Utils.analyticsTimerStart("renderFile")}self.renderer.render({object:self.getActiveStage(),target:self.target,forceUpdate:true,queueRender:true,delayEvery:30,renderCallback:function(){_gliffy.Spinner.hide({context:"loaded"});if(_gliffy.Timer.hasTimer("renderFile")){_gliffy.Utils.analyticsTimerEnd("renderFile")}draftManager.enable(self.getActiveDocument());self.enableRenderLoop();if(options.callback){options.callback()}if(self.__forceUpdate){self.__forceUpdate=false}}});GliffyApp.documentModel.reset();GliffyApp.documentModel.update(self.getActiveDocument());self.__editor.grid.setEnabled(self.getActiveStage().gridOn);_gliffy.toolbarController.syncButtons(self.getActiveStage())},function(e){_gliffy.Spinner.hide({context:"loaded"});_gliffy.handleError("com.gliffy.error.render_failed",[],e)})},1)};readyCallback=function(){self.cleanTarget();_gliffy.Utils.tryCatch(function(){_gliffy.Spinner.show({context:"preload"});if(options.json){self.getActiveDocument().loadFromText(options.json,loadedCallback)}else{if(options.jsonObj){self.getActiveDocument().loadFromObject(options.jsonObj,loadedCallback)}else{if(options.url){self.__editor.performAction("open",options.url,function(document){self.getActiveDocument().loadFromObject(document,loadedCallback);if(self.hasTransformExceptions(document)){_gliffy.Utils.notify("error",$.i18n._("DOCUMENTMGR_WE_COULD_NOT_CONVERT_ALL_OF_YOUR_SHAPES."),$.i18n._("DOCUMENTMGR_TRY_TO_FIND_EQUIVALENT_SHAPES_IN_THE_GLIFFY_LIBRARIES_OR_UPLOAD_IMAGES_TO_REPLACE_THEM."))}},function(xhr,text,error){if(xhr.status===404){window.GLIFFY.Dialog.showAlertDialog({content:$.i18n._("com.gliffy.error.file_not_found"),title:$.i18n._("com.gliffy.error.uh_oh")});if(loadedCallback){loadedCallback()}}else{if(xhr.status===401){window.GLIFFY.Dialog.showAlertDialog({content:$.i18n._("com.gliffy.error.file_not_authorized"),title:$.i18n._("com.gliffy.error.uh_oh")});if(loadedCallback){loadedCallback()}}else{if(xhr.status===403){window.GLIFFY.Dialog.showAlertDialog({content:$.i18n._("com.gliffy.error.file_forbidden"),title:$.i18n._("com.gliffy.error.uh_oh")});if(loadedCallback){loadedCallback()}}else{_gliffy.handleError("com.gliffy.error.file_malformed",[options.url],error,self.errorTarget)}}}})}else{if(options.textId){self.getActiveDocument().loadFromText($(options.textId),loadedCallback)}}}}},function(e){_gliffy.handleError("com.gliffy.error.file_load",[],e)})};if(options.iframe){contents=options.target.contents();if(contents&&contents.get(0).readyState==="complete"&&contents.find("#container").length>0){self.target=contents.find("#container");readyCallback()}else{options.target.load(function(){self.target=options.target.contents().find("#container");readyCallback()})}}else{readyCallback()}},hasTransformExceptions:function(documentData){var hasTransformException=false,i,errors;if(documentData.gon&&documentData.gon.errors){errors=documentData.gon.errors;for(i=0;i<errors.length;i++){_gliffy.Logger.warn("Transform:"+errors[i].level+" : "+errors[i].exception+" : "+errors[i].message);if(errors[i].level==="exception"){hasTransformException=true}}}return hasTransformException},cleanTarget:function(){$("#gliffy-edit-text").trigger("customblur.gliffy-edit-text",{skipSaveToDocument:true});this.target.find(".gliffy-stage").find(".gliffy-graphic,.gliffy-text,.gliffy-viewbox,.gliffy-drawing-guide").remove();this.target.data("contexts",null);_gliffy.Tree.clear()},redrawDebug:function(callback,forceUpdate){var self=this;this.__addRenderCallback(callback);this.__setForceUpdate(forceUpdate);_gliffy.Utils.tryCatch(function(){self.__deferredRender()},function(e){_gliffy.handleError("com.gliffy.error.render_failed",[],e)})},disableRenderLoop:function(){this.__renderLoopEnabled=false;this.__render=false},enableRenderLoop:function(){this.__renderLoopEnabled=true},redraw:function(callback,forceUpdate){if(this.__renderLoopEnabled){if(_gliffy.Debug.SKIP_RENDER_LOOP){this.redrawDebug()}else{this.__addRenderCallback(callback);this.__setForceUpdate(forceUpdate);this.__render=true}}},getActiveStageViewPort:function(){var dimension=this.__editor.containerBounds.getDimension(),minX=-this.getActiveStage().pan_x,minY=-this.getActiveStage().pan_y,zoom=this.getZoom();return new _gliffy.BoundingBox(minX/zoom,minY/zoom,(minX+dimension.x)/zoom,(minY+dimension.y)/zoom)},zoomToBox:function(boundingBox,callback){var dimension=this.getActiveStageViewPort().getDimension();this.getActiveStage().zoomToBox(boundingBox,dimension.x,dimension.y);GliffyApp.documentModel.update(this.getActiveDocument());this.redraw(callback,true)},zoomToCenter:function(zoom,callback){var dimension=this.getActiveStageViewPort().getDimension();this.getActiveStage().zoomToCenter(zoom,dimension.x,dimension.y);GliffyApp.documentModel.update(this.getActiveDocument());this.redraw(callback,true)},zoomAt:function(zoom,stageX,stageY,callback){var dimension=this.getActiveStageViewPort().getDimension();this.getActiveStage().zoomAt(zoom,stageX,stageY,dimension.x,dimension.y);GliffyApp.documentModel.update(this.getActiveDocument());this.redraw(callback,true)},zoomToFit:function(callback){var dimension=this.getActiveStageViewPort().getDimension();this.getActiveStage().zoomToFit(dimension.x,dimension.y);GliffyApp.documentModel.update(this.getActiveDocument());this.redraw(callback,true)},zoom:function(zoomValue,callback){this.getActiveStage().setZoom(zoomValue);GliffyApp.documentModel.update(this.getActiveDocument());this.redraw(callback,true)},getZoom:function(){return this.getActiveStage().getZoom()},reset:function(callback){this.getActiveStage().pan_x=0;this.getActiveStage().pan_y=0;this.getActiveStage().setZoom(1);this.redraw(callback,true)},pan:function(x,y,callback){this.getActiveStage().pan_x=x;this.getActiveStage().pan_y=y;this.redraw(callback)},getPreviewImageFromGon:function(gon,callback){var self=this,tmp,gonObject=new _gliffy.Gon();gonObject.fromObject(gon,{subscribeToConstraints:false});gonObject.__registerShapes(function(){self.getImageData(gonObject.stage,"image/png",callback,true)})},getImageData:function(stage,contentType,callback,showProgressBar){var tmp,self;tmp=$("<div/>");$("body").append(tmp);self=this;if(!_gliffy.renderers[_gliffy.Renderer.StageSingleCanvas.prototype.id]){_gliffy.renderers[_gliffy.Renderer.StageSingleCanvas.prototype.id]=new _gliffy.Renderer.StageSingleCanvas()}_gliffy.renderers[_gliffy.Renderer.StageSingleCanvas.prototype.id].render({object:stage,target:tmp,show_progress_bar:showProgressBar,renderCallback:function(){var $canvas,canvas,imageData,imageData2;$canvas=tmp.find("canvas");canvas=$canvas.get(0);if(contentType==="smallest"){imageData=canvas.toDataURL("image/png");imageData2=canvas.toDataURL("image/jpeg");if(imageData.length>imageData2.length){imageData=imageData2;imageData2=null}}else{imageData=canvas.toDataURL(contentType)}tmp.remove();callback(imageData)}})},updateTextDefaults:function(prop,value){var activeDocument=this.getActiveDocument();if(!activeDocument.getStage().textStyles.global){activeDocument.getStage().textStyles.global=new _gliffy.TextStyle()}switch(prop){case"bold":case"italic":case"underline":activeDocument.getStage().textStyles.global[prop]=!activeDocument.getStage().textStyles.global[prop];break;case"face":case"size":case"color":activeDocument.getStage().textStyles.global[prop]=value;break}},applyTextDefaults:function(html,themeType){var $html=$(html),globalDefaults=this.getActiveDocument().getStage().textStyles.global,$span,textTheme;if(!globalDefaults){globalDefaults=new _gliffy.TextStyle()}if(this.getActiveDocument().getStage().themeData&&themeType){if(themeType==="text"){textTheme=this.getActiveDocument().getStage().themeData.text}else{if(themeType==="line"){textTheme=this.getActiveDocument().getStage().themeData.line.text}else{textTheme=this.getActiveDocument().getStage().themeData.shape[themeType].text}}globalDefaults.fromTheme(textTheme)}$("body").append($html);$span=$html.find("span:first");if(globalDefaults&&$span.length===1){if(globalDefaults.bold){$span.css("font-weight","bold")}if(globalDefaults.italic){$span.css("font-style","italic")}if(globalDefaults.underline){$span.css("text-decoration","underline")}if(globalDefaults.face){$span.css("font-family",globalDefaults.face)}if(globalDefaults.size){$span.css("font-size",globalDefaults.size)}if(globalDefaults.color){$span.css("color",globalDefaults.color)}}$html.remove();return $html[0].outerHTML},updateStyleDefaultsForNode:function(node,prop,value){var subLibraryId=node.getSubLibraryId(),nodeStyle,activeDocument=this.getActiveDocument();if(node.isLine()){nodeStyle=activeDocument.getStage().lineStyles.global}else{if(subLibraryId&&!node.getShapeInformation().useStaticStyleDefaults){nodeStyle=activeDocument.getStage().shapeStyles[subLibraryId]}}if(prop==="BorderWidth"||prop==="LineThickness"){prop="strokeWidth"}if(prop==="DropShadow"){prop="shadow"}prop=prop.charAt(0).toLowerCase()+prop.slice(1);if(nodeStyle&&nodeStyle[prop]!==undefined){nodeStyle[prop]=value}}})}());(function(){var LINE_THRESHOLD=13*13,MIN_SIZE=3,CLASS_NAME="gliffy-text-selector";_gliffy.DrawManager=_gliffy.Class.extend({__active:false,__orthoMode:0,__documentManager:null,__dragStageDiv:null,fileHandlerRegister:null,customLibraryDropRegister:null,init:function(o){if(!o){throw new Error("Selector init needs options")}if(!o.documentManager){throw new Error("DrawManager init options needs document manager")}if(!o.dragStageDiv){throw new Error("DrawManager init options needs dragStageDiv")}this.__documentManager=o.documentManager;this.__editor=this.__documentManager.__editor;this.__dragStageDiv=o.dragStageDiv;this.fileHandlerRegister=new _gliffy.FileHandlerRegister(this);this.customLibraryDropRegister=new _gliffy.CustomLibraryDropRegister(this.__editor);this.bindDropHandler()},bindDropHandler:function(){var element=(this.__editor&&this.__editor.container)?this.__editor.container.get(0):null,self=this;if(element){element.ondragover=function(){return false};element.ondragend=function(){return false};element.ondrop=function(e){e.preventDefault();_gliffy.Mouse.updatePosition(e);var files,source,i,j,handler,file,fileHandlers=self.fileHandlerRegister.getFileHandlers(),url;if(e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length>0){files=e.dataTransfer.files}else{if(e.dataTransfer){files=[];try{source=e.dataTransfer.getData("text/html");url=_gliffy.Utils.getImageUrlFromHtml(source)}catch(error){source=e.dataTransfer.getData("TEXT");if(source!==null){url=_gliffy.Utils.getImageUrlFromHtml(source)}else{url=e.dataTransfer.getData("URL")}}if(url&&url.length>0){files.push({url:url,source:source,type:"url"})}}}for(i=0;i<files.length;i++){file=files[i];for(j=0;j<fileHandlers.length;j++){handler=fileHandlers[j];if(handler.canHandleFile(file)){handler.handle(file,i);break}}}return false}}},bindDrawHandlers:function(){var editor=this.__editor,stage=editor.container.find(".gliffy-stage"),self=this,shapeInfo,startPos,lastpos;_gliffy.Mouse.registerDragState([{modes:["ellipse","rectangle"],dragStart:function(){shapeInfo=self.shapeToolStartDrag(editor.getDrawMode())},drag:function(){if(shapeInfo){self.shapeToolDrag(shapeInfo.node,shapeInfo.initX,shapeInfo.initY)}},dragEnd:function(){if(shapeInfo){self.shapeToolDragEnd(shapeInfo,editor.overlayManager)}shapeInfo=null},autoPan:true},{modes:["text"],dragStart:function(){self.__dragStageDiv.setClassName(CLASS_NAME);self.__dragStageDiv.setStartCorner(_gliffy.Mouse.getPosition())},drag:function(){self.__dragStageDiv.setEndCorner(_gliffy.Mouse.getPosition());if(!self.__dragStageDiv.isScreenDiagonalLessThan(MIN_SIZE)){self.__dragStageDiv.draw()}else{self.__dragStageDiv.hide()}},dragEnd:function(){var node,pos,w,h,bounds;node=new _gliffy.Node();pos=_gliffy.Mouse.getPosition();w=150;h=0;bounds=self.__dragStageDiv.getBoundingBox();if(self.__dragStageDiv.isVisible()&&(bounds.max.x-bounds.min.x>10)&&(bounds.max.x-bounds.min.x>10)){pos.x=(bounds.min.x+bounds.max.x)/2;pos.y=(bounds.min.y+bounds.max.y)/2;w=bounds.max.x-bounds.min.x}self.__dragStageDiv.hide();self.createText(node,pos.x-(w*0.5),pos.y-(h*0.5),w,h);editor.getDocumentManager().addAndExecuteCommand(new _gliffy.AddNodeCommand({node:node,prepend:true}));editor.getDocumentManager().redraw(function(){node.getGraphic().editable.setEditMode(true);node.getGraphic().editable.focus();node.getGraphic().editable.select();editor.overlayManager.textControl.edit(node.getGraphic());node.getGraphic().editable.registerBlurHandler(function(){GliffyApp.contextualPropertiesController.blurRTE();editor.getDocumentManager().redraw()})})},autoPan:true},{modes:["ortho","line"],dragStart:function(){editor.getDocumentManager().pushCommandBundle();var node,pos,line,lineStyle,themeData=null;node=new _gliffy.Node();pos=_gliffy.Mouse.getPosition();startPos=pos;editor.drawManager.createLine(node,pos.x,pos.y);line=node.getGraphic();line.setOrtho(editor.getDrawMode()===_gliffy.Editor.DRAW_MODE.ortho);if(!editor.getDocumentManager().getActiveDocument().getStage().lineStyles.global){lineStyle=new _gliffy.LineStyle();editor.getDocumentManager().getActiveDocument().getStage().lineStyles.global=lineStyle}else{lineStyle=editor.getDocumentManager().getActiveDocument().getStage().lineStyles.global}themeData=editor.getDocumentManager().getActiveStage().themeData;if(themeData){lineStyle.fromTheme(themeData.line)}line.applyStyle(lineStyle);node.update();editor.__documentManager.addAndExecuteCommand(new _gliffy.AddNodeCommand({node:node,prepend:true}));editor.overlayManager.ungroupSelectedNodes();editor.overlayManager.lineOverlay.isNewlyCreatedLine=true;editor.overlayManager.selectNode(node);editor.overlayManager.lineOverlay.simulateControlDrag(0,pos,"start");editor.overlayManager.lineOverlay.simulateControlDrag(0,pos);editor.overlayManager.lineOverlay.simulateControlDrag(0,pos,"end");editor.overlayManager.lineOverlay.simulateControlDrag(1,pos,"start");_gliffy.Mouse.setCursor("move")},drag:function(){editor.overlayManager.lineOverlay.simulateControlDrag(1,_gliffy.Mouse.getPosition())},dragEnd:function(){var pos,dist2,selectedNode;pos=_gliffy.Mouse.getPosition();editor.overlayManager.lineOverlay.isNewlyCreatedLine=false;editor.overlayManager.lineOverlay.simulateControlDrag(1,pos,"end");editor.__documentManager.addAndExecuteCommand(new _gliffy.ModifyLineCommand({node:editor.overlayManager.lineOverlay.getSelectedNode()}));editor.getDocumentManager().popCommandBundle();dist2=_gliffy.Vec2.squaredDistance(startPos,pos);if(dist2<=LINE_THRESHOLD){editor.overlayManager.deselectAll();editor.getDocumentManager().getActiveStage().commandHistory.removeAndUndoLastCommand();selectedNode=_gliffy.Pick.getNodeAt(editor.getDocumentManager().getActiveStage().objects,pos.x,pos.y);if(selectedNode){$("#gliffy-toolbar-button-pointer").trigger({type:"click",deselect:false});editor.overlayManager.selectNode(selectedNode);GliffyApp.contextualPropertiesController.showControls(editor.overlayManager.getActiveOverlay())}else{editor.overlayManager.lineOverlay.showConnectionPoints(true)}}},autoPan:true},{modes:["pan"],dragStart:function(event){_gliffy.CursorManager.setCursor("hand-closed");_gliffy.Mouse.lockDragUI("hand-closed");lastpos={x:event.pageX,y:event.pageY}},drag:function(event){var xDiff,yDiff,dimension=editor.getDocumentManager().getActiveStageViewPort().getDimension();xDiff=event.pageX-lastpos.x;yDiff=event.pageY-lastpos.y;lastpos={x:event.pageX,y:event.pageY};editor.getDocumentManager().getActiveStage().offsetPan(xDiff,yDiff,dimension.x,dimension.y);editor.getDocumentManager().renderer.render({object:editor.getDocumentManager().getActiveStage(),target:editor.getDocumentManager().target,panOnly:true})},dragEnd:function(){_gliffy.CursorManager.setCursor("hand")}}])},createLine:function(node,x1,y1,x2,y2){var line;if(x2===undefined){line=new _gliffy.Line(node)}else{line=new _gliffy.Line(node,new _gliffy.Vec2(0,0),new _gliffy.Vec2(x2-x1,y2-y1))}line.editable.allowComputeBestPath=true;node.setX(x1);node.setY(y1);node.setGraphic(line);return node},createShape:function(node,x,y){var shape=new _gliffy.Shape(node);node.setGraphic(shape);shape.setGradient(true);node.setX(x-50);node.setY(y-50);return node},createImage:function(node,params,x,y){var proxy=new _gliffy.Proxy(node),default_text=node.getShapeInformation().defaults?node.getShapeInformation().defaults.default_text_style:[{}],self=this,swapProxy,downloadImage,img;node.setGraphic(proxy);node.setEditTextOnInit(false);node.setX(x-50);node.setY(y-50);node.setLockAspectRatio(true);this.setupTextDefaults(node,default_text,true,null);swapProxy=function(){var node=proxy.getNode(),image=new _gliffy.Image(node);proxy.replaceWith(image);image.setDropShadow(false);image.setUrl(img.src);image.imgWidth=img.width;image.imgHeight=img.height;node.setWidth(img.width);node.setHeight(img.height);node.update();if(self.__editor.overlayManager.overlay.isActive()){self.__editor.overlayManager.overlay.refresh();GliffyApp.contextualPropertiesController.configureDialogControls()}self.redraw();img=null;swapProxy=null};downloadImage=function(url){if(url){img=new Image();img.onload=swapProxy;img.onerror=function(){img=new Image();img.onload=swapProxy;img.src=_gliffy.Renderer.ImageCanvas.imageNotAvailable};img.src=url}else{img=new Image();img.onload=swapProxy;img.src=_gliffy.Renderer.ImageCanvas.imageNotAvailable}};if(params.image){if(params.doNotProxyImage){downloadImage(params.image)}else{this.__editor.performAction("image",params.image,downloadImage,function(xhr,text,error){})}}else{if(params.getImageUrl){params.getImageUrl(downloadImage)}}return node},createSvg:function(node,params,x,y){var proxy=new _gliffy.Proxy(node),resources,resource,dim,self=this,default_text=node.getShapeInformation().defaults?node.getShapeInformation().defaults.default_text_style:[{}];node.setEditTextOnInit(false);proxy.setDropShadow(false);node.setGraphic(proxy);node.setX(x-50);node.setY(y-50);node.setLockAspectRatio(true);this.setupTextDefaults(node,default_text,true,null);_gliffy.shapeLibrary.loadSvgStencil(params.svg).then(function(data){dim=_gliffy.shapeLibrary.svgDim[params.svg];var width=dim.width,height=dim.height,svg=new _gliffy.Svg(node);node=proxy.getNode();if(dim.height>0&&dim.width>0){if(dim.width>1000||dim.height>1000){while(width>1000||height>1000){width/=2;height/=2;node.setHeight(height);node.setWidth(width)}}else{node.setHeight(dim.height);node.setWidth(dim.width)}}resources=self.__documentManager.getActiveDocument().getEmbeddedResources();dim=_gliffy.shapeLibrary.svgDim[params.svg];resource=resources.add("image/svg+xml",params.svg,dim.x,dim.y,dim.width,dim.height);svg.setEmbeddedResourceId(resource.getId());proxy.replaceWith(svg);node.setFlag("bounds");node.update();if(self.__editor.overlayManager.overlay.isActive()){self.__editor.overlayManager.overlay.refresh();GliffyApp.contextualPropertiesController.configureDialogControls()}self.redraw()},function(text){_gliffy.Utils.notify("info",$.i18n._("SVG_FILE_HANDLER_NOTIFY_TITLE"),$.i18n._("SVG_FILE_HANDLER_NOTIFY_MESSAGE"));new _gliffy.RemoveNodeCommand({node:proxy.getNode()}).execute(this.__documentManager.getActiveStage());self.redraw();_gliffy.Logger.warn("Could not import svg: "+text)});return node},setupShape:function(node,params,pos,addCommand){var defaults=null,shapeInfo,customHandler;node.setUid(params.uid);customHandler=this.customLibraryDropRegister.getCustomHandler(node);shapeInfo=node.getShapeInformation();addCommand=(addCommand!==false&&pos!==undefined&&pos!==null);if(shapeInfo&&shapeInfo.defaults&&shapeInfo.defaults.copyObject){node.fromObject(shapeInfo.defaults.copyObject);customHandler.setupShape(node,addCommand);if(addCommand){this.__documentManager.addAndExecuteCommand(new _gliffy.AddCopyNodeCommand({node:node}));this.__documentManager.redraw()}}else{if(params.tid==="com.gliffy.stencil.image"){this.createImage(node,params,pos.x,pos.y)}else{if(params.tid==="com.gliffy.stencil.custom.svg.static"){this.createSvg(node,params,pos.x,pos.y)}else{defaults=(shapeInfo)?shapeInfo.defaults:null;if(params.tid==="com.gliffy.stencil.line"){this.createLine(node,pos.x-50,pos.y,pos.x+50,pos.y);this.setupLineDefaults(node,defaults)}else{this.createShape(node,pos.x,pos.y);node.getGraphic().setTid(params.tid);this.setupShapeDefaults(node,defaults)}}}customHandler.setupShape(node,addCommand);if(addCommand){this.__documentManager.addAndExecuteCommand(new _gliffy.AddNodeCommand({node:node,prepend:true}));this.__documentManager.redraw()}}},setupShapeDefaults:function(node,defaults){var graphic=node.getGraphic(),themeType,shapeInfo;if(defaults){node.setWidth(defaults.width);node.setHeight(defaults.height);node.setRotation(defaults.rotate);node.setLockAspectRatio(defaults.lockAspectRatio);if(defaults.editTextOnInit!==undefined){node.setEditTextOnInit(defaults.editTextOnInit)}this.setupShapeGraphicStyleDefaults(node,defaults);shapeInfo=node.getShapeInformation();themeType=(shapeInfo&&shapeInfo.defaults&&shapeInfo.defaults.themeType)?shapeInfo.defaults.themeType:null;this.setupTextDefaults(node,defaults.default_text_style,node.getShapeInformation().useStaticTextStyleDefaults,themeType)}},setupShapeGraphicStyleDefaults:function(node,defaults){var graphic=node.getGraphic(),shadowSize,subLibraryId,shapeStyle;subLibraryId=node.getSubLibraryId();if(node.getShapeInformation().useStaticStyleDefaults){shapeStyle=new _gliffy.ShapeStyle();shapeStyle.fromObject(defaults)}else{if(node.getShapeInformation().defaults.themeType&&this.__documentManager.getActiveStage().themeData){shapeStyle=new _gliffy.ShapeStyle();shapeStyle.fromTheme(this.__documentManager.getActiveStage().themeData.shape[node.getShapeInformation().defaults.themeType])}else{if(this.__documentManager.getActiveStage().shapeStyles[subLibraryId]){shapeStyle=this.__documentManager.getActiveStage().shapeStyles[subLibraryId]}else{shapeStyle=new _gliffy.ShapeStyle();shapeStyle.fromObject(defaults);this.__documentManager.getActiveStage().shapeStyles[subLibraryId]=shapeStyle}}}graphic.applyStyle(shapeStyle)},setupLineDefaults:function(node,defaults){var graphic=node.getGraphic();if(defaults){if(defaults.orthoMode>=0){graphic.setOrtho(true)}graphic.applyStyle(defaults);this.setupTextDefaults(node,defaults.default_text_style,node.getShapeInformation().useStaticStyleDefaults,"line")}},setupTextDefaults:function(node,textDefaults,ignoreGlobalOverrides,themeType){var text=new _gliffy.Text();text.setupDefaults(textDefaults);if(!ignoreGlobalOverrides){text.setHTML(this.__documentManager.applyTextDefaults(text.getHTML(),themeType))}node.setDefaultTextGraphic(text)},createText:function(node,x,y,width,height){var text=new _gliffy.Text(node);text.setOverflow("none");text.setVPosition("none");node.setX(x);node.setY(y);node.setWidth(width);node.setHeight(height);node.setGraphic(text);node.setUid("com.gliffy.shape.basic.basic_v1.default.text");return node},setOrthoMode:function(mode){if(mode!==undefined&&mode!==null&&mode<Object.keys(_gliffy.Editor.ORTHO_MODE).length&&mode>=0){this.__orthoMode=mode}else{throw new Error(mode+" is not a valid ortho line type")}},shapeToolStartDrag:function(type){var uid,tid,node,pos,graphic,self,rect,snapPixels,initX,initY,params;if(type!==_gliffy.Editor.DRAW_MODE.ellipse&&type!==_gliffy.Editor.DRAW_MODE.rectangle){return}snapPixels=_gliffy.Utils.shouldSnapToGrid()?_gliffy.Utils.SNAP_PIXELS:1;uid="com.gliffy.shape.basic.basic_v1.default.ellipse";tid="com.gliffy.stencil.ellipse.basic_v1";if(type===_gliffy.Editor.DRAW_MODE.rectangle){uid="com.gliffy.shape.basic.basic_v1.default.rectangle";tid="com.gliffy.stencil.rectangle.basic_v1"}node=new _gliffy.Node();pos=_gliffy.Mouse.getPosition();pos.x=pos.x-pos.x%snapPixels;pos.y=pos.y-pos.y%snapPixels;params={tid:tid,uid:uid};this.setupShape(node,params,pos,false);graphic=node.getGraphic();graphic.setGradient(false);graphic.setFillColor("#ffffff");graphic.setStrokeColor("#000000");graphic.setDropShadow(false);graphic.setShadowX(0);graphic.setShadowY(0);graphic.setStrokeWidth(1);node.setX(pos.x);node.setY(pos.y);node.setWidth(0);node.setHeight(0);self=this;rect=null;initX=pos.x;initY=pos.y;self.__documentManager.addAndExecuteCommand(new _gliffy.AddNodeCommand({node:node,prepend:true}));this.__documentManager.redraw();return{node:node,initX:initX,initY:initY}},shapeToolDrag:function(node,initX,initY){var pos,eventX,eventY,l,r,t,b,w,h,snapPixels,rect;snapPixels=_gliffy.Utils.shouldSnapToGrid()?_gliffy.Utils.SNAP_PIXELS:1;pos=_gliffy.Mouse.getPosition();eventX=pos.x-pos.x%snapPixels;eventY=pos.y-pos.y%snapPixels;l=Math.min(initX,eventX);r=Math.max(initX,eventX);t=Math.min(initY,eventY);b=Math.max(initY,eventY);w=r-l;h=b-t;rect={tl:new _gliffy.Vec2(l,t),br:new _gliffy.Vec2(r,b)};if(rect.tl.x!==node.getX()||rect.tl.y!==node.getY()){this.__documentManager.addAndExecuteCommand(new _gliffy.MoveNodeCommand({node:node,x:rect.tl.x,y:rect.tl.y}))}if(w!==node.getWidth()||h!==node.getHeight()){this.__documentManager.addAndExecuteCommand(new _gliffy.SetWidthAndHeightCommand({node:node,width:w,height:h}))}this.__documentManager.redraw()},shapeToolDragEnd:function(shapeInfo,overlayManager){var diff,pos,eventX,eventY,l,r,t,b,w,h,snapPixels,rect;snapPixels=_gliffy.Utils.shouldSnapToGrid()?_gliffy.Utils.SNAP_PIXELS:1;pos=_gliffy.Mouse.getPosition();eventX=pos.x-pos.x%snapPixels;eventY=pos.y-pos.y%snapPixels;l=Math.min(shapeInfo.initX,eventX);r=Math.max(shapeInfo.initX,eventX);t=Math.min(shapeInfo.initY,eventY);b=Math.max(shapeInfo.initY,eventY);rect={tl:new _gliffy.Vec2(l,t),br:new _gliffy.Vec2(r,b)};if(shapeInfo.node){diff=new _gliffy.Vec2(0,0);if(rect){diff=_gliffy.Vec2.difference(rect.br,rect.tl)}if(diff.x<10&&diff.y<10){new _gliffy.RemoveNodeCommand({node:shapeInfo.node}).execute(this.__documentManager.getActiveStage());this.__documentManager.redraw()}else{overlayManager.deselectAll();overlayManager.selectNode(shapeInfo.node);GliffyApp.contextualPropertiesController.showControls(overlayManager.getActiveOverlay());this.__documentManager.getActiveStage().setUnsavedChanges(true)}}},redraw:function(){this.__documentManager.redraw()}})}());(function(){_gliffy.OverlayManager=_gliffy.Class.extend({overlay:null,lineOverlay:null,textControl:null,__documentManager:null,__container:null,__editor:null,__selectedNodes:null,__enabled:true,__dragStageDiv:null,__nodeSelectionEnabled:true,__selectionNodesToBreakup:null,__DOUBLE_CLICK_TIMEOUT:300,init:function(o){this.__selectedNodes=[];this.__selectionNodesToBreakup=[];this.config(o)},config:function(o){if(!o){throw new Error("overlayManager config needs options")}if(!o.documentManager){throw new Error("overlayManager config options needs documentManager")}if(!o.target){throw new Error("overlayManager config options needs target")}if(!o.editor){throw new Error("overlayManager config options needs editor")}this.__documentManager=o.documentManager;this.__container=o.target;this.__editor=o.editor;this.__dragStageDiv=o.dragStageDiv;if(this.textControl===null){this.textControl=new _gliffy.TextControl(o)}if(this.overlay===null){this.overlay=new _gliffy.Overlay({documentManager:o.documentManager,target:o.target,textControl:this.textControl,manager:this})}if(this.lineOverlay===null){this.lineOverlay=new _gliffy.LineOverlay({editor:o.editor,documentManager:o.documentManager,target:o.target,textControl:this.textControl})}var self=this;this.__documentManager.setBeforeRenderCallback(function(){self.overlay.deselect();self.lineOverlay.detach();self.overlay.detach()});$(".gliffy-stage").delegate("a","mouseenter",function(ev){self.__nodeSelectionEnabled=false});$(".gliffy-stage").delegate("a","mouseleave",function(ev){self.__nodeSelectionEnabled=true})},singleDownNoNode:function(event){var self=this;_gliffy.KeyManager.setState("stage");if(self.__enabled){$("#gliffy-edit-text").trigger("customblur.gliffy-edit-text");self.deselectAll()}},singleDownWithNode:function(event,selectedNode){var self=this,lastSelected=this.getSelectedNode(),position=_gliffy.Mouse.getPosition(),node;if(self.__enabled&&self.__nodeSelectionEnabled){if(!lastSelected||(selectedNode&&lastSelected.getId()!==selectedNode.getId())){$("#gliffy-edit-text").trigger("customblur.gliffy-edit-text")}if(!(this.__editor.getDrawMode()===_gliffy.Editor.DRAW_MODE.line||this.__editor.getDrawMode()===_gliffy.Editor.DRAW_MODE.ortho)){event.preventDefault();if(selectedNode){if(_gliffy.KeyManager.shiftKeyDown||_gliffy.KeyManager.metaCtrlKeyDown){if(self.addNodeToSelection(selectedNode)){self.overlay.beginInitialDrag();event.stopPropagation()}}else{self.deselectAll();if(self.selectNode(selectedNode)){if(selectedNode.getGraphic() instanceof _gliffy.Line){self.lineOverlay.beginInitialDrag(event)}else{self.overlay.beginInitialDrag()}event.stopPropagation();GliffyApp.hudController.show(GliffyApp.hudController.HUD_MODE.pos)}}}else{if(lastSelected.getGraphic() instanceof _gliffy.Line){self.lineOverlay.beginInitialDrag(event)}else{self.overlay.beginInitialDrag()}}}}},setEnabled:function(enabled){this.__enabled=enabled},getSelectedNodes:function(){var nodes=[],i=0,n;for(i=0;i<this.__selectedNodes.length;i++){n=this.__documentManager.getActiveStage().find(this.__selectedNodes[i]);if(n){nodes.push(n)}}return nodes},getSelectedNode:function(){if(this.getActiveOverlay()===null){return null}else{return this.getActiveOverlay().getSelectedNode()}},selectNodes:function(nodes){var selectionNode,nodeIds;if(nodes.length>0){this.deselectAll();nodeIds=this.nodeIdsFromSelection(nodes);if(nodeIds.length>1){this.__selectedNodes=nodeIds;selectionNode=this.createSelectionNode();if(selectionNode){this.selectNode(selectionNode,true)}else{return false}return selectionNode}else{if(nodeIds.length===1){this.selectNode(nodes[0]);return nodes[0]}}}return false},selectAllNodes:function(){this.selectNodes(this.__documentManager.getActiveStage().objects)},nodeIdsFromSelection:function(objects){var i,object,toAdd=[],children,j;for(i=0;i<objects.length;i++){object=objects[i];if($.inArray(object.getId(),toAdd)===-1){toAdd.push(object.getId())}}return toAdd},addSelectionNodesToBreakup:function(node){if(node&&node.isSelection&&$.inArray(node.getId(),this.__selectionNodesToBreakup)===-1){this.__selectionNodesToBreakup.push(node.getId())}},deselectAll:function(){if(typeof this.__documentManager==="undefined"){return}var i,stage=this.__documentManager.getActiveStage(),node;for(i=0;i<this.__selectionNodesToBreakup.length;i++){node=stage.find(this.__selectionNodesToBreakup[i]);if(node&&node.isSelection()){this.ungroupifySelection(node)}}this.overlay.deselect();this.lineOverlay.deselect();this.__selectionNodesToBreakup=[];this.__selectedNodes=[];this.__documentManager.redraw()},selectNode:function(node,isGroupSelection){var container=this.__container;if(node.isLine()){this.overlay.deselect();this.lineOverlay.select(node,container)}else{this.lineOverlay.deselect();this.overlay.select(node,container)}if(!node.isSelection()){this.__selectedNodes=[node.getId()]}if(node.isGroup()||node.isSelection()){this.__updateRTEControls("")}else{if(node.children&&node.children.length!==0&&node.children[0].getGraphic() instanceof _gliffy.Text){this.__updateRTEControls(node.children[0].getGraphic().getHTML())}else{if(node.getGraphic() instanceof _gliffy.Text){this.__updateRTEControls(node.getGraphic().getHTML())}else{this.__updateRTEControls("")}}}return true},__updateRTEControls:function(content){},createSelectionNode:function(){var parentNode,stage;parentNode=new _gliffy.Node();stage=this.__documentManager.getActiveStage();parentNode.setUid("com.gliffy.shape.basic.basic_v1.default.selection");stage.appendNode(parentNode);stage.attachSelectionToGroup(parentNode,this.getSelectedNodes());if(!parentNode.children){new _gliffy.RemoveNodeCommand({node:parentNode}).execute(stage);return null}else{this.addSelectionNodesToBreakup(parentNode);return parentNode}},ungroupSelectedNodes:function(){var parentNode,stage;parentNode=this.overlay.getSelectedNode();stage=this.__documentManager.getActiveStage();if(parentNode&&parentNode.isSelection()){stage.detachSelectionFromGroup(parentNode);new _gliffy.RemoveNodeCommand({node:parentNode}).execute(stage);this.__documentManager.redraw()}},groupifySelection:function(){var node=this.overlay.getSelectedNode();if(node&&node.isSelection()){this.__selectedNodes=[node.getId()];this.__selectedNodes=[node.getId()];this.__documentManager.addAndExecuteCommand(new _gliffy.GroupCommand({node:node}))}},ungroupifyGroup:function(){var groupNode=this.overlay.getSelectedNode();if(groupNode&&groupNode.isGroup()){this.__documentManager.addAndExecuteCommand(new _gliffy.UngroupCommand({node:this.overlay.getSelectedNode()}))}this.overlay.deselect();this.lineOverlay.deselect()},ungroupifySelection:function(node){if(node.isSelection()){_gliffy.Tree.remove(node);this.__documentManager.getActiveStage().detachSelectionFromGroup(node);new _gliffy.RemoveNodeCommand({node:node}).execute(this.__documentManager.getActiveStage())}},addNodeToSelection:function(node){var i,curNode,selectedNodes=this.getSelectedNodes(),selectedNode=this.getSelectedNode(),stage=this.__documentManager.getActiveStage();if(this.getSelectedNodes().length===0){return this.selectNode(node,false)}else{if(!node.isSelection()){for(i=0;i<selectedNodes.length;i++){curNode=selectedNodes[i];if(curNode.isSelection()){return false}if(curNode.getId()===node.getId()){return false}}this.__selectedNodes.push(node.getId());if(selectedNode.isSelection()){stage.addSelectionToGroup(selectedNode,[node])}else{selectedNode=this.createSelectionNode()}this.lineOverlay.deselect();this.overlay.deselect();if(selectedNode){return this.selectNode(selectedNode,true)}else{return false}}else{return false}}},setDrawMode:function(drawMode){this.deselectAll();this.__enabled=(drawMode!==_gliffy.Editor.DRAW_MODE.pan);this.overlay.setActive(this.__enabled&&drawMode!==_gliffy.Editor.DRAW_MODE.line&&drawMode!==_gliffy.Editor.DRAW_MODE.ortho)},getActiveOverlay:function(){if(this.lineOverlay.isActive()){return this.lineOverlay}else{if(this.overlay.isActive()){return this.overlay}else{return null}}},deleteSelectedNode:function(){var nodes=this.getSelectedNodes(),commands=[],i=0;if(nodes.length>0){this.deselectAll();for(i=0;i<nodes.length;i++){commands.push(new _gliffy.RemoveNodeCommand({node:nodes[i]}))}this.__documentManager.addAndExecuteCommand(new _gliffy.BundledCommand({commands:commands}));this.__documentManager.redraw()}this.deselectAll()},updateOverlayX:function(value){if(this.overlay.isActive()){this.overlay.setTransX(value);this.overlay.__redrawModel=true;this.overlay.__popCommandBundle=true}},updateOverlayY:function(value){if(this.overlay.isActive()){this.overlay.setTransY(value);this.overlay.__redrawModel=true;this.overlay.__popCommandBundle=true}},updateOverlayWidth:function(value){var node,tnode,center,center2;if(this.overlay.isActive()){node=this.getSelectedNode();center=node.worldTransform.transformPoint(node.getWidth()/2,node.getHeight()/2);tnode=new _gliffy.Node();tnode.setWidth(value);tnode.setHeight(node.getHeight());tnode.setX(node.getX());tnode.setY(node.getY());tnode.setRotation(node.getRotation());tnode.setScaleX(node.getScaleX());tnode.setScaleY(node.getScaleY());tnode.update();center2=tnode.worldTransform.transformPoint(tnode.getWidth()/2,tnode.getHeight()/2);this.overlay.setTransX(tnode.getX()+(center.x-center2.x));this.overlay.setTransY(tnode.getY()+(center.y-center2.y));this.overlay.setScaleX(value);this.overlay.__redrawModel=true;this.overlay.__popCommandBundle=true}},updateOverlayHeight:function(value){var node,tnode,center,center2;if(this.overlay.isActive()){node=this.getSelectedNode();center=node.worldTransform.transformPoint(node.getWidth()/2,node.getHeight()/2);tnode=new _gliffy.Node();tnode.setWidth(node.getWidth());tnode.setHeight(value);tnode.setX(node.getX());tnode.setY(node.getY());tnode.setRotation(node.getRotation());tnode.setScaleX(node.getScaleX());tnode.setScaleY(node.getScaleY());tnode.update();center2=tnode.worldTransform.transformPoint(tnode.getWidth()/2,tnode.getHeight()/2);this.overlay.setTransX(tnode.getX()+(center.x-center2.x));this.overlay.setTransY(tnode.getY()+(center.y-center2.y));this.overlay.setScaleY(value);this.overlay.__redrawModel=true;this.overlay.__popCommandBundle=true}},updateOverlayRotation:function(value){if(this.overlay.isActive()){this.overlay.setRotation(value);this.overlay.__redrawModel=true;this.overlay.__popCommandBundle=true}}})}());(function(){var INHERIT="inherit",CURSOR_DATA="__cursor";_gliffy._CursorManager=_gliffy.Class.extend({__container:null,init:function(options){options=options||{};if(!options.container){throw new Error("The options must contain a container.")}this.__container=$(options.container)},setCursor:function(name,element){var jqElement=element?$(element):this.__container;this.clearCursor(element);if(name!==null){if(typeof(name)!=="string"){name=this.getCursorName(name)}if(name!==null){this.__setCursorName(name,jqElement);name=this.getCursorClass(name);jqElement.addClass(name)}}},clearCursor:function(element){var jqElement=element?$(element):this.__container,name=this.getCursorName(jqElement);if(name){this.__clearCursorName(jqElement);name=this.getCursorClass(name);jqElement.removeClass(name);if(!element){jqElement.removeClass(this.getCursorClass(INHERIT))}}},pushCursor:function(name,element){var jqElement=element?$(element):this.__container;if(name!==null){if(typeof(name)!=="string"){name=this.getCursorName(name)}if(name!==null){this.__removeCurrentCursor(jqElement);this.__pushCursorName(name,jqElement);name=this.getCursorClass(name);jqElement.addClass(name);if(!element){jqElement.addClass(this.getCursorClass(INHERIT))}}}},popCursor:function(element){var jqElement=element?$(element):this.__container,name,data;name=this.__popCursorName(jqElement);if(name){name=this.getCursorClass(name);jqElement.removeClass(name);name=this.getCursorName(jqElement);if(name!==null){jqElement.addClass(this.getCursorClass(name))}data=jqElement.data(CURSOR_DATA);if(data===null||data.length<=1){jqElement.removeClass(this.getCursorClass(INHERIT))}}},getCursorName:function(element){var jqElement=element?$(element):this.__container,name=jqElement.data(CURSOR_DATA)||null;return name?name[name.length-1]:null},getCursorClass:function(name){return"gliffy-cursor-"+name},__removeCurrentCursor:function(jqElement){var name=this.getCursorName(jqElement);if(name){jqElement.removeClass(this.getCursorClass(name))}},__clearCursorName:function(jqElement){jqElement.data(CURSOR_DATA,null)},__setCursorName:function(name,jqElement){jqElement.data(CURSOR_DATA,[name])},__pushCursorName:function(name,jqElement){var names=jqElement.data(CURSOR_DATA)||null;if(names===null){names=[];jqElement.data(CURSOR_DATA,names)}names.push(name)},__popCursorName:function(jqElement){var names=jqElement.data(CURSOR_DATA)||null;if(names===null){return null}else{return names.pop()||null}}})}());(function(){_gliffy.DraftManager=_gliffy.Class.extend({_draftsEnabled:null,_editor:null,_enabled:null,_interval:null,_draftNoticeTemplate:null,_draftStatusTemplate:null,_draftDiffTemplate:null,_i18nStrings:null,_showingDraftNotice:false,createI18nStrings:function(indices){var obj={},i;for(i=0;i<indices.length;i++){obj["i18n_"+indices[i]]=$.i18n._(indices[i])}return obj},init:function(o){var self=this,options=$.extend({editor:null},o);this._editor=options.editor;this._interval=options.editor.draftInterval;this._draftsEnabled=options.editor.draftsEnabled;this._i18nStrings=this.createI18nStrings(["DRAFT_LOAD_DRAFT","DRAFT_YOU_HAVE_A_DRAFT_FROM","DRAFT_DRAFT_SAVED_AT","DRAFT_DISCARD_DRAFT","DRAFT_DRAFT_PREVIEW","DRAFT_WHAT_DO_YOU_WANT_TO_DO","DRAFT_PREVIEW_DRAFT"]);$(function(){if(self.draftsEnabled()){$("body").on("click","#gliffyViewDraftDiff",function(event){event.preventDefault();var notice=$("#gliffy-draft-notice");self.showDraftDiff(notice.data("draft"))});$("body").on("click","#gliffyLoadDraft",function(event){event.preventDefault();var notice=$("#gliffy-draft-notice");self.getDraft(notice.data("draft"),function(gon){self.loadDraft(gon)});notice.alert("close")});$("body").on("click","#gliffyDiscardDraft",function(event){event.preventDefault();var notice=$("#gliffy-draft-notice");self.deleteDraft();notice.alert("close")})}})},draftsEnabled:function(){return this._draftsEnabled},getDocument:function(){return this._editor.getDocumentManager().getActiveDocument()},removeDraftState:function(document){document.draftState=null},getDraftState:function(document){if(!document.draftState){document.draftState={firstCheck:true,commandLength:document.getStage().commandHistory.getSize(),noticeDraft:null,saveDraft:null}}return document.draftState},isActive:function(){return this._enabled===true},enable:function(){var self=this,state;this.disable();if(this._enabled===false&&this.draftsEnabled()&&this._interval>=5){this._enabled=true;state=this.getDraftState(this.getDocument());if(state.firstCheck){state.firstCheck=false;self.checkDraft()}if(state.noticeDraft){this.displayAutosaveDraftNotice(state.noticeDraft)}else{if(state.saveDraft){this.displayDraftStatus(state.saveDraft)}this.enableSaveDraftLoop()}}return this},disable:function(){this._enabled=false;this.hideNotifications();clearTimeout(this.timeout);return this},waitAndEnableSaveDraftLoop:function(){var self=this;clearTimeout(this.timeout);this.timeout=setTimeout(function(){self.enableSaveDraftLoop()},this._interval*1000)},enableSaveDraftLoop:function(){var self=this,document=this.getDocument(),state=this.getDraftState(document),stage=document.getStage();clearTimeout(this.timeout);if(this.draftsEnabled()&&this._enabled&&document&&stage.hasUnsavedChanges()&&!this._editor.isSaving()&&stage.objects.length>0&&!this._showingDraftNotice&&((state.commandLength!==stage.commandHistory.getSize())||$("#gliffy-edit-text_ifr:visible").length>0)){this.saveDraft()}else{this.timeout=setTimeout(function(){self.enableSaveDraftLoop()},self._interval*1000)}},sanitizeDocument:function(document){var stage=new _gliffy.Stage(),i,node,activeTextNode,textNode,textContent,isMultipart;stage.fromObject(document.gon.stage,{subscribeToConstraints:false});stage.update();activeTextNode=$("#gliffy-edit-text_ifr:visible").data("node");if(activeTextNode){textNode=stage.find(activeTextNode.getId());isMultipart=textNode.getUidNode().isMultipartShape();textContent.find(".gliffy-placeholder-text").removeClass("gliffy-placeholder-text");if(_gliffy.Utils.hasNonWhitespaceCharacter(textContent.text())||isMultipart){textNode.getGraphic().setHTML(textContent.html())}else{if(!isMultipart){stage.removeNode(textNode)}}}for(i=0;i<stage.objects.length;i++){node=stage.objects[i];if(node.isSelection()){stage.detachSelectionFromGroup(node);stage.removeNode(node)}}stage.update();document.gon.stage=stage.toObject();return document},saveDraft:function(){var self=this,document=this.getDocument(),state=this.getDraftState(document);this._editor.integration.saveDraft(this.sanitizeDocument(document.toObject()),function(draft){state.noticeDraft=null;state.saveDraft=draft;state.commandLength=document.getStage().commandHistory.getSize();self.displayDraftStatus(draft);self.waitAndEnableSaveDraftLoop()},function(){_gliffy.Logger.error("Failed to saveDraft:"+document.getTitle());self.waitAndEnableSaveDraftLoop()})},getDraft:function(draft,callback){this._editor.integration.getDraft(draft.location,function(gon){callback(gon)},function(){callback(null)})},loadDraft:function(gon){var self=this,document=this.getDocument(),state=this.getDraftState(document),docObj;if(gon){this.disable();state.noticeDraft=null;state.saveDraft=null;docObj=document.toObject();docObj.gon=gon;self._editor.open({jsonObj:docObj,checkForDrafts:false,callback:function(){self._editor.getDocumentManager().getActiveStage().setUnsavedChanges(true);state.commandLength=document.getStage().commandHistory.getSize();self.enable();self._showingDraftNotice=false}})}else{self.enable();_gliffy.Logger.error("No draft to load.")}},checkDraft:function(){var self=this,document=this.getDocument(),state=this.getDraftState(document);this._editor.integration.checkDraft(document.toObject(),function(draftArray){if(draftArray&&draftArray.length>0){state.noticeDraft=draftArray[0];self.displayAutosaveDraftNotice(draftArray[0])}else{self.enableSaveDraftLoop()}},function(data){self.waitAndEnableSaveDraftLoop();_gliffy.Logger.error("Failed to check for draft for document:"+document.getTitle())})},deleteDraft:function(){var self=this,document=this.getDocument(),state=this.getDraftState(document);self.hideNotifications();this._showingDraftNotice=false;self._editor.integration.deleteDraft(document.toObject(),function(){state.noticeDraft=null;state.saveDraft=null;self.enableSaveDraftLoop()},function(){self.waitAndEnableSaveDraftLoop();_gliffy.Logger.error("Failed to delete draft for document:"+document.getTitle())})},displayAutosaveDraftNotice:function(draft){if(!this._draftNoticeTemplate){this._draftNoticeTemplate=$("#gliffy-draft-notice-template").html()}var html=Mustache.render(this._draftNoticeTemplate,$.extend({date:draft.friendlyDate},this._i18nStrings));$(html).appendTo("body").data({draft:draft}).alert();this._showingDraftNotice=true},displayDraftStatus:function(draft){if(!this._draftStatusTemplate){this._draftStatusTemplate=$("#gliffy-draft-status-template").html()}var html=Mustache.render(this._draftStatusTemplate,$.extend({date:new Date(draft.createDate).toString("HH:mm:ss")},this._i18nStrings));$("#gliffy-draft-status").remove();$(html).appendTo(".gliffy-toolbar");$("body").trigger("gliffy.display-draft-status")},showDraftDiff:function(draft){if(!this._draftDiffTemplate){this._draftDiffTemplate=$("#gliffy-draft-diff-template").html()}var html,self=this;$("#gliffy-draft-diff").remove();this.getDraft(draft,function(gon){self._editor.getDocumentManager().getPreviewImageFromGon(gon,function(imageData){var bar=GliffyApp.progressBarController.getBar(),barQueueLength=bar.queue().length;bar.delay(500).queue(function(next){html=Mustache.render(self._draftDiffTemplate,$.extend({img:imageData},self._i18nStrings));GliffyApp.progressBarController.hide();$(html).appendTo("body").modal("show");next()});if(barQueueLength===0){bar.dequeue()}})})},hideNotifications:function(){$("#gliffy-draft-notice,#gliffy-draft-status,#gliffy-draft-diff").remove()}})}());(function(){var _alignments={align:{left:function(boundingBox,node){var pos=node.getWorldPosition();return{x:boundingBox.min.x+node.getBoundsOffset().x,y:pos.y}},center:function(boundingBox,node){var pos=node.getWorldPosition();return{x:boundingBox.getCenter().x+node.getBoundsOffset().x-node.worldAabb.getWidth()/2,y:pos.y}},right:function(boundingBox,node){var pos=node.getWorldPosition();return{x:boundingBox.max.x+node.getBoundsOffset().x-node.worldAabb.getWidth(),y:pos.y}},top:function(boundingBox,node){var pos=node.getWorldPosition();return{x:pos.x,y:boundingBox.min.y+node.getBoundsOffset().y}},middle:function(boundingBox,node){var pos=node.getWorldPosition();return{x:pos.x,y:boundingBox.getCenter().y+node.getBoundsOffset().y-node.worldAabb.getHeight()/2}},bottom:function(boundingBox,node){var pos=node.getWorldPosition();return{x:pos.x,y:boundingBox.max.y+node.getBoundsOffset().y-node.worldAabb.getHeight()}}},distribute:{horizontal:function(boundingBox,node,numNodes,index){var pos=node.getWorldPosition();return{x:(numNodes-1>0)?boundingBox.min.x+boundingBox.getWidth()*index/(numNodes-1)+node.getBoundsOffset().x-node.worldAabb.getWidth()/2:pos.x,y:pos.y}},vertical:function(boundingBox,node,numNodes,index){var pos=node.getWorldPosition();return{x:pos.x,y:(numNodes-1>0)?boundingBox.min.y+boundingBox.getHeight()*index/(numNodes-1)+node.getBoundsOffset().y-node.worldAabb.getHeight()/2:pos.y}}}};_gliffy._Align=_gliffy.Class.extend({_documentManager:null,init:function(options){if(!options||!options.documentManager){throw new Error("The Align Instance needs a documentManager in the options.")}this._documentManager=options.documentManager},align:function(type,nodes){this._transform(type,nodes,false)},distribute:function(type,nodes){this._transform(type,nodes,true)},_sortNodes:function(type,nodes){var getEdge={horizontal:function(bb){return bb.getCenter().x},vertical:function(bb){return bb.getCenter().y}};nodes.sort(function(a,b){return getEdge[type](a.worldAabb)>getEdge[type](b.worldAabb)});return nodes},_dumpUnalignable:function(nodes){var i,ret=[];for(i=0;i<nodes.length;i++){if(this._isAlignable(nodes[i])){ret.push(nodes[i])}}return ret},_transform:function(type,nodes,isDistribute){var i,pos,node,boundingBox=_gliffy.BoundingBox.SMALLEST.clone(),parentOffset,centers,i;if(nodes.length>0){this._documentManager.pushCommandBundle();nodes=this._dumpUnalignable(nodes);if(isDistribute){nodes=this._sortNodes(type,nodes);centers=[];for(i=0;i<nodes.length;i++){centers.push(nodes[i].worldAabb.getCenter())}boundingBox.fitPoints(centers)}else{for(i=0;i<nodes.length;i++){boundingBox.add(nodes[i].worldAabb)}}for(i=0;i<nodes.length;i++){node=nodes[i];pos=_alignments[(isDistribute?"distribute":"align")][type](boundingBox,node,nodes.length,i);if(node.parent){parentOffset=node.parent.getWorldPosition()}else{parentOffset={x:0,y:0}}this._documentManager.addAndExecuteCommand(new _gliffy.MoveNodeCommand({node:node,x:pos.x-parentOffset.x,y:pos.y-parentOffset.y}))}this._documentManager.redraw();this._documentManager.popCommandBundle()}},_isAlignable:function(node){return !node.getLockPosition()}})}());(function(){_gliffy.MoveThreshold=_gliffy.Class.extend({__x:0,__y:0,__above:false,__distanceThreshold:3,init:function(distanceThreshold){if(distanceThreshold){this.__distanceThreshold=distanceThreshold}},setDistanceThreshold:function(distanceThreshold){this.__distanceThreshold=distanceThreshold},reset:function(event){this.__x=event.pageX;this.__y=event.pageY;this.__above=false},above:function(event){var x,y;if(this.__above||!event){return this.__above}x=event.pageX-this.__x;y=event.pageY-this.__y;this.__above=x*x+y*y>=this.__distanceThreshold*this.__distanceThreshold;return this.__above},setAbove:function(value){this.__above=value}})}());(function(){_gliffy.StageDiv=_gliffy.Class.extend({__points:null,__boundingBox:null,__redraw:false,__display:null,__className:null,init:function(options){var self=this;if(!options||!options.documentManager){throw new Error("StageDiv init does not have valid options. A documentManager is required.")}this.__boundingBox=new _gliffy.BoundingBox();this.__points=[null,null];this.__className=options.className;this.__documentManager=options.documentManager;if(options.container){this.setContainer(options.container)}_gliffy.RenderLoop.appendTask(function(){if(self.__redraw&&this.__display!==null){self.__deferredDraw()}self.__redraw=false})},isVisible:function(){return this.__display.css("display")!=="none"},setClassName:function(className){if(this.__display&&this.__className){this.__display.removeClass(this.__className)}this.__className=className;if(this.isVisible()){this.draw()}},setContainer:function(container){this.__display=$("<div></div>");this.__display.css({display:"none"});container.append(this.__display)},getDiv:function(){return this.__display},isScreenDiagonalLessThan:function(value){value/=this.__documentManager.getZoom();return _gliffy.Vec2.squaredDistance(this.__points[0],this.__points[1])<value*value},setStartCorner:function(point){this.__points[0]=point;if(this.__points[1]===null){this.__points[1]=point}if(this.isVisible()){this.draw()}},setEndCorner:function(point){this.__points[1]=point;if(this.__points[0]===null){this.__points[0]=point}if(this.isVisible()){this.draw()}},getStartCorner:function(){return this.__points[0]},getEndCorner:function(){return this.__points[1]},getBoundingBox:function(){return this.__boundingBox},draw:function(){if(this.__points[0]!==null&&this.__points[1]!==null){this.__boundingBox.fitPoints(this.__points);this.__redraw=true}},hide:function(){this.__display.css({display:"none"});this.__redraw=false},drawBox:function(boundingBox){this.__boundingBox.copy(boundingBox);this.__redraw=true},__deferredDraw:function(){var css=_gliffy.Utils.boundingBoxToCss(this.__boundingBox,this.__documentManager.getZoom());css.display="block";this.__display.addClass(this.__className);this.__display.css(css)}})}());(function(){var RESIZE_CURSORS=["nw-resize","n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize"],CLOCKWISE_CONTROL_POINTS=[0,1,2,5,8,7,6,3],ROTATION_CONTROL_OFFSET=25,ROTATION_HANDLE_SIZE=8,PADDING=2;_gliffy.Overlay=_gliffy.Class.extend({__overlayContainer:null,__overlayControl:null,__overlayControlLane:null,__rotateControl:null,__rotateHandle:null,__overlayOutline:null,__overlayedNode:null,__container:null,__manager:null,__MIN_DIMENSIONS:{x:15,y:15},__snapPixels:10,__lockAspectRatio:false,__rotation:0,__scaleX:1,__scaleY:1,__requestedScaleX:1,__requestedScaleY:1,__transX:0,__transY:0,__laneCommand:null,__overlayCoords:null,__active:false,__eventsRegistered:false,__textControl:null,__dragOffset:new _gliffy.Vec2(0,0),__documentManager:null,__redraw:false,__redrawHud:false,__redrawModel:false,__popCommandBundle:false,__modifyLines:null,__contextMenu:null,__guides:[],isDragging:false,init:function(o){var self=this,i,j,idx=0,oc,x,y;if(!o){throw new Error("overlay init needs options")}if(!o.documentManager){throw new Error("overlay init options needs documentManager")}if(!o.textControl){throw new Error("overlay init options needs textControl")}if(!o.manager){throw new Error("overlay init options needs manager")}this.__manager=o.manager;this.__documentManager=o.documentManager;this.__textControl=o.textControl;this.__overlayContainer=$('<div id="gliffy-overlay" />');this.__overlayContainer.css("display","none");this.__overlayOutline=$('<div class="gliffy-overlay-outline"/>');if($.browser.msie){this.__overlayOutline.css("background-color","rgba(255,255,255,0)")}_gliffy.CursorManager.setCursor("move",this.__overlayOutline);this.__overlayContainer.append(this.__overlayOutline);this.__overlayControl=[];for(i=0;i<9;i++){this.__overlayControl[i]=$('<div class="gliffy-overlay-control"/>');this.__overlayOutline.append(this.__overlayControl[i])}this.__overlayControlLane=[];for(i=0;i<11;i++){this.__overlayControlLane[i]=$("<div/>",{"class":"gliffy-overlay-control-lane lane-"+i});this.__overlayOutline.append(this.__overlayControlLane[i])}this.__rotateControl=$('<div class="gliffy-overlay-rotate gliffy-icon-overlay-rotate" />');_gliffy.CursorManager.setCursor("rotate",this.__rotateControl);this.__overlayOutline.append(this.__rotateControl);this.__rotateHandle=$('<div class="gliffy-overlay-rotate-handle" />');this.__overlayOutline.append(this.__rotateHandle);this.__hud=$('<div id="gliffy-hud"></div>');this.__overlayContainer.append(this.__hud);GliffyApp.contextMenuController.createContextMenu(this,this.__overlayContainer,this.getContextMenuDefinition(),"gliffy-context-menu-overlay");for(j=0;j<3;j++){for(i=0;i<3;i++){oc=this.__overlayControl[idx];x=i*0.5;y=j*0.5;oc.css({top:(y*100)+"%",left:(x*100)+"%"});oc.data("overlayCoords",{x:x,y:y});idx++}}this.__rotateControl.data("overlayCoords",{x:0.5,y:1.5});this.__overlayOutline.data("overlayCoords",{x:0.5,y:0.5});this.__rotateControl.css({top:"-"+ROTATION_CONTROL_OFFSET+"px",left:"50%"});this.__overlayControl[4].addClass("gliffy-overlay-control-center");this.__snapPixels=_gliffy.Utils.SNAP_PIXELS;_gliffy.RenderLoop.appendTask(function(){if(self.__redraw){self.__deferredDrawOverlay()}self.__redraw=false});this.__setupControlDragManager();if(_gliffy.BrowserDetect.browser==="Explorer"){this.__rotateHandle.css("z-index",10000)}},__compileGuides:function(nodeArray,guides){var node,i,guideData,j;for(i=0;i<nodeArray.length;i++){node=nodeArray[i];if(node!==this.getSelectedNode()){if(node.isGuideNode()){node.hideGuides();guideData=node.getGuideData();for(j=0;j<3;j++){guides.x.push({node:node,pos:guideData.x[j],which:j});guides.y.push({node:node,pos:guideData.y[j],which:j})}}else{if(node.isGroup()&&node.children!==null&&node.children.length>0){this.__compileGuides(node.children,guides)}}}}},cacheGuideNodes:function(){var bounds,nodesInView,i,j,compare,xOrY,prev,guides;if(GliffyApp.documentModel.drawingGuides){bounds=this.__documentManager.getActiveStageViewPort();nodesInView=_gliffy.Pick.pickAllNodesInside(this.__documentManager.getActiveStage().objects,bounds);guides={x:[],y:[]};this.__guides={x:[],y:[]};this.__compileGuides(nodesInView,guides);compare=function(a,b){if(a.pos<b.pos){return -1}if(a.pos>b.pos){return 1}return 0};for(i=0;i<2;i++){xOrY=i===0?"x":"y";guides[xOrY].sort(compare);prev=-10000;for(j=0;j<guides[xOrY].length;j++){if(guides[xOrY][j].pos!==prev){this.__guides[xOrY].push(guides[xOrY][j])}prev=guides[xOrY].pos}}}},hideActiveGuides:function(){var i,j,xOrY,node;if(this.__guides){for(i=0;i<2;i++){xOrY=i===0?"x":"y";if(this.__guides[xOrY]!==undefined&&this.__guides[xOrY]!==null){for(j=0;j<this.__guides[xOrY].length;j++){node=this.__guides[xOrY][j].node;if(node){node.hideGuides()}}}}this.__documentManager.redraw()}},__setupControlDragManager:function(){var self=this,$this,minDragSize;_gliffy.Mouse.registerClickState({name:"overlay",modes:["shape-rotate","shape-resize","shape-overlay","lane-resize"],target:".gliffy-overlay-control,.gliffy-overlay-rotate,.gliffy-overlay-outline,.gliffy-overlay-control-lane",mouseDown:function(event){var pos=_gliffy.Mouse.getPosition(),selectedNode,overlayedNode;event.stopPropagation();_gliffy.Mouse.setClickMode("overlay");$this=$(event.currentTarget);overlayedNode=self.getSelectedNode();if($this.hasClass("gliffy-overlay-rotate")){_gliffy.Mouse.setState("shape-rotate")}else{if($this.hasClass("gliffy-overlay-control")&&!($this.hasClass("gliffy-overlay-control-center"))){_gliffy.Mouse.setState("shape-resize")}else{if($this.hasClass("gliffy-overlay-control-lane")){_gliffy.Mouse.setState("lane-resize")}else{if(overlayedNode&&self.__lastTarget===overlayedNode.getId()){self.__lastTarget=null;self.makeTextEditable();return}else{_gliffy.Mouse.setState("shape-overlay");self.__setLastTarget()}}}}_gliffy.Mouse.__mousedown(event)}});_gliffy.Mouse.registerDragState([{modes:["shape-rotate"],dragStart:function(event){_gliffy.Mouse.setCursor("rotate");self.__documentManager.pushCommandBundle();self.__storeState();GliffyApp.contextualPropertiesController.hideControls();GliffyApp.hudController.show(GliffyApp.hudController.HUD_MODE.rot);$this=$(event.currentTarget);$this.data("overlaySpace",self.__getOverlaySpace());$this.data("initRotation",self.__rotation)},drag:function(event){var x,y,angle,deg,pos,nodeCenter;pos=_gliffy.Mouse.getPosition();nodeCenter=self.getSelectedNode().getCenterPosition();x=pos.x;y=pos.y;x-=nodeCenter.x;y-=nodeCenter.y;angle=Math.atan2(y,x)+Math.PI/2;deg=_gliffy.Utils.radiansToDegrees(angle);if(event&&!event.shiftKey){deg=deg+7.5-_gliffy.Utils.posMod(deg+7.5,15)}self.__rotation=_gliffy.Utils.degreesToRadians(deg);self.__drawOverlay();self.__updateHud()},dragEnd:function(event){GliffyApp.hudController.hide();GliffyApp.contextualPropertiesController.showControls(self);self.__applyState();self.__documentManager.popCommandBundle()}},{modes:["shape-resize"],dragStart:function(event){var selected,i,child;self.__documentManager.pushCommandBundle();self.__storeState();GliffyApp.contextualPropertiesController.hideControls();GliffyApp.hudController.show(GliffyApp.hudController.HUD_MODE.size);self.__dragOffset=_gliffy.Vec2.difference(_gliffy.Mouse.getPosition(),self.getSelectedNode().getPosition());if(!self.getSelectedNode().getLockPosition()){_gliffy.Mouse.setCursor(_gliffy.CursorManager.getCursorName($this))}self.__overlayCoords=$this.data("overlayCoords");self.cacheGuideNodes();minDragSize={x:self.__MIN_DIMENSIONS.x,y:self.__MIN_DIMENSIONS.y};selected=self.getSelectedNode();if((selected.isGroup()||selected.isSelection())&&self.__documentManager.getActiveStage().objects.length>1){for(i=0;i<selected.children.length;i++){child=selected.children[i];if(!(child.getGraphic() instanceof _gliffy.Text)){if(child.getWidth()>0&&child.getHeight()>0){minDragSize.x=Math.max(minDragSize.x,self.__MIN_DIMENSIONS.x/child.getWidth()*selected.getWidth());minDragSize.y=Math.max(minDragSize.y,self.__MIN_DIMENSIONS.y/child.getHeight()*selected.getHeight())}}}}},drag:function(event){var pos,delta,rotationMatrix,rotated,sx,sy;if(self.__active&&!self.getSelectedNode().getLockPosition()){self.__overlayCoords=$this.data("overlayCoords");pos=_gliffy.Vec2.difference(_gliffy.Mouse.getPosition(),self.__dragOffset);delta=_gliffy.Mouse.getDelta();if(self.__overlayCoords.x===0.5&&self.__overlayCoords.y===0.5){self.setTrans(pos.x,pos.y,true)}else{rotationMatrix=_gliffy.AffineTransform.getRotateInstance(-self.__rotation,0,0);rotated=rotationMatrix.transformPoint(delta.x,delta.y);sx=0;sy=0;if(self.__overlayCoords.x<0.5){sx=-rotated.x}else{if(self.__overlayCoords.x>0.5){sx=rotated.x}}if(self.__overlayCoords.y<0.5){sy=-rotated.y}else{if(self.__overlayCoords.y>0.5){sy=rotated.y}}self.__doScale(sx,sy,1-self.__overlayCoords.x,1-self.__overlayCoords.y,minDragSize.x,minDragSize.y)}self.isDragging=true;self.__drawOverlay();self.__updateHud()}},dragEnd:function(event){var selectedNode=self.getSelectedNode(),swimlanes,children,isGroup,images,i;this.__overlayCoords=null;GliffyApp.hudController.hide();self.isDragging=false;GliffyApp.contextualPropertiesController.showControls(self);self.__applyState();images=selectedNode.findGraphic(_gliffy.Image);for(i=0;i<images.length;i++){images[i].setFlag("skin");images[i].markDirty()}if(selectedNode.isSelection()||selectedNode.isGroup()){children=selectedNode.children;isGroup=selectedNode.isGroup();if(selectedNode.immediateChildrenHaveMixedRotation()){children=children.slice();if(isGroup){self.__manager.ungroupifyGroup()}self.__manager.deselectAll();self.__manager.selectNodes(children);if(isGroup){self.__manager.groupifySelection()}GliffyApp.contextualPropertiesController.showControls(self)}swimlanes=selectedNode.findUidFunction(function(uid){return uid&&uid.indexOf("com.gliffy.shape.swimlanes")===0});self.__documentManager.addAndExecuteCommand(new _gliffy.CleanSwimlanePositions({nodes:swimlanes}));self.__documentManager.redraw()}self.__documentManager.popCommandBundle();self.hideActiveGuides()},autoPan:true},{modes:["shape-overlay"],dragStart:function(event){self.cacheGuideNodes();self.__documentManager.pushCommandBundle();self.__dragOffset=_gliffy.Vec2.difference(_gliffy.Mouse.getPosition(),self.getSelectedNode().getPosition());if(!self.getLockPosition()){_gliffy.Mouse.setCursor("move");self.hideControls();GliffyApp.contextualPropertiesController.hideControls();GliffyApp.hudController.show(GliffyApp.hudController.HUD_MODE.pos)}},drag:function(event){if(!self.getLockPosition()){self.__outlineDrag();GliffyApp.hudController.show(GliffyApp.hudController.HUD_MODE.pos);self.isDragging=true}},dragEnd:function(event,didDrag,beginInitialDrag){self.isDragging=false;var pos,lastSelectedNode,selectedNode,selectedNode2,selectedNodeLength,selectList=[],i,objects;self.hideActiveGuides();GliffyApp.hudController.hide();self.__documentManager.popCommandBundle();lastSelectedNode=self.getSelectedNode();pos=_gliffy.Mouse.getPosition();if(lastSelectedNode&&lastSelectedNode.isSelection()){selectedNode=_gliffy.Pick.getNodeAt(lastSelectedNode.flattenChildren(),pos.x,pos.y);objects=[].concat(self.__documentManager.getActiveStage().objects);objects=$.grep(objects,function(item){return item.getId()!==lastSelectedNode.getId()});selectedNode2=_gliffy.Pick.getNodeAt(objects,pos.x,pos.y);if(!selectedNode||(selectedNode2&&selectedNode.getOrder()<selectedNode2.getOrder())){selectedNode=selectedNode2}}else{selectedNode=_gliffy.Pick.getNodeAt(self.__documentManager.getActiveStage().objects,pos.x,pos.y)}if(!didDrag&&lastSelectedNode&&lastSelectedNode.isSwimlane()&&lastSelectedNode!==selectedNode){self.__manager.deselectAll();if(selectedNode){self.__manager.selectNode(selectedNode);GliffyApp.contextualPropertiesController.showControls(self)}}else{if(!didDrag&&lastSelectedNode&&lastSelectedNode.isSelection()&&(_gliffy.KeyManager.shiftKeyDown||_gliffy.KeyManager.metaCtrlKeyDown)&&selectedNode&&!beginInitialDrag){if(selectedNode){selectedNodeLength=lastSelectedNode.children?lastSelectedNode.children.length:0;for(i=0;i<selectedNodeLength;i++){if(lastSelectedNode.children[i].getId()!==selectedNode.getId()){selectList.push(lastSelectedNode.children[i])}}if(selectList.length===lastSelectedNode.children.length){selectList.push(selectedNode)}self.__manager.deselectAll();self.__manager.selectNodes(selectList);GliffyApp.contextualPropertiesController.showControls(self)}}else{if(!didDrag&&lastSelectedNode&&lastSelectedNode.isSelection()&&!(_gliffy.KeyManager.shiftKeyDown||_gliffy.KeyManager.metaCtrlKeyDown)){self.__manager.deselectAll();if(selectedNode){self.__manager.selectNode(selectedNode);self.showControls();GliffyApp.contextualPropertiesController.showControls(self)}}else{if(!didDrag&&lastSelectedNode&&lastSelectedNode.isGroup()){if(!(_gliffy.KeyManager.shiftKeyDown||_gliffy.KeyManager.metaCtrlKeyDown)){if(selectedNode&&selectedNode.closestGroup()!==lastSelectedNode){self.__manager.selectNode(selectedNode)}else{if(!selectedNode){self.__manager.deselectAll()}}}else{if(selectedNode&&selectedNode.getId()!==lastSelectedNode.getId()){self.__manager.deselectAll();self.__manager.selectNodes([lastSelectedNode,selectedNode])}}self.showControls();GliffyApp.contextualPropertiesController.showControls(self)}else{if(!didDrag&&lastSelectedNode&&selectedNode&&!lastSelectedNode.isSelection()){self.__manager.selectNode(selectedNode);self.showControls();GliffyApp.contextualPropertiesController.showControls(self)}else{self.showControls();GliffyApp.contextualPropertiesController.showControls(self)}}}}}},autoPan:true},{modes:["lane-resize"],dragStart:function(event){self.__documentManager.pushCommandBundle()},drag:function(event){var stage=self.__documentManager.getActiveStage(),data=$this.data("lane");self.__laneCommand=new _gliffy.UpdateLaneCommand({selectedNode:self.getSelectedNode(),node:stage.find(data.nodeId),sibling:stage.find(data.sibling),nextSibling:stage.find(data.nextSibling),mousePosition:_gliffy.Mouse.getPosition()});self.__drawOverlay()},dragEnd:function(event){self.__documentManager.popCommandBundle()}}])},__setLastTarget:function(){var self=this;this.__lastTarget=this.getSelectedNode().getId();setTimeout(function(){self.__lastTarget=null},this.__manager.__DOUBLE_CLICK_TIMEOUT)},detach:function(){this.__overlayContainer.detach()},__outlineDrag:function(){if(!this.__active||this.getSelectedNode().getLockPosition()){return}var pos=_gliffy.Vec2.difference(_gliffy.Mouse.getPosition(),this.__dragOffset);this.setTrans(pos.x,pos.y,true)},getLaneCommand:function(){return this.__laneCommand},getTransX:function(){return this.__transX},setTransX:function(transX){this.__transX=transX;this.__drawOverlay();this.__redrawModel=true},getTransY:function(){return this.__transY},setTransY:function(transY){this.__transY=transY;this.__drawOverlay()},__applyDrawingGuidesForTrans:function(x,y){var self=this,myGuideCoords=this.getSelectedNode().getGuideData(),originalCoords=$.extend(true,{},myGuideCoords),i,j,k,l,xOrY,inputCoord,floatLessThan,floatEqual,closest,myGuideIdx,minDistance,stageGuide,myPos,stagePos,dist,trans,hasSetTrans;floatLessThan=function(a,b){return(a-b)<-0.0001};floatEqual=function(a,b){return Math.abs(a-b)<0.0001};for(i=0;i<2;i++){xOrY=i===0?"x":"y";inputCoord=i===0?x:y;for(j=0;j<3;j++){myGuideCoords[xOrY][j]=inputCoord-originalCoords[xOrY][0]+originalCoords[xOrY][j]}}closest={x:[],y:[]};myGuideIdx={x:[],y:[]};minDistance={x:10,y:10};this.getSelectedNode().hideGuides();for(i=0;i<2;i++){xOrY=i===0?"x":"y";if(self.__guides[xOrY]){for(j=0;j<self.__guides[xOrY].length;j++){stageGuide=self.__guides[xOrY][j];stageGuide.node.hideGuides();for(l=0;l<3;l++){k=(l+1)%3;myPos=myGuideCoords[xOrY][k];stagePos=stageGuide.pos;dist=Math.abs(myPos-stagePos);if(floatEqual(dist,minDistance[xOrY])){closest[xOrY].push(stageGuide);myGuideIdx[xOrY].push(k)}else{if(floatLessThan(dist,minDistance[xOrY])){minDistance[xOrY]=dist;closest[xOrY]=[stageGuide];myGuideIdx[xOrY]=[k]}}}}}}hasSetTrans={x:false,y:false};for(i=0;i<2;i++){xOrY=i===0?"x":"y";trans=i===0?"__transX":"__transY";inputCoord=i===0?x:y;self[trans]=inputCoord;for(j=0;j<closest[xOrY].length;j++){stageGuide=closest[xOrY][j];if(!hasSetTrans[xOrY]){self[trans]=stageGuide.pos+originalCoords[xOrY][0]-originalCoords[xOrY][myGuideIdx[xOrY][j]];hasSetTrans[xOrY]=true}if(floatEqual(self[trans],stageGuide.pos+originalCoords[xOrY][0]-originalCoords[xOrY][myGuideIdx[xOrY][j]])){stageGuide.node.showGuide(xOrY,stageGuide.which)}}}},__applyDrawingGuidesForScale:function(bb,anchor){var self=this,minDistance={x:10.01,y:10.01},closest={x:null,y:null},ret={x:null,y:null},inputCoords={x:null,y:null},xOrY,i,j,inputCoord,scaleName,transName,stageGuide,dist;for(i=0;i<2;i++){xOrY=i===0?"x":"y";if(anchor[xOrY]<0.49){inputCoords[xOrY]=bb.max[xOrY]}else{if(anchor[xOrY]>0.51){inputCoords[xOrY]=bb.min[xOrY]}}ret[xOrY]=inputCoords[xOrY];for(j=0;j<self.__guides[xOrY].length;j++){self.__guides[xOrY][j].node.hideGuides()}}for(i=0;i<2;i++){xOrY=i===0?"x":"y";inputCoord=inputCoords[xOrY];scaleName=i===0?"__scaleX":"__scaleY";transName=i===0?"__transX":"__transY";if(inputCoord!==null){for(j=0;j<self.__guides[xOrY].length;j++){stageGuide=self.__guides[xOrY][j];dist=Math.abs(inputCoord-stageGuide.pos);if(dist<minDistance[xOrY]){closest[xOrY]=stageGuide;minDistance[xOrY]=dist}}if(closest[xOrY]!==null){closest[xOrY].node.showGuide(xOrY,closest[xOrY].which);ret[xOrY]=closest[xOrY].pos}}if(ret[xOrY]!==null){if(anchor[xOrY]<0.49){self[scaleName]+=ret[xOrY]-bb.max[xOrY]}else{if(anchor[xOrY]>0.51){self[transName]+=ret[xOrY]-bb.min[xOrY];self[scaleName]-=(ret[xOrY]-bb.min[xOrY])}}}}},setTrans:function(x,y,bSnap){if(bSnap&&this.isSnapEnabled()){x=x-x%this.__snapPixels;y=y-y%this.__snapPixels}if(GliffyApp.documentModel.drawingGuides&&this.getSelectedNode()&&(_gliffy.Utils.floatEquals(this.getSelectedNode().getRotation(),0,0.0001)||_gliffy.Utils.floatEquals(this.getSelectedNode().getRotation(),180,0.0001))){if(_gliffy.Mouse.getVelocity()<1500){this.__applyDrawingGuidesForTrans(x,y)}else{this.__transX=x;this.__transY=y;$(".gliffy-drawing-guide").remove()}}else{this.__transX=x;this.__transY=y}this.__drawOverlay()},getScaleX:function(){return this.__scaleX},setScaleX:function(scaleX){if(this.getLockAspectRatio()){this.__requestedScaleY=this.__scaleY=(this.__scaleY*scaleX/this.__scaleX)}this.__requestedScaleX=this.__scaleX=scaleX;this.__drawOverlay()},getScaleY:function(){return this.__scaleY},setScaleY:function(scaleY){if(this.getLockAspectRatio()){this.__requestedScaleX=this.__scaleX=(this.__scaleX*scaleY/this.__scaleY)}this.__requestedScaleY=this.__scaleY=scaleY;this.__drawOverlay()},getRotation:function(){return this.__rotation},setRotation:function(rotation){this.__rotation=rotation;this.__drawOverlay()},__updateHud:function(){if(_gliffy.Debug.SKIP_RENDER_LOOP){GliffyApp.hudController.update()}else{this.__redrawHud=true}},__updateModel:function(){if(_gliffy.Debug.SKIP_RENDER_LOOP){GliffyApp.overlayModel.update(this)}else{this.__redrawModel=true}},beginInitialDrag:function(){var self=this,overlayedNode;overlayedNode=self.getSelectedNode();if(overlayedNode){this.__dragOffset=_gliffy.Vec2.difference(_gliffy.Mouse.getPosition(),this.getSelectedNode().getPosition());if(self.__lastTarget===overlayedNode.getId()){self.__lastTarget=null;self.makeTextEditable()}else{self.cacheGuideNodes();this.__setLastTarget();_gliffy.Mouse.beginInitialDrag("overlay","shape-overlay");if(!this.getLockPosition()){_gliffy.Mouse.lockDragUI("move");self.hideControls();GliffyApp.contextualPropertiesController.hideControls();GliffyApp.hudController.show(GliffyApp.hudController.HUD_MODE.pos)}}}},getOverlayBoundingBox:function(){var node=this.getSelectedNode(),boundingBox,rotateHandle,rotateHandleOffset,rotateControlOffset;node.update();boundingBox=node.worldAabb.clone();rotateHandleOffset=ROTATION_HANDLE_SIZE/this.getZoom();rotateControlOffset=-(ROTATION_CONTROL_OFFSET+ROTATION_HANDLE_SIZE)/this.getZoom();rotateHandle=node.worldTransform.transformPoint(node.getWidth()/2+rotateHandleOffset,rotateControlOffset);boundingBox.grow(rotateHandle.x,rotateHandle.y);rotateHandle=node.worldTransform.transformPoint(node.getWidth()/2-rotateHandleOffset,rotateControlOffset);boundingBox.grow(rotateHandle.x,rotateHandle.y);return boundingBox},initText:function(){var node,textChildren,j,self=this;node=self.getSelectedNode();if(node&&(node.isShape()||node.isImage()||node.isSvg())){textChildren=node.findGraphic(_gliffy.Text);for(j=1;j<textChildren.length;j++){new _gliffy.RemoveNodeCommand({node:textChildren[j]}).execute(this.__documentManager.getActiveStage())}if(textChildren.length===0){self.__setupTextGraphic(node);node.markDirty();self.__documentManager.redraw()}}},getTextControl:function(){return this.__textControl},__setupTextGraphic:function(parent){var node=new _gliffy.Node(),parentGraphic=parent.getGraphic(),textGraphic=new _gliffy.Text(),defaultText;defaultText=parentGraphic.node.getDefaultTextGraphic();if(defaultText){textGraphic.fromObject(defaultText.toObject())}else{this.__setupTextDefaults(parent,node,textGraphic)}node.setWidth(parent.getWidth()-PADDING*2);node.setHeight(parent.getHeight());node.setX(PADDING);node.setGraphic(textGraphic);node.setOrder("auto");node.setUid(null);this.__documentManager.addAndExecuteCommand(new _gliffy.AddNodeCommand({node:node,target:parent,prepend:true}));node.markDirty();return node},__setupTextDefaults:function(parent,node,text){var defaultTextStyle=null,themeType;if(parent.getShapeInformation()&&parent.getShapeInformation().defaults){if(parent.getShapeInformation().defaults.default_text_style){defaultTextStyle=parent.getShapeInformation().defaults.default_text_style}themeType=parent.getShapeInformation().defaults.themeType}text.setupDefaults(defaultTextStyle);text.setHTML(this.__documentManager.applyTextDefaults(text.getHTML(),themeType));node.setDefaultTextGraphic(text)},__editText:function(textNode,event){var self=this,textGraphic=textNode.getGraphic();self.__documentManager.redraw(function(){textGraphic.editable.setEditMode(true);textGraphic.editable.focus();if((event!==null&&event!==undefined)){textGraphic.editable.setKeyEvent(event)}else{textGraphic.editable.setCursorEnd()}self.__textControl.edit(textGraphic);textGraphic.editable.registerBlurHandler(function(){GliffyApp.contextualPropertiesController.blurRTE(self);textGraphic.editable.setEditMode(false);self.__documentManager.redraw()})})},__getFirstTextChild:function(node){var children=node.flattenChildren(),i;for(i=0;i<children.length;i++){if(children[i].isTextChild()){return children[i]}}return null},makeTextEditable:function(event){var self=this,node=self.getSelectedNode(),textChildren,position=_gliffy.Mouse.getPosition(),children,i,child,selectedChildren,j;if(node){if(node.isGroup()||node.isSelection()){children=node.flattenChildren();if(event){for(i=0;i<children.length;i++){if(children[i].isShape()||children[i].isMultipartShape()||children[i].isLine()||children[i].isImage()||children[i].isSvg()||children[i].isStandAloneText()){node=children[i];break}}}else{node=_gliffy.Pick.getNodeAt(node.flattenChildren(),position.x,position.y,true)}}if(node){if(node.isMultipartShape()){children=node.flattenChildren();if(!event){selectedChildren=_gliffy.Pick.pickAllNodesAt(children,position.x,position.y,0);child=null;if(selectedChildren.length>0){child=self.__getFirstTextChild(selectedChildren[0])}if(!child){child=_gliffy.Pick.pickFirstTextChildNode(children,position.x,position.y)}if(!child){child=self.__getFirstTextChild(node)}}else{child=self.__getFirstTextChild(node)}if(child){self.__editText(child,event)}}else{if(node.isLine()){self.__manager.lineOverlay.makeTextEditable(event,node)}else{if(node.isShape()||node.isImage()||node.isSvg()){textChildren=node.findGraphic(_gliffy.Text);for(j=1;j<textChildren.length;j++){new _gliffy.RemoveNodeCommand({node:textChildren[j]}).execute(this.__documentManager.getActiveStage())}if(textChildren.length===0){child=self.__setupTextGraphic(node)}else{child=textChildren[0]}self.__editText(child,event)}else{if(node.isStandAloneText()){self.__editText(node,event)}}}}GliffyApp.overlayModel.update(self);self.__manager.deselectAll();_gliffy.KeyManager.setState("rte");GliffyApp.contextualPropertiesController.showControls(this);self.hideActiveGuides()}}},__registerEvents:function(){var self=this;_gliffy.KeyManager.registerState("overlaySelected","default",[{action:"delete",keydown:function(e){e.stopImmediatePropagation();e.preventDefault();_gliffy.toolbarController.doDelete()}},{action:"cut",keydown:function(e){e.stopImmediatePropagation();e.preventDefault();_gliffy.toolbarController.doCut()}},{action:"copy",keydown:function(e){e.stopImmediatePropagation();e.preventDefault();_gliffy.toolbarController.doCopy()}},{action:"paste",keydown:function(e){e.stopImmediatePropagation();e.preventDefault();_gliffy.toolbarController.doPaste()}},{action:"nudgeLeft",keydown:function(ev){ev.stopImmediatePropagation();ev.preventDefault();self.__nudge(true,true);GliffyApp.contextualPropertiesController.hideControls(self)}},{action:"nudgeRight",keydown:function(ev){ev.stopImmediatePropagation();ev.preventDefault();self.__nudge(true,false);GliffyApp.contextualPropertiesController.hideControls(self)}},{action:"nudgeUp",keydown:function(ev){ev.stopImmediatePropagation();ev.preventDefault();self.__nudge(false,true);GliffyApp.contextualPropertiesController.hideControls(self)}},{action:"nudgeDown",keydown:function(ev){ev.stopImmediatePropagation();ev.preventDefault();self.__nudge(false,false);GliffyApp.contextualPropertiesController.hideControls(self)}},{action:"enterRTE",keydown:function(ev){ev.stopImmediatePropagation();ev.preventDefault();self.makeTextEditable()}},{action:"group",keydown:function(ev){ev.stopImmediatePropagation();ev.preventDefault();_gliffy.toolbarController.doGroup();return false},keypress:function(ev){return false},keyup:function(ev){return false}},{action:"ungroup",keydown:function(ev){ev.stopImmediatePropagation();ev.preventDefault();_gliffy.toolbarController.doUnGroup();return false},keypress:function(ev){return false},keyup:function(ev){return false}},{action:"sendFront",keydown:function(ev){ev.stopImmediatePropagation();ev.preventDefault();_gliffy.toolbarController.doBringToFront();return false},keypress:function(ev){return false},keyup:function(ev){return false}},{action:"sendBack",keydown:function(ev){ev.stopImmediatePropagation();ev.preventDefault();_gliffy.toolbarController.doSendToBack();return false},keypress:function(ev){return false},keyup:function(ev){return false}},{action:"jumpStageLeft",keydown:function(e){e.stopImmediatePropagation();e.preventDefault()}},{action:"jumpStageRight",keydown:function(e){e.stopImmediatePropagation();e.preventDefault()}},{action:"jumpStageUp",keydown:function(e){e.stopImmediatePropagation();e.preventDefault()}},{action:"jumpStageDown",keydown:function(e){e.stopImmediatePropagation();e.preventDefault()}},{keypress:function(ev){if(!_gliffy.KeyManager.isControlKey(ev)&&self.isActive()){ev.stopImmediatePropagation();self.makeTextEditable(ev)}}}]);this.__eventsRegistered=true},__nudge:function(xAxis,negative){var nudge,viewPort=this.__documentManager.getActiveStageViewPort(),viewportDimension,node=this.getSelectedNode();if(this.getLockPosition()){return}nudge=this.__getNudgeAmount();if(negative){nudge*=-1}if(xAxis){this.setTransX(this.getTransX()+nudge)}else{this.setTransY(this.getTransY()+nudge)}if(node){if(xAxis){if(viewPort.max.x<node.worldAabb.max.x+nudge*2||(negative&&viewPort.min.x>node.worldAabb.min.x+nudge*2)){viewportDimension=viewPort.getDimension();this.__documentManager.getActiveStage().offsetPan(-nudge,0,viewportDimension.x,viewportDimension.y)}}else{if(viewPort.max.y<node.worldAabb.max.y+nudge*2||(negative&&viewPort.min.y>node.worldAabb.min.y+nudge*2)){viewportDimension=viewPort.getDimension();this.__documentManager.getActiveStage().offsetPan(0,-nudge,viewportDimension.x,viewportDimension.y)}}}_gliffy.Mouse.updateOffset();this.__redrawModel=true},__getNudgeAmount:function(){return this.isSnapEnabled()?this.__snapPixels:1},setActive:function(active){this.__active=active;this.deselect()},isSnapEnabled:function(){return _gliffy.Utils.shouldSnapToGrid()},getLockAspectRatio:function(){return this.getSelectedNode()?this.getSelectedNode().getLockAspectRatio():false},setLockAspectRatio:function(enabled){this.__lockAspectRatio=enabled},getLockPosition:function(){return this.getSelectedNode()?this.getSelectedNode().getLockPosition():false},setLockPosition:function(enabled){if(enabled){this.__overlayContainer.addClass("resize gliffy-overlay-lock")}else{this.__overlayContainer.removeClass("gliffy-overlay-lock")}},getZoom:function(){return this.__documentManager.getZoom()},__setControlCursors:function(){var rot=_gliffy.Utils.unwrapRadians(this.__rotation+Math.PI/8),idxOffset,idx,i,cursorType,controlPoint,currentCursor,j;idxOffset=Math.floor(rot/(Math.PI/4));if(idxOffset<=7){for(i=0;i<CLOCKWISE_CONTROL_POINTS.length;i++){idx=(i+idxOffset)%8;cursorType=RESIZE_CURSORS[idx];controlPoint=this.__overlayControl[CLOCKWISE_CONTROL_POINTS[i]];currentCursor=_gliffy.CursorManager.getCursorName(controlPoint);if(currentCursor===cursorType){return}if(CLOCKWISE_CONTROL_POINTS[i]===3&&this.getSelectedNode().isSwimlane()){for(j=0;j<this.__overlayControlLane.length;j++){_gliffy.CursorManager.setCursor(cursorType,this.__overlayControlLane[j])}}_gliffy.CursorManager.setCursor(cursorType,controlPoint)}}},__worldToOverlay:function(xInWorld,yInWorld){var invertedOverlaySpace=this.__getOverlaySpace().createInverse();return invertedOverlaySpace.transformPoint(xInWorld,yInWorld)},__overlayToWorld:function(xInOverlaySpace,yInOverlaySpace){return this.__getOverlaySpace().transformPoint(xInOverlaySpace,yInOverlaySpace)},__drawRotateHandle:function(){var offset=ROTATION_CONTROL_OFFSET-ROTATION_HANDLE_SIZE,height=offset+this.getSelectedNode().getHeight()*this.__documentManager.getZoom()/2;this.__rotateHandle.css({left:"50%",top:-offset+"px",height:height+"px"})},__drawOverlay:function(){if(_gliffy.Debug.SKIP_RENDER_LOOP){this.__deferredDrawOverlay()}else{this.__redraw=true}},__storeState:function(){this.__modifyLines=[];var lines=this.getSelectedNode().findGraphic(_gliffy.Line),i,command;for(i=0;i<lines.length;i++){command=new _gliffy.ModifyLineCommand({node:lines[i]});this.__modifyLines.push(command);this.getSelectedNode().stage.commandHistory.addAndExecuteCommand(command)}},__applyState:function(){var i,selectedNode=this.getSelectedNode();if(selectedNode){for(i=0;i<this.__modifyLines.length;i++){this.__modifyLines[i].takeSnapShot(selectedNode.stage)}}else{_gliffy.Logger.error("selectedNode is null in overlay._applyState")}this.__modifyLines=[]},__deferredDrawOverlay:function(){var node=this.getSelectedNode(),scaleX,scaleY,deg,o,outlineTransform,zoom,overlayOutlineCss,self=this;if(node!==null){scaleX=this.__scaleX/node.getWidth();scaleY=this.__scaleY/node.getHeight();deg=_gliffy.Utils.radiansToDegrees(this.__rotation);if(!_gliffy.Utils.floatEquals(scaleX,1)||!_gliffy.Utils.floatEquals(scaleY,1)){if(node.isSwimlane()&&node.children.length>2&&self.__overlayCoords&&self.__overlayCoords.x!==0.5){this.__documentManager.addAndExecuteCommand(new _gliffy.ScaleSwimlaneCommand({node:node,scaleX:scaleX,scaleY:scaleY,x:this.__transX,y:this.__transY,overlayCoords:self.__overlayCoords}))}else{this.__documentManager.addAndExecuteCommand(new _gliffy.SetScaleCommand({node:node,scaleX:scaleX,scaleY:scaleY,x:this.__transX,y:this.__transY}))}}else{if(Math.ceil(this.__transX)!==Math.ceil(node.getX())||Math.ceil(this.__transY)!==Math.ceil(node.getY())){this.__documentManager.addAndExecuteCommand(new _gliffy.MoveNodeCommand({node:node,x:this.__transX,y:this.__transY}))}else{if(deg!==node.getRotation()){this.__documentManager.addAndExecuteCommand(new _gliffy.SetRotationCommand({node:node,rotation:deg}))}}}if(this.getLaneCommand()){this.__documentManager.addAndExecuteCommand(this.getLaneCommand());this.__laneCommand=null}o=this.__overlayToWorld(0,0);outlineTransform=_gliffy.AffineTransform.getTranslateInstance(o.x,o.y);outlineTransform.rotate(this.__rotation,0,0);zoom=this.__documentManager.getActiveStage().getZoom();overlayOutlineCss=_gliffy.Utils.transformCss(outlineTransform);overlayOutlineCss.width=this.__scaleX*zoom;overlayOutlineCss.height=this.__scaleY*zoom;this.__overlayOutline.css(overlayOutlineCss);if(this.__overlayContainer.css("display")!=="inline"){this.__overlayContainer.css("display","inline")}this.__documentManager.redraw(function(){if(self.__transX!==node.getX()||self.__transY!==node.getY()||self.__scaleX!==node.getWidth()||self.__scaleY!==node.getHeight()){node.update();outlineTransform=_gliffy.AffineTransform.getTranslateInstance(node.worldTransform.getTranslateX()*zoom,node.worldTransform.getTranslateY()*zoom);outlineTransform.rotate(self.__rotation,0,0);overlayOutlineCss=_gliffy.Utils.transformCss(outlineTransform);overlayOutlineCss.width=node.getWidth()*zoom;overlayOutlineCss.height=node.getHeight()*zoom;self.__overlayOutline.css(overlayOutlineCss)}});if(this.__redrawModel){GliffyApp.overlayModel.update(this);GliffyApp.contextualPropertiesController.updateControlsPosition(this)}if(this.__popCommandBundle){this.__documentManager.popCommandBundle()}this.__redrawHud=false;this.__redrawModel=false;this.__popCommandBundle=false;this.__updateLanes();this.__setControlCursors();this.__drawRotateHandle();if(_gliffy.Mouse.getVelocity()<1500){GliffyApp.hudController.showDeferred()}else{GliffyApp.hudController.quickHide()}}},__getStageOverlaySpace:function(){return new _gliffy.AffineTransform().translate(this.__transX,this.__transY).rotate(this.__rotation,0.5*this.__scaleX,0.5*this.__scaleY).scale(this.__scaleX,this.__scaleY)},__getOverlaySpace:function(){var zoom=this.__documentManager.getActiveStage().getZoom();return new _gliffy.AffineTransform().scale(zoom,zoom).translate(this.__transX,this.__transY).rotate(this.__rotation,0.5*this.__scaleX,0.5*this.__scaleY).scale(this.__scaleX,this.__scaleY)},refresh:function(){var node=this.getSelectedNode();if(node!==null){this.setLockPosition(node.getLockPosition());this.__requestedScaleX=this.__scaleX=node.getWidth();this.__requestedScaleY=this.__scaleY=node.getHeight();this.__transX=node.getX();this.__transY=node.getY();this.__rotation=node.getRotation()*Math.PI/180;this.__drawOverlay();this.__updateModel()}},select:function(node,container){var domStage=container.find(".gliffy-stage"),overlayUnderStage=domStage.find("#gliffy-overlay"),selectedNodes,i;if(overlayUnderStage.length===0){domStage.append(this.__overlayContainer);if(!this.__eventsRegistered){this.__registerEvents()}}this.__container=container;this.setSelectedNode(node);selectedNodes=this.__manager.getSelectedNodes();for(i=0;i<selectedNodes.length;i++){if(selectedNodes[i].isGroup()){selectedNodes[i].getDomViewbox().addClass("gliffy-active")}}if(node.isGroup()){node.getDomViewbox().addClass("gliffy-active")}_gliffy.KeyManager.setState("overlaySelected");this.refresh();this.configControlsDisplay()},deselect:function(){$(".gliffy-viewbox.gliffy-active").removeClass("gliffy-active");this.setSelectedNode(null);$("#gliffy-overlay").css("display","none");this.__overlayContainer.css("display","none");GliffyApp.contextualPropertiesController.hideControls()},isActive:function(){return(this.getSelectedNode()!==null)},__doScale:function(x,y,anchorX,anchorY,minX,minY){var scaleX,scaleY,aspect,overlaySpace,oMod,minDim,snapPixels,oOriginal,tl,br,bb;this.__requestedScaleX+=x;this.__requestedScaleY+=y;overlaySpace=this.__getStageOverlaySpace();overlaySpace.rotate(-this.__rotation,anchorX,anchorY);oMod=overlaySpace.transformPoint(anchorX,anchorY);minDim={x:Math.max(this.__MIN_DIMENSIONS.x,minX),y:Math.max(this.__MIN_DIMENSIONS.y,minY)};scaleX=Math.max(this.__requestedScaleX,minDim.x);scaleY=Math.max(this.__requestedScaleY,minDim.y);snapPixels=this.isSnapEnabled()?this.__snapPixels:1;if(x!==0){this.__scaleX=scaleX-scaleX%snapPixels;if(this.__scaleX<minDim.x){this.__scaleX=minDim.x}}if(y!==0){this.__scaleY=scaleY-scaleY%snapPixels;if(this.__scaleY<minDim.y){this.__scaleY=minDim.y}}if(this.__allowLockAspectOnStretch()){aspect=this.getSelectedNode().getAspectRatio();if(anchorY===0.5){this.__scaleY=this.__scaleX/aspect;this.__requestedScaleY=this.__requestedScaleX/aspect}else{this.__scaleX=this.__scaleY*aspect;this.__requestedScaleX=this.__requestedScaleY*aspect}}oOriginal=this.__getStageOverlaySpace().transformPoint(anchorX,anchorY);this.__transX+=oMod.x-oOriginal.x;this.__transY+=oMod.y-oOriginal.y;if(GliffyApp.documentModel.drawingGuides&&!this.__allowLockAspectOnStretch()&&_gliffy.Utils.floatEquals(this.getSelectedNode().getRotation(),0,0.0001)){overlaySpace=this.__getOverlaySpace();tl=overlaySpace.transformPoint(0,0);br=overlaySpace.transformPoint(1,1);bb=new _gliffy.BoundingBox(tl.x,tl.y,br.x,br.y);this.__applyDrawingGuidesForScale(bb,{x:anchorX,y:anchorY})}},__allowLockAspectOnStretch:function(){return(this.getSelectedNode().getLockAspectRatio()||this.__isShiftKeyLockAspect(this.getSelectedNode()))},__isShiftKeyLockAspect:function(selectedNode){return _gliffy.KeyManager.shiftKeyDown&&selectedNode.supportsLockAspect()},move:function(axis,value){if(axis==="x"){this.setTransX(this.getTransX()+value)}else{this.setTransY(this.getTransY()+value)}this.__redrawModel=true},rotate:function(value){this.setRotation(_gliffy.Utils.unwrapRadians(this.getRotation()+value))},getSelectedNode:function(){return this.__documentManager.getActiveStage().find(this.__overlayedNode)},setSelectedNode:function(node){if(node){this.__overlayedNode=node.getId()}else{this.__overlayedNode=null}},setupLanes:function(){var selectedNode=this.getSelectedNode(),lanes,i,lane,constraint;if(selectedNode.isSwimlane()){lanes=selectedNode.children.length-1;for(i=2;i<selectedNode.children.length;i++){lane=this.__overlayControlLane[i-2];constraint=selectedNode.children[i].getConstraints().getConstraint(_gliffy.PositionConstraint);if(constraint){lane.data("lane",{nodeId:selectedNode.children[i].getId(),sibling:selectedNode.children[i-1].getId(),nextSibling:selectedNode.children[i+1]?selectedNode.children[i+1].getId():null,lanes:lanes});lane.css({left:constraint.px*100+"%",top:"50%"})}else{_gliffy.Logger.warn("Swimlane is missing constraints! Removing this object: "+selectedNode.toObject());this.deselect();new _gliffy.RemoveNodeCommand({node:selectedNode}).execute(this.__documentManager.getActiveStage())}}for(i=lanes-1;i<11;i++){this.__overlayControlLane[i].removeClass("active")}this.__overlayContainer.addClass("lanes lane-"+lanes)}else{this.__overlayContainer.removeClass("lanes")}},__updateLanes:function(){var selectedNode=this.getSelectedNode(),i,stage=this.__documentManager.getActiveStage(),constraint,lane,data;if(selectedNode.isSwimlane()){for(i=0;i<this.__overlayControlLane.length;i++){if(this.__overlayControlLane[i].is(":visible")){data=this.__overlayControlLane[i].data("lane");if(data){lane=stage.find(data.nodeId);if(lane){constraint=lane.getConstraints().getConstraint(_gliffy.PositionConstraint);this.__overlayControlLane[i].css({left:constraint.px*100+"%",top:"50%"})}else{this.__overlayContainer.removeClass("lane-"+data.lanes).addClass("lane-"+selectedNode.children.length-1)}}}}}},configControlsDisplay:function(){var i,targets,shapeInfo,mutableProps,heightConstraint=false,widthConstraint=false,rotationConstraint=false,selectedNode=this.getSelectedNode();if(selectedNode){if(!selectedNode.isMultipartShape()&&selectedNode.children&&selectedNode.children.length>1){targets=selectedNode.children}else{targets=[selectedNode]}if(this.getLockPosition()){this.setLockPosition(true)}if(targets){this.__overlayContainer.removeClass().addClass("rotate resize");for(i=0;i<targets.length;i++){shapeInfo=targets[i].getShapeInformation();mutableProps=shapeInfo.mutableProperties;if(mutableProps){if(!heightConstraint){heightConstraint=($.inArray("height",mutableProps)===-1)}if(!widthConstraint){widthConstraint=($.inArray("width",mutableProps)===-1)}if(!rotationConstraint){rotationConstraint=($.inArray("rotate",mutableProps)===-1)}}}if(selectedNode.isProxy()||(heightConstraint&&widthConstraint)){this.__overlayContainer.removeClass("resize")}else{if(heightConstraint){this.__overlayContainer.addClass("height-constraint")}else{if(widthConstraint){this.__overlayContainer.addClass("width-constraint")}}}if(rotationConstraint){this.__overlayContainer.removeClass("rotate")}this.setupLanes()}}},inStageViewport:function(){var inViewport=false,stageDimensions=this.__documentManager.getActiveStageViewPort();if(((this.getTransY()+this.getScaleY())>stageDimensions.min.y)&&((this.getTransX()+this.getScaleX())>stageDimensions.min.x)&&(this.getTransY()<stageDimensions.max.y)&&(this.getTransX()<stageDimensions.max.x)){inViewport=true}return inViewport},getClassName:function(){return"Overlay"},hideControls:function(){this.__overlayContainer.removeClass("resize rotate lanes")},showControls:function(){this.configControlsDisplay()},clearContextMenu:function(){return GliffyApp.contextMenuController.clearContextMenu(this.__contextMenu)},getContextMenuDefinition:function(){var self=this,contextMenu=[],pushToMenu;pushToMenu=function(key,val){var obj={};obj[key]=val;contextMenu.push(obj)};pushToMenu($.i18n._("OVERLAY_CUT"),function(menuItem,menu){_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextMenu",action:"overlayCut"});_gliffy.toolbarController.doCut()});pushToMenu($.i18n._("OVERLAY_COPY"),function(menuItem,menu){_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextMenu",action:"overlayCopy"});_gliffy.toolbarController.doCopy()});pushToMenu($.i18n._("OVERLAY_PASTE"),function(menuItem,menu){_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextMenu",action:"overlayPaste"});_gliffy.Mouse.setLastMouseUpPosition(_gliffy.Mouse.getContextMenuMouseDownPosition());_gliffy.toolbarController.doPaste()});pushToMenu($.i18n._("OVERLAY_DELETE"),function(menuItem,menu){_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextMenu",action:"overlayDelete"});_gliffy.toolbarController.doDelete()});contextMenu.push($.contextMenu.separator);pushToMenu($.i18n._("OVERLAY_UNLOCK_SELECTION"),{onclick:function(menuItem,menu){_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextMenu",action:"overlayUnlock"});GliffyApp.contextualPropertiesController.updateShapeTabProperty("LockPosition",false);self.refresh()},className:"gliffy-context-menu-item-unlock"});pushToMenu($.i18n._("OVERLAY_LOCK_SELECTION"),{onclick:function(menuItem,menu){_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextMenu",action:"overlayLock"});GliffyApp.contextualPropertiesController.updateShapeTabProperty("LockPosition",true);self.refresh()},className:"gliffy-context-menu-item-lock"});contextMenu.push($.contextMenu.separator);pushToMenu($.i18n._("OVERLAY_SEND_TO_FRONT"),function(menuItem,menu){_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextMenu",action:"overlayToFront"});_gliffy.toolbarController.doBringToFront()});pushToMenu($.i18n._("OVERLAY_SEND_TO_BACK"),function(menuItem,menu){_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextMenu",action:"overlayToBack"});_gliffy.toolbarController.doSendToBack()});pushToMenu($.i18n._("OVERLAY_GROUP"),{onclick:function(menuItem,menu){_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextMenu",action:"overlayGroup"});_gliffy.toolbarController.doGroup()},className:"gliffy-context-menu-item-group"});pushToMenu($.i18n._("OVERLAY_UNGROUP"),{onclick:function(menuItem,menu){_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextMenu",action:"overlayUngroup"});_gliffy.toolbarController.doUnGroup()},className:"gliffy-context-menu-item-ungroup"});return contextMenu},beforeContextMenuShow:function(menu){var node=this.getSelectedNode(),isGroupOrSelection=false,isLocked=false;_gliffy.Mouse.setContextMenuMouseDownPosition(_gliffy.Mouse.getPosition());if(node){isGroupOrSelection=node.isGroup()||node.isSelection()}isLocked=this.getLockPosition();$(menu).find(".gliffy-context-menu-item-group").toggle(isGroupOrSelection);$(menu).find(".gliffy-context-menu-item-ungroup").toggle(isGroupOrSelection);$(menu).find(".gliffy-context-menu-item-lock").toggle(!isLocked);$(menu).find(".gliffy-context-menu-item-unlock").toggle(isLocked)}})}());(function(){var MIN_SIZE=3,ZOOM_AMOUNTS=[0.1,0.15,0.25,0.33,0.5,0.67,0.75,1,1.25,1.5,1.75,2,2.5,3,3.5,4],CLASS_NAME="gliffy-zoom-box";_gliffy.ZoomOverlay=_gliffy.Class.extend({init:function(options){var self=this;if(!options||!options.stageDiv||!options.documentManager){throw new Error("A stageDiv and documentManager is required for this to work.")}this.__stageDiv=options.stageDiv;this.__documentManager=options.documentManager;_gliffy.Mouse.registerDragState([{modes:["zoomIn","zoomOut"],dragStart:function(){self.__stageDiv.setClassName(CLASS_NAME);self.__stageDiv.setStartCorner(_gliffy.Mouse.getPosition())},drag:function(){self.__stageDiv.setEndCorner(_gliffy.Mouse.getPosition());if(self.isZoomIn()&&!self.__stageDiv.isScreenDiagonalLessThan(MIN_SIZE)){self.__stageDiv.draw()}else{self.__stageDiv.hide()}},dragEnd:function(){if(self.isZoomIn()&&self.__stageDiv.isVisible()){self.__documentManager.zoomToBox(self.__stageDiv.getBoundingBox());self.__stageDiv.hide()}else{self.click(self.__stageDiv.getEndCorner())}},autoPan:true}])},click:function(point){this.__documentManager.zoomAt(this.__getNextZoom(this.isZoomIn()),point.x,point.y)},keyboardZoom:function(zoomIn){this.__documentManager.zoomToCenter(this.__getNextZoom(zoomIn))},isZoomIn:function(){return _gliffy.Mouse.getState()==="zoomIn"},__getNextZoom:function(zoomIn){var zoom=this.__documentManager.getZoom(),i;if(zoomIn){if(Math.floor(zoom)>=ZOOM_AMOUNTS[ZOOM_AMOUNTS.length-1]){return Math.floor(zoom)+1}for(i=0;i<ZOOM_AMOUNTS.length;i++){if(ZOOM_AMOUNTS[i]>zoom){return ZOOM_AMOUNTS[i]}}return ZOOM_AMOUNTS[ZOOM_AMOUNTS.length-1]}else{if(Math.ceil(zoom)>=ZOOM_AMOUNTS[ZOOM_AMOUNTS.length-1]+1){return Math.ceil(zoom)-1}for(i=ZOOM_AMOUNTS.length;i>=0;i--){if(ZOOM_AMOUNTS[i]<zoom){return ZOOM_AMOUNTS[i]}}return ZOOM_AMOUNTS[0]}}});_gliffy.ZoomOverlay.ZOOM_AMOUNTS=ZOOM_AMOUNTS}());(function(){var moveThreshold=new _gliffy.MoveThreshold(),CLASS_NAME="gliffy-selector";_gliffy.Selector=_gliffy.Class.extend({__domSelector:null,__eventsRegistered:false,__documentManager:null,__overlayManager:null,__stageDiv:null,init:function(o){if(!o){throw new Error("Selector init needs options")}if(!o.documentManager){throw new Error("Selector init options needs stage manager")}if(!o.overlayManager){throw new Error("Selector init options needs overlay manager")}if(!o.stageDiv){throw new Error("Selector init options needs a stage div")}this.__stageDiv=o.stageDiv;this.__documentManager=o.documentManager;this.__overlayManager=o.overlayManager;this.registerState();_gliffy.Mouse.setState("none")},registerState:function(){var self=this,moved=false,pos,nodeAtPoint;_gliffy.Mouse.registerDragState([{modes:["none"],dragStart:function(event){moved=false;self.__stageDiv.setStartCorner(_gliffy.Mouse.getPosition());self.__stageDiv.setClassName(CLASS_NAME);moveThreshold.reset(event)},drag:function(event){moved=moveThreshold.above(event);if(moved){self.__stageDiv.setEndCorner(_gliffy.Mouse.getPosition());self.__stageDiv.draw()}},dragEnd:function(event){var node,selected=false,selectedNodes,selectedNode=self.__overlayManager.getSelectedNode();self.__stageDiv.hide();if(selectedNode&&(_gliffy.KeyManager.shiftKeyDown||_gliffy.KeyManager.metaCtrlKeyDown)){if(moved){selectedNodes=self.__overlayManager.getSelectedNodes();selectedNodes=selectedNodes.concat(_gliffy.Pick.pickAllNodesInside(self.__documentManager.getActiveStage().objects,self.__stageDiv.getBoundingBox()));selected=self.__overlayManager.selectNodes(selectedNodes);if(selected){GliffyApp.contextualPropertiesController.showControls(self.__overlayManager.getActiveOverlay())}}_gliffy.Mouse.resetMouseUpPosition()}else{if(moved){selected=self.__overlayManager.selectNodes(_gliffy.Pick.pickAllNodesInside(self.__documentManager.getActiveStage().objects,self.__stageDiv.getBoundingBox()));if(selected){GliffyApp.contextualPropertiesController.showControls(self.__overlayManager.getActiveOverlay());_gliffy.Mouse.resetMouseUpPosition()}}else{pos=_gliffy.Mouse.getPosition();node=_gliffy.Pick.getNodeAt(self.__stageDiv.getEndCorner());nodeAtPoint=_gliffy.Pick.getNodeAt(self.__documentManager.getActiveStage().objects,pos.x,pos.y);if(node){self.__overlayManager.selectNode(node);GliffyApp.contextualPropertiesController.showControls(self.__overlayManager.getActiveOverlay());_gliffy.Mouse.resetMouseUpPosition()}else{if(nodeAtPoint&&nodeAtPoint.getLockPosition()){self.__overlayManager.selectNode(nodeAtPoint);GliffyApp.contextualPropertiesController.showControls(self.__overlayManager.getActiveOverlay())}}}}},autoPan:true}])}})}());(function(){var moveThreshold=new _gliffy.MoveThreshold();_gliffy.LineOverlay=_gliffy.Class.extend({__MAX_CONTROL_POINTS:2,__MAX_ADJUSTMENT_POINTS:3,__CONTROL_POINT_PADDING:8,__editor:null,__documentManager:null,__overlayControl:null,__overlayAdjustment:null,__selectedNodeId:null,__container:null,__overlayControlWidth:0,__overlayControlHeight:0,__overlayContainer:null,__eventsRegistered:false,__textControl:null,__lineDrawMode:false,__snapPixels:10,__modifyLineCommand:null,__connectionData:null,__contextMenu:null,__connectionPointsActive:false,isNewlyCreatedLine:false,isDragging:false,init:function(o){this.__overlayControl=[];this.__overlayAdjustment=[];if(!o){throw new Error("lineOverlay init needs options")}if(!o.documentManager){throw new Error("lineOverlay init options needs documentManager")}if(!o.target){throw new Error("lineOverlay init options needs target")}if(!o.textControl){throw new Error("lineOverlay needs textControl")}if(!o.editor){throw new Error("lineOverlay init options needs editor")}var i,self=this;this.__editor=o.editor;this.__container=o.target;this.__documentManager=o.documentManager;this.__textControl=o.textControl;this.__overlayContainer=$('<div id="gliffy-line-overlay"/>');for(i=0;i<this.__MAX_CONTROL_POINTS;i++){this.__overlayControl.push($('<div class="gliffy-line-overlay-control gliffy-icon-overlay-handle-circle" />'));this.__overlayControl[i].data("i",i);this.__overlayContainer.append(this.__overlayControl[i]);_gliffy.CursorManager.setCursor("move",this.__overlayControl[i])}for(i=0;i<this.__MAX_ADJUSTMENT_POINTS;i++){this.__overlayAdjustment.push($('<div class="gliffy-line-overlay-adjustment gliffy-icon-overlay-handle-circle" style="display:none;" />'));this.__overlayAdjustment[i].data("i",i);this.__overlayContainer.append(this.__overlayAdjustment[i])}_gliffy.RenderLoop.appendTask(function(){if(self.__redraw){self.__deferredDrawOverlay()}self.__redraw=false});this.__setupControlDragManager();this.__bindConnectionPointDistanceHiding();GliffyApp.contextMenuController.createContextMenu(this,this.__overlayContainer,this.getContextMenuDefinition(),"gliffy-context-menu-line-overlay")},__bindConnectionPointDistanceHiding:function(){var self=this,$body=$("body");$body.on("mousemove",function(e){if(self.__connectionPointsActive){var p=_gliffy.Mouse.getPosition(),size=10,bb=new _gliffy.BoundingBox(p.x-size,p.y-size,p.x+size,p.y+size),nodes,i;nodes=_gliffy.Pick.selectNodesInclusive(self.__documentManager.getActiveStage().objects,bb);$("div.gliffy-viewbox.gliffy-near").removeClass("gliffy-near");for(i=0;i<nodes.length;i++){self.__addClassToNodeViewbox(nodes[i])}}})},__addClassToNodeViewbox:function(node){var i;node.getDomViewbox().addClass("gliffy-near");for(i=0;node.children&&i<node.children.length;i++){this.__addClassToNodeViewbox(node.children[i])}},__setupConnectionPointDistanceHiding:function(maxDist,onceEvery,zeroOpacity){var cpDomsModifiedLastFrame=[],maxDistSq=maxDist*maxDist,ctr=-1,stageDom=null,self=this,i,j,pos,closeNodes,node,cpPos,sqDist,opacity,cpDom;$(document).on("mousemove",function(){ctr=(ctr+1)%onceEvery;if(!stageDom){stageDom=self.__documentManager.target.find(".gliffy-stage");stageDom.addClass(zeroOpacity?"gliffy-zero-opacity-connection-point":"gliffy-partial-opacity-connection-point")}for(i=0;i<cpDomsModifiedLastFrame.length;i++){cpDomsModifiedLastFrame[i].css("opacity",zeroOpacity?"0":"0.35")}if(stageDom.hasClass("gliffy-connections-active")){pos=_gliffy.Mouse.getPosition();closeNodes=_gliffy.Pick.pickAllNodesAt(self.__documentManager.getActiveStage().objects,pos.x,pos.y,maxDist);for(i=0;i<closeNodes.length;i++){node=closeNodes[i];if(node.supportsConnections()){for(j=0;j<node.getConnections().length;j++){cpPos=node.getConnectionPoint(j);sqDist=_gliffy.Vec2.squaredDistance(pos,cpPos);if(sqDist<maxDistSq){cpDom=node.getConnectionPointDom(j);opacity=Math.sqrt((maxDistSq-sqDist)/maxDistSq);if(opacity>0.82){opacity=1}cpDom.css("opacity",opacity);cpDomsModifiedLastFrame.push(cpDom)}}}}}})},__setupControlDragManager:function(){var self=this,$this,overlayedNode;_gliffy.Mouse.registerClickState({name:"line-overlay",target:".gliffy-line-overlay-control,.gliffy-line-overlay-adjustment",modes:["line-control","line-adjustment","line-move"],mouseDown:function(event){event.stopPropagation();_gliffy.Mouse.setClickMode("line-overlay");$this=$(event.currentTarget);overlayedNode=self.getSelectedNode();if($this.hasClass("gliffy-line-overlay-control")){_gliffy.Mouse.setState("line-control")}else{if($this.hasClass("gliffy-line-overlay-adjustment")){_gliffy.Mouse.setState("line-adjustment")}else{if(overlayedNode&&self.__lastTarget===overlayedNode.getId()){self.__lastTarget=null;self.makeTextEditable();return}else{_gliffy.Mouse.setState("line-move");self.__setLastTarget()}}}_gliffy.Mouse.__mousedown(event)}});_gliffy.Mouse.registerDragState([{modes:["line-control"],dragStart:function(event){_gliffy.Mouse.setCursor("move");self.__startModifyLine();GliffyApp.contextualPropertiesController.hideControls();self.__controlDragStart($this)},drag:function(event){self.isDragging=true;self.__controlDrag($this,_gliffy.Mouse.getPosition())},dragEnd:function(event){self.isDragging=false;self.__controlDragEnd();self.__endModifyLine()},autoPan:true},{modes:["line-adjustment"],dragStart:function(event){var node=self.getSelectedNode(),index=$this.data("i")+1;if(node.getGraphic().editable.isSegmentHorizontal(index)){_gliffy.Mouse.setCursor("n-resize")}else{_gliffy.Mouse.setCursor("w-resize")}self.__startModifyLine();GliffyApp.contextualPropertiesController.hideControls();self.showConnectionPoints(false)},drag:function(event){var node=self.getSelectedNode(),index=$this.data("i")+1,start,end,delta;delta=_gliffy.Mouse.getDelta();if(node.getGraphic().editable.isSegmentHorizontal(index)){delta.x=0}else{delta.y=0}start=node.getGraphic().getWorldControlPoint(index);end=node.getGraphic().getWorldControlPoint(index+1);start=_gliffy.Vec2.sum(start,delta);end=_gliffy.Vec2.sum(end,delta);node.getGraphic().setWorldControlPoint(index,start);node.getGraphic().setWorldControlPoint(index+1,end);node.getGraphic().editable.allowClearLocks=false;node.getGraphic().editable.setLockSegment(index,true);self.isDragging=true;self.__drawOverlay()},dragEnd:function(event){var node=self.getSelectedNode();node.getGraphic().editable.allowClearLocks=true;self.isDragging=false;GliffyApp.lineOverlayModel.update(self);GliffyApp.contextualPropertiesController.showControls(self);self.showConnectionPoints(true);self.__endModifyLine()},autoPan:true},{modes:["line-move"],dragStart:function(event){self.__startModifyLine();moveThreshold.reset(event);self.showConnectionPoints(false);GliffyApp.contextualPropertiesController.hideControls()},drag:function(event){self.isDragging=true;if(moveThreshold.above(event)){self.move()}},dragEnd:function(event){self.isDragging=false;GliffyApp.lineOverlayModel.update(self);GliffyApp.contextualPropertiesController.showControls(self);self.showConnectionPoints(true);self.__endModifyLine()},autoPan:true}])},__getConnectionPoint:function(pos){var node,nodes,controlPoint,viewboxDom,i;nodes=_gliffy.Pick.pickAllNodesAt(this.__documentManager.getActiveStage().objects,pos.x,pos.y,this.__CONTROL_POINT_PADDING);for(i=0;i<nodes.length;i++){node=nodes[i];controlPoint=_gliffy.Pick.pickConnectionPoint(node,pos,this.__CONTROL_POINT_PADDING);if(controlPoint!==null){viewboxDom=node.getDomViewbox();return $(viewboxDom.children()[controlPoint])}else{if(node.getGraphic()!==null&&node.supportsConnections()&&_gliffy.Pick.isNodeOpaqueAt(node,pos.x,pos.y)){return null}}}return null},setLineType:function(orthoMode){var node=this.getSelectedNode(),options={};if(node){options.node=node;if(orthoMode!==null){options.ortho=true;switch(orthoMode){case _gliffy.Editor.ORTHO_MODE.bezel:options.interpolation=_gliffy.Line.INTERPOLATION_TYPE.linear;options.cornerRadius=10;break;case _gliffy.Editor.ORTHO_MODE.curved:options.interpolation=_gliffy.Line.INTERPOLATION_TYPE.quadratic;break;default:options.interpolation=_gliffy.Line.INTERPOLATION_TYPE.linear;break}}else{options.interpolation=_gliffy.Line.INTERPOLATION_TYPE.linear}this.__startModifyLine();node.stage.commandHistory.addAndExecuteCommand(new _gliffy.SetLineTypeCommand(options));if(orthoMode!==null){this.__documentManager.updateStyleDefaultsForNode(this.getSelectedNode(),"orthoMode",orthoMode)}this.__endModifyLine();if(node.getGraphic()){node.getGraphic().markDirty()}this.__documentManager.redraw()}},detach:function(){$("#gliffy-line-overlay").detach()},isSnapEnabled:function(){return _gliffy.Utils.shouldSnapToGrid()},__unhighlightConnectionPoints:function(){this.__documentManager.target.find(".gliffy-stage .gliffy-connection-point.gliffy-connection-point-highlight").removeClass("gliffy-connection-point-highlight gliffy-icon-overlay-plus-on")},__controlDragStart:function(jControl){},__controlDrag:function(jControl,stageCoords){var connectionPoint,lineIdx,node=this.getSelectedNode(),connectedNode;lineIdx=$(jControl).data("i");this.__unhighlightConnectionPoints();if(node){connectionPoint=this.__getConnectionPoint(stageCoords);if(connectionPoint!==null){connectionPoint.addClass("gliffy-connection-point-highlight gliffy-icon-overlay-plus-on");connectedNode=this.__documentManager.getActiveStage().find(connectionPoint.data("id"));this.attachLineToConnectionPoint(node,lineIdx,connectedNode,connectionPoint.data("i"));this.__drawOverlay()}else{this.detachLineFromConnectionPoint(node,lineIdx)}this.__updateControl(jControl)}else{_gliffy.Logger.warn("node is null in lineOverlay __controlDrag")}this.__drawOverlay()},__controlDragEnd:function(){GliffyApp.lineOverlayModel.update(this);GliffyApp.contextualPropertiesController.showControls(this);this.__unhighlightConnectionPoints()},__startModifyLine:function(){var node=this.getSelectedNode();this.__documentManager.pushCommandBundle();if(node!==null){node.getGraphic().editable.allowComputeBestPath=true;this.__modifyLineCommand=new _gliffy.ModifyLineCommand({node:this.getSelectedNode()});this.__documentManager.addAndExecuteCommand(this.__modifyLineCommand)}},__endModifyLine:function(){if(this.__modifyLineCommand!==null){this.__modifyLineCommand.takeSnapShot(this.__documentManager.getActiveStage());this.__modifyLineCommand=null}this.__documentManager.popCommandBundle()},move:function(delta){var node=this.getSelectedNode();delta=delta||_gliffy.Mouse.getDelta();this.detachLineFromConnectionPoint(this.getSelectedNode(),0);this.detachLineFromConnectionPoint(this.getSelectedNode(),1);this.__documentManager.addAndExecuteCommand(new _gliffy.MoveNodeCommand({node:node,x:node.getX()+delta.x,y:node.getY()+delta.y}));this.getSelectedNode().update();this.__drawOverlay()},__setLastTarget:function(){var self=this;this.__lastTarget=this.getSelectedNode().getId();setTimeout(function(){self.__lastTarget=null},this.__editor.overlayManager.__DOUBLE_CLICK_TIMEOUT)},beginInitialDrag:function(event){var self=this;if(this.getSelectedNode()&&self.__lastTarget===this.getSelectedNode().getId()){self.__lastTarget=null;self.__documentManager.popCommandBundle();self.makeTextEditable()}else{moveThreshold.reset(event);_gliffy.Mouse.lockDragUI("move");self.showConnectionPoints(false);GliffyApp.contextualPropertiesController.hideControls();self.__setLastTarget();_gliffy.Mouse.beginInitialDrag("line-overlay","line-move")}},simulateControlDrag:function(idx,stageCoords,type){var jControl=this.__overlayControl[idx];switch(type){case"start":this.__controlDragStart(jControl);break;case"end":this.__controlDragEnd();break;default:this.__controlDrag(jControl,stageCoords)}},__registerEvents:function(){var self=this;_gliffy.KeyManager.registerState("lineOverlaySelected","default",[{action:"nudgeLeft",keydown:function(ev){ev.stopImmediatePropagation();ev.preventDefault();self.__nudge(true,true)}},{action:"nudgeRight",keydown:function(ev){ev.stopImmediatePropagation();ev.preventDefault();self.__nudge(true,false)}},{action:"nudgeUp",keydown:function(ev){ev.stopImmediatePropagation();ev.preventDefault();self.__nudge(false,true)}},{action:"cut",keydown:function(e){e.stopImmediatePropagation();e.preventDefault();_gliffy.toolbarController.doCut()}},{action:"copy",keydown:function(e){e.stopImmediatePropagation();e.preventDefault();_gliffy.toolbarController.doCopy()}},{action:"paste",keydown:function(e){e.stopImmediatePropagation();e.preventDefault();_gliffy.toolbarController.doPaste()}},{action:"delete",keydown:function(e){e.stopImmediatePropagation();e.preventDefault();_gliffy.toolbarController.doDelete()}},{action:"nudgeDown",keydown:function(ev){ev.stopImmediatePropagation();ev.preventDefault();self.__nudge(false,false)}},{action:"enterRTE",keydown:function(ev){ev.stopImmediatePropagation();ev.preventDefault();self.makeTextEditable()}},{action:"jumpStageLeft",keydown:function(e){e.stopImmediatePropagation();e.preventDefault()}},{action:"jumpStageRight",keydown:function(e){e.stopImmediatePropagation();e.preventDefault()}},{action:"jumpStageUp",keydown:function(e){e.stopImmediatePropagation();e.preventDefault()}},{action:"jumpStageDown",keydown:function(e){e.stopImmediatePropagation();e.preventDefault()}},{action:"sendBack",keydown:function(ev){ev.stopImmediatePropagation();ev.preventDefault();_gliffy.toolbarController.doSendToBack();return false},keypress:function(ev){return false},keyup:function(ev){return false}},{action:"sendFront",keydown:function(ev){ev.stopImmediatePropagation();ev.preventDefault();_gliffy.toolbarController.doBringToFront();return false},keypress:function(ev){return false},keyup:function(ev){return false}},{keypress:function(ev){if(!_gliffy.KeyManager.isControlKey(ev)&&self.isActive()){ev.stopImmediatePropagation()}}}]);this.__eventsRegistered=true},__getNudgeAmount:function(){return this.isSnapEnabled()?this.__snapPixels:1},__nudge:function(xAxis,negative){var nudge=this.__getNudgeAmount(),viewPort=this.__documentManager.getActiveStageViewPort(),viewportDimension,node=this.getSelectedNode();if(negative){nudge*=-1}if(xAxis){this.move(new _gliffy.Vec2(nudge,0))}else{this.move(new _gliffy.Vec2(0,nudge))}if(node){if(xAxis){if(viewPort.max.x<node.worldAabb.max.x+nudge*2||(negative&&viewPort.min.x>node.worldAabb.min.x+nudge*2)){viewportDimension=viewPort.getDimension();this.__documentManager.getActiveStage().offsetPan(-nudge,0,viewportDimension.x,viewportDimension.y)}}else{if(viewPort.max.y<node.worldAabb.max.y+nudge*2||(negative&&viewPort.min.y>node.worldAabb.min.y+nudge*2)){viewportDimension=viewPort.getDimension();this.__documentManager.getActiveStage().offsetPan(0,-nudge,viewportDimension.x,viewportDimension.y)}}}_gliffy.Mouse.updateOffset();GliffyApp.contextualPropertiesController.updateControlsPosition(this)},showConnectionPoints:function(show){var stage=this.__documentManager.target.find(".gliffy-stage");this.__connectionPointsActive=show;if(show){stage.addClass("gliffy-connections-active");if(this.__editor.inLineDrawMode()){this.__addConnectionHighlightHandler()}}else{stage.removeClass("gliffy-connections-active");this.__removeConnectionHightlightHandler()}},select:function(node,container){var domStage=container.find(".gliffy-stage"),overlayUnderStage=domStage.find("#gliffy-line-overlay");this.deselect();if(overlayUnderStage.length===0){domStage.append(this.__overlayContainer);this.__overlayControlWidth=this.__overlayControl[0].width();this.__overlayControlHeight=this.__overlayControl[0].height();if(!this.__eventsRegistered){this.__registerEvents()}}this.__overlayContainer.css({display:"inline",width:"0px",height:"0px"});if((node.getGraphic()!==null)&&(node.getGraphic().getClassName()==="Line"||node.getGraphic().getClassName()==="FillLine")){this.__selectedNodeId=node.getId();this.getSelectedNode().getGraphic().setOverlay(true);this.showConnectionPoints(true);this.__drawOverlay()}else{throw new Error("Line overlay is trying to select a non-line.")}_gliffy.KeyManager.setState("lineOverlaySelected");GliffyApp.lineOverlayModel.update(this);GliffyApp.contextualPropertiesController.showControls(this)},deselect:function(){var i;$("#gliffy-line-overlay").css("display","none");GliffyApp.contextualPropertiesController.hideControls();if(this.getSelectedNode()&&this.getSelectedNode().getGraphic()){this.getSelectedNode().getGraphic().setOverlay(false);if(!this.__editor.inLineDrawMode()){this.showConnectionPoints(false)}for(i=0;i<this.__MAX_CONTROL_POINTS;i++){this.__overlayControl[i].css("display","none")}for(i=0;i<this.__MAX_ADJUSTMENT_POINTS;i++){this.__overlayAdjustment[i].css("display","none")}this.__documentManager.redraw()}this.__selectedNodeId=null},isActive:function(){return(this.getSelectedNode()!==null)},attachLineToConnectionPoint:function(lineNode,lineIdx,graphicNode,graphicConnectionIdx){var node=this.getSelectedNode();if(node){if(lineIdx===0){node.getGraphic().editable.setConnectionStart(graphicNode,graphicConnectionIdx)}else{node.getGraphic().editable.setConnectionEnd(graphicNode,graphicConnectionIdx)}}},getContainer:function(){return this.__container},getSelectedNode:function(){return this.__documentManager.getActiveStage().find(this.__selectedNodeId)},detachLineFromConnectionPoint:function(lineNode,lineIdx){if(lineNode){if(lineIdx===0){lineNode.getGraphic().editable.clearConnectionStart()}else{lineNode.getGraphic().editable.clearConnectionEnd()}}},__updateControl:function(jqControl){var node=this.getSelectedNode(),globalPos=_gliffy.Mouse.getPosition(),line=node.getGraphic(),opposingPoint,distance,snapDegrees,controlIndex=(jqControl.data("i")===0)?0:line.getControlPointCount()-1;if(!line.isOrtho()){opposingPoint=(controlIndex===0)?line.editable.getWorldEndPoint():line.editable.getWorldStartPoint();distance=(_gliffy.Vec2.distance(globalPos,opposingPoint));if(distance>15){snapDegrees=_gliffy.Utils.SNAP_DEGREES_MULTIPLIER/distance;globalPos=_gliffy.Utils.calculateLineSnap(globalPos,opposingPoint,snapDegrees).point}}line.setWorldControlPoint(controlIndex,globalPos)},__deferredDrawOverlay:function(){var start,end,point,i,line,path,overlayControlHalfWidth,overlayControlHalfHeight,zoom,isLinearLine;zoom=this.__documentManager.getActiveStage().getZoom();overlayControlHalfWidth=this.__overlayControlWidth*0.5;overlayControlHalfHeight=this.__overlayControlHeight*0.5;if(this.getSelectedNode()!==null){this.getSelectedNode().update();line=this.getSelectedNode().getGraphic();path=line.getWorldControlPath();start=path[0];point=new _gliffy.Vec2(start[0],start[1]);if(this.isNewlyCreatedLine&&this.__editor.inLineDrawMode()&&line.getStartConnection()){this.__overlayControl[0].addClass("hidden")}else{this.__overlayControl[0].removeClass("hidden");this.__overlayControl[0].css({display:"inline",left:point.x*zoom-overlayControlHalfWidth,top:point.y*zoom-overlayControlHalfHeight})}end=path[path.length-1];point=new _gliffy.Vec2(end[0],end[1]);this.__overlayControl[1].css({display:"inline",left:point.x*zoom-overlayControlHalfWidth,top:point.y*zoom-overlayControlHalfHeight});isLinearLine=line.isLinearLine();for(i=1;i<path.length-2;i++){start=path[i];end=path[i+1];if(this.__isMinAdjustableSegmentLength(start,end)&&!isLinearLine){point=new _gliffy.Vec2((start[0]+end[0])/2,(start[1]+end[1])/2);this.__overlayAdjustment[i-1].css({display:"inline",left:point.x*zoom-overlayControlHalfWidth,top:point.y*zoom-overlayControlHalfHeight});if(start[0]===end[0]){_gliffy.CursorManager.setCursor("w-resize",this.__overlayAdjustment[i-1])}else{_gliffy.CursorManager.setCursor("n-resize",this.__overlayAdjustment[i-1])}}else{this.__overlayAdjustment[i-1].css("display","none")}}i=(path.length-3>0)?path.length-3:0;for(i;i<this.__MAX_ADJUSTMENT_POINTS;i++){this.__overlayAdjustment[i].css("display","none")}}this.__documentManager.redraw()},__isMinAdjustableSegmentLength:function(start,end){if(start[0]===end[0]){return(Math.abs(end[1]-start[1])>5)}else{return(Math.abs(end[0]-start[0])>5)}},redraw:function(){this.__drawOverlay()},__drawOverlay:function(){if(_gliffy.Debug.SKIP_RENDER_LOOP){this.__deferredDrawOverlay()}else{this.__redraw=true}},__setupTextGraphic:function(parentNode){var node=new _gliffy.Node(),textGraphic=new _gliffy.Text();textGraphic.setOverflow("both");textGraphic.setValign("middle");node.setWidth(1);node.setHeight(1);node.setGraphic(textGraphic);node.setOrder("auto");node.setUid(null);this.__documentManager.addAndExecuteCommand(new _gliffy.AddNodeCommand({node:node,target:parentNode,prepend:true}));node.markDirty();return node},__editText:function(node,event){var self=this,textGraphic=node.getGraphic();self.__documentManager.redraw(function(){textGraphic.editable.setEditMode(true);textGraphic.editable.focus();if(event!==undefined&&event!==null){textGraphic.editable.setKeyEvent(event)}else{textGraphic.editable.setCursorEnd()}self.__textControl.edit(textGraphic);textGraphic.editable.registerBlurHandler(function(){GliffyApp.contextualPropertiesController.blurRTE(self);textGraphic.editable.setEditMode(false);self.__documentManager.redraw()})})},makeTextEditable:function(keyEvent,node){var self=this,child;if(!node){node=self.getSelectedNode()}if(node.isLine()){child=node.findGraphic(_gliffy.Text);if(child.length===0){child=self.__setupTextGraphic(node)}else{child=child[0]}self.__editText(child,keyEvent);self.deselect();_gliffy.KeyManager.setState("rte")}},getOverlayBoundingBox:function(){var node=this.getSelectedNode(),boundingBox;boundingBox=node.worldAabb.clone();return boundingBox},setLineDrawMode:function(lineDrawMode){this.__lineDrawMode=lineDrawMode},inStageViewport:function(){return this.getOverlayBoundingBox().inBoundingBox(this.__documentManager.getActiveStageViewPort())},__addConnectionHighlightHandler:function(){var unhighlightFunc,self=this;unhighlightFunc=function(){self.__unhighlightConnectionPoints();var connectionPoint=self.__getConnectionPoint(_gliffy.Mouse.getPosition());if(connectionPoint!==null){connectionPoint.addClass("gliffy-connection-point-highlight gliffy-icon-overlay-plus-on")}};$(".gliffy-stage").bind("mousemove.gliffyHighlight",function(){unhighlightFunc()});$(".gliffy-stage").bind("mousewheel.gliffyHighlight",function(event){if(!(_gliffy.BrowserDetect.browser==="Firefox")){self.__documentManager.redraw(function(){_gliffy.Mouse.updatePosition(event);unhighlightFunc()});self.__documentManager.redraw()}return true})},__removeConnectionHightlightHandler:function(){$(".gliffy-stage").unbind("mousemove.gliffyHighlight");$(".gliffy-stage").unbind("mousewheel.gliffyHighlight")},clearContextMenu:function(){return GliffyApp.contextMenuController.clearContextMenu(this.__contextMenu)},getContextMenuDefinition:function(){var self=this,contextMenu=[{Cut:{onclick:function(menuItem,menu){_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextMenu",action:"lineOverlayCut"});_gliffy.toolbarController.doCut()},className:"gliffy-context-menu-item-line-overlay gliffy-context-menu-item-cut"}},{Copy:{onclick:function(menuItem,menu){_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextMenu",action:"lineOverlayCopy"});_gliffy.toolbarController.doCopy()},className:"gliffy-context-menu-item-line-overlay gliffy-context-menu-item-copy"}},{Paste:{onclick:function(menuItem,menu){_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextMenu",action:"lineOverlayPaste"});_gliffy.Mouse.setLastMouseUpPosition(_gliffy.Mouse.getContextMenuMouseDownPosition());_gliffy.toolbarController.doPaste()},className:"gliffy-context-menu-item-line-overlay gliffy-context-menu-item-paste"}},{Delete:{onclick:function(menuItem,menu){_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextMenu",action:"lineOverlayDelete"});_gliffy.toolbarController.doDelete()},className:"gliffy-context-menu-item-line-overlay gliffy-context-menu-item-delete"}},$.contextMenu.separator,{"Bring to front":{onclick:function(menuItem,menu){_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextMenu",action:"lineOverlayToFront"});_gliffy.toolbarController.doBringToFront()},className:"gliffy-context-menu-item-line-overlay gliffy-context-menu-item-sendToFront"}},{"Send to back":{onclick:function(menuItem,menu){_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextMenu",action:"lineOverlayToBack"});_gliffy.toolbarController.doSendToBack()},className:"gliffy-context-menu-item-line-overlay gliffy-context-menu-item-sendToBack"}},$.contextMenu.separator,{"Reset connector path":{onclick:function(menuItem,menu){_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextMenu",action:"lineOverlayResetConnector"});var node=self.getSelectedNode();if(node){self.__startModifyLine();node.getGraphic().editable.clearLockSegments();self.__endModifyLine();self.__deferredDrawOverlay()}},className:"gliffy-context-menu-item-line-overlay gliffy-context-menu-item-reset-connector"}}];return contextMenu},beforeContextMenuShow:function(menu){var node=this.getSelectedNode(),isOrthoLine=false;_gliffy.Mouse.setContextMenuMouseDownPosition(_gliffy.Mouse.getPosition());if(node){isOrthoLine=node.getGraphic().isOrtho()}$(menu).find(".gliffy-context-menu-item-reset-connector").toggle(isOrthoLine);$(menu).find(".gliffy-context-menu-item-reset-connector").prev().toggle(isOrthoLine)}})}());(function(){_gliffy.TextControl=_gliffy.Class.extend({LINE_TEXT_WIDTH:200,__container:null,__rteNode:null,__object:null,__rteContainer:null,__initialWidth:0,__initialHeight:0,__documentManager:null,__editor:null,__nodeQueue:null,__cantUndoCallback:null,__bookmark:null,linkBrowser:null,lastUsedCss:null,__internal:false,init:function(o){var self=this,keyeventNode,keyeventParent,keyeventSiblings,keyIndex,keyeventGraphic,once=true;self.__container=o.target;self.__documentManager=o.documentManager;self.__editor=o.editor;_gliffy.KeyManager.registerState("rte",null,[{action:"zoomIn",keydown:function(e){return self.__blurAndPassKeyEvent(e)}},{action:"zoomOut",keydown:function(e){return self.__blurAndPassKeyEvent(e)}},{action:"save",keydown:function(e){return self.__blurAndPassKeyEvent(e)}},{action:"blur",keydown:function(e){self.__cancel();e.preventDefault();e.stopImmediatePropagation();return false}},{action:"undo",keydown:function(e){e.preventDefault();e.stopImmediatePropagation();return false}},{action:"redo",keydown:function(e){e.preventDefault();e.stopImmediatePropagation();return false}},{action:"selectAll",keydown:function(e){self.__gte.select();e.preventDefault();e.stopImmediatePropagation();return false}},{action:"switchFields",keydown:function(e){e.preventDefault();e.stopImmediatePropagation();keyeventNode=self.__object.node;keyeventParent=keyeventNode.getUidNode();keyeventSiblings=keyeventParent.findGraphic(_gliffy.Text);$("#gliffy-edit-text").trigger("customblur.gliffy-edit-text");if(keyeventParent.isMultipartShape()&&keyeventSiblings.length>1){for(keyIndex=0;keyIndex<keyeventSiblings.length;keyIndex++){if(keyeventNode.getId()===keyeventSiblings[keyIndex].getId()){break}}keyIndex=(keyIndex+1)%keyeventSiblings.length;keyeventGraphic=keyeventSiblings[keyIndex].getGraphic();self.__documentManager.redraw(function(){keyeventGraphic.editable.setEditMode(true);keyeventGraphic.editable.focus();keyeventGraphic.editable.setCursorEnd();self.edit(keyeventGraphic);keyeventGraphic.editable.registerBlurHandler(function(){GliffyApp.contextualPropertiesController.blurRTE(self);keyeventGraphic.editable.setEditMode(false);self.__documentManager.redraw()});_gliffy.KeyManager.setState("rte")})}return false}}],function(){_gliffy.KeyManager.resetModifierKeys()},function(){_gliffy.KeyManager.resetModifierKeys()})},reportAnalytics:function(cmd,val){var newVal=null;switch(cmd){case"FontName":cmd+=val;break;case"FontSize":newVal=parseInt(val.replace("px",""),10);break}if(newVal){_gliffy.Utils.analyticsEvent("trackEvent",{category:"tinyMCE",action:cmd,value:newVal})}else{_gliffy.Utils.analyticsEvent("trackEvent",{category:"tinyMCE",action:cmd})}},__blurAndPassKeyEvent:function(e){return false},__hasLineParent:function(){return this.__object&&this.__object.hasLineParent()},__updateTextDefaults:function(cmd,val){},getTinymceCommandName:function(cmd){var justify={JustifyLeft:"alignleft",JustifyCenter:"aligncenter",JustifyRight:"alignright"};if(justify[cmd]){return justify[cmd]}else{return cmd.toLowerCase()}},getTinymceButtonState:function(cmd){var command=cmd.toLowerCase(),selectorClass=".mceButton.mceButtonActive.mce_"+command;return $(selectorClass).length>0},reset:function(){},hideMenus:function(except){},getActiveObject:function(){return this.__object},setActiveObject:function(object){this.__object=object;this.__getObjectText()},setActiveObjectColor:function(hex){var tempText=this.__getObjectText();this.__css.color=hex;this.__updateObjectText(tempText)},edit:function(object){var textNode=object.node.getDomElement(),html,self=this,transform,width,height,background,key,uidNode,keyEvent=object.editable.__keyEvent;self.__object=object;$("#gliffy-edit-text_ifr").data("node",object.node);uidNode=self.__object.node.getUidNode();if(uidNode.isShape()&&uidNode.getGraphic()){if(uidNode.getUid()==="com.gliffy.shape.ui.ui_v2.miscellaneous.note"||uidNode.getUid()==="com.gliffy.shape.network.network_v3.business.cloud"||uidNode.getUid()==="com.gliffy.shape.network.network_v3.home.cloud"){background="#ffffff"}else{if(this.__object._vposition==="below"||this.__object._hposition==="right"){background=self.__object.node.stage.background==="transparent"?"#ffffff":self.__object.node.stage.background}else{background=uidNode.getGraphic().getFillColor()}}}else{background=self.__object.node.stage.background==="transparent"?"#ffffff":self.__object.node.stage.background}if(self.__hasLineParent()){self.__object.node.setX(0);self.__object.node.setY(0);self.__object.node.update()}self.__initialWidth=self.__object.style.width;self.__initialHeight=self.__object.style.height;if(self.__object.getOverflow()==="none"){width=self.__object.node.getWidth()-self.__object.getPaddingLeft()-self.__object.getPaddingRight()}else{width=self.__object.node.getWidth()}if(self.__object.node.isPartOfMultipartShape()){height=self.__object.node.getHeight()+self.__object.getPaddingTop()+self.__object.getPaddingBottom()}else{height=self.__object.node.getHeight()}transform=new _gliffy.AffineTransform().scale(self.__object.node.stage.getZoom(),self.__object.node.stage.getZoom()).concatenate(self.__object.node.worldTransform).translate(self.__object.style.x,self.__object.style.y);if(!self.__gte){self.__modal=$("<div id='gliffy-gte' class='gliffy-popup'><div class='modal'><div class='modal-header'>"+$.i18n._("DESKTOP_GTE_ADD_TEXT")+"</div><div class='modal-body'><div class='toolbar-top defaultSkin'><div class='btn-group'><a id='gliffy-gte-bold' class='btn gliffy-gte-format toggle' data-style='font-weight' data-value='bold' data-toggle='button' href='#'><span class='mceIcon mce_bold'></span></a><a id='gliffy-gte-italic' class='btn gliffy-gte-format toggle' data-style='font-style' data-value='italic' data-toggle='button' href='#'><span class='mceIcon mce_italic'></span></a><a id='gliffy-gte-underline' class='btn gliffy-gte-format toggle' data-style='text-decoration' data-value='underline' data-toggle='button' href='#'><span class='mceIcon mce_underline'></span></a></div><div class='btn-group' data-toggle='buttons-radio'><a id='gliffy-gte-justifyleft' class='btn gliffy-gte-format' data-style='text-align' data-value='left' href='#'><span class='mceIcon mce_justifyleft'></span></a><a id='gliffy-gte-justifycenter' class='btn gliffy-gte-format' data-style='text-align' data-value='center' href='#'><span class='mceIcon mce_justifycenter'></span></a><a id='gliffy-gte-justifyright' class='btn gliffy-gte-format' data-style='text-align' data-value='right' href='#'><span class='mceIcon mce_justifyright'></span></a></div><div class='btn-group'><a id='gliffy-gte-forecolor' class='btn' href='#'><span class='mceIcon mce_gliffyforecolor'></span></a></div><div id='gliffy-gte-fontfamily-dropdown' class='btn-group dropdown'><a id='gliffy-gte-fontfamily' class='btn dropdown-toggle' data-toggle='dropdown' href='#'><span class='mceIcon mce_gliffycarret'></span><span class='mceIcon mce_gliffyfontfamily'>Ariel</span></a><ul style='top: 100%;' class='dropdown-menu'><li><a href='#' class='gliffy-gte-format' data-style='font-family' data-value='Arial'><span class='arial'>Arial</span></a></li><li><a href='#' class='gliffy-gte-format' data-style='font-family' data-value='Helvetica'><span class='helvetica'>Helvetica</span></a></li><li><a href='#' class='gliffy-gte-format' data-style='font-family' data-value='Courier'><span class='courier'>Courier</span></a></li><li><a href='#' class='gliffy-gte-format' data-style='font-family' data-value='Times'><span class='times'>Times</span></a></li><li><a href='#' class='gliffy-gte-format' data-style='font-family' data-value='Verdana'><span class='verdana'>Verdana</span></a></li></ul></div><div id='gliffy-gte-fontsize-dropdown' class='btn-group dropdown'><a id='gliffy-gte-fontsize' class='btn dropdown-toggle' data-toggle='dropdown' href='#'><span class='mceIcon mce_gliffycarret'></span><span class='mceIcon mce_gliffyfontsize'>12px</span></a><ul style='top: 100%;' class='dropdown-menu'><li><a href='#' class='gliffy-gte-format' data-style='font-size' data-value='9px'><span>9px</span></a></li><li><a href='#' class='gliffy-gte-format' data-style='font-size' data-value='9px'><span>10px</span></a></li><li><a href='#' class='gliffy-gte-format' data-style='font-size' data-value='11px'><span>11px</span></a></li><li><a href='#' class='gliffy-gte-format' data-style='font-size' data-value='12px'><span>12px</span></a></li><li><a href='#' class='gliffy-gte-format' data-style='font-size' data-value='13px'><span>13px</span></a></li><li><a href='#' class='gliffy-gte-format' data-style='font-size' data-value='14px'><span>14px</span></a></li><li><a href='#' class='gliffy-gte-format' data-style='font-size' data-value='18px'><span>18px</span></a></li><li><a href='#' class='gliffy-gte-format' data-style='font-size' data-value='24px'><span>24px</span></a></li><li><a href='#' class='gliffy-gte-format' data-style='font-size' data-value='36px'><span>36px</span></a></li><li><a href='#' class='gliffy-gte-format' data-style='font-size' data-value='48px'><span>48px</span></a></li><li><a href='#' class='gliffy-gte-format' data-style='font-size' data-value='64px'><span>64px</span></a></li><li><a href='#' class='gliffy-gte-format' data-style='font-size' data-value='72px'><span>72px</span></a></li><li><a href='#' class='gliffy-gte-format' data-style='font-size' data-value='96px'><span>96px</span></a></li><li><a href='#' class='gliffy-gte-format' data-style='font-size' data-value='110px'><span>110px</span></a></li><li><a href='#' class='gliffy-gte-format' data-style='font-size' data-value='127px'><span>127px</span></a></li></ul></div></div><textarea class='gte'></textarea><div class='toolbar-bottom'><button id='gliffy-gte-ok' class='btn gliffy-btn-primary'>"+$.i18n._("online.modal.ok")+"</button><button id='gliffy-gte-cancel' class='btn'>"+$.i18n._("online.modal.cancel")+"</button></div></div></div></div>");$("#gliffy").append(this.__modal);this.__gte=this.__modal.find(".gte");this.__modal.find("#gliffy-gte-ok").click(function(ev){self.__accept()});this.__modal.find("#gliffy-gte-cancel").click(function(ev){self.__cancel()});this.__modal.find("#gliffy-gte-forecolor").click(function(ev){$(ev.currentTarget).toggleClass("active");GliffyApp.colorpickerController.toggleColorSwatchPicker(ev.currentTarget,{resetDialogControls:function(){},getTargetColor:function(){return self.__css.color},getTargetNodes:function(){return self.__object.node.getLeafNodes()},handleColorpickerColorChange:function(hex,mode){self.__css.color=hex;self.__updateGteStyle()}});GliffyApp.colorpickerController.setSelectedSwatchColor(self.__css.color);ev.stopPropagation()}).mousedown(function(ev){ev.preventDefault();ev.stopImmediatePropagation();return false});this.__modal.find(".gliffy-gte-format").click(function(ev){var target=$(ev.currentTarget),value=ev.currentTarget.dataset.value,style=ev.currentTarget.dataset.style;if(target.hasClass("toggle")&&self.__css[style]===value){delete self.__css[style]}else{self.__css[style]=value}self.__updateGteStyle()}).mousedown(function(ev){ev.preventDefault();ev.stopImmediatePropagation();return false});this.__modal.find("#gliffy-gte-fontfamily").mousedown(function(ev){ev.preventDefault();ev.stopImmediatePropagation();return false});this.__modal.find("#gliffy-gte-fontfamily-dropdown ul a").click(function(ev){var value=ev.currentTarget.dataset.value;self.__modal.find(".mce_gliffyfontfamily").html(value);self.__modal.find(".mce_gliffyfontfamily").css("font-family",value);self.__modal.find("#gliffy-gte-fontfamily-dropdown a").removeClass("active");$(ev.currentTarget).addClass("active")}).mousedown(function(ev){ev.preventDefault();ev.stopImmediatePropagation();return false});this.__modal.find("#gliffy-gte-fontsize").mousedown(function(ev){ev.preventDefault();ev.stopImmediatePropagation();return false});this.__modal.find("#gliffy-gte-fontsize-dropdown ul a").click(function(ev){var value=ev.currentTarget.dataset.value;self.__modal.find(".mce_gliffyfontsize").html(value);self.__modal.find("#gliffy-gte-fontsize-dropdown a").removeClass("active");$(ev.currentTarget).addClass("active")}).mousedown(function(ev){ev.preventDefault();ev.stopImmediatePropagation();return false});this.__modal.click(function(ev){self.__modal.find("#gliffy-gte-forecolor").removeClass("active");GliffyApp.colorpickerController.hideColorpicker()});this.__gte.keydown("esc",function(e){self.__cancel()}).keydown("ctrl+z",function(e){e.preventDefault();e.stopImmediatePropagation();return false}).keydown("ctrl+y",function(e){e.preventDefault();e.stopImmediatePropagation();return false}).keydown("meta+z",function(e){e.preventDefault();e.stopImmediatePropagation();return false}).keydown("meta+shift+z",function(e){e.preventDefault();e.stopImmediatePropagation();return false})}if(GliffyApp.contextualPropertiesController.__addingLoremIpsum){self.__gte.val(_gliffy.Editor.LOREM_IPSUM_TEXT)}else{self.__gte.val(self.__getObjectText())}self.__updateGteStyle();this.__modal.find(".active").removeClass("active");for(key in this.__css){if(this.__css.hasOwnProperty(key)){this.__modal.find(".gliffy-gte-format[data-style="+key+"][data-value="+this.__css[key]+"]").addClass("active")}}self.__modal.find(".mce_gliffyfontfamily").html(this.__css["font-family"]);self.__modal.find(".mce_gliffyfontsize").html(this.__css["font-size"]);self.__gte.css("background",background);self.__modal.show();self.__object.editable.setEditMode(true);if(keyEvent){self.__setSelectedText(self.__gte[0],1,1)}else{self.__gte.focus();self.__gte.select()}},__setSelectedText:function(input,selectionStart,selectionEnd){if(input.setSelectionRange){input.focus();input.setSelectionRange(selectionStart,selectionEnd)}},__updateNodeSize:function(){if(this.__object){var node=this.__editor.getDocumentManager().getActiveStage().find(this.__object.node.getId()),parent,change,height,width;height=this.__object.getCalculatedHeight();if(height!==undefined&&height!==null){if(node.isPartOfMultipartShape()){parent=node.getUidNode();if(parent.getUid()==="com.gliffy.shape.bpmn.bpmn_v1.data_artifacts.annotation"){change=(node.getHeight()-(node.getGraphic().getPaddingTop()+node.getGraphic().getPaddingBottom()+height))/2;if(Math.abs(change)>5){parent.setY(parent.getY()+change)}}node.setHeight(height+node.getGraphic().getPaddingTop()+node.getGraphic().getPaddingBottom())}else{node.setHeight(height)}this.__editor.getDocumentManager().redraw()}}},__updateGteStyle:function(){var face=this.__css["font-family"]||"Arial",weight=this.__css["font-weight"]||"normal",size=this.__css["font-size"]?parseInt(this.__css["font-size"]):12,lineHeight=null,background=this.__gte.css("background");if(_gliffy.TextUtils.FONT_FIXES[face]&&_gliffy.TextUtils.FONT_FIXES[face][weight]&&_gliffy.TextUtils.FONT_FIXES[face][weight][size]){lineHeight=(_gliffy.TextUtils.FONT_FIXES[face][weight][size]+size)+"px"}this.__gte.removeAttr("style");this.__gte.css($.extend({"line-height":lineHeight,background:background},this.__css))},__shouldRemoveNode:function(content){var isMultipart=this.__object.node.getUidNode().isMultipartShape();return !isMultipart&&/^\s*$/.test(content)},__removeNode:function(){this.__object.node.stage.commandHistory.addAndExecuteCommand(new _gliffy.RemoveNodeCommand({node:this.__object.node}));this.__object=null;this.__editor.getDocumentManager().redraw()},removeEmptyText:function(node){this.__object=node.getGraphic();this.__selectOrRemove(this.__getObjectText());this.__object=null},__selectOrRemove:function(content){this.__object.editable.setEditMode(false);if(this.__shouldRemoveNode(content)){if(this.__object.node.getRootParent()!==this.__object.node){this.__editor.overlayManager.selectNode(this.__object.node.getRootParent())}this.__removeNode()}else{this.__editor.overlayManager.selectNode(this.__object.node.getRootParent())}},__cancel:function(){this.__selectOrRemove(this.__originalVal);this.__closeModal()},__accept:function(){if(!this.__shouldRemoveNode(this.__gte.val())){this.__setObjectText();this.__updateNodeSize()}this.__selectOrRemove(this.__gte.val());this.__closeModal()},__closeModal:function(){var overlay=this.__editor.overlayManager.getActiveOverlay();if(overlay){GliffyApp.contextualPropertiesController.showControls(overlay)}GliffyApp.contextualPropertiesController.__addingLoremIpsum=false;this.__modal.hide()},__setObjectText:function(){var text=GLIFFY.Utils.escapeHTML(this.__gte.val());this.__updateObjectText(text)},__updateObjectText:function(text){var command,style,key,pStyle;if(this.__object){style="";pStyle=this.__css["text-align"]?"text-align:"+this.__css["text-align"]+";":"";this.lastUsedCss=this.__css;for(key in this.__css){if(this.__css.hasOwnProperty(key)&&key!=="text-align"){style+=key+":"+this.__css[key]+";"}}text=text.split("\n");for(var i=0;i<text.length;i++){var newline=(i==text.length-1)?(""):("\n");text[i]="<p style='"+pStyle+"'><span style='"+style+"'>"+text[i]+newline+"</span></p>"}text=text.join("");command=new _gliffy.SetTextCommand({node:this.__object.node,text:text});this.__object.node.stage.commandHistory.addAndExecuteCommand(command)}},__getObjectText:function(){var textData=new _gliffy.TextData(),result=[],lines,i,format,key;lines=textData.parseText(this.__object.getHTML()).getOldStyleLines();this.__css=$.extend({"font-size":"12px","text-align":"center","font-family":"Arial",color:"#000000","white-space":"pre-wrap"},textData.defaultStyle);if(this.__object.editable.__keyEvent){this.__originalVal=String.fromCharCode(this.__object.editable.__keyEvent.keyCode);this.__object.editable.__keyEvent=null}else{if(textData.lines.length>0&&textData.lines[0].textBlocks.length>0){format=textData.lines[0].textBlocks[0].style;this.__css=$.extend(this.__css,format)}else{if(this.lastUsedCss){this.__css=this.lastUsedCss}}delete this.__css.text;delete this.__css["line-height"];for(i=0;i<lines.length;i++){result.push(lines[i].text)}this.__originalVal=result.join("")}return this.__originalVal},__stripLineHeights:function(html){var $html=$("<div/>").append($(html));$html.find("span").each(function(){$(this).css("line-height","")});return $html.html()},__linkAction:function(self,ed){var callback,existingLink,e,currentLink=null;callback=function(value){var anchor,formatter=ed.formatter,dom=ed.dom,selection=ed.selection,rteActive=$("#gliffy-edit-text_ifr").is(":visible"),textNodes;if(tinyMCE.isIE&&self.__bookmark){ed.selection.moveToBookmark(self.__bookmark)}if(!rteActive){textNodes=self.__editor.overlayManager.getSelectedNode().findGraphic(_gliffy.Text);if(textNodes.length>=1){ed.setContent(textNodes[0].getGraphic().getHTML());$("#gliffy-edit-text-container").css({display:""});ed.focus();ed.selection.select(ed.getBody(),true);$("#gliffy-edit-text-container").css("display","none");dom=ed.dom}}if(typeof(value)==="string"){value={href:value}}anchor=dom.getParent(selection.getNode(),"a");value.href=value.href.replace(" ","%20");if(!anchor||!value.href){formatter.remove("link")}if(value.href){formatter.apply("link",value,anchor)}if(!rteActive&&textNodes.length>=1){textNodes[0].stage.commandHistory.addAndExecuteCommand(new _gliffy.SetTextCommand({node:textNodes[0],text:ed.getContent()}));_gliffy.Utils.stealFocus();self.__documentManager.redraw()}else{if(ed){ed.undoManager.add()}}};if(tinyMCE.isIE){self.__bookmark=ed.selection.getBookmark()}e=ed.dom.getParent(ed.selection.getNode(),"A");if(e){currentLink=ed.dom.getAttrib(e,"href")}self.linkBrowser.show(callback,currentLink)},__setupTooltips:function(){var i,add=[$("#gliffy-edit-text_bold"),$("#gliffy-edit-text_italic"),$("#gliffy-edit-text_underline"),$("#gliffy-edit-text_justifyleft"),$("#gliffy-edit-text_justifycenter"),$("#gliffy-edit-text_justifyright"),$("#gliffy-edit-text_link"),$("#gliffy-edit-text_unlink"),$("#gliffy-edit-text_gliffyforecolor")];for(i=0;i<add.length;i++){add[i].tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD)}$("#gliffy-edit-text_forecolor table").attr("title","")},doUndo:function(cantUndoCallback){var localCallback;cantUndoCallback=cantUndoCallback===undefined?null:cantUndoCallback;this.__cantUndoCallback=cantUndoCallback;this.__cantUndoCallback=null},debugEvents:function(ed,log){}})}());(function(){_gliffy.LinkBrowser=_gliffy.Class.extend({__url:null,__urlRegex:null,__protocolRegex:null,init:function(o){this.__urlRegex=new RegExp("^(http|https|file|ftp|mailto|notes):\\/\\/(((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:)*@)?((\\[(|(v[\\da-f]{1,}\\.(([a-z]|\\d|-|\\.|_|~)|[!\\$&'\\(\\)\\*\\+,;=]|:)+))\\])|((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5]))|((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)*(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.?)(:\\d*)?)(\\/((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)+(\\/(([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)*)*)?)?(\\?((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)|[\\uE000-\\uF8FF]|\\/|\\?)*)?(\\#((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)|\\/|\\?)*)?$","i");this.__protocolRegex=new RegExp("^(.*?):");this.__url="http://"},show:function(applyURL,url){var self=this,keyUpFunc;self.__url=url||"http://";_gliffy.Dialog.showGenericDialog({content:'<p style="text-align:center">'+$.i18n._("LINKBROWSER_WEB_ADDRESS")+': <input type="text" tabindex="0" class="gliffy-url-input" name="destination" size="100" value="http://"/></p><p style="text-align:center" class="gliffy-url-message">'+$.i18n._("LINKBROWSER_PLEASE_ENTER_A_VALID_URL")+"</p>",title:$.i18n._("LINKBROWSER_INSERT_LINK"),cancelCallback:null,escapeHTML:false,skipNodeDeselect:true,buttons:[{text:$.i18n._("LINKBROWSER_INSERT_LINK"),callback:function(button){if(!$(button).hasClass("disabled")){self.__unbindHandlers();applyURL(self.__url);_gliffy.Dialog.hide()}},primary:true,dismiss:false,add_classes:["gliffy-insert-link-button","disabled"]},{text:$.i18n._("LINKBROWSER_CANCEL"),callback:self.__unbindHandlers,primary:false,dismiss:true}]});$(".gliffy-url-input").focus().val(self.__url);$(".gliffy-url-input").bind("keyup.gliffy-url-input",function(e){self.__keyUpFunc(e,$(this));if(e.keyCode===13){$(".gliffy-insert-link-button").click()}});self.__keyUpFunc(null,$(".gliffy-url-input"));setTimeout(function(){$(".gliffy-url-input").focus();$(".gliffy-url-input").get(0).setSelectionRange(self.__url.length,self.__url.length)},100)},__validateUrl:function(valUrl){return this.__urlRegex.test(valUrl)||!this.__protocolRegex.test(valUrl)},__unbindHandlers:function(){$(".gliffy-url-input").unbind("keyup.gliffy-url-input")},__keyUpFunc:function(e,jqEle){var weblink_url=jqEle.val().replace(" ","%20");if(this.__validateUrl(weblink_url)){this.__url=weblink_url;$(".gliffy-insert-link-button").removeClass("disabled");$(".gliffy-url-message").css("visibility","hidden")}else{$(".gliffy-insert-link-button").addClass("disabled");$(".gliffy-url-message").css("visibility","visible")}}})}());(function(){var KEYS_PC={nudgeStageUp:"up",nudgeStageLeft:"left",nudgeStageDown:"down",nudgeStageRight:"right",jumpStageUp:"ctrl+up",jumpStageLeft:"ctrl+left",jumpStageDown:"ctrl+down",jumpStageRight:"ctrl+right",doNothing:"home end pagedown pageup",arrowsDoNothing:"up down left right shift+up shift+down shift+right shift+left",cut:"ctrl+x",copy:"ctrl+c",paste:"ctrl+v","delete":"backspace del",blur:"esc",selectAll:"ctrl+a",toggleFrameRate:"ctrl+shift+d",undo:"ctrl+z",redo:"ctrl+shift+z ctrl+y",textMode:"ctrl+2",ellipseMode:"ctrl+9",rectMode:"ctrl+8",connectMode:"ctrl+3",lineMode:"ctrl+6",nudgeLeft:"left shift+left",nudgeRight:"right shift+right",nudgeUp:"up shift+up",nudgeDown:"down shift+down",enterRTE:"F2",dumpFile:"ctrl+shift+F1",toggleVersionInfo:"ctrl+shift+F2",group:"ctrl+g",ungroup:"ctrl+u",sendFront:"ctrl+f",sendBack:"ctrl+b",save:"ctrl+s",zoomIn:"alt+plus alt+ffplus alt+numpadplus ctrl+plus ctrl+ffplus ctrl+numpadplus",zoomOut:"alt+minus alt+ffminus alt+numpadminus ctrl+minus ctrl+ffminus ctrl+numpadminus",pan:"space",switchFields:"tab"},KEYS_MAC={nudgeStageUp:"up",nudgeStageLeft:"left",nudgeStageDown:"down",nudgeStageRight:"right",jumpStageUp:"meta+up",jumpStageLeft:"meta+left",jumpStageDown:"meta+down",jumpStageRight:"meta+right",doNothing:"home end pagedown pageup",arrowsDoNothing:"up down left right shift+up shift+down shift+right shift+left",cut:"meta+x",copy:"meta+c",paste:"meta+v","delete":"backspace del",blur:"esc",selectAll:"meta+a",toggleFrameRate:"meta+shift+d",undo:"meta+z",redo:"meta+shift+z meta+y",textMode:"meta+2",ellipseMode:"meta+9",rectMode:"meta+8",connectMode:"meta+3",lineMode:"meta+6",nudgeLeft:"left shift+left",nudgeRight:"right shift+right",nudgeUp:"up shift+up",nudgeDown:"down shift+down",enterRTE:"F2",dumpFile:"meta+shift+F1",toggleVersionInfo:"meta+shift+F2",group:"meta+g",ungroup:"meta+u",sendFront:"meta+f",sendBack:"meta+b",save:"meta+s",zoomIn:"meta+plus meta+ffplus meta+numpadplus",zoomOut:"meta+minus meta+ffminus meta+numpadminus",pan:"space",switchFields:"tab"};_gliffy.Editor=_gliffy.Class.extend({__documentManager:null,__actions:null,overlayManager:null,drawManager:null,documentTabsController:null,container:null,rootServiceUrl:null,rootResourceUrl:null,imageContext:null,readyCallback:null,errorCallback:null,colorPicker:null,__drawMode:0,__node:null,__mouseDownPosition:null,__contextMenu:null,containerBounds:null,postSaveCallback:null,saving:false,productVersion:null,customerId:null,language:null,init:function(o){if(!o){throw new Error("editor init needs options")}else{if(!o.target){throw new Error("editor init options needs target")}else{if(!o.rootServiceUrl){throw new Error("editor init options needs rootServiceUrl")}else{if(!o.integration){throw new Error("editor init options needs integration")}}}}_gliffy.IntegrationHandler.validate(o.integration);var options,self=this,editor=this,dragStageDiv,selectedNode;this.integration=o.integration;this.container=o.target;this.rootServiceUrl=o.rootServiceUrl;this.rootResourceUrl=(o.rootResourceUrl!==undefined)?o.rootResourceUrl:null;this.imageContext=o.imageContext;this.__actions=o.actions;this.productVersion=o.productVersion;this.customerId=o.customerId;this.readyCallback=o.readyCallback;this.errorCallback=o.errorCallback;this.draftInterval=o.draftInterval||30;this.draftsEnabled=o.draftsEnabled||false;this.analyticsEnabled=(o.analyticsEnabled!==undefined?o.analyticsEnabled:true);this.analyticsAccount=o.analyticsAccount||"UA-248648-8";this.analyticsLabel=o.analyticsLabel||null;this.analyticsProduct=o.analyticsProduct||"none";this.analyticsLicense=o.analyticsLicense||"none";this.analyticsNumUsers=o.analyticsNumUsers||0;this.language=o.language||null;this.imageExportType=o.imageExportType||"smallest";this.bindBeforeUnloadOverride=o.bindBeforeUnloadOverride;this.confluenceVersion=o.confluenceVersion||null;_gliffy.confluenceVersion=this.confluenceVersion;_gliffy.versionString=this.productVersion;_gliffy.CursorManager=new _gliffy._CursorManager({container:this.container});_gliffy.KeyManager=new _gliffy._KeyManager({container:this.container,editor:this});window.GLIFFY.KeyManager=_gliffy.KeyManager;this.init_i18n();if(this.analyticsEnabled){_gliffy.Utils.analyticsEvent("init",{accountType:"google",accountID:this.analyticsAccount,debug:_gliffy.Debug.USE_ANALYTICS_DEBUG_JS});if(_gliffy.Debug.LOG_ANALYTICS){_gliffy.Utils.analyticsEvent("logEvents",{logEvents:true,logger:_gliffy.Logger})}if(this.analyticsLabel){_gliffy.Utils.analyticsEvent("setLabel",{label:this.analyticsLabel})}_gliffy.Utils.analyticsEvent("setCustomVariables",{product:this.analyticsProduct,license:this.analyticsLicense,numUsers:(this.analyticsNumUsers+" Users")});_gliffy.Utils.analyticsEvent("trackEvent",{category:"editorLanguage",action:(this.language||"en"),non_interaction:true})}if($.browser.msie){$("body").on("selectstart","div",function(e){if($("input:focus, textarea:focus").length===0){e.preventDefault()}})}if(_gliffy.BrowserDetect.OS==="Mac"){_gliffy.KeyManager.addKeyBindings(KEYS_MAC)}else{_gliffy.KeyManager.addKeyBindings(KEYS_PC)}$("body").bind("send-error.gliffy-body",function(event,errorObj){if(self.errorCallback){self.errorCallback(errorObj)}});this.__documentManager=new _gliffy.DocumentManager({editor:this});dragStageDiv=new _gliffy.StageDiv({documentManager:this.__documentManager,container:this.container});options={documentManager:this.__documentManager,target:o.target,editor:this,dragStageDiv:dragStageDiv,linkBrowser:o.linkBrowser};GliffyApp.documentModel=GliffyApp.DocumentModel.create();GliffyApp.contextualPropertiesController=GliffyApp.ContextualPropertiesController.create({__editor:this});GliffyApp.colorpickerController=GliffyApp.ColorpickerController.create({__editor:this});GliffyApp.contextMenuController=GliffyApp.ContextMenuController.create({__editor:this});GliffyApp.tipsController=GliffyApp.TipsController.create({__editor:this,__tips:o.tips});GliffyApp.pageNavigatorController=GliffyApp.PageNavigatorController.create({__editor:this});GliffyApp.imageBrowserController=GliffyApp.ImageBrowserController.create({__editor:this});GliffyApp.progressBarController=GliffyApp.ProgressBarController.create();if(this.container.find("gliffy-stage").length===0){this.container.append($("<div />",{"class":"gliffy-stage"}))}_gliffy.Mouse=new _gliffy._Mouse({editor:self});window.GLIFFY.Mouse=_gliffy.Mouse;_gliffy.Mouse.registerClickState({name:"stage",target:".gliffy-stage",modes:$.extend([],_gliffy.Editor.DRAW_MODE_NAMES),mouseDown:function(event){var self=_gliffy.Mouse,pos;_gliffy.Mouse.setClickMode("stage");_gliffy.Utils.stealFocus();$("#gliffy-edit-text").trigger("customblur.gliffy-edit-text");if(self.getState()==="none"){pos=_gliffy.Mouse.getPosition();selectedNode=_gliffy.Pick.getNodeAt(editor.getDocumentManager().getActiveStage().objects,pos.x,pos.y);if(!selectedNode&&(_gliffy.KeyManager.shiftKeyDown||_gliffy.KeyManager.metaCtrlKeyDown)){self.__mousedown(event)}else{if(!selectedNode||(selectedNode.getLockPosition()&&!(_gliffy.KeyManager.shiftKeyDown||_gliffy.KeyManager.metaCtrlKeyDown))){editor.overlayManager.singleDownNoNode(event);self.__mousedown(event)}else{editor.getDocumentManager().pushCommandBundle();editor.overlayManager.singleDownWithNode(event,selectedNode)}}}else{if(self.getState()!=="line"&&self.getState()!=="ortho"){editor.overlayManager.singleDownNoNode(event);if(self.getState()==="none"){pos=_gliffy.Mouse.getPosition();selectedNode=_gliffy.Pick.getNodeAt(editor.getDocumentManager().getActiveStage().objects,pos.x,pos.y);if(selectedNode){editor.getDocumentManager().pushCommandBundle();editor.overlayManager.singleDownWithNode(event,selectedNode)}else{self.__mousedown(event)}}else{self.__mousedown(event)}}else{self.__mousedown(event)}}}});_gliffy.Mouse.setState("none");this.overlayManager=new _gliffy.OverlayManager(options);this.selector=new _gliffy.Selector({documentManager:options.documentManager,overlayManager:this.overlayManager,stageDiv:options.dragStageDiv});this.zoomOverlay=new _gliffy.ZoomOverlay({stageDiv:options.dragStageDiv,documentManager:options.documentManager});this.drawManager=new _gliffy.DrawManager(options);GliffyApp.documentTabsController=GliffyApp.DocumentTabsController.create({__editor:this});this.documentTabsController=GliffyApp.documentTabsController;GliffyApp.themeController=GliffyApp.ThemeController.create({__editor:this});GliffyApp.documentPropertiesController=GliffyApp.DocumentPropertiesController.create();GliffyApp.documentPropertiesController.setEditor(this);GliffyApp.saveDialogController=GliffyApp.SaveDialogController.create({__editor:this});_gliffy.toolbarController=GliffyApp.toolbarController.create({__editor:this});window.GLIFFY.toolbarController=_gliffy.toolbarController;this.grid=new _gliffy.Grid({documentManager:this.__documentManager});GliffyApp.revisionHistoryController=GliffyApp.RevisionHistoryController.create({__editor:this});GliffyApp.hudController=GliffyApp.HudController.create({__editor:this});GliffyApp.shapeLibraryController=GliffyApp.ShapeLibraryController.create({__editor:this});this.createUntitledTab(function(){if(self.readyCallback){self.readyCallback(self)}});this.setDrawMode(_gliffy.Editor.DRAW_MODE.none);this.colorPicker=$("#gliffy-colorpicker").ColorPicker({flat:true});this.__bindResizeContainer();this.drawManager.bindDrawHandlers();GliffyApp.contextMenuController.createContextMenu(this,$(".gliffy-stage"),this.getStageContextMenuObject(),"gliffy-context-menu-stage");GliffyApp.saveDialogController.getFilenameElement().click(function(event){GliffyApp.saveDialogController.getFilenameElement().parents("div.control-group").removeClass("error").find("span.help-inline").empty()});$(window).unbind("rte-resize.gliffy-edit-text.editable-text").bind("rte-resize.gliffy-edit-text.editable-text",function(event){var node=self.getDocumentManager().getActiveStage().find(event.node.getId()),parent,change;if(node){if(event.w!==undefined&&event.w!==null){node.setWidth(event.w);self.getDocumentManager().redraw()}if(event.h!==undefined&&event.h!==null){if(node.isPartOfMultipartShape()){parent=node.getUidNode();if(parent.getUid()==="com.gliffy.shape.bpmn.bpmn_v1.data_artifacts.annotation"){change=(node.getHeight()-(node.getGraphic().getPaddingTop()+node.getGraphic().getPaddingBottom()+event.h))/2;if(Math.abs(change)>5){parent.setY(parent.getY()+change)}}node.setHeight(event.h+node.getGraphic().getPaddingTop()+node.getGraphic().getPaddingBottom())}else{node.setHeight(event.h)}self.getDocumentManager().redraw()}}});_gliffy.Align=new _gliffy._Align({documentManager:this.__documentManager});_gliffy.RenderLoop.start();$("body").on("shown",".gliffy-popup .modal",function(){var skipNodeDeselect=($(this).data("skipNodeDeselect"))||false;$(this).removeData("skipNodeDeselect");if(!skipNodeDeselect){self.overlayManager.deselectAll();_gliffy.KeyManager.handleEscKeypress()}_gliffy.KeyManager.setState("modals");$(this).on("focus","input",function(event){_gliffy.KeyManager.setState("input")});$(this).on("focus","textarea",function(event){_gliffy.KeyManager.setState("input")});$(this).on("blur","input",function(event){if(_gliffy.KeyManager.getState()==="input"){_gliffy.KeyManager.setLastState()}});$(this).on("blur","textarea",function(event){if(_gliffy.KeyManager.getState()==="input"){_gliffy.KeyManager.setLastState()}})});$("body").on("hidden",".gliffy-popup .modal",function(){_gliffy.KeyManager.setState("stage");$(this).off("focus","input");$(this).off("focus","textarea");$(this).off("blur","input");$(this).off("blur","textarea")});_gliffy.KeyManager.registerState("modals","default",[{action:"nudgeStageRight",keydown:function(e){e.preventDefault()}},{action:"nudgeStageLeft",keydown:function(e){e.preventDefault()}},{action:"nudgeStageDown",keydown:function(e){e.preventDefault()}},{action:"nudgeStageUp",keydown:function(e){e.preventDefault()}},{action:"jumpStageRight",keydown:function(e){e.preventDefault()}},{action:"jumpStageLeft",keydown:function(e){e.preventDefault()}},{action:"jumpStageDown",keydown:function(e){e.preventDefault()}},{action:"jumpStageUp",keydown:function(e){e.preventDefault()}}]);if(!window.jasmine){this.initNavigator()}this.bindBeforeUnload(this.bindBeforeUnloadOverride)},init_i18n:function(){$(".gliffy-colorswatchpicker button").tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD)},openTips:function(){GliffyApp.tipsController.openOnInit()},openUpdateSplash:function(options){if(window.GLIFFY&&window.GLIFFY.updateSplashController){return window.GLIFFY.updateSplashController.openOnInit(options)}return false},initNavigator:function(){var zoomAmounts=_gliffy.ZoomOverlay.ZOOM_AMOUNTS,slider,self=this,lastValue;lastValue=zoomAmounts.indexOf(1);slider=new _gliffy.Slider({target:$("#gliffy-navigator-zoom-slider"),namespace:"gliffy.editor.zoom",min:0,max:zoomAmounts.length-1,value:lastValue,reset_value:lastValue,reset_step:1,step:1,dragCallback:function(slider){var actualZoom=self.getDocumentManager().getActiveStage().getZoom(),sliderZoom=zoomAmounts[Math.round(slider.value)];if(!_gliffy.Utils.floatEquals(sliderZoom,actualZoom)){$("#gliffy-edit-text").trigger("customblur.gliffy-edit-text");self.overlayManager.deselectAll();self.getDocumentManager().zoomToCenter(sliderZoom)}}});$(document).bind("gliffy.zoom",function(event,value){var smallestDiff=10000,smallestDiffIdx=null,i,diff;for(i=0;i<zoomAmounts.length;i++){diff=Math.abs(zoomAmounts[i]-value);if(diff<smallestDiff){smallestDiff=diff;smallestDiffIdx=i}}if(smallestDiffIdx!==null){slider.value=smallestDiffIdx;slider.moveHandle()}})},isSaving:function(){return this.saving},getDocumentManager:function(){return this.__documentManager},unsavedChanges:function(){var i;for(i=0;i<this.getDocumentManager().getDocuments().length;i++){if(this.getDocumentManager().getDocuments()[i].getStage().hasUnsavedChanges()){return true}}return false},open:function(options){this.getDocumentManager().disableRenderLoop();this.container.scrollTop(0).scrollLeft(0);options.target=this.container;_gliffy.Mouse.reset();this.overlayManager.textControl.reset();this.getDocumentManager().render(options)},openInNewTab:function(options){GliffyApp.documentTabsController.selectTab(new _gliffy.Document());this.open(options)},openTemplateFromGON:function(gon,options){var jsonObj={name:"untitled",version:0,gon:gon};options.jsonObj=jsonObj;this.open(options)},createUntitledTab:function(callback){this.__documentManager.setActiveDocument(new _gliffy.Document());this.create(callback)},create:function(callback){if(!window.jasmine){this.open({jsonObj:new _gliffy.Document().toObject(),scale:1,callback:callback})}},close:function(){var self=this;if(this.unsavedChanges()){_gliffy.Dialog.showYesNoDialog({title:$.i18n._("EDITOR_CONFIRM_NAVIGATION"),content:$.i18n._("EDITOR_YOU_HAVE_UNSAVED_CHANGES._ARE_YOU_SURE_YOU_WANT_TO_LEAVE_THIS_PAGE?"),cancelCallback:null,buttons:[{text:$.i18n._("EDITOR_STAY_ON_THIS_PAGE"),callback:null,primary:false,dismiss:true},{text:$.i18n._("EDITOR_LEAVE_THIS_PAGE"),callback:function(e){self.__close();return false},primary:true,dismiss:true}]})}else{this.__close()}},__close:function(){var i;for(i=0;i<this.getDocumentManager().getDocuments().length;i++){this.getDocumentManager().getDocuments()[i].getStage().setUnsavedChanges(false)}if(window.parent!==window){GliffyApp.documentTabsController.closeAllTabs();this.getDocumentManager().cleanTarget()}this.performAction("close")},closeLastTab:function(){this.integration.closeLastTab(this)},blur:function(){_gliffy.RenderLoop.stop()},focus:function(){_gliffy.RenderLoop.start()},__doSave:function(doSaveSuccessCallback,doSaveErrorCallback){this.saving=true;var self=this,revision=this.getDocumentManager().getActiveDocument().getCurrentRevision(),originalTitle=this.getDocumentManager().getActiveDocument().getTitle(),successCallback=function(data,textStatus,xhr){self.saving=false;$(".gliffy-save button,.gliffy-save-dialog-button").html($.i18n._("EDITOR_SAVE")).removeAttr("disabled");$(".gliffy-save-blocker").remove();if(data.error){GliffyApp.saveDialogController.showErrorMessage(data.error);if(revision<1&&originalTitle){self.getDocumentManager().getActiveDocument().setTitle(originalTitle)}if(doSaveErrorCallback){doSaveErrorCallback(data)}}else{GliffyApp.saveDialogController.hide();self.getDocumentManager().getActiveDocument().refreshFromObject(data);self.getDocumentManager().getActiveStage().setUnsavedChanges(false);GliffyApp.documentModel.update(self.getDocumentManager().getActiveDocument());if(self.postSaveCallback){self.postSaveCallback()}if(doSaveSuccessCallback){doSaveSuccessCallback(data)}}self.postSaveCallback=null},errorCallback=function(xhr,textStatus,errorThrown){self.saving=false;$(".gliffy-save button,.gliffy-save-dialog-button").html($.i18n._("EDITOR_SAVE")).removeAttr("disabled");$(".gliffy-save-blocker").remove();if(revision<1&&originalTitle){self.getDocumentManager().getActiveDocument().setTitle(originalTitle)}if(xhr.status===400){GliffyApp.saveDialogController.getFilenameElement().parents("div.control-group").addClass("error").find("span.help-inline").text(xhr.responseText)}else{GliffyApp.saveDialogController.showErrorMessage(xhr.responseText)}if(doSaveErrorCallback){doSaveErrorCallback(xhr,textStatus,errorThrown)}self.postSaveCallback=null};$(".gliffy-save button,.gliffy-save-dialog-button").html('<div class="gliffy-save-spinner"></div>&nbsp;'+$.i18n._("EDITOR_SAVING...")).attr("disabled",true);$("body").append($('<div class="gliffy-save-blocker gliffy-super-ui-blocker"></div>'));if(self.getDocumentManager().getActiveDocument().getCurrentRevision()<1){self.getDocumentManager().getActiveDocument().setTitle(GliffyApp.saveDialogController.getFilename())}this.getDocumentManager().getActiveStage().update();this.getDocumentManager().getImageData(this.getDocumentManager().getActiveStage(),this.imageExportType,function(imageData){self.getDocumentManager().getActiveDocument().setImage(imageData);if(self.getDocumentManager().getActiveDocument().getCurrentRevision()<1){self.performAction("create",self.getDocumentManager().getActiveDocument().toObject(),successCallback,errorCallback)}else{self.performAction("save",self.getDocumentManager().getActiveDocument().toObject(),successCallback,errorCallback)}},false)},save:function(postSaveCallback){var self=this,oldPostSaveCallback;this.deselect();if(postSaveCallback){if(this.postSaveCallback){oldPostSaveCallback=this.postSaveCallback;this.postSaveCallback=function(){postSaveCallback();oldPostSaveCallback()}}else{this.postSaveCallback=postSaveCallback}}self.getDocumentManager().getDraftManager().hideNotifications();if((self.getDocumentManager().getActiveDocument().getCurrentRevision()+1||1)===1){GliffyApp.saveDialogController.show()}else{this.__doSave()}},deselect:function(){this.overlayManager.deselectAll();_gliffy.KeyManager.setState("stage");$("#gliffy-edit-text").trigger("customblur.gliffy-edit-text")},__bindResizeContainer:function(){var self=this,$window=$(window),resizeContainer,offset;resizeContainer=function(){self.__resizeContainer()};$window.bind("resize",resizeContainer);$window.load(resizeContainer);resizeContainer()},__resizeContainer:function(){var $window=$(window),offset=this.container.offset(),width=$window.width()-offset.left,height=$window.height()-offset.top-$("#gliffy-bottom-panel").height();$(".gliffy-sidebar").css("height",($window.height()-$(".navbar-fixed-top").height()-4)+"px");this.container.css({width:width+"px",height:height+"px",overflow:"scroll"});this.containerBounds=new _gliffy.BoundingBox(offset.left,offset.top,offset.left+width,offset.top+height)},inZoomInMode:function(){return this.isZoomInMode(this.__drawMode)},inZoomOutMode:function(){return this.isZoomOutMode(this.__drawMode)},inZoomMode:function(){return this.isZoomMode(this.__drawMode)},inLineDrawMode:function(){return this.isLineDrawMode(this.__drawMode)},inShapeDrawMode:function(){return this.isShapeDrawMode(this.__drawMode)},isLineDrawMode:function(mode){return mode===_gliffy.Editor.DRAW_MODE.line||mode===_gliffy.Editor.DRAW_MODE.ortho},isShapeDrawMode:function(mode){return mode===_gliffy.Editor.DRAW_MODE.ellipse||mode===_gliffy.Editor.DRAW_MODE.rectangle},isZoomMode:function(mode){return mode===_gliffy.Editor.DRAW_MODE.zoomIn||mode===_gliffy.Editor.DRAW_MODE.zoomOut},isZoomInMode:function(mode){return mode===_gliffy.Editor.DRAW_MODE.zoomIn},isZoomOutMode:function(mode){return mode===_gliffy.Editor.DRAW_MODE.zoomOut},__showConnectionPoints:function(show){var stage=this.getDocumentManager().target?this.getDocumentManager().target.find(".gliffy-stage"):null;if(stage){this.overlayManager.lineOverlay.showConnectionPoints(show);this.overlayManager.lineOverlay.setLineDrawMode(show)}},setDrawMode:function(mode){if(mode!=="undefined"&&mode!==null){if(mode!==this.__drawMode){$(_gliffy.Editor.DRAW_MODE_BUTTONS[this.__drawMode]).removeClass("active")}$(_gliffy.Editor.DRAW_MODE_BUTTONS[mode]).addClass("active");this.__drawMode=mode;this.overlayManager.setDrawMode(this.__drawMode);_gliffy.CursorManager.setCursor(_gliffy.Editor.DRAW_MODE_CURSORS[mode]);this.__showConnectionPoints(this.inLineDrawMode());_gliffy.KeyManager.setState("stage");_gliffy.Mouse.setState(_gliffy.Editor.DRAW_MODE_NAMES[mode])}},getDrawMode:function(){return this.__drawMode},viewActiveDocumentSource:function(){var timeout,display,keyState,destroy,self=this;display=$("<div class='gliffy-super-ui-blocker gliffy-semi-opaque'><div class='gliffy-document-window'><h1>"+$.i18n._("EDITOR_DOCUMENT_SOURCE")+"</h1><pre>"+$.i18n._("EDITOR_LOADING...")+"</pre><div><input type='button' class='btn' value='"+$.i18n._("EDITOR_CLOSE")+"'/><input type='button' class='btn' value='"+$.i18n._("EDITOR_SELECT")+"'/><input type='button' class='btn' value='"+$.i18n._("EDITOR_RELOAD")+"'/></div></div></div>");$("body").append(display);timeout=setTimeout(function(){var serializedDocument=JSON.stringify(self.__documentManager.getActiveDocument().getGon().toObject(),undefined,2);serializedDocument=document.createTextNode(serializedDocument);$(".gliffy-document-window pre").html("").get(0).appendChild(serializedDocument);timeout=null;$(".gliffy-document-window input[value=Select]").removeAttr("disabled")},100);keyState=_gliffy.KeyManager.getState();_gliffy.KeyManager.setState(null);destroy=function(){$(document).unbind(".gliffyprintdoc");_gliffy.KeyManager.setState(keyState);display.remove();display=null;destroy=null;if(timeout!==null){clearTimeout(timeout)}};$(document).bind("keydown.gliffyprintdoc","esc",destroy);$(".gliffy-document-window input[value="+$.i18n._("EDITOR_CLOSE")+"]").click(destroy);$(".gliffy-document-window input[value="+$.i18n._("EDITOR_SELECT")+"]").click(function(){_gliffy.Utils.selectAllTextInElement($(".gliffy-document-window pre"))});$(".gliffy-document-window input[value="+$.i18n._("EDITOR_RELOAD")+"]").click(function(){if(window.console&&window.console.log){window.console.log("Attempting to reload...")}self.open({jsonObj:self.getDocumentManager().getActiveDocument().toObject(),callback:function(){if(window.console&&window.console.log){window.console.log("File has been reloaded!")}}});destroy()});$(".gliffy-document-window input[value=Select]").attr("disabled",true)},clearContextMenu:function(){return GliffyApp.contextMenuController.clearContextMenu(this.__contextMenu)},bindBeforeUnload:function(overrideFunction){},getStageContextMenuObject:function(){var self=this,stageMenu=[],pushToMenu;pushToMenu=function(key,val){var obj={};obj[key]=val;stageMenu.push(obj)};pushToMenu($.i18n._("EDITOR_PASTE_HERE"),{onclick:function(menuItem,menu){_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextMenu",action:"paste"});_gliffy.Mouse.setLastMouseUpPosition(_gliffy.Mouse.getContextMenuMouseDownPosition());_gliffy.toolbarController.doPaste()},className:"gliffy-context-menu-item-stage gliffy-context-menu-item-paste"});stageMenu.push($.contextMenu.separator);pushToMenu($.i18n._("EDITOR_SELECT_ALL"),{onclick:function(menuItem,menu){_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextMenu",action:"selectAll"});_gliffy.toolbarController.doSelectAll()},className:"gliffy-context-menu-item-stage gliffy-context-menu-item-selectAll"});stageMenu.push($.contextMenu.separator);pushToMenu($.i18n._("EDITOR_ZOOM_-_FIT_TO_SCREEN"),{onclick:function(menuItem,menu){_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextMenu",action:"zoomFit"});self.overlayManager.deselectAll();_gliffy.toolbarController.handleZoomSelect("fit")},className:"gliffy-context-menu-item-stage gliffy-context-menu-item-zoomFit"});pushToMenu($.i18n._("EDITOR_ZOOM")+" - 400%",{onclick:function(menuItem,menu){_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextMenu",action:"zoom400"});self.overlayManager.deselectAll();self.getDocumentManager().zoomAt(4,_gliffy.Mouse.getContextMenuMouseDownPosition().x,_gliffy.Mouse.getContextMenuMouseDownPosition().y)},className:"gliffy-context-menu-item-stage gliffy-context-menu-item-zoom400"});pushToMenu($.i18n._("EDITOR_ZOOM")+" - 200%",{onclick:function(menuItem,menu){_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextMenu",action:"zoom200"});self.overlayManager.deselectAll();self.getDocumentManager().zoomAt(2,_gliffy.Mouse.getContextMenuMouseDownPosition().x,_gliffy.Mouse.getContextMenuMouseDownPosition().y)},className:"gliffy-context-menu-item-stage gliffy-context-menu-item-zoom200"});pushToMenu($.i18n._("EDITOR_ZOOM")+" - 100%",{onclick:function(menuItem,menu){_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextMenu",action:"zoom100"});self.overlayManager.deselectAll();self.getDocumentManager().zoomAt(1,_gliffy.Mouse.getContextMenuMouseDownPosition().x,_gliffy.Mouse.getContextMenuMouseDownPosition().y)},className:"gliffy-context-menu-item-stage gliffy-context-menu-item-zoom100"});pushToMenu($.i18n._("EDITOR_ZOOM")+" - 50%",{onclick:function(menuItem,menu){_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextMenu",action:"zoom50"});self.overlayManager.deselectAll();self.getDocumentManager().zoomAt(0.5,_gliffy.Mouse.getContextMenuMouseDownPosition().x,_gliffy.Mouse.getContextMenuMouseDownPosition().y)},className:"gliffy-context-menu-item-stage gliffy-context-menu-item-zoom50"});stageMenu.push($.contextMenu.separator);pushToMenu($.i18n._("EDITOR_VIEW_DIAGRAM_SOURCE"),{onclick:function(menuItem,menu){_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextMenu",action:"viewSource"});self.viewActiveDocumentSource()},className:"gliffy-context-menu-item-stage gliffy-context-menu-item-source"});return stageMenu.concat(this.overlayManager.lineOverlay.getContextMenuDefinition())},beforeContextMenuShow:function(menu){_gliffy.Mouse.setContextMenuMouseDownPosition(_gliffy.Mouse.getPosition());var selectedNode,pos=_gliffy.Mouse.getPosition();selectedNode=_gliffy.Pick.getNodeAt(this.getDocumentManager().getActiveStage().objects,pos.x,pos.y);$(".gliffy-context-menu-stage .context-menu-separator").show();if(selectedNode&&this.overlayManager.lineOverlay.isActive()&&this.overlayManager.lineOverlay.getSelectedNode()===selectedNode){$(".gliffy-context-menu-stage .gliffy-context-menu-item-stage").hide();$(".gliffy-context-menu-stage .gliffy-context-menu-item-line-overlay").show();$($(".gliffy-context-menu-stage .context-menu-separator").get(0)).hide();$($(".gliffy-context-menu-stage .context-menu-separator").get(1)).hide();$($(".gliffy-context-menu-stage .context-menu-separator").get(2)).hide();this.overlayManager.lineOverlay.beforeContextMenuShow(menu)}else{$(".gliffy-context-menu-stage .gliffy-context-menu-item-stage").show();$(".gliffy-context-menu-stage .gliffy-context-menu-item-line-overlay").hide();$($(".gliffy-context-menu-stage .context-menu-separator").get(3)).hide();$($(".gliffy-context-menu-stage .context-menu-separator").get(4)).hide()}},performAction:function(name){var args,self=this;if(this.__actions&&this.__actions[name]){args=Array.prototype.slice.call(arguments);args.shift();_gliffy.Utils.tryCatch(function(){if(!self.__actions[name]){throw new Error("Missing action: "+name)}return self.__actions[name].apply(self.__actions,args)},function(e){_gliffy.handleError("com.gliffy.error.action_failed",null,e)})}else{_gliffy.handleError("com.gliffy.error.unknown_action")}},getEmbeddedResources:function(){return this.getDocumentManager().getActiveDocument().getEmbeddedResources()},getEmbeddedResource:function(node){if(node.getGraphic() instanceof _gliffy.Svg){return this.getDocumentManager().getActiveDocument().getEmbeddedResources().getResource(node.getGraphic().getEmbeddedResourceId())}return null},dockToBottomPanel:function(element){$("#gliffy-bottom-panel").empty().append(element);this.__resizeContainer()},clearBottomPanel:function(){$("#gliffy-bottom-panel").empty();this.__resizeContainer()},updateContainerSize:function(){this.__resizeContainer()}});_gliffy.Editor.DRAW_MODE_BUTTONS=["#gliffy-toolbar-button-pointer","#gliffy-toolbar-button-lineTool","#gliffy-toolbar-button-connectorTool","#gliffy-toolbar-button-textTool","#gliffy-toolbar-button-pan","#gliffy-toolbar-button-ellipseTool","#gliffy-toolbar-button-rectangleTool","#gliffy-toolbar-button-zoomIn","#gliffy-toolbar-button-zoomOut"];_gliffy.Editor.DRAW_MODE_CURSORS=["default","line","connector","text","hand","ellipse","rectangle","zoom-in","zoom-out"];_gliffy.Editor.DRAW_MODE={none:0,line:1,ortho:2,text:3,pan:4,ellipse:5,rectangle:6,zoomIn:7,zoomOut:8};_gliffy.Editor.DRAW_MODE_NAMES=["none","line","ortho","text","pan","ellipse","rectangle","zoomIn","zoomOut"];_gliffy.Editor.ORTHO_MODE={straight:0,bezel:1,curved:2};_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD={placement:"bottom",trigger:"hover",delay:{show:650,hide:50}};_gliffy.Editor.TOOLTIP_OPTIONS_QUICK={placement:"bottom",trigger:"hover",delay:{show:0,hide:50}};_gliffy.Editor.TOOLTIP_OPTIONS_SHAPE_LIBRARY={placement:"right",trigger:"hover",delay:{show:650,hide:50}};_gliffy.Editor.TOOLTIP_OPTIONS_LEFT={placement:"left",trigger:"hover",delay:{show:650,hide:50}};_gliffy.Editor.TOOLTIP_OPTIONS_TOP={placement:"top",trigger:"hover",delay:{show:650,hide:50}};_gliffy.Editor.LOREM_IPSUM_TEXT="Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.";_gliffy.Editor.CONTEXT_MENU_STYLE="gliffy"}());(function(){GliffyApp.DocumentModel=Ember.Object.extend({title:"",currentRevision:0,zoom:1,gridVisible:true,pageBreaksVisible:false,exportBorder:false,maxWidth:5000,maxHeight:5000,unsavedChanges:false,snapToGrid:true,drawingGuides:false,pageColor:"#FFFFFF",reset:function(){this.set("title","");this.set("currentRevision",0);this.set("zoom",1);this.set("gridVisible",true);this.set("pageBreaksVisible",false);this.set("exportBorder",false);this.set("maxWidth",5000);this.set("maxHeight",5000);this.set("unsavedChanges",false);this.set("snapToGrid",true);this.set("drawingGuides",false);this.set("pageColor","#FFFFFF")},update:function(document){if(document){if(document.getStage()){this.set("zoom",document.getStage().getZoom());this.set("gridVisible",document.getStage().isGridVisible());this.set("pageBreaksVisible",document.getStage().isPageBreaksVisible());this.set("snapToGrid",document.getStage().isSnapToGrid());this.set("drawingGuides",document.getStage().isDrawingGuideOn())}this.set("title",document.getTitle());this.set("currentRevision",document.getCurrentRevision());this.set("exportBorder",document.getStage().exportBorder||false);if(document.getStage()){this.set("unsavedChanges",document.getStage().hasUnsavedChanges());this.set("pageColor",document.getStage().background)}this.set("maxWidth",document.getStage().maxWidth);this.set("maxHeight",document.getStage().maxHeight)}},updateProperty:function(prop,value){this.set(prop.charAt(0).toLowerCase()+prop.slice(1),value)}})}());(function(){GliffyApp.overlayModel=Ember.Object.create({x:200,y:100,width:100,height:75,rotation:0,fillAllowed:true,lineColorAllowed:true,gradientAllowed:true,gradientOn:false,shadowAllowed:true,shadowOn:false,fixedAspect:false,lockShape:false,shapeState:0,shapeStateBoolean:false,__lockShapeState:"unlocked",__lockAspectState:"unlocked",__USE_GHOST_CHECK:true,reset:function(){this.set("gradientOn",false);this.set("shadowOn",false);this.set("fixedAspect",false);this.set("lockShape",false);this.set("shapeState",0);this.set("shapeStateBoolean",false);this.set("lockSomeShapes","")},update:function(o,node){var i,selectedNode=node||o.getSelectedNode(),list,olHeight;if(selectedNode){this.reset();this.set("x",Math.round(o.getTransX()));this.set("y",Math.round(o.getTransY()));this.set("width",Math.round(o.getScaleX()));this.set("height",Math.round(selectedNode.getHeight()));this.set("rotation",Math.round(_gliffy.Utils.radiansToDegrees(o.getRotation())));list=selectedNode.findGraphics([_gliffy.Image,_gliffy.Shape]);for(i=0;i<list.length;i++){this.__updateFromNode(list[i])}this.updateLockedShapeProperties(o,selectedNode);this.updateLockedAspectProperties(o,selectedNode)}},__updateLockProperties:function(selectedNode,overlay,$checkboxDom,propertyName,nodeSetFuncName,nodeGetFuncName,overlaySetFuncName,hybridLock){var lockedArr=[],unlockedArr=[],self=this,lockFunc,lockState,shouldLockParent,i,newLockState;lockFunc=function(node){if(node[nodeGetFuncName]&&node[nodeGetFuncName]()){lockedArr.push(node)}else{unlockedArr.push(node)}};lockState=function(){if(lockedArr.length===0&&unlockedArr.length>0){return"unlocked"}else{if(lockedArr.length>0&&unlockedArr.length===0){return"locked"}}return"hybrid"};if(selectedNode.isSelection()){for(i=0;i<selectedNode.children.length;i++){lockFunc(selectedNode.children[i])}}else{lockFunc(selectedNode)}newLockState=lockState();shouldLockParent=(newLockState==="hybrid"?hybridLock:(newLockState==="locked"));self.set(propertyName,shouldLockParent);if(selectedNode[nodeSetFuncName]&&overlay[overlaySetFuncName]){selectedNode[nodeSetFuncName](shouldLockParent);overlay[overlaySetFuncName](shouldLockParent)}return newLockState},updateLockedAspectProperties:function(overlay,node){this.__lockAspectState=this.__updateLockProperties(node,overlay,$("#gliffy-contextual-properties-checkbox-fixedaspect"),"fixedAspect","setLockAspectRatio","getLockAspectRatio","setLockAspectRatio",false)},updateLockedShapeProperties:function(overlay,node){this.__lockShapeState=this.__updateLockProperties(node,overlay,$("#gliffy-contextual-properties-checkbox-lockshape"),"lockShape","setLockPosition","getLockPosition","setLockPosition",false)},__updateFromNode:function(node){var graphic=node.getGraphic();if(graphic instanceof _gliffy.Shape){if(!this.gradientOn){this.set("gradientOn",graphic.isGradient())}this.set("shapeState",graphic.getState());this.set("shapeStateBoolean",(graphic.getState()===1))}if(!this.shadowOn){this.set("shadowOn",graphic.isDropShadow())}}})}());(function(){GliffyApp.lineOverlayModel=Ember.Object.create({startPt:null,endPt:null,path:null,lineArrowBegin:0,lineArrowEnd:0,lineWeight:0,init:function(){this.startPt={x:0,y:0};this.endPt={x:0,y:0}},update:function(o){var selectedNode=o.getSelectedNode();if(selectedNode){this.__updateFromNode(selectedNode)}},__updateFromNode:function(node){if(node){var graphic=node.getGraphic();if(graphic){this.set("lineArrowBegin",graphic.getStartArrow());this.set("lineArrowEnd",graphic.getEndArrow());this.set("lineWeight",graphic.getStrokeWidth())}}}})}());(function(){GliffyApp.AbstractPropertiesController=Ember.Object.extend({__editor:null,setEditor:function(editor){this.__editor=editor}})}());(function(){GliffyApp.toolbarController=Ember.Object.extend({__editor:null,init:function(){var orthoMode,self=this;if(this.__editor!==null){orthoMode=_gliffy.Editor.ORTHO_MODE.bezel;this.__editor.drawManager.setOrthoMode(orthoMode)}GliffyApp.saveDialogController.hide();GliffyApp.saveDialogController.getModal().find("form").submit(function(event){event.preventDefault();self.__editor.__doSave()});GliffyApp.saveDialogController.getModal().find(".gliffy-save-dialog-button").click(function(event){event.preventDefault();self.__editor.__doSave()});GliffyApp.saveDialogController.getModal().find(".gliffy-save-dialog-cancel-button").click(function(event){self.__editor.postSaveCallback=null});$(".navbar").delegate(".gliffy-close a","click",function(event){event.preventDefault();self.__editor.close()});$(".navbar").delegate(".gliffy-toolbar .gliffy-save button","click",function(event){event.preventDefault();$(this).blur();self.doSave()});if(this.__editor){setTimeout(function(){if(self.__editor.rootResourceUrl){$(".gliffy-navbar-helpmenu-eula a").attr("href",self.__editor.rootResourceUrl+"/Gliffy_EULA.pdf")}$(".gliffy-navbar-helpmenu-productVersion a").text($.i18n._("MENU_GLIFFY_VERSION",[self.__editor.productVersion]));$(".gliffy-navbar-helpmenu-customerId a").text($.i18n._("MENU_CUSTOMER_ID")+self.__editor.customerId);$("#gliffy-anchor-feedback").on("click",function(e){self.__editor.performAction("clickFeedback");e.preventDefault()})},1)}},captureSaveAnalytics:function(){var self=this;_gliffy.Utils.analyticsEvent("runFuncIfAnalyticsExists",{func:function(){var analyticsData=self.__editor.getDocumentManager().getActiveStage().getAnalyticsData();$.each(analyticsData,function(topKey,topVal){if($.isPlainObject(topVal)){$.each(topVal,function(subKey,subVal){_gliffy.Utils.analyticsEvent("trackEvent",{category:"save."+topKey,action:subKey,value:subVal,non_interaction:true})})}else{_gliffy.Utils.analyticsEvent("trackEvent",{category:"save."+topKey,action:topVal,non_interaction:true})}})}})},syncButtons:function(stage){_gliffy.toolbarController.toggleDrawingGuidesButton(stage.drawingGuidesOn);_gliffy.toolbarController.toggleShowGridButton(stage.gridOn);_gliffy.toolbarController.toggleSnapToGridButton(stage.snapToGrid)},doNew:function(){this.__editor.performAction("handleFileNew")},doOpen:function(){this.__editor.performAction("showFileOpenBrowser")},doSave:function(){this.captureSaveAnalytics();this.__editor.save()},doSaveAndClose:function(){var self=this;this.__editor.postSaveCallback=function(e){self.doClose()};this.captureSaveAnalytics();this.__editor.save()},doClose:function(){GliffyApp.documentTabsController.closeTab(this.__editor.getDocumentManager().getActiveDocument())},doPrint:function(){},doExportImage:function(contentType,extension){var self=this,command;this.__editor.getDocumentManager().getImageData(this.__editor.getDocumentManager().getActiveStage(),contentType,function(imageData){command={document:self.__editor.getDocumentManager().getActiveDocument(),contentType:contentType,extension:extension,data:imageData};self.__editor.performAction("export",command);GliffyApp.progressBarController.getBar().delay(500).queue(function(next){GliffyApp.progressBarController.hide();next()})},true)},doExportData:function(contentType,extension){var self=this,command;command={document:self.__editor.getDocumentManager().getActiveDocument(),contentType:contentType,extension:extension};self.__editor.performAction("export",command);GliffyApp.progressBarController.getBar().delay(500).queue(function(next){GliffyApp.progressBarController.hide();next()})},doDeselectAll:function(){this.__editor.overlayManager.deselectAll()},handleZoomSelect:function(val){if(val==="fit"){this.__editor.overlayManager.deselectAll();this.__editor.getDocumentManager().zoomToFit()}else{this.__editor.overlayManager.deselectAll();this.__editor.getDocumentManager().zoomToCenter(Number(val))}},doZoomOut:function(){this.__editor.setDrawMode(_gliffy.Editor.DRAW_MODE.zoomOut)},doZoomIn:function(){this.__editor.setDrawMode(_gliffy.Editor.DRAW_MODE.zoomIn)},updateDrawMode:function(mode){this.__editor.setDrawMode(mode)},doUndo:function(target){$("#gliffy-edit-text").trigger("customblur.gliffy-edit-text");this.__editor.overlayManager.deselectAll();this.__editor.getDocumentManager().undoCommand();this.__editor.getDocumentManager().redraw()},doRedo:function(target){$("#gliffy-edit-text").trigger("customblur.gliffy-edit-text");this.__editor.overlayManager.deselectAll();this.__editor.getDocumentManager().redoCommand();this.__editor.getDocumentManager().redraw()},doSelectAll:function(target){this.__editor.overlayManager.selectAllNodes();GliffyApp.contextualPropertiesController.showControls(this.__editor.overlayManager.getActiveOverlay())},doGroup:function(target){var self=this;if(this.__editor.overlayManager.getSelectedNode()){$(".gliffy-viewbox.gliffy-active").removeClass("gliffy-active");this.__editor.overlayManager.groupifySelection();this.__editor.getDocumentManager().redraw(function(){self.__editor.overlayManager.getSelectedNode().getDomViewbox().addClass("gliffy-active")})}},doUnGroup:function(target){if(this.__editor.overlayManager.getSelectedNode()){this.__editor.overlayManager.ungroupifyGroup();this.__editor.overlayManager.deselectAll();this.__editor.getDocumentManager().redraw()}},doCopy:function(){var node=this.__editor.overlayManager.getSelectedNode();if(node&&!node.isProxy()){_gliffy.Mouse.resetMouseUpPosition();this.__editor.getDocumentManager().addAndExecuteCommand(new _gliffy.CopyCommand({node:node,embeddedResources:this.__editor.getEmbeddedResources()}))}},doCut:function(){var node=this.__editor.overlayManager.getSelectedNode();if(node&&!node.isProxy()){this.__editor.getDocumentManager().addAndExecuteCommand(new _gliffy.CutCommand({node:node,embeddedResources:this.__editor.getEmbeddedResources()}))}this.__editor.getDocumentManager().redraw()},doPaste:function(){var selectedNode=this.__editor.overlayManager.getSelectedNode();this.__editor.getDocumentManager().addAndExecuteCommand(new _gliffy.PasteCommand({selectedNode:selectedNode}));this.__editor.getDocumentManager().redraw()},doDelete:function(){this.__editor.overlayManager.deleteSelectedNode();this.__editor.getDocumentManager().redraw()},doSendToBack:function(){var node=this.__editor.overlayManager.getSelectedNode();if(this.__editor.getDocumentManager().getActiveDocument()!==null&&node){this.__editor.getDocumentManager().addAndExecuteCommand(new _gliffy.SendToBackCommand({node:node}));this.__editor.getDocumentManager().redraw()}},doBringToFront:function(){var node=this.__editor.overlayManager.getSelectedNode();if(this.__editor.getDocumentManager().getActiveDocument()!==null&&node){this.__editor.getDocumentManager().addAndExecuteCommand(new _gliffy.BringToFrontCommand({node:node}));this.__editor.getDocumentManager().redraw()}},togglePageNavigator:function(on){if(on){GliffyApp.pageNavigatorController.show()}else{GliffyApp.pageNavigatorController.hide()}},toggleDrawingGuides:function(on){this.__editor.getDocumentManager().getActiveStage().drawingGuidesOn=on;GliffyApp.documentModel.update(this.__editor.getDocumentManager().getActiveDocument());_gliffy.toolbarController.toggleDrawingGuidesButton(!on)},toggleThemes:function(on){_gliffy.toolbarController.toggleThemesButton(on);GliffyApp.themeController[on?"showDialog":"hideDialog"]()},toggleDrawingGuidesButton:function(on){if(on){$(".gliffy-tool-guides").parent().addClass("active")}else{$(".gliffy-tool-guides").parent().removeClass("active")}},toggleShowGrid:function(on){this.__editor.getDocumentManager().getActiveStage().gridOn=on;this.__editor.grid.setEnabled(on);this.__editor.getDocumentManager().redraw();GliffyApp.documentModel.update(this.__editor.getDocumentManager().getActiveDocument());_gliffy.toolbarController.toggleShowGridButton(!on)},toggleShowGridButton:function(on){if(on){$(".gliffy-tool-show-grid").parent().addClass("active")}else{$(".gliffy-tool-show-grid").parent().removeClass("active")}},toggleSnapToGrid:function(on){this.__editor.getDocumentManager().getActiveStage().snapToGrid=on;GliffyApp.documentModel.update(this.__editor.getDocumentManager().getActiveDocument());_gliffy.toolbarController.toggleSnapToGridButton(!on)},toggleSnapToGridButton:function(on){if(on){$(".gliffy-tool-snap-to-grid").parent().addClass("active")}else{$(".gliffy-tool-snap-to-grid").parent().removeClass("active")}},toggleThemesButton:function(on){var currentState=$(".gliffy-tool-themes").parent().hasClass("active");if(currentState!==on){$(".gliffy-tool-themes").parent()[on?"addClass":"removeClass"]("active");_gliffy.Utils.analyticsEvent("trackEvent",{category:"toolbarClick",action:(on?"themesOn":"themesOff")})}},toggleVersionInfo:function(on){$(".gliffy-version-info").toggle()},setEditMenuWidth:function(){if(!_gliffy.Utils.isEnglish(this.__editor)){$(".gliffy-edit-dropdown").css("width","250px")}},setFileMenuWidth:function(){if(!_gliffy.Utils.isEnglish(this.__editor)){$(".gliffy-file-dropdown").css("width","250px")}}})}());(function(){var TABS={NONE:0,SHAPE:1,GROUP:2,LINE:3,TEXT:4};GliffyApp.ContextualPropertiesController=GliffyApp.AbstractPropertiesController.extend({overlayXBinding:Ember.Binding.oneWay("GliffyApp.overlayModel.x"),overlayYBinding:Ember.Binding.oneWay("GliffyApp.overlayModel.y"),overlayWidthBinding:Ember.Binding.oneWay("GliffyApp.overlayModel.width"),overlayHeightBinding:Ember.Binding.oneWay("GliffyApp.overlayModel.height"),overlayRotationBinding:Ember.Binding.oneWay("GliffyApp.overlayModel.rotation"),overlayGradientOnBinding:Ember.Binding.oneWay("GliffyApp.overlayModel.gradientOn"),overlayShadowOnBinding:Ember.Binding.oneWay("GliffyApp.overlayModel.shadowOn"),overlayFixedAspectBinding:Ember.Binding.oneWay("GliffyApp.overlayModel.fixedAspect"),overlayLockShapeBinding:Ember.Binding.oneWay("GliffyApp.overlayModel.lockShape"),overlayLockSomeShapesBinding:Ember.Binding.oneWay("GliffyApp.overlayModel.lockSomeShapes"),currentXPos:0,currentYPos:0,_tab:TABS.SHAPE,__currentTextObject:null,__openMagnitude:1,__LINE_PROPS_INSIDE_OFFSET:10,__LINE_PROPS_OUTSIDE_OFFSET:10,__CONTROL_BUTTONS_WIDTH:75,__dialogButtons:["gliffy-contextual-properties-fill-button","gliffy-contextual-properties-bordercolor-button","gliffy-contextual-properties-linecolor-button","gliffy-contextual-properties-textcolor-button"],__dialogDropdowns:["gliffy-contextual-properties-border-width","gliffy-contextual-properties-arrowbegin","gliffy-contextual-properties-arrowend","gliffy-contextual-properties-line-type","gliffy-contextual-properties-line-width","gliffy-contextual-properties-dash-style"],__markersDict:{},__scrollTimeout:null,__scrolling:false,__tempTime:null,__editTextWidth:-10000,__editTextHeight:-10000,__groupOrLineGrabberWidth:170,__shapeGrabberWidth:210,keepDialogOpen:false,keepDialogOpenOnBlurText:false,__updateOverlayTimeout:null,__updateDialogTimeout:null,__addingLoremIpsum:false,init:function(){var self=this;this.__markersDict.standard=[1,2,3,17];this.__markersDict["com.gliffy.shape.uml.uml_v1"]=[4,5,6,7];this.__markersDict["com.gliffy.shape.floorplan.floorplan_v2"]=[8];this.__markersDict["com.gliffy.shape.erd.erd_v1"]=[9,10,11,12,13,14];this.__markersDict["com.gliffy.shape.bpmn.bpmn_v1"]=[4,5,15,16];$("#gliffy-contextual-properties-dialog").mousedown(function(e){if(e.target.tagName.toUpperCase()!=="INPUT"){return false}});$(window).bind("rte-remove.gliffy-edit-text",function(event){self.hideControls()});$(window).bind("rte-add.gliffy-edit-text",function(event){self.__editTextWidth=-10000;self.__editTextHeight=-10000;self.showControls($("#gliffy-edit-text_ifr"));if(self.__addingLoremIpsum){self.addLoremIpsum();self.__addingLoremIpsum=false}});$(window).bind("rte-resize.gliffy-edit-text",function(event){if(!(self.__editTextWidth===event.w&&self.__editTextHeight===event.h)){self.updateControlsPosition($("#gliffy-edit-text_ifr"));self.__editTextWidth=event.w;self.__editTextHeight=event.h}});this.__tempTime=(new Date()).getTime();this.registerScrollHandler();$("#container").bind("scrollStart",function(){self.__scrolling=true;if(self.__editor.overlayManager.getActiveOverlay()!==null){GliffyApp.contextualPropertiesController.hideControls()}else{if($("#gliffy-edit-text_ifr").is(":visible")){GliffyApp.contextualPropertiesController.hideControls(true)}}});$("#container").bind("scrollEnd",function(){self.__scrolling=false;if(self.__editor.overlayManager.getActiveOverlay()!==null&&!self.__editor.overlayManager.getActiveOverlay().isDragging){GliffyApp.contextualPropertiesController.showControls(self.__editor.overlayManager.getActiveOverlay())}else{if($("#gliffy-edit-text_ifr").is(":visible")){GliffyApp.contextualPropertiesController.showControls($("#gliffy-edit-text_ifr"))}}});if(_gliffy.KeyManager){_gliffy.KeyManager.registerState("contextualProperties","default",[{action:"arrowsDoNothing",keydown:function(e){e.stopImmediatePropagation();e.preventDefault()}},{action:"jumpStageLeft",keydown:function(e){e.stopImmediatePropagation();e.preventDefault()}},{action:"jumpStageRight",keydown:function(e){e.stopImmediatePropagation();e.preventDefault()}},{keypress:function(ev){var overlay=self.__editor.overlayManager.overlay,lineOverlay=self.__editor.overlayManager.lineOverlay;if(!_gliffy.KeyManager.isControlKey(ev)){if(overlay.isActive()){ev.stopImmediatePropagation();ev.preventDefault()}else{if(lineOverlay.isActive()){ev.stopImmediatePropagation();ev.preventDefault()}}}}}])}$("#gliffy-contextual-properties-controls-tabs a").on("show",function(){var rte=$("#gliffy-edit-text_ifr"),tabs=$("#gliffy-contextual-properties-controls-tabs");if(tabs.find("li:visible").length===3){tabs.addClass("three-tabs")}else{tabs.removeClass("three-tabs")}if(rte.is(":visible")){_gliffy.KeyManager.setState("rte")}else{_gliffy.KeyManager.setState("contextualProperties")}})},registerScrollHandler:function(){var self=this;$("#container").bind("scroll.gliffy_cprops",function(){var now=(new Date()).getTime();if(now-self.__tempTime>200&&!self.__scrolling){$("#container").trigger("scrollStart");self.__tempTime=now}clearTimeout(self.__scrollTimeout);self.__scrollTimeout=setTimeout(function(){if(self.__scrolling){$("#container").trigger("scrollEnd")}},300)})},isValidPropertyValue:function(prop,value){value=Number(value);if(isNaN(value)){return false}else{if(Math.abs(value)>5000){return false}}if(prop==="width"||prop==="height"){if(value<=0){return false}}return true},doUpdateLane:function(node,value){this.__editor.overlayManager.deselectAll();this.__editor.getDocumentManager().addAndExecuteCommand(new _gliffy.UpdateLaneNumberCommand({node:node,lanes:value}));this.__editor.overlayManager.selectNode(node)},getTargetNode:function(blurText){var overlayManager=this.__editor.overlayManager,targetNode;targetNode=overlayManager.getSelectedNode();if(!targetNode&&$("#gliffy-edit-text_ifr").is(":visible")&&this.__currentTextObject!==null){targetNode=this.__currentTextObject;if(blurText){this.keepDialogOpen=true;this.keepDialogOpenOnBlurText=$("#gliffy-edit-text_ifr").is(":visible");if(this.__currentTextObject.isStandAloneText()){$("#gliffy-edit-text").trigger("customblur.gliffy-edit-text")}else{$("#gliffy-edit-text").trigger("customblur.gliffy-edit-text")}this.__editor.overlayManager.selectNode(this.__currentTextObject);if($("#gliffy-contextual-properties-dialog").is(":visible")){_gliffy.KeyManager.setState("contextualProperties")}this.keepDialogOpen=this.keepDialogOpenOnBlurText}}return targetNode},__updateProperties:function(options){var documentManager=this.__editor.getDocumentManager(),i,o=$.extend({list:[],prop:null,value:null,updateStyleDefaultsForNode:false},options);for(i=0;i<o.list.length;i++){o.list[i].updateProperty(o.prop,o.value);if(o.updateStyleDefaultsForNode){documentManager.updateStyleDefaultsForNode(o.list[i],o.prop,o.value)}}},__forceImagesToReload:function(selectedNode){var images,i;images=selectedNode.findGraphic(_gliffy.Image);for(i=0;i<images.length;i++){images[i].setFlag("skin");images[i].markDirty()}},updateShapeTabProperty:function(prop,value){var overlayManager=this.__editor.overlayManager,documentManager=this.__editor.getDocumentManager(),targetNode,list;GliffyApp.overlayModel.set(prop,value);documentManager.pushCommandBundle();switch(prop){case"x":targetNode=this.getTargetNode(true);overlayManager.updateOverlayX(Number(value));break;case"y":targetNode=this.getTargetNode(true);overlayManager.updateOverlayY(Number(value));break;case"width":targetNode=this.getTargetNode(true);overlayManager.updateOverlayWidth(Number(value));this.__forceImagesToReload(targetNode);break;case"height":targetNode=this.getTargetNode(true);overlayManager.updateOverlayHeight(Number(value));this.__forceImagesToReload(targetNode);break;case"rotation":targetNode=this.getTargetNode(true);overlayManager.updateOverlayRotation(_gliffy.Utils.degreesToRadians(Number(value)));break;case"LockAspectRatio":targetNode=this.getTargetNode(true);overlayManager.overlay.setLockAspectRatio(value);list=targetNode.getLeafNodes(true);this.__updateProperties({list:list,prop:prop,value:value,updateStyleDefaultsForNode:false});documentManager.popCommandBundle();break;case"LockPosition":targetNode=this.getTargetNode(true);overlayManager.overlay.setLockPosition(value);list=targetNode.getLeafNodes(true);this.__updateProperties({list:list,prop:prop,value:value,updateStyleDefaultsForNode:false});documentManager.popCommandBundle();break;case"StrokeWidth":case"DropShadow":targetNode=this.getTargetNode(false);list=targetNode.findGraphics([_gliffy.Shape,_gliffy.Image]);this.__updateProperties({list:list,prop:prop,value:value,updateStyleDefaultsForNode:true});documentManager.popCommandBundle();break;case"Gradient":case"State":targetNode=this.getTargetNode(false);list=targetNode.findGraphic(_gliffy.Shape);this.__updateProperties({list:list,prop:prop,value:value,updateStyleDefaultsForNode:true});documentManager.popCommandBundle();break;case"Lanes":targetNode=this.getTargetNode(true);this.doUpdateLane(targetNode,value);documentManager.popCommandBundle();break}this.__updateOverlayAndRedraw(GliffyApp.overlayModel,overlayManager.overlay,TABS.SHAPE,targetNode);if($("#gliffy-edit-text_ifr").is(":visible")){$("#gliffy-edit-text_ifr").focus()}},updateLineTabProperty:function(prop,value){var overlayManager=this.__editor.overlayManager,documentManager=this.__editor.getDocumentManager(),targetNode,lines,overlayModel,overlay;targetNode=this.getTargetNode(prop==="LineType");lines=targetNode.findGraphic(_gliffy.Line);if(targetNode.isLine()){overlayModel=GliffyApp.lineOverlayModel;overlay=overlayManager.lineOverlay}else{overlayModel=GliffyApp.overlayModel;overlay=overlayManager.overlay}overlayModel.set(prop,value);documentManager.pushCommandBundle();switch(prop){case"StartArrow":case"EndArrow":case"StrokeWidth":case"DashStyle":this.__updateProperties({list:lines,prop:prop,value:value,updateStyleDefaultsForNode:true});break;case"LineType":this.changeLineType(value,lines);break}documentManager.popCommandBundle();this.__updateOverlayAndRedraw(overlayModel,overlay,TABS.LINE,targetNode);if($("#gliffy-edit-text_ifr").is(":visible")){$("#gliffy-edit-text_ifr").focus()}},__updateOverlayAndRedraw:function(overlayModel,overlay,tab,target){var dimension,self=this;if(overlayModel){overlayModel.update(overlay,target)}if(overlay){overlay.__drawOverlay();if((tab===TABS.SHAPE)&&!overlay.inStageViewport()){$("#container").unbind("scroll.gliffy_cprops");GliffyApp.contextualPropertiesController.keepDialogOpen=true;dimension=this.__editor.getDocumentManager().getActiveStageViewPort().getDimension();this.__editor.getDocumentManager().getActiveStage().centerAt(overlay.getTransX()+overlay.getScaleX()/2,overlay.getTransY()+overlay.getScaleY()/2,dimension.x,dimension.y);self.__updateOverlayTimeout=setTimeout(function(){GliffyApp.contextualPropertiesController.keepDialogOpen=false;self.registerScrollHandler()},50)}this.__editor.getDocumentManager().redraw(function(){_gliffy.Mouse.updateOffset();self.updateControlsPosition(self.__editor.overlayManager.overlay);self.__updateDialogTimeout=setTimeout(function(){if($.browser.msie){self.__updateDialogPosition()}if(overlayModel){overlayModel.update(overlay,target)}},50)})}else{this.__editor.getDocumentManager().redraw()}if(tab===TABS.LINE){this.__showArrowSelections()}this.configureDialogControls()},handleColorpickerColorChange:function(color,mode){var i,graphic,node,targetNode=GliffyApp.contextualPropertiesController.getTargetNode(false),pullTab,documentManager=GliffyApp.contextualPropertiesController.__editor.getDocumentManager(),stage=documentManager.getActiveStage(),shapes=targetNode.findGraphic(_gliffy.Shape),lines=targetNode.findGraphic(_gliffy.Line);documentManager.pushCommandBundle();switch(mode){case"fill":if(targetNode.isSwimlane()){shapes=[targetNode.children[0]]}for(i=0;i<shapes.length;i++){node=shapes[i];graphic=node.getGraphic();if(color==="none"){node.updateProperty("Gradient",false);GliffyApp.contextualPropertiesController.__editor.getDocumentManager().updateStyleDefaultsForNode(node,"gradient",false)}stage.commandHistory.addAndExecuteCommand(_gliffy.SetFillColorCommand({node:node,fillColor:color}));GliffyApp.contextualPropertiesController.__editor.getDocumentManager().updateStyleDefaultsForNode(node,"fill",color);GliffyApp.contextualPropertiesController.configureDialogControls()}break;case"border":for(i=0;i<shapes.length;i++){shapes[i].stage.commandHistory.addAndExecuteCommand(_gliffy.SetStrokeColorCommand({node:shapes[i],strokeColor:color}));GliffyApp.contextualPropertiesController.__editor.getDocumentManager().updateStyleDefaultsForNode(shapes[i],"stroke",color)}break;case"linefill":for(i=0;i<lines.length;i++){graphic=lines[i].getGraphic();lines[i].stage.commandHistory.addAndExecuteCommand(_gliffy.SetFillColorCommand({node:lines[i],fillColor:color}));GliffyApp.contextualPropertiesController.__editor.getDocumentManager().updateStyleDefaultsForNode(lines[i],"fill",color)}break;case"line":for(i=0;i<lines.length;i++){lines[i].stage.commandHistory.addAndExecuteCommand(_gliffy.SetStrokeColorCommand({node:lines[i],strokeColor:color}));GliffyApp.contextualPropertiesController.__editor.getDocumentManager().updateStyleDefaultsForNode(lines[i],"stroke",color)}break;case"text":tinyMCE.activeEditor.execCommand("ForeColor",false,color);break}documentManager.popCommandBundle();GliffyApp.contextualPropertiesController.setPickerButtonColors();GliffyApp.contextualPropertiesController.__editor.getDocumentManager().redraw();if($("#gliffy-edit-text_ifr").is(":visible")){$("#gliffy-edit-text_ifr").focus()}},resetDialogControls:function(exclude){var i,ddId;if(!exclude){exclude=""}this.resetPickerControls(exclude);this.__editor.overlayManager.textControl.hideMenus(exclude);for(i=0;i<this.__dialogDropdowns.length;i++){ddId=this.__dialogDropdowns[i];if(exclude!==ddId){$("#"+ddId).parent().removeClass("open")}}},resetPickerControls:function(exclude){var i,btnId;$("#gliffy-colorpicker").ColorPickerHide();$(".gliffy-colorswatchpicker").hide();if(!exclude){exclude=""}for(i=0;i<this.__dialogButtons.length;i++){btnId=this.__dialogButtons[i];if(exclude!==btnId){$("#"+btnId).attr("class","btn")}}},showDialog:function(e){var dh,dw,val,dialog=$("#gliffy-contextual-properties-dialog"),controlTabs=$("#gliffy-contextual-properties-controls-tabs");$("#gliffy-contextual-properties-dialog-Trigger").hide();this.resetDialogControls();this.configureDialogControls();dialog.css({width:40,height:50,left:200,top:0});dialog.jqmShow();dh=this.getDialogHeight();dw=this.getDialogWidth();dialog.find("div.jqmdBC").css("height",dh);if($.browser.msie){dialog.css({width:dw,height:dh})}this.__updateDialogPosition();val=$(e.currentTarget).attr("value");if(val==="text"){controlTabs.find("a[href='#gliffy-contextual-properties-tab-text']").tab("show").trigger("show")}else{if(this.getTab()===TABS.LINE){controlTabs.find("a[href='#gliffy-contextual-properties-tab-line']").tab("show").trigger("show")}else{controlTabs.find("a[href='#gliffy-contextual-properties-tab-shape']").tab("show").trigger("show")}}this.__adjustGrabberWidth();this.showNoTextInfo()},__adjustGrabberWidth:function(){$(".gliffy-contextual-properties-dragarea").width(this.__shapeGrabberWidth);if(this.getTab()===TABS.LINE||$("#gliffy-contextual-properties-controls-tabs.three-tabs .gliffy-contextual-properties-dragarea").length>0){$(".gliffy-contextual-properties-dragarea").width(this.__groupOrLineGrabberWidth)}},__activeNode:function(){var node=this.__editor.overlayManager.getSelectedNode(),txt;if(!node){txt=this.__editor.overlayManager.textControl.getActiveObject();node=txt?txt.node:null}return node},showNoTextInfo:function(){var node=this.__activeNode();if(node&&node.hasText()){$("#gliffy-contextual-properties-tab-text-rte").show();$("#gliffy-contextual-properties-notext-message").hide();return false}$("#gliffy-contextual-properties-tab-text-rte").hide();$("#gliffy-contextual-properties-notext-message").show();return true},__updateDialogPosition:function(){var dh=this.getDialogHeight(),dw=this.getDialogWidth(),dialog=$("#gliffy-contextual-properties-dialog"),offset=$("#gliffy-contextual-properties-controls").offset();if(this.__openMagnitude>0){if($.browser.msie){dialog.css({top:offset.top-75,left:offset.left+200})}else{dialog.animate({width:dw,height:dh,top:-75},50)}}else{if(this.getTab()===TABS.LINE){if($.browser.msie){dialog.css({top:offset.top-75,left:offset.left-10})}else{dialog.animate({width:dw,height:dh,left:0,top:-75},50)}}else{if($.browser.msie){dialog.css({top:offset.top-75,left:offset.left-40})}else{dialog.animate({width:dw,height:dh,left:-40,top:-75},50)}}}},handleDrag:function(event,dd){var newX,newY,dialog=$("#gliffy-contextual-properties-dialog"),offset,browserOffsetX=0,browserOffsetY=0,$ddProxy=$(dd.proxy),threeTabs=$("#gliffy-contextual-properties-controls-tabs.three-tabs .gliffy-contextual-properties-dragarea").length>0,grabberOffsetX=(threeTabs)?110:75;if($.browser.msie){offset=$("#gliffy-contextual-properties-controls").offset();browserOffsetX=offset.left;browserOffsetY=offset.top}if($("#gliffy-edit-text_ifr").is(":visible")){newX=dd.offsetX-GliffyApp.contextualPropertiesController.currentXPos-grabberOffsetX+browserOffsetX;newY=dd.offsetY-GliffyApp.contextualPropertiesController.currentYPos-90+browserOffsetY}else{newX=dd.offsetX-GliffyApp.contextualPropertiesController.currentXPos*this.getZoom()-grabberOffsetX-this.__getScrollX()+browserOffsetX;newY=dd.offsetY-GliffyApp.contextualPropertiesController.currentYPos*this.getZoom()-90-this.__getScrollY()+browserOffsetY}dialog.css({left:newX+"px",top:newY+"px"})},handleDragStart:function(event){GliffyApp.contextualPropertiesController.resetDialogControls()},setTab:function(tab){this._tab=tab},getTab:function(){return this._tab},getDialogHeight:function(){if(this.getTab()===TABS.LINE){return 150}else{if(this.getTab()===TABS.GROUP){return 256}else{return 186}}},getDialogWidth:function(){if(this.getTab()===TABS.LINE){return 275}else{return 310}},closeDialog:function(e){if(!$("#gliffy-edit-text_ifr").is(":visible")){GliffyApp.contextualPropertiesController.setKeyState()}GliffyApp.contextualPropertiesController.resetDialogControls(null);if($.browser.msie){GliffyApp.contextualPropertiesController.hideControls()}else{$("#gliffy-contextual-properties-dialog").hide();$("#gliffy-contextual-properties-dialog-Trigger").show()}},configureDialogControls:function(){var i,graphic,shape,node,targets=this.getTargetNodes(),showFill=true,showBorderColor=true,showBorderWidth=true,showGradient=true,showDropShadow=true,showLineFill=true,showBooleanState=true,showLoremIpsum=true,showLockAspect=true,disableWidth=false,disableHeight=false,disableRotation=false,hasTextShape=false,hasFillableShapes=false,hasImageShape=false,hasLine=false;if(targets!==null){for(i=0;i<targets.length;i++){node=targets[i];graphic=node.getGraphic();shape=_gliffy.shapeLibrary.shapes[node.getUid()];if(shape){if($.inArray("fill",shape.mutableProperties)<0){showFill=false}if($.inArray("stroke",shape.mutableProperties)<0){showBorderColor=false}if($.inArray("strokeWidth",shape.mutableProperties)<0){showBorderWidth=false}if(($.inArray("gradient",shape.mutableProperties)<0)||(node.getGraphic()&&node.getGraphic().getFillColor&&node.getGraphic().getFillColor()==="none")){showGradient=false}if($.inArray("shadow",shape.mutableProperties)<0){showDropShadow=false}if($.inArray("lockAspectRatio",shape.mutableProperties)<0){showLockAspect=false}if($.inArray("width",shape.mutableProperties)<0){disableWidth=true}if($.inArray("height",shape.mutableProperties)<0){disableHeight=true}if($.inArray("rotate",shape.mutableProperties)<0){disableRotation=true}if(node.getShapeInformation().states!==2){showBooleanState=false}if(!node.getShapeInformation().showLoremIpsumButton){showLoremIpsum=false}}if(node.isLine()){hasLine=true;if(graphic.getStrokeWidth()<3){showLineFill=false}showLoremIpsum=false;showBooleanState=false}else{if(node.isStandAloneText()){showFill=false;showBorderColor=false;showBorderWidth=false;showGradient=false;showDropShadow=false;showLoremIpsum=false;showBooleanState=false;hasTextShape=true;showLoremIpsum=false;showBooleanState=false}else{if(node.isImage()){hasImageShape=true;showFill=false;showBorderColor=false;showBorderWidth=false;showGradient=false;showLoremIpsum=false;showBooleanState=false}else{hasFillableShapes=true}}}}this.showShapePropertiesTopRowPanel();if(!(showFill||showBorderColor||showBorderWidth||showGradient||showDropShadow)||(!hasFillableShapes&&!hasImageShape)){this.hideShapePropertiesTopRowPanel()}$("#gliffy-contextual-properties-fill-button").toggle(showFill);$("#gliffy-contextual-properties-bordercolor-button").toggle(showBorderColor);$("#gliffy-contextual-properties-border-width").toggle(showBorderWidth);$("#gliffy-contextual-properties-gradient-button").toggle(showGradient);$("#gliffy-contextual-properties-shadow-button").toggle(showDropShadow);$("#gliffy-contextual-properties-linefillcolor-button").toggle(showLineFill);$("#gliffy-contextual-properties-span-state").toggle(showBooleanState);$("#gliffy-contextual-properties-button-loremipsum").toggle(showLoremIpsum);$("#gliffy-contextual-properties-lanes").toggle(targets&&targets.length===1&&targets[0].isSwimlane());$("#gliffy-contextual-properties-span-lock-aspect").toggle(showLockAspect);if(!GliffyApp.overlayModel.lockShape){this.setTextFieldDisabled("#gliffy-contextual-properties-textfield-width",disableWidth);this.setTextFieldDisabled("#gliffy-contextual-properties-textfield-height",disableHeight);this.setTextFieldDisabled("#gliffy-contextual-properties-textfield-rotation",disableRotation)}if(targets.length===1&&targets[0].isProxy()){this.setTextFieldDisabled("#gliffy-contextual-properties-textfield-width",true);this.setTextFieldDisabled("#gliffy-contextual-properties-textfield-height",true)}if(hasLine){this.__buildArrowDropdowns();this.__showArrowSelections()}this.setPickerButtonColors();this.setActiveDropdowns()}else{this.hideControls()}},setActiveDropdowns:function(){var node=this.getTargetNode(),lines=node.findGraphic(_gliffy.Line),shapes=node.findGraphic(_gliffy.Shape),line,shape;if(lines.length>0){line=lines[0].getGraphic();this.__setActiveDropdown("#gliffy-contextual-properties-line-width",this.getStrokeWidth(line));this.__setActiveDropdown("#gliffy-contextual-properties-line-type",this.getLineType(line));this.__setActiveDropdown("#gliffy-contextual-properties-dash-style",this.getDashStyle(line))}if(shapes.length>0){shape=shapes[0].getGraphic();this.__setActiveDropdown("#gliffy-contextual-properties-border-width",this.getStrokeWidth(shape))}},getStrokeWidth:function(graphic){if(graphic.getStrokeWidth){return graphic.getStrokeWidth()}else{return null}},getDashStyle:function(line){var dashArray=line.getDashStyle(),values,i,result=[];if(dashArray&&dashArray.split){values=dashArray.split(",");for(i=0;i<values.length;i++){result.push((parseInt(values[i],10))+".0")}}if(result.length>0){dashArray=result.join(",")}return dashArray},getLineType:function(line){var result=null;if(line.isOrtho()){if(line.getInterpolationType()===_gliffy.Line.INTERPOLATION_TYPE.linear){result=line.getCornerRadius()===10?line.LINE_TYPE_ORTHO_ROUNDED:line.LINE_TYPE_ORTHO_RIGHT_ANGLE}else{result=line.LINE_TYPE_QUADRATIC_BEZIER}}else{result=line.LINE_TYPE_STRAIGHT}return result},__setActiveDropdown:function(target,value){target=$(target).siblings();target.find("li.active").removeClass("active");if(value===null){value="null"}if(value!==undefined){target.find('a[data-gliffy-value="'+value+'"]').parent().addClass("active")}},setPickerButtonColors:function(){var node=this.getTargetNode(),lines=node.findGraphic(_gliffy.Line),shapes=node.findGraphic(_gliffy.Shape);$("#gliffy-contextual-properties-bordercolor-button .gliffy-color-line-color-icon").css("background-color",this.getTargetStrokeColor(shapes));$("#gliffy-contextual-properties-fill-button .gliffy-color-fill-icon").css("background-color",this.getTargetFillColor(shapes));$("#gliffy-contextual-properties-linefillcolor-button .gliffy-color-fill-icon").css("background-color",this.getTargetFillColor(lines));$("#gliffy-contextual-properties-linecolor-button .gliffy-color-line-color-icon").css("background-color",this.getTargetStrokeColor(lines))},setTextFieldDisabled:function(selector,disable){if(disable){$(selector).attr("disabled","disabled")}else{$(selector).removeAttr("disabled")}},__buildArrowDropdowns:function(){var i,markerArr,self=this,lineLibIdChunked,lineLibraryId,line,nodes=this.getTargetNode().findGraphic(_gliffy.Line),begin=$("#gliffy-contextual-properties-arrowbegin-dropdown"),end=$("#gliffy-contextual-properties-arrowend-dropdown");if(nodes!==null&&nodes.length>0){lineLibraryId=nodes[0].getUid()}if(lineLibraryId!==null){lineLibIdChunked=lineLibraryId.split(".");if(lineLibIdChunked.length>4){lineLibraryId="com.gliffy.shape.".concat(lineLibIdChunked[3]).concat(".").concat(lineLibIdChunked[4])}}markerArr=this.__markersDict[lineLibraryId];if(markerArr){markerArr=this.__markersDict.standard.concat(markerArr)}else{markerArr=this.__markersDict.standard}begin.empty().html('<li><a href="#" data-gliffy-value="0"><span class="icon line-ending left_noarrow gliffy-icon-arrow-none-left"></span></a></li>');end.empty().html('<li><a href="#" data-gliffy-value="0"><span class="icon line-ending right_noarrow gliffy-icon-arrow-none-right"></span></a></li>');for(i=0;i<markerArr.length;i++){$('<li><a href="#" data-gliffy-value="'+markerArr[i]+'"><span class="icon line-ending left_'+markerArr[i]+" gliffy-icon-arrow-"+markerArr[i]+'-left"></span></a></li>').insertAfter("#gliffy-contextual-properties-arrowbegin-dropdown li:last");$('<li><a href="#" data-gliffy-value="'+markerArr[i]+'"><span class="icon line-ending right_'+markerArr[i]+" gliffy-icon-arrow-"+markerArr[i]+'-right"></span></a></li>').insertAfter("#gliffy-contextual-properties-arrowend-dropdown li:last")}begin.find("li a").each(function(){$(this).bind("click",function(e){var num=Number(e.currentTarget.getAttribute("data-gliffy-value"));GliffyApp.contextualPropertiesController.updateLineTabProperty("StartArrow",num);_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextualProperties",action:"lineArrowBegin",value:num});e.preventDefault();begin.click()})});end.find("li a").each(function(){$(this).bind("click",function(e){var num=Number(e.currentTarget.getAttribute("data-gliffy-value"));GliffyApp.contextualPropertiesController.updateLineTabProperty("EndArrow",num);_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextualProperties",action:"lineArrowEnd",value:num});e.preventDefault();end.click()})})},__showArrowSelections:function(){var i,line,startArrow,endArrow,startArrowClass,endArrowClass,nodes=this.getTargetNode().findGraphic(_gliffy.Line);if(nodes!==null&&nodes.length>0){line=nodes[0].getGraphic();startArrow=line.getStartArrow();if(startArrow){startArrowClass="gliffy-icon-arrow-"+startArrow+"-left"}else{startArrowClass="gliffy-icon-arrow-none-left"}endArrow=line.getEndArrow();if(endArrow){endArrowClass="gliffy-icon-arrow-"+endArrow+"-right"}else{endArrowClass="gliffy-icon-arrow-none-right"}$("#gliffy-contextual-properties-arrowbegin span.icon").removeClass().addClass("icon "+startArrowClass);$("#gliffy-contextual-properties-arrowend span.icon").removeClass().addClass("icon "+endArrowClass)}else{$("#gliffy-contextual-properties-arrowbegin span.icon").removeClass().addClass("icon gliffy-icon-arrow-none-left");$("#gliffy-contextual-properties-arrowend span.icon").removeClass().addClass("icon gliffy-icon-arrow-none-right")}},updateControlsPosition:function(target){var xpos,ypos,cpropsTransform;this.__openMagnitude=1;if($("#gliffy-edit-text_ifr").is(":visible")){this.__getDialogTransformForText(target)}else{if(this.getTab()===TABS.LINE){this.__getDialogTransformForLine(target)}else{this.__getDialogTransformForShape(target)}}if(!$("#gliffy-tabs-container").is(":visible")){this.currentYPos=this.currentYPos-54}if(!$("#gliffy-edit-text_ifr").is(":visible")){this.__checkYPos();xpos=(this.getZoom()*this.currentXPos)+this.__getScrollX();ypos=(this.getZoom()*this.currentYPos)+this.__getScrollY()}else{xpos=this.currentXPos;ypos=this.currentYPos}if(xpos<30){xpos=30}cpropsTransform=_gliffy.AffineTransform.getTranslateInstance(Math.ceil(xpos),Math.ceil(ypos));$("#gliffy-contextual-properties-controls").css(_gliffy.Utils.transformCss(cpropsTransform,{matrixOnly:true}))},isVisible:function(){return($("#gliffy-contextual-properties-controls").is(":visible")||$("#gliffy-contextual-properties-dialog").is(":visible"))},__getScrollX:function(){return(_gliffy.Mouse.getStageOffset().left-($(".gliffy-sidebar").width()+10))},__getScrollY:function(){return(_gliffy.Mouse.getStageOffset().top-this.__editor.containerBounds.min.y)},getZoom:function(){return this.__editor.getDocumentManager().getActiveStage().zoom},__getDialogTransformForLine:function(ol){var mousePos=_gliffy.Mouse.getPosition(),lineGraphic=this.__editor.overlayManager.lineOverlay.getSelectedNode().getGraphic(),editableLine=lineGraphic.editable,sp=editableLine.getWorldStartPoint(),ep=editableLine.getWorldEndPoint(),pos="end";if(_gliffy.Vec2.squaredDistance(mousePos,sp)<_gliffy.Vec2.squaredDistance(mousePos,ep)){pos="start";ep=editableLine.getWorldStartPoint();sp=editableLine.getWorldEndPoint()}this.__positionForLinePoint(pos,sp,ep,lineGraphic);this.__checkLineXPos(pos,sp,ep,lineGraphic)},__positionForLinePoint:function(pos,sp,ep,lineGraphic){var propsOffset=this.__LINE_PROPS_INSIDE_OFFSET+lineGraphic.getStrokeWidth(),editableLine=lineGraphic.editable,magAxis=editableLine.getMagnitudeAndAxis(pos),mag=magAxis.mag,axis=magAxis.axis,x=0,y=0;if(axis==="y"){if((pos==="start"&&mag===1)||(pos==="end"&&mag===-1)){y=Math.round(ep.y+this.__LINE_PROPS_INSIDE_OFFSET/this.getZoom()+70/this.getZoom())}else{y=Math.round(ep.y-this.__LINE_PROPS_INSIDE_OFFSET/this.getZoom()+20/this.getZoom())}if(ep.x>sp.x){x=Math.round(ep.x+(propsOffset+15)/this.getZoom())}else{this.__openMagnitude=-1;x=Math.round(ep.x-propsOffset/this.getZoom()-65/this.getZoom())}}else{if(axis==="x"){if((pos==="start"&&mag===1)||(pos==="end"&&mag===-1)){this.__openMagnitude=-1;x=Math.round(ep.x+this.__LINE_PROPS_INSIDE_OFFSET/this.getZoom()-90/this.getZoom())}else{x=Math.round(ep.x-this.__LINE_PROPS_INSIDE_OFFSET/this.getZoom()+35/this.getZoom())}if(ep.y>sp.y){y=Math.round(ep.y+propsOffset/this.getZoom()+5/this.getZoom())}else{y=Math.round(ep.y-propsOffset/this.getZoom()+90/this.getZoom())}}}this.currentXPos=x;this.currentYPos=y},__checkLineXPos:function(pos,sp,ep,lineGraphic){var stageOffsetX=_gliffy.Mouse.getStageOffset().left,newMag;if((this.__openMagnitude===1&&(this.currentXPos*this.getZoom()+this.getDialogWidth()+stageOffsetX-20)>$(window).width())||(this.__openMagnitude===-1&&(stageOffsetX+this.currentXPos*this.getZoom()+this.__CONTROL_BUTTONS_WIDTH-this.getDialogWidth()-5<0))){newMag=this.__openMagnitude*-1;if(pos==="start"){pos="end"}else{pos="start"}this.__positionForLinePoint(pos,ep,sp,lineGraphic);this.__openMagnitude=newMag}},__checkYPos:function(){var stageOffsetY=this._getStageOffsetY();if(this.currentYPos*this.getZoom()+this.__getScrollY()<this.getDialogHeight()/2){this.currentYPos=(this.getDialogHeight()/2-this.__getScrollY())/this.getZoom()}else{if(this.currentYPos*this.getZoom()+this.getDialogHeight()/2+15+this.__getScrollY()>$(window).height()-stageOffsetY){this.currentYPos=($(window).height()-stageOffsetY-this.getDialogHeight()/2-15-this.__getScrollY())/this.getZoom()}}},_getStageOffsetY:function(){return $(".navbar-fixed-top").height()},__getDialogTransformForShape:function(ol){var olBox,positionX,positionY,dw=this.getDialogWidth(),dh=this.getDialogHeight(),stageOffsetX=_gliffy.Mouse.getStageOffset().left;if(ol.getSelectedNode()!==null){olBox=ol.getOverlayBoundingBox()}else{olBox=new _gliffy.BoundingBox()}positionX=olBox.max.x+(20/this.getZoom());if((olBox.max.y-olBox.min.y)<(95/this.getZoom())){positionY=olBox.min.y+(90/this.getZoom())}else{positionY=olBox.min.y+(110/this.getZoom())}if((positionX*this.getZoom()+stageOffsetX+dw-15)>$(window).width()){this.__openMagnitude=-1;positionX=positionX-((olBox.max.x-olBox.min.x)+(20/this.getZoom()))-(80/this.getZoom())}this.currentXPos=positionX;this.currentYPos=positionY},__getDialogTransformForText:function(target){var dw=this.getDialogWidth(),containerOffsetX=_gliffy.Mouse.getContainerOffset().left,rteBoundingBox=$("#gliffy-edit-text-container").data("boundingBox");this.currentXPos=rteBoundingBox.max.x+20+this.__getScrollX();this.currentYPos=rteBoundingBox.min.y+(rteBoundingBox.max.y-rteBoundingBox.min.y)/2+45+this.__getScrollY();if((this.currentXPos+dw+containerOffsetX-15)>$(window).width()){this.__openMagnitude=-1;this.currentXPos=this.currentXPos-(rteBoundingBox.max.x-rteBoundingBox.min.x)-100}},showControls:function(target){var textNode,display=false,rte=$("#gliffy-edit-text_ifr"),activeOverlay=this.__editor.overlayManager.getActiveOverlay();if(target!==null){if(target instanceof _gliffy.Overlay){if(activeOverlay!==null&&activeOverlay instanceof _gliffy.LineOverlay){target=activeOverlay}else{GliffyApp.overlayModel.update(target)}}}$("#gliffy-contextual-properties-shapeline-trigger i").removeClass("gliffy-tool-rect gliffy-icon-toolbar-rectangle-white gliffy-tool-line gliffy-icon-toolbar-line-white gliffy-tool-group gliffy-icon-toolbar-group-white");if(target!==null){if(target instanceof _gliffy.LineOverlay){this.__currentTextObject=null;this.setTab(TABS.LINE);if(target.isNewlyCreatedLine){return}this.__showLineControls();display=target.inStageViewport()}else{if(target instanceof _gliffy.Overlay){this.__currentTextObject=null;this.__showShapeControls(target,false);display=(target.inStageViewport()&&target.getSelectedNode()!==null)}else{if(rte.is(":visible")){textNode=rte.data("node");if(textNode){this.__currentTextObject=textNode.getUidNode();if(this.__currentTextObject.isLine()){this.setTab(TABS.LINE);this.__showLineControls()}else{this.__showShapeControls(target,true)}}display=true}}}this.updateControlsPosition(target)}if(display){this.displayControls()}},displayControls:function(){$("#gliffy-contextual-properties-controls").show()},__doTransformGroup:function(type,distributeOrAlign){var documentManager=this.__editor.getDocumentManager(),overlayManager=this.__editor.overlayManager;if(overlayManager.getSelectedNode().isSelection()){documentManager.pushCommandBundle();documentManager.getActiveStage().detachSelectionFromGroup(overlayManager.getSelectedNode());_gliffy.Align[distributeOrAlign](type,overlayManager.getSelectedNodes());documentManager.getActiveStage().attachSelectionToGroup(overlayManager.getSelectedNode(),overlayManager.getSelectedNodes());documentManager.popCommandBundle();overlayManager.overlay.refresh();documentManager.redraw()}else{if(overlayManager.getSelectedNode().isGroup()){documentManager.pushCommandBundle();_gliffy.Align[distributeOrAlign](type,overlayManager.getSelectedNode().children);overlayManager.getSelectedNode().stage.commandHistory.addAndExecuteCommand(new _gliffy.UpdateGroupBoundsCommand({node:overlayManager.getSelectedNode()}));documentManager.popCommandBundle();overlayManager.overlay.refresh();documentManager.redraw()}}},doAlign:function(type){this.__doTransformGroup(type,"align")},doDistribute:function(type){this.__doTransformGroup(type,"distribute")},__showLineControls:function(){$("#gliffy-contextual-properties-controls-tabs li:eq(0)").hide();$("#gliffy-contextual-properties-controls-tabs li:eq(1)").css("display","block");$("#gliffy-contextual-properties-shapeline-trigger").attr("data-original-title",$.i18n._("CPROPS_JS_EDIT_LINE_PROPERTIES"));$("#gliffy-contextual-properties-shapeline-trigger i").addClass("gliffy-tool-line gliffy-icon-toolbar-line-white")},__showShapeControls:function(target,isActiveText){$("#gliffy-contextual-properties-controls-tabs li:eq(0)").css("display","block");if(!isActiveText&&this.__isGroupSelected(target)){this.setTab(TABS.GROUP);$("#gliffy-contextual-properties-controls-tabs li:eq(1)").toggle(this.__hasLineInGroup(target));$(".gliffy-pe-align").show();$("#gliffy-contextual-properties-controls-tabs li:eq(0)").attr("data-original-title",$.i18n._("CPROPS_JS_SELECTION/SHAPE_PROPERTIES"));$("#gliffy-contextual-properties-shapeline-trigger").attr("data-original-title",$.i18n._("CPROPS_JS_EDIT_GROUP_PROPERTIES"));$("#gliffy-contextual-properties-shapeline-trigger i").addClass("gliffy-tool-group gliffy-icon-toolbar-group-white")}else{this.setTab(TABS.SHAPE);$("#gliffy-contextual-properties-controls-tabs li:eq(1)").hide();$(".gliffy-pe-align").hide();$("#gliffy-contextual-properties-controls-tabs li:eq(0)").attr("data-original-title",$.i18n._("CPROPS_JS_SHAPE_PROPERTIES"));$("#gliffy-contextual-properties-shapeline-trigger").attr("data-original-title",$.i18n._("CPROPS_JS_EDIT_SHAPE_PROPERTIES"));$("#gliffy-contextual-properties-shapeline-trigger i").addClass("gliffy-tool-rect gliffy-icon-toolbar-rectangle-white")}},__isGroupSelected:function(target){var node=target.getSelectedNode?target.getSelectedNode():null;return node&&(node.isGroup()||node.isSelection())},__hasLineInGroup:function(target){var node=target.getSelectedNode?target.getSelectedNode():null;return(node&&node.findGraphic(_gliffy.Line).length>0)},setKeyState:function(){if(GliffyApp.contextualPropertiesController.__editor.overlayManager.getSelectedNode()){if(this.getTargetNode().isLine()){_gliffy.KeyManager.setState("lineOverlaySelected")}else{_gliffy.KeyManager.setState("overlaySelected")}}else{_gliffy.KeyManager.setState("stage")}},blurRTE:function(){if(!this.keepDialogOpenOnBlurText){this.hideControls()}this.keepDialogOpenOnBlurText=false},hideControls:function(skipKeyState){if(skipKeyState===undefined){skipKeyState=false}if(!this.keepDialogOpen&&!this.keepDialogOpenOnBlurText){this.setTab(TABS.NONE);if($("#gliffy-contextual-properties-controls").css("display")!=="none"){$("#gliffy-contextual-properties-controls").hide();$("#gliffy-contextual-properties-dialog").hide();$("#gliffy-contextual-properties-dialog").jqmHide();$("#gliffy-contextual-properties-dialog-Trigger").show();$("#gliffy-colorpicker").ColorPickerHide();$(".gliffy-colorswatchpicker").hide()}if(!skipKeyState){this.setKeyState()}}},toggleColorSwatchPicker:function(domElement){var domId=domElement.getAttribute("id");this.resetDialogControls(domId)},getTargetColor:function(domElement){var domId=domElement.getAttribute("id"),node=this.getTargetNode(false);if(node){switch(domId){case"gliffy-contextual-properties-fill-button":return this.getTargetFillColor(node.findGraphic(_gliffy.Shape));case"gliffy-contextual-properties-linefillcolor-button":return this.getTargetFillColor(node.findGraphic(_gliffy.Line));case"gliffy-contextual-properties-bordercolor-button":return this.getTargetStrokeColor(node.findGraphic(_gliffy.Shape));case"gliffy-contextual-properties-linecolor-button":return this.getTargetStrokeColor(node.findGraphic(_gliffy.Line));case"gliffy-edit-text_gliffyforecolor":case"gliffy-contextual-properties-textcolor-button":return null}}return null},getTargetFillColor:function(nodes){var fillColor="#000000";if(nodes&&nodes.length>0){fillColor=nodes[0].getGraphic().getFillColor();if(fillColor===null){fillColor="#000000"}else{if(fillColor==="none"){fillColor="transparent"}}}return fillColor},getTargetStrokeColor:function(nodes){var strokeColor="#000000";if(nodes&&nodes.length>0){strokeColor=nodes[0].getGraphic().getStrokeColor()}return strokeColor},showTab:function(){this.resetDialogControls()},getTargetNodes:function(){var targets=this.getTargetNode();if(targets===null){return null}else{return this.getTargetNode().getLeafNodes()}},hideShapePropertiesTopRowPanel:function(){$(".gliffy-pe-toprow").hide()},showShapePropertiesTopRowPanel:function(){$(".gliffy-pe-toprow").show()},changeLineType:function(type,nodes){var overlay=this.__editor.overlayManager.getActiveOverlay(),i,node;for(i=0;i<nodes.length;i++){node=nodes[i];if(node.isLine()){switch(type){case (_gliffy.Line.prototype.LINE_TYPE_STRAIGHT):if(overlay instanceof _gliffy.LineOverlay){this.__editor.drawManager.setOrthoMode(_gliffy.Editor.ORTHO_MODE.bezel);overlay.setLineType(null)}else{node.getGraphic().editable.setOrthoMode(_gliffy.Editor.ORTHO_MODE.bezel);node.getGraphic().setOrtho(false)}break;case (_gliffy.Line.prototype.LINE_TYPE_ORTHO_RIGHT_ANGLE):if(overlay instanceof _gliffy.LineOverlay){this.__editor.drawManager.setOrthoMode(_gliffy.Editor.ORTHO_MODE.straight);overlay.setLineType(_gliffy.Editor.ORTHO_MODE.straight)}else{node.getGraphic().editable.setOrthoMode(_gliffy.Editor.ORTHO_MODE.straight);node.getGraphic().setOrtho(true)}break;case (_gliffy.Line.prototype.LINE_TYPE_ORTHO_ROUNDED):if(overlay instanceof _gliffy.LineOverlay){this.__editor.drawManager.setOrthoMode(_gliffy.Editor.ORTHO_MODE.bezel);overlay.setLineType(_gliffy.Editor.ORTHO_MODE.bezel)}else{node.getGraphic().editable.setOrthoMode(_gliffy.Editor.ORTHO_MODE.bezel);node.getGraphic().setOrtho(true)}break;case (_gliffy.Line.prototype.LINE_TYPE_QUADRATIC_BEZIER):if(overlay instanceof _gliffy.LineOverlay){this.__editor.drawManager.setOrthoMode(_gliffy.Editor.ORTHO_MODE.curved);overlay.setLineType(_gliffy.Editor.ORTHO_MODE.curved)}else{node.getGraphic().editable.setOrthoMode(_gliffy.Editor.ORTHO_MODE.curved);node.getGraphic().setOrtho(true)}break}}}},handleLoremIpsumClick:function(){if(this.__editor.overlayManager.getActiveOverlay() instanceof _gliffy.Overlay){this.__editor.overlayManager.overlay.makeTextEditable();this.__addingLoremIpsum=true}else{this.addLoremIpsum()}},addLoremIpsum:function(){tinyMCE.activeEditor.execCommand("mceInsertContent",false,_gliffy.Editor.LOREM_IPSUM_TEXT);tinyMCE.activeEditor.execCommand("mceAutoResize",false)}})}());(function(){GliffyApp.DocumentPropertiesController=GliffyApp.AbstractPropertiesController.extend({__dialogButtons:null,titleVersionDisplay:null,init:function(){var self=this;this.__dialogButtons=["gliffy-document-properties-pagecolor-button"];GliffyApp.documentModel.addObserver("gridVisible",function(){self.updateUI()});GliffyApp.documentModel.addObserver("title",function(){self.updateUI()});GliffyApp.documentModel.addObserver("currentRevision",function(){self.updateUI()});GliffyApp.documentModel.addObserver("pageColor",function(){self.setPickerButtonColors()})},updateUI:function(){if($("#gliffy-document-properties-dialog").is(":visible")){this.set("titleVersionDisplay",GliffyApp.documentTabsController.getDisplayTitle());this.setPickerButtonColors()}},updateSizeProperty:function(prop,value){var documentManager=GliffyApp.contextualPropertiesController.__editor.getDocumentManager();if(prop==="MaxWidth"){documentManager.getActiveStage().commandHistory.addAndExecuteCommand(_gliffy.SetPageWidthCommand({stage:documentManager.getActiveStage(),width:value}))}else{documentManager.getActiveStage().commandHistory.addAndExecuteCommand(_gliffy.SetPageHeightCommand({stage:documentManager.getActiveStage(),height:value}))}this.__editor.getDocumentManager().redraw()},updateProperty:function(prop,value){GliffyApp.documentModel.updateProperty(prop,value);this.__editor.getDocumentManager().getActiveDocument().updateProperty(prop,value);if(prop==="GridVisible"){this.__editor.grid.setEnabled(value)}this.__editor.getDocumentManager().redraw()},isValidPropertyValue:function(prop,value){value=Number(value);if(isNaN(value)){return false}else{if(value<=0||value>5000){return false}}return true},resetDialogControls:function(exclude){var i,btnId;$("#gliffy-colorpicker").ColorPickerHide();$(".gliffy-colorswatchpicker").hide();if(!exclude){exclude=""}for(i=0;i<this.__dialogButtons.length;i++){btnId=this.__dialogButtons[i];if(btnId!==exclude){$("#"+btnId).attr("class","btn")}}},setPickerButtonColors:function(){var pageColor=this.getTargetColor($("#gliffy-document-properties-pagecolor-button").get(0));$("#gliffy-document-properties-pagecolor-button .gliffy-color-fill-icon").css("background-color",pageColor)},handleColorpickerColorChange:function(color,mode){var documentManager=GliffyApp.contextualPropertiesController.__editor.getDocumentManager();documentManager.getActiveStage().commandHistory.addAndExecuteCommand(new _gliffy.SetPageColorCommand({stage:documentManager.getActiveStage(),background:color}));documentManager.redraw(null,false);this.setPickerButtonColors()},showDialog:function(){var dialog=$("#gliffy-document-properties-dialog"),l=$(window).width()/2,t=$(window).height()/2-dialog.height()/2;dialog.css({left:l+"px",top:t+"px"});dialog.show();this.updateUI()},hideDialog:function(){$("#gliffy-document-properties-pagecolor-button").attr("class","btn");$("#gliffy-document-properties-dialog").hide();$("#gliffy-colorpicker").ColorPickerHide();$(".gliffy-colorswatchpicker").hide()},getTargetColor:function(domElement){return this.__editor.getDocumentManager().getActiveStage().background}})}());(function(){GliffyApp.DocumentTabsController=Ember.Object.extend({__editor:null,__tabIDCounter:0,__tabLimit:9,__tabTemplate:null,init:function(){var self=this;GliffyApp.documentModel.addObserver("title",function(){self.updateTabText()});GliffyApp.documentModel.addObserver("unsavedChanges",function(){self.updateTabText()});GliffyApp.documentModel.addObserver("currentRevision",function(){self.updateTabText()});$("#gliffy-tabs-container").on("click",".gliffy-document-tab",function(e){e.preventDefault();var document=$(this).data("document");if(document){self.selectTab($(this).data("document"))}});$("#gliffy-tabs-button-add").attr("title",$.i18n._("TABDIALOG_OPEN_DOCUMENT"));$("#gliffy-tabs-button-add").click(function(e){_gliffy.Utils.analyticsEvent("trackEvent",{category:"documentTabClick",action:"newTabClicked"});self.__editor.performAction("clickAddTab");e.preventDefault()}).tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy-tabs-container").delegate('.icon-remove"',"click",function(e){e.preventDefault();var tabId=e.currentTarget.getAttribute("data-tabId"),document=$("#"+tabId).data("document");self.closeTab(document)})},getDisplayTitle:function(){var str=GliffyApp.documentModel.title+", v"+GliffyApp.documentModel.currentRevision;if(!$.isNumeric(GliffyApp.documentModel.currentRevision)||GliffyApp.documentModel.currentRevision<1){str=GliffyApp.documentModel.title}return(GliffyApp.documentModel.unsavedChanges===true?"*":"")+str},updateTabText:function(){var tabDomElement=this.__editor.getDocumentManager().getActiveDocument().tabDomElement,tab;tab=$(this.getTabTemplateHTML($("#gliffy-tabs-button-add").length!==0,tabDomElement.attr("id"))).data(tabDomElement.data());tabDomElement.replaceWith(tab);this.__editor.getDocumentManager().getActiveDocument().tabDomElement=tab;tab.find("i").tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy").trigger("gliffy.document_tab_updated")},getTabCount:function(){return this.__editor.getDocumentManager().getDocumentCount()},getTabTemplateHTML:function(close,tabId){return this.__tabTemplate({displayTitle:this.getDisplayTitle(),tabId:tabId,"active?":true,"close?":close})},createNewTab:function(document){var tabHTML,tab,tmpl,self=this;if(!this.__tabTemplate){tmpl=$("#gliffy-tab-template").html();this.__tabTemplate=function(data){if(data&&tmpl){return Mustache.render(tmpl,$.extend(data,{i18n_TAB_CLOSE_DOCUMENT:$.i18n._("TAB_CLOSE_DOCUMENT")}))}}}tabHTML=this.getTabTemplateHTML($("#gliffy-tabs-button-add").length!==0,"gliffy-tab-"+this.__tabIDCounter);tab=$(tabHTML);tab.insertBefore("#gliffy-tabs-container li:last");tab.data("document",document);document.tabDomElement=tab;this.__tabIDCounter++;$("#gliffy").trigger("gliffy.document_tab_updated");$("#gliffy-tabs-button-add").toggle(this.getTabCount()<=this.__tabLimit)},closeAllTabs:function(){var i,documents=this.__editor.getDocumentManager().getDocuments();for(i=0;i<documents.length;i++){this.__preRemoveTab(document[i])}},closeTab:function(document){var self=this;if(document.getStage().hasUnsavedChanges()){if(this.__editor.getDocumentManager().getActiveDocument()!==document){this.selectTab(document)}_gliffy.Dialog.showYesNoDialog({title:$.i18n._("TABDIALOG_CONFIRM_NAVIGATION"),content:$.i18n._("TABDIALOG_UNSAVED_CHANGES",[document.getTitle()]),cancelCallback:null,buttons:[{text:$.i18n._("TABDIALOG_CONTINUE_WORKING"),callback:null,primary:false,dismiss:true},{text:$.i18n._("TABDIALOG_CLOSE_TAB"),callback:function(e){document.getStage().setUnsavedChanges(false);self.__preRemoveTab(document)},primary:true,dismiss:true}]})}else{this.__preRemoveTab(document)}},__preRemoveTab:function(document){var self=this;if(!(document instanceof _gliffy.Document)){document=this.__editor.getDocumentManager().getActiveDocument()}if(this.getTabCount()===1){if(window===window.parent){this.__editor.closeLastTab()}else{this.__editor.create(function(){self.__editor.closeLastTab()})}}else{this.removeTab(document)}},removeTab:function(document){this.killCloseTooltip(document.tabDomElement);this.__editor.getDocumentManager().removeDocument(document);document.tabDomElement.remove();this.selectLastTab();$("#gliffy-tabs-button-add").toggle(this.getTabCount()<=this.__tabLimit)},killCloseTooltip:function(tabDomElement){tabDomElement.find("i").removeAttr("data-original-title").tooltip("hide")},selectTab:function(document){$("#gliffy-edit-text").trigger("customblur.gliffy-edit-text");if(document!==this.__editor.getDocumentManager().getActiveDocument()){this.__editor.overlayManager.deselectAll();this.__editor.getDocumentManager().cleanTarget();this.__editor.getDocumentManager().setActiveDocument(document);document.tabDomElement.addClass("active")}},selectLastTab:function(){var lastTab=$("#gliffy-tabs-container .gliffy-document-tab:last");if(lastTab.length>0){this.selectTab(lastTab.data("document"));lastTab.addClass("active")}else{this.__editor.closeLastTab()}}})}());(function(){GliffyApp.RevisionHistoryController=Ember.Object.extend({currentPage:1,numPages:1,currentBaseRevision:1,currentMaxRevision:1,numRevisions:0,allRevisions:null,revisions:null,errorTarget:null,__editor:null,init:function(){this.revisions=Ember.A([])},reset:function(){this.allRevisions=[];this.currentPage=1;this.numPages=1;Ember.set("currentBaseRevision",1);Ember.set("currentMaxRevision",1);Ember.set("numRevisions",0);this.revisions.clear()},handleNextClick:function(){this.currentPage++;this.__populate()},handlePreviousClick:function(){this.currentPage--;this.__populate()},__populate:function(){var i,revision,moddt,currentMaxRevision,currentBaseRevision;this.revisions.clear();currentBaseRevision=((this.currentPage-1)*10+1);currentMaxRevision=(this.currentPage*10);if(currentMaxRevision>this.numRevisions){currentMaxRevision=this.numRevisions}this.set("currentBaseRevision",currentBaseRevision);this.set("currentMaxRevision",currentMaxRevision);for(i=0;i<this.allRevisions.length;i++){if(i>=currentBaseRevision-1&&i<=currentMaxRevision-1){revision=this.allRevisions[i];moddt=new Date(revision.lastModified);revision.prettyDate=revision.lastModifiedFriendly;revision.isChecked=(this.__editor.getDocumentManager().getActiveDocument().getCurrentRevision()===revision.version);revision.radioId="gliffy-revison-history-radio-"+revision.version;revision.descriptor="id:"+revision.id+",dvid:"+revision.version;if(revision.urls){revision.openUrl=revision.urls.open}this.revisions.pushObject(revision)}}this.__displayPreviousNext()},__hidePreviousNext:function(){$("#gliffy-revision-history-previous-button").hide();$("#gliffy-revision-history-next-button").hide();$("#gliffy-revision-history-previous-next-separator").hide()},__displayPreviousNext:function(){$("#gliffy-revision-history-previous-button").show();$("#gliffy-revision-history-next-button").show();$("#gliffy-revision-history-previous-next-separator").show();if(this.numPages===this.currentPage){$("#gliffy-revision-history-next-button").hide();$("#gliffy-revision-history-previous-next-separator").hide()}if(this.currentPage===1){$("#gliffy-revision-history-previous-button").hide();$("#gliffy-revision-history-previous-next-separator").hide()}},loadRevisionHistory:function(){var self=this;this.reset();this.__editor.performAction("history",this.__editor.getDocumentManager().getActiveDocument().toObject(),function(data){_gliffy.Utils.tryCatch(function(){self.handleLoadSuccess(data)},function(e){_gliffy.handleError("com.gliffy.error.file_malformed",[],e,self.errorTarget)})},function(xhr,status,error){if(xhr.status===404){_gliffy.handleError("com.gliffy.error.file_not_found",[],error,this.errorTarget)}else{_gliffy.handleError("com.gliffy.error.file_malformed",[],error,this.errorTarget)}})},handleLoadSuccess:function(data){this.set("numRevisions",data.numRevisions);this.numPages=Math.ceil(this.numRevisions/10);this.allRevisions=data.revisions;this.__populate();this.__displayPreviousNext()},openRevision:function(openUrl){var self=this;if(this.__editor.getDocumentManager().getActiveStage().hasUnsavedChanges()){_gliffy.Dialog.showYesNoDialog({title:$.i18n._("REVISIONHISTORY_CONFIRM_NAVIGATION"),content:$.i18n._("REVISIONHISTORY_YOU_HAVE_UNSAVED_CHANGES._ARE_YOU_SURE_YOU_WANT_TO_LOAD_THIS_REVISION?"),cancelCallback:null,buttons:[{text:$.i18n._("REVISIONHISTORY_CONTINUE_WORKING"),callback:null,primary:false,dismiss:true},{text:$.i18n._("REVISIONHISTORY_OPEN_REVISION"),callback:function(e){self.__editor.open({url:openUrl});self.ga("openRevision")},primary:true,dismiss:true}]})}else{this.__editor.open({url:openUrl});self.ga("openRevision")}},ga:function(action){_gliffy.Utils.analyticsEvent("trackEvent",{category:"revisionHistory",action:action})}})}());(function(){GliffyApp.HudController=Ember.Object.extend({__editor:null,__mode:null,__width:null,__deferredMode:null,canShow:false,HUD_MODE:{pos:"pos",size:"size",rot:"rot"},update:function(){var o=this.__editor.overlayManager.overlay,height,selectedNode,deg;switch(this.__mode){case this.HUD_MODE.pos:$("#gliffy-hud").html("<span>X: </span> "+Math.round(o.getTransX())+"px <span>Y:</span> "+Math.round(o.getTransY())+"px");break;case this.HUD_MODE.size:selectedNode=o.getSelectedNode();if(selectedNode){height=Math.round(selectedNode.getHeight())}else{height=Math.round(o.getScaleY())}$("#gliffy-hud").html("<span>"+$.i18n._("HUD_W")+": </span> "+Math.round(o.getScaleX())+$.i18n._("HUD_PX")+" <span>"+$.i18n._("HUD_H")+":</span> "+height+$.i18n._("HUD_PX"));break;case this.HUD_MODE.rot:deg=(Math.round(_gliffy.Utils.radiansToDegrees(o.getRotation()))+3600)%360;$("#gliffy-hud").html((deg>180?-360+deg:deg)+"&#176;");break}this.position()},position:function(){var hud=$("#gliffy-hud"),transform,selectedNode=this.__editor.overlayManager.getSelectedNode(),zoom=this.__editor.getDocumentManager().getActiveStage().getZoom(),bb,width,o=this.__editor.overlayManager.overlay,ow,oh,x,y;switch(this.__mode){case this.HUD_MODE.rot:ow=o.getScaleX()*zoom;oh=o.getScaleY()*zoom;x=o.getTransX()*zoom+ow/2-this.__width*zoom/2;y=o.getTransY()*zoom+oh+20;hud.css({top:y,left:x});break;default:if(selectedNode!==null){selectedNode.update();bb=selectedNode.getChildrenAabb(true);bb.transform(selectedNode.worldTransform);width=bb.getDimension().x;hud.css({top:(bb.max.y+20/zoom)*zoom,left:(bb.min.x+(width/2-this.__width/2/zoom))*zoom})}break}},show:function(mode){this.__deferredMode=mode},showDeferred:function(){this.canShow=true;var self=this,hud=$("#gliffy-hud");if(!this.isOn){setTimeout(function(){if(self.canShow&&self.__deferredMode!==null){self.__mode=self.__deferredMode;if(self.__mode===self.HUD_MODE.rot){hud.width(40);self.__width=40}else{hud.width(125);self.__width=125}self.update();hud.show();self.isOn=true}},300)}else{this.update()}},quickHide:function(){this.isOn=false;$("#gliffy-hud").hide()},hide:function(){this.canShow=false;this.isOn=false;$("#gliffy-hud").hide();this.__deferredMode=null}})}());(function(){GliffyApp.ShapeLibraryController=Ember.Object.extend({__editor:null,__currentLibrary:null,__currentLibraryDOM:null,__gliffyStandardLibraryCache:null,__loadedArray:null,__initialShapeLibraryClick:false,customLibraryDropRegister:null,init:function(){this.__loadedArray=[];this.customLibraryDropRegister=new _gliffy.CustomLibraryDropRegister(this.__editor);if(!window.jasmine){this.registerMouseClickState();this.cacheLibraries();_gliffy.shapeLibrary.loadShapes(["com.gliffy.shape.basic.basic_v1.default.rectangle","com.gliffy.shape.basic.basic_v1.default.ellipse","com.gliffy.shape.basic.basic_v1.default.image","com.gliffy.shape.basic.basic_v1.default.svg"],null,this.__editor.language).done(function(data){var i,stencils=[];for(i=0;i<data.length;i++){if(data.tids){stencils=stencils.concat(data[i].tids)}}_gliffy.shapeLibrary.loadStencils(stencils)});$(function(){if($.browser.webkit){$("body").on("mousedown",".gliffy-accordion-inner",function(e){var elems=_gliffy.KoreSampl.fromEvent(e,e.currentTarget);if(elems.length>0&&$(elems[0]).is("input")){return true}else{return false}})}$("body").on("mouseenter",".gliffy-sidebar-shape",function(){$(this).addClass("gliffy-hover")}).on("mouseleave",".gliffy-sidebar-shape",function(){$(".gliffy-sidebar-shape.gliffy-hover").removeClass("gliffy-hover")})})}},registerMouseClickState:function(){var self=this,INTERP_TIME=150,draggingOverStage=false,nodeDom=null,node,annotationRemoved,$dragThis,$this,shapeCopy,w,h,autoPan=new _gliffy.AutoPan({editor:this.__editor,callback:function(position){self.__updateNode($dragThis,node,position)}});_gliffy.Mouse.registerClickState({name:"shapeLibrary",modes:["library-drop"],target:".gliffy-sidebar-shape,.gliffy-shape-library-com-gliffy-shape-image",mouseDown:function(event){$this=$(event.currentTarget);if(!$this.hasClass("gliffy-shape-clone")){$(".gliffy-shape-clone").remove();_gliffy.Mouse.setClickMode("shapeLibrary");_gliffy.Mouse.setState("library-drop");_gliffy.Mouse.__mousedown(event)}}});_gliffy.Mouse.registerDragState([{modes:["library-drop"],dragStart:function(event){$("#gliffy-edit-text").trigger("customblur");shapeCopy=$this.clone().addClass("gliffy-shape-clone");w=shapeCopy.width();h=shapeCopy.height();shapeCopy.css({position:"absolute",left:event.pageX-w/2+"px",top:event.pageY-h/2+"px"});$("#gliffy").append(shapeCopy);draggingOverStage=false;nodeDom=null;$("#gliffy-toolbar-button-pointer").trigger({type:"click",deselect:false});_gliffy.Mouse.lockDragUI("move")},drag:function(event){var dragPoint,stageCoord=_gliffy.Mouse.getPosition(),domNode,nodeId,containerBounds,params;if(event){shapeCopy.css({left:event.pageX-w/2+"px",top:event.pageY-h/2+"px"});$dragThis=$this;self.__editor.overlayManager.overlay.isDragging=true;self.__editor.overlayManager.lineOverlay.isDragging=true;containerBounds=new _gliffy.BoundingBox(self.__editor.containerBounds.min.x,self.__editor.containerBounds.min.y,self.__editor.containerBounds.max.x+40,self.__editor.containerBounds.max.y+40);dragPoint=new _gliffy.Vec2(event.pageX+20,event.pageY+20);if(containerBounds.pointInside(dragPoint.x,dragPoint.y)){if(!draggingOverStage){autoPan.start(event,stageCoord);shapeCopy.animate({opacity:0},INTERP_TIME);node=new _gliffy.Node();params=$dragThis.data("params");self.__editor.drawManager.setupShape(node,params,stageCoord);if(node.isLine()){self.__editor.overlayManager.lineOverlay.isNewlyCreatedLine=true;self.__editor.overlayManager.selectNode(node);self.__editor.overlayManager.lineOverlay.showConnectionPoints(false,true)}else{self.__editor.overlayManager.selectNode(node);if(node.isContainer()){self.__editor.getDocumentManager().getActiveStage().sendToBack(node)}self.__editor.overlayManager.overlay.cacheGuideNodes()}}else{autoPan.update(event,stageCoord)}if(node){if(!nodeDom){nodeDom=node.getDomElement();if(nodeDom){nodeDom.css("opacity","0.0");nodeDom.animate({opacity:1},INTERP_TIME)}if(node.isGuideNode()){self.__editor.overlayManager.overlay.cacheGuideNodes()}}self.__updateNode($dragThis,node,stageCoord)}draggingOverStage=true}else{autoPan.stop();if(draggingOverStage){shapeCopy.animate({opacity:1},INTERP_TIME);self.__editor.overlayManager.deselectAll();self.__editor.overlayManager.overlay.hideActiveGuides();domNode=node.getDomElements();nodeId=node.getId();domNode.animate({opacity:"0.1"},INTERP_TIME,function(){var stage=self.__editor.getDocumentManager().getActiveStage(),removeNode=stage.find(nodeId);if(removeNode){annotationRemoved=removeNode.isAnnotation();self.__editor.getDocumentManager().addAndExecuteCommand(new _gliffy.RemoveNodeCommand({node:removeNode}));if(annotationRemoved){self.__editor.getDocumentManager().popCommandBundle()}self.__editor.getDocumentManager().redraw()}});GliffyApp.hudController.hide()}draggingOverStage=false;nodeDom=null;node=null}}},dragEnd:function(event){var customHandler;self.__editor.overlayManager.overlay.isDragging=false;self.__editor.overlayManager.lineOverlay.isDragging=false;autoPan.stop();shapeCopy.animate({left:$this.offset().left,top:$this.offset().top},INTERP_TIME,function(){shapeCopy.remove()});if(draggingOverStage){_gliffy.Utils.analyticsEvent("trackEvent",{category:"shapeAdded",action:node.getUid()});customHandler=self.customLibraryDropRegister.getCustomHandler(node);customHandler.afterDrop(node,$this)}draggingOverStage=false;GliffyApp.hudController.hide()}}])},setupShapeLibrary:function(){var self=this;$("body").on("show",".accordion-body",function(event){if(_gliffy.BrowserDetect.browser==="Firefox"){$(".accordion-body").not(".collapse").not(".in").addClass("collapse").collapse("hide")}var library=$(this);if(!library.data("libraryLoaded")){self.buildShapesForLibrary($("#"+library.attr("data-gliffy-default-sublibrary")));library.data("libraryLoaded",true)}if(!self.__initialShapeLibraryClick){_gliffy.Utils.analyticsEvent("trackEvent",{category:"shapeLibraryShow",action:event.currentTarget.id.replace("gliffy-sidebar-com-gliffy-library-","")})}$("#gliffy-edit-text").trigger("customblur");$(".gliffy-sidebar a[href='#"+event.currentTarget.id+"']").addClass("opened");self.__currentLibrary=event.currentTarget.parentElement.getAttribute("data-gliffy-library");self.__currentLibraryDOM=event.currentTarget.parentElement});$("body").on("hide",".accordion-body",function(event){$("#gliffy-edit-text").trigger("customblur");$(".gliffy-sidebar a[href='#"+event.currentTarget.id+"']").removeClass("opened")});setTimeout(function(){self.__initialShapeLibraryClick=true;$("#gliffy-symbol-library-com-gliffy-library-basic>.accordion-heading>a").trigger("click");setTimeout(function(){self.__initialShapeLibraryClick=false},1)},1);$("body").on("click",".gliffy-sidebar-sublibrary-dropdown a",function(e){_gliffy.Utils.analyticsEvent("trackEvent",{category:"shapeSubLibraryShow",action:e.currentTarget.getAttribute("data-gliffy-value").replace("gliffy-shape-library-com-gliffy-library-","")});$(e.currentTarget.getAttribute("href")+" a").first().html(e.currentTarget.innerHTML+' <b class="caret"></b>');e.preventDefault();self.selectSublibrary(e.currentTarget.getAttribute("data-gliffy-value"),$(e.currentTarget).parent().parent())})},buildShapesForLibrary:function(subLibraryDiv){var subLibraryUID,self=this,shapes,uidLoadList=[],tids=[],i,shape,uid,tid,shapeLoaded=false,stencilLoaded=false,onLoaded,fStencilLoaded,fShapeLoaded,shapeData,shapeClassName,shapeDiv,iconWidth,iconHeight,iconColumns,shapeClassBase;subLibraryUID=$(subLibraryDiv).find("span").last().attr("data-gliffy-shape-library-uid");shapes=this.getShapesByUIDFromLibraryCache(subLibraryUID);$(subLibraryDiv).css("opacity","0.1");if(subLibraryUID==="com.gliffy.shape.images"){GliffyApp.imageBrowserController.buildImageShapes(subLibraryDiv)}else{if(shapes&&$.inArray(subLibraryUID,this.__loadedArray)===-1){for(i=0;i<shapes.length;i++){uid=shapes[i];if(_gliffy.shapeLibrary.getShape(uid)===null||_gliffy.shapeLibrary.getShape(uid)===undefined){uidLoadList.push(uid)}}onLoaded=function(){$(subLibraryDiv).css("opacity","1.0");self.__loadedArray.push(subLibraryUID)};fStencilLoaded=function(){stencilLoaded=true;if(stencilLoaded&&shapeLoaded){onLoaded()}};fShapeLoaded=function(){var j,i18nTooltip,desc;shapeLoaded=true;shapeClassBase="gliffy-shape-library-"+shapes[0].substring(0,uid.lastIndexOf(".")).split(".").join("-");iconWidth=Number($(subLibraryDiv).find("span").attr("data-icon-width"));iconHeight=Number($(subLibraryDiv).find("span").attr("data-icon-height"));iconColumns=Number($(subLibraryDiv).find("span").attr("data-icon-columns"));for(i=0;i<shapes.length;i++){uid=shapes[i];shapeData=_gliffy.shapeLibrary.getShape(uid);for(j=0;j<shapeData.tids.length;j++){tid=shapeData.tids[j];if(tid!=="com.gliffy.stencil.line"&&(_gliffy.shapeLibrary[tid]===null||_gliffy.shapeLibrary[tid]===undefined)){tids.push(tid)}}desc=shapeData.description;if(desc==="iphone"){desc="iPhone"}else{desc=_gliffy.Utils.capitalize(shapeData.description);if(self.__editor.language&&(self.__editor.language.indexOf("no")!==-1||self.__editor.language.indexOf("fi")!==-1)){desc=_gliffy.Utils.capitalizeFirstWord(shapeData.description)}}shapeClassName=shapes[i].split(".").join("-").split("_").join("-");shapeDiv=$("<div/>",{id:"gliffy-shape-library-"+uid.split(".").join("-"),"class":shapeClassBase+" "+shapeClassName+" gliffy-sidebar-shape",title:desc});shapeDiv.data("params",{uid:uid,tid:tid});$(subLibraryDiv).find("span").append(shapeDiv)}self.bindEventsToShapes(shapeClassBase);if(tids.length>0){_gliffy.shapeLibrary.loadStencils(tids).done(fStencilLoaded)}else{stencilLoaded=true}if(stencilLoaded&&shapeLoaded){onLoaded()}};if(uidLoadList.length>0){_gliffy.shapeLibrary.loadShapes(uidLoadList,null,self.__editor.language).done(fShapeLoaded)}else{stencilLoaded=true;fShapeLoaded()}}else{$(subLibraryDiv).css("opacity","1.0")}}},__updateNode:function($this,node,stageCoord){var nodeBB=null,imageWidth,imageHeight;if($this.data("params")!==undefined&&$this.data("params").tid==="com.gliffy.stencil.line"){this.__editor.overlayManager.lineOverlay.isNewlyCreatedLine=true;node.setX(stageCoord.x);node.setY(stageCoord.y);node.update();this.__editor.overlayManager.lineOverlay.redraw()}else{if(node.getRotation()===0){this.__editor.overlayManager.overlay.setTrans(stageCoord.x,stageCoord.y,true)}else{nodeBB=node.worldAabb.clone();this.__editor.overlayManager.overlay.setTrans(stageCoord.x+(node.getX()-nodeBB.min.x),stageCoord.y+(node.getY()-nodeBB.min.y),true)}this.__editor.overlayManager.overlay.hideControls();GliffyApp.hudController.show(GliffyApp.hudController.HUD_MODE.pos)}},bindEventsToShapes:function(shapeClassBase){$("."+shapeClassBase).bind("click.gliffy-tooltip-swap",function(){var $this=$(this),originalTitle=$this.attr("data-original-title");$this.attr("data-original-title",$.i18n._("SHAPELIBRARY_DRAG_STAGE",[originalTitle]));$this.tooltip("show");$this.attr("data-original-title",originalTitle)}).tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_SHAPE_LIBRARY)},cacheLibraries:function(){var self=this;if(this.__gliffyStandardLibraryCache===null){_gliffy.shapeLibrary.loadLibraries("").done(function(data){self.__gliffyStandardLibraryCache=data;self.setupShapeLibrary()})}},selectSublibrary:function(subLibId,dropdown){var i,subLibraryCount=$(dropdown).find("li").length;for(i=0;i<subLibraryCount;i++){$("#"+$(dropdown).find("li a").get(i).getAttribute("data-gliffy-value")).hide()}$("#"+subLibId).show();this.buildShapesForLibrary($("#"+subLibId))},getShapesByUIDFromLibraryCache:function(uid){var i,j,shapeSet,shapes;for(i=0;i<this.__gliffyStandardLibraryCache[0].shapeSets.length;i++){shapeSet=this.__gliffyStandardLibraryCache[0].shapeSets[i];if(shapeSet.uid===uid){shapes=shapeSet.shapes}}return shapes},fixImageButtons:function(){if(this.__editor.language&&this.__editor.language.indexOf("ru")===0){$("#gliffy-image-browser-button-addImages").css("width","141px");$("#gliffy-image-browser-button-refresh").css("width","141px")}}})}());(function(){GliffyApp.ColorpickerController=Ember.Object.extend({__currentButtonDomElement:null,__editor:null,__propertiesController:null,__colorPickerMemory:null,__colorPickerMemoryIndex:0,init:function(){var self=this;this.__colorPickerMemory=[]},handleSwatchClick:function(e){var hex,colorData;hex=(new _gliffy.RGBColor($(e.currentTarget).css("background-color"))).toHex();colorData=$(e.currentTarget).data("gliffy-color");_gliffy.Utils.analyticsEvent("trackEvent",{category:"colorpickerClick",action:colorData});if($(e.currentTarget).parent().hasClass("gliffy-custom-swatches")){_gliffy.Utils.analyticsEvent("trackEvent",{category:"colorpickerClick",action:"customSwatch"})}if(colorData){if(colorData!=="none"){this.__propertiesController.handleColorpickerColorChange(hex,this.getColorpickerMode(this.__currentButtonDomElement));this.addToColorMemory(hex)}else{this.__propertiesController.handleColorpickerColorChange("none",this.getColorpickerMode(this.__currentButtonDomElement))}this.setSelectedSwatchColor(hex);if(this.__currentButtonDomElement.id!=="gliffy-edit-text_gliffyforecolor"){this.__currentButtonDomElement.click()}}},handleCustomButtonClick:function(e){_gliffy.Utils.analyticsEvent("trackEvent",{category:"colorpickerClick",action:"custom"});this.toggleColorpicker(this.__currentButtonDomElement,this.__propertiesController)},getColorPickerPosition:function(domElementId){var xoff=-205,yoff=-62,stageOffsetX=_gliffy.Mouse.getStageOffset().left,stageOffsetY=$(".navbar-fixed-top").height(),picker=$("#gliffy-colorpicker"),cx=$("#"+domElementId).offset().left+xoff,cy=$("#"+domElementId).offset().top+yoff,cw=picker.ColorPickerGetWidth(),ch=picker.ColorPickerGetHeight();return this.__getAdjustedPosition(cx,cy,cw,ch,stageOffsetX,stageOffsetY,domElementId)},getColorSwatchPosition:function(domElementId){var xoff=-3,yoff=-34,stageOffsetX=_gliffy.Mouse.getStageOffset().left,stageOffsetY=$(".navbar-fixed-top").height(),picker=$(".gliffy-colorswatchpicker"),cx=$("#"+domElementId).offset().left-_gliffy.Mouse.getContainerOffset().left+xoff,cy=$("#"+domElementId).offset().top+yoff,cw=picker.width(),ch=picker.height();return this.__getAdjustedPosition(cx,cy,cw,ch,stageOffsetX,stageOffsetY,domElementId)},__getAdjustedPosition:function(cx,cy,cw,ch,stageOffsetX,stageOffsetY,domElementId){if((cx+cw+stageOffsetX)>$(window).width()){cx-=(cx+cw+stageOffsetX)-$(window).width()}if((cy+ch+stageOffsetY)>$(window).height()){cy=cy-$("#"+domElementId).height()-ch-8}return{x:cx,y:cy}},toggleColorSwatchPicker:function(domElement,propertiesController){var coords,domId=domElement.getAttribute("id"),swatchPicker=$(".gliffy-colorswatchpicker"),picker=$("#gliffy-colorpicker");this.__propertiesController=propertiesController;this.__currentButtonDomElement=domElement;propertiesController.resetDialogControls(domId);if(domElement.getAttribute("class").indexOf("active")===-1){this.hideColorpicker()}else{picker.ColorPickerHide();domId=domElement.getAttribute("id");swatchPicker.show();coords=this.getColorSwatchPosition(domId);swatchPicker.css("left",coords.x+212);swatchPicker.css("top",coords.y+62);this.showColorMemory();this.setSelectedSwatchColor(this.__propertiesController.getTargetColor(domElement));this.showNoFill(domElement)}},showNoFill:function(domElement){var i,targets,hideNoFill=false,mode=this.getColorpickerMode(domElement);$(".gliffy-colorswatchpicker .gliffy-nofill").hide();if(mode==="fill"||mode==="linefill"){targets=this.__propertiesController.getTargetNodes();for(i=0;i<targets.length;i++){if(targets[i].getShapeInformation().hideNoFill){hideNoFill=true}}if(!hideNoFill){$(".gliffy-colorswatchpicker .gliffy-nofill").show()}}},hideColorpicker:function(){if(this.__propertiesController){this.__propertiesController.resetDialogControls(null)}$("#gliffy-colorpicker").ColorPickerHide();$(".gliffy-colorswatchpicker").hide()},toggleColorpicker:function(domElement,propertiesController){var domId=domElement.getAttribute("id"),picker=$("#gliffy-colorpicker"),swatchPicker=$(".gliffy-colorswatchpicker");this.__propertiesController=propertiesController;this.__currentButtonDomElement=domElement;if(domElement.getAttribute("class").indexOf("active")===-1){this.hideColorpicker()}else{this.__propertiesController.resetDialogControls(domId);picker.ColorPickerSetColor(this.__propertiesController.getTargetColor(domElement),this.getColorpickerMode(domElement));swatchPicker.hide();picker.find(".btn.swatches-button").text($.i18n._("COLORSWATCHPICKER_SWATCHES"));picker.find(".btn.ok-button").text($.i18n._("COLORSWATCHPICKER_OK"));picker.find(".btn.cancel-button").text($.i18n._("COLORSWATCHPICKER_CANCEL"));picker.show();picker.ColorPickerShow();domId=domElement.getAttribute("id");picker.ColorPickerPosition(this.getColorPickerPosition(domId));picker.ColorPickerSetCallback(this.__propertiesController.handleColorpickerColorChange)}},handleSwatchesButtonClick:function(e){var self=GliffyApp.colorpickerController;self.toggleColorSwatchPicker(self.__currentButtonDomElement,self.__propertiesController)},getColorpickerMode:function(domElement){var domId=domElement.getAttribute("id");switch(domId){case"gliffy-contextual-properties-fill-button":return"fill";case"gliffy-contextual-properties-bordercolor-button":return"border";case"gliffy-contextual-properties-linecolor-button":return"line";case"gliffy-contextual-properties-linefillcolor-button":return"linefill";case"gliffy-edit-text_gliffyforecolor":case"gliffy-contextual-properties-textcolor-button":return"text";case"gliffy-document-properties-pagecolor-button":return"page";default:return"fill"}},setSelectedSwatchColor:function(c){if(c){c=c.toUpperCase();$(".gliffy-colorswatchpicker .swatch").each(function(){if($(this).data("gliffy-color")===c){$(this).addClass("selected")}else{$(this).removeClass("selected")}})}},addToColorMemory:function(c){if($.inArray(c,this.__colorPickerMemory)===-1){this.__colorPickerMemory[this.__colorPickerMemoryIndex]=c;this.__colorPickerMemoryIndex++}},showColorMemory:function(){var self=this,index=0,total=this.__colorPickerMemory.length;if(total>10){index=total-10}$(".gliffy-custom-swatches .swatch").each(function(){if(self.__colorPickerMemory[index]){$(this).css("background-color",self.__colorPickerMemory[index]);$(this).data("gliffy-color",self.__colorPickerMemory[index]);$(this).removeClass("nohover")}index++})}})}());(function(){GliffyApp.ContextMenuController=Ember.Object.extend({__editor:null,init:function(){var self=this;$("#container").bind("scroll",function(){self.clearAll()})},clearAll:function(){if(this.__editor.clearContextMenu()||this.__editor.overlayManager.overlay.clearContextMenu()||this.__editor.overlayManager.lineOverlay.clearContextMenu()){$(".context-menu-shadow").hide()}},createContextMenu:function(object,domElement,definition,className){if(!_gliffy.Debug.NO_CONTEXT_MENU){var self=this;domElement.contextMenu(definition,{theme:_gliffy.Editor.CONTEXT_MENU_STYLE,shadow:false,className:className,beforeShow:function(){$("#gliffy-edit-text").trigger("customblur.gliffy-edit-text");self.clearAll();_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextMenu",action:"show"});object.beforeContextMenuShow(this.menu);object.__contextMenu=this.menu}})}},clearContextMenu:function(menu){if(menu&&menu.is(":visible")){menu.hide();return true}return false}})}());(function(){GliffyApp.TipsController=Ember.Object.extend({__editor:null,__tips:[],__currentTip:1,__closeCallback:null,init:function(){},__update:function(){if(this.__tips.length>0){$("#gliffy-tips-link-previous-tip").toggle(this.__currentTip>1);$("#gliffy-tips-link-next-tip").toggle(this.__currentTip<this.__tips.length);$(".gliffy-tips-graphic").css("background-image","url("+this.__tips[this.__currentTip-1].image+")");$(".gliffy-tips-content h1").html(this.__currentTip+". "+$.i18n._(this.__tips[this.__currentTip-1].title));$(".gliffy-tips-content p").html($.i18n._(this.__tips[this.__currentTip-1].content));$(".gliffy-tips-number").html($.i18n._("TIPS_TIP_NUM",[this.__currentTip,this.__tips.length]))}},close:function(ignoreCloseCallback){$("#gliffy-tips").hide();_gliffy.KeyManager.setState("stage");if(!ignoreCloseCallback&&this.__closeCallback!==null){this.__closeCallback()}},openOnInit:function(){if(!this.doNotShowTips()){this.open()}},open:function(closeCallback){if(closeCallback){this.__closeCallback=closeCallback}else{this.__closeCallback=null}if(this.__tips.length>0){_gliffy.toolbarController.doDeselectAll();_gliffy.KeyManager.handleEscKeypress();_gliffy.KeyManager.setState("modals");$("#gliffy-tips").show();$("#gliffy-tips-checkbox-no-tips").attr("checked",(this.doNotShowTips()))}},doNotShowTips:function(){var cookie=$.cookie("doNotShowTips");return _gliffy.Debug.NO_TIPS||cookie==="true"},showTip:function(tipNum){this.__currentTip=tipNum;this.__update()}})}());(function(){GliffyApp.PageNavigatorController=Ember.Object.extend({__editor:null,__positionX:-10000,__positionY:-10000,init:function(){var self=this;$(".gliffy-page-navigator-dragarea").bind("drag",function(event,dd){self.handleDrag(event,dd)});$("#gliffy-navigator-dialog .close").click(function(){$(".gliffy-tool-navigator").parent().removeClass("active");self.hide()});$(".gliffy-navigator-zoomIn").click(function(){$("#gliffy-edit-text").trigger("customblur.gliffy-edit-text");self.__editor.overlayManager.deselectAll();self.__editor.zoomOverlay.keyboardZoom(true)});$(".gliffy-navigator-zoomOut").click(function(){$("#gliffy-edit-text").trigger("customblur.gliffy-edit-text");self.__editor.overlayManager.deselectAll();self.__editor.zoomOverlay.keyboardZoom(false)});self.hide()},show:function(){$("#gliffy-navigator-dialog").show();if(this.__positionX===-10000){this.__positionX=$(window).width()-$("#gliffy-navigator-dialog").width()-25;this.__positionY=100}$("#gliffy-navigator-dialog").css({left:this.__positionX+"px",top:this.__positionY+"px"})},hide:function(){$("#gliffy-navigator-dialog").hide()},handleDrag:function(event,dd){var dialog=$("#gliffy-navigator-dialog"),newX=dd.offsetX,newY=dd.offsetY,dialogWidth=dialog.width(),dialogHeight=dialog.height(),windowWidth=$(window).width(),windowHeight=$(window).height();if(dd.offsetX<0){newX=0}else{if(dd.offsetX>(windowWidth-dialogWidth)){newX=windowWidth-dialogWidth}}if(dd.offsetY<90){newY=90}else{if(dd.offsetY>(windowHeight-dialogHeight-15)){newY=(windowHeight-dialogHeight-15)}}dialog.css({left:newX+"px",top:newY+"px"});this.__positionX=newX;this.__positionY=newY}})}());(function(){GliffyApp.ImageBrowserController=Ember.Object.extend({__editor:null,__numPages:1,__currentPage:1,__totalImages:0,init:function(){var self=this;setTimeout(function(){$("#gliffy-image-browser-button-previous").tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy-image-browser-button-next").tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD);self.__editor.performAction("configureImagesControls")},1);$("#gliffy-image-browser-button-previous").click(function(e){self.handlePreviousClick()}).tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy-image-browser-button-next").click(function(e){self.handleNextClick()}).tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy-image-browser-button-refresh").click(function(e){e.preventDefault();$("#gliffy-shape-library-images-container").empty();self.buildImageShapes($("#gliffy-shape-library-com-gliffy-library-images"))});this.__editor.performAction("configureImagesControls")},updateCounter:function(){var rows,height,num1,num2;if(this.__totalImages<16){rows=Math.ceil(this.__totalImages/3);$("#gliffy-shape-library-com-gliffy-library-images .gliffy-image-browser-pagination").hide();height=61*rows;$("#gliffy-shape-library-images-container").height(height)}else{$("#gliffy-shape-library-com-gliffy-library-images .gliffy-image-browser-pagination").show();$("#gliffy-shape-library-images-container").height(304)}this.updateTotalImagesDisplay();if(this.__currentPage===1){$("#gliffy-image-browser-button-previous").addClass("disabled")}else{$("#gliffy-image-browser-button-previous").removeClass("disabled")}if(this.__currentPage===this.__numPages){$("#gliffy-image-browser-button-next").addClass("disabled")}else{$("#gliffy-image-browser-button-next").removeClass("disabled")}},updateTotalImagesDisplay:function(){var num1=(this.__currentPage*15)-15+1,num2=num1+14;$(".gliffy-image-browser-counter").html(num1+" - "+num2+" of "+this.__totalImages)},buildImageShapes:function(subLibraryDiv){var self=this;this.__editor.performAction("imageList",this.__editor.imageContext,function(data){self.buildImageShapesFromData(data);self.bindDragEvents(subLibraryDiv)},function(xhr,text,error){})},buildImageShapesFromData:function(data){var i,o,imageElement,bgX=0,bgY=0,iconColumns=3,imagePageDiv,pageNum;this.__numPages=1;this.__currentPage=1;this.__totalImages=0;$("#gliffy-shape-library-images-container").append("<div id='gliffy-shape-library-imageBrowser-page1'></div>");imagePageDiv=$("#gliffy-shape-library-imageBrowser-page1");for(i=0;i<data.length;i++){this.__totalImages++;if(i>0&&(i%15===0)){this.__numPages++;imagePageDiv=$("<div id='gliffy-shape-library-imageBrowser-page"+this.__numPages+"'></div>");$("#gliffy-shape-library-images-container").append(imagePageDiv);imagePageDiv.hide()}o=$.extend({uid:"com.gliffy.shape.basic.basic_v1.default.image",tid:"com.gliffy.stencil.image"},data[i]);imageElement=this._buildImageElementFromObject(o);imagePageDiv.append(imageElement);bgX=bgX-50;if((i-(iconColumns-1))%iconColumns===0){bgX=0;bgY=bgY-50}}this.updateCounter()},_buildImageElementFromObject:function(o){var imageElement=$('<div class="gliffy-shape-library-com-gliffy-shape-image"><img src="'+o.thumbnail+'"/></div>');imageElement.data("params",o);return imageElement},bindDragEvents:function(subLibraryDiv){_gliffy.shapeLibrary.loadShapes(["com.gliffy.shape.basic.basic_v1.default.image"],null,this.__editor.language).done(function(){$(subLibraryDiv).css("opacity","1")})},handlePreviousClick:function(){if(!$("#gliffy-image-browser-button-previous").hasClass("disabled")){$("#gliffy-shape-library-imageBrowser-page"+this.__currentPage).hide();this.__currentPage--;$("#gliffy-shape-library-imageBrowser-page"+this.__currentPage).show();this.updateCounter()}},handleNextClick:function(){if(!$("#gliffy-image-browser-button-next").hasClass("disabled")){$("#gliffy-shape-library-imageBrowser-page"+this.__currentPage).hide();this.__currentPage++;$("#gliffy-shape-library-imageBrowser-page"+this.__currentPage).show();this.updateCounter()}}})}());(function(){GliffyApp.ProgressBarController=Ember.Object.extend({title:null,init:function(){},show:function(title){if(!title){title=""}this.set("title",title);$("#gliffyProgressBar .progress .bar").width(0);$("#gliffyProgressBar button").attr("disabled","disabled");$("#gliffyProgressBar").modal({backdrop:false})},hide:function(){$("#gliffyProgressBar").modal("hide")},getBar:function(){return $("#gliffyProgressBar .progress .bar")},updateProgress:function(currentSize,totalSize){this.getBar().width(Math.floor((currentSize/totalSize)*100)+"%")}})}());(function(){GliffyApp.SaveDialogController=Ember.Object.extend({__editor:null,init:function(){},getModal:function(){return $("#saveDialog")},show:function(){this.getModal().modal("show");var filenameElement=this.getFilenameElement();filenameElement.parents("div.control-group").removeClass("error").find("span.help-inline").text("");filenameElement.val("").focus();$(".gliffy-save-dialog-error").hide();return this.getModal()},hide:function(){this.getModal().modal("hide")},applySave:function(){this.__editor.__doSave()},cancelSave:function(){this.__editor.postSaveCallback=null},getFilenameElement:function(){return this.getModal().find(".gliffy-save-filename")},getFilename:function(){return this.getFilenameElement().val()},showErrorMessage:function(msg){$(".gliffy-save-dialog-error").find("p").html(msg);$(".gliffy-save-dialog-error").show()}})}());(function(){GLIFFY.DocumentBrowserController=_gliffy.Class.extend({__editor:null,__container:null,__selectedDocumentUrl:null,__selectedCategoryItem:null,__selectedDocumentItem:null,init:function(o){var self=this;this.__editor=o.editor;this.__container=o.container},show:function(){$("#gliffy-modal-document-browser").modal("show")},showAction:function(){var self=this;$("#gliffy-document-browser-spaces-container").empty();self.__editor.performAction("documentContainerList",null,function(containerList){var i,container;for(i=0;i<containerList.length;i++){container=$('<li class=><span class="gliffy-icon-documentBrowser-confluence"></span><a href="#">'+containerList[i].name+"</a></li>");container.data("url",containerList[i].url);$("#gliffy-document-browser-spaces-container").append(container);if(i===0){self.categorySelect(container)}}$("#gliffy-document-browser-spaces-container").parent().scrollTop(0)},function(xhr,text,error){$("#gliffy-modal-document-browser").modal("hide");if(xhr.status===404){_gliffy.handleError("com.gliffy.error.operation_failed",[text],error,self.errorTarget)}else{_gliffy.handleError("com.gliffy.error.operation_malformed",[text],error,self.errorTarget)}});$("#gliffy-document-browser-spaces-container").delegate("li","click",function(e){e.preventDefault();self.categorySelect($(e.currentTarget))});$("#gliffy-document-browser-diagrams-table").delegate("tr","click",function(e){e.preventDefault();self.documentSelect($(e.currentTarget))});$("#gliffy-document-browser-diagrams-table").delegate("tr","dblclick",function(e){self.open(self.__selectedDocumentItem)})},hideAction:function(){var self=this;$("#gliffy-document-browser-spaces-container").undelegate("li","click");$("#gliffy-document-browser-diagrams-table").undelegate("tr","click");$("#gliffy-document-browser-diagrams-table").undelegate("tr","dblclick")},openAction:function(){var self=this;self.open(self.__selectedDocumentItem)},render:function(documentListUrl){var self=this;self.__editor.performAction("documentList",documentListUrl,function(documentList){var i,documentNode;$("#gliffy-document-browser-diagrams-table").empty();for(i=0;i<documentList.length;i++){documentNode=$('<tr><td class="gliffy-name"><a href="#">'+documentList[i].name+'</a></td><td class="gliffy-date">'+documentList[i].lastModified+"</td></tr>");documentNode.data("url",documentList[i].url);documentNode.data("image",documentList[i].image);$("#gliffy-document-browser-diagrams-table").append(documentNode);if(i===0){self.documentSelect(documentNode)}}$("#gliffy-document-browser-diagrams-table").parent().scrollTop(0)},function(xhr,text,error){$("#gliffy-modal-document-browser").modal("hide");if(xhr.status===404){_gliffy.handleError("com.gliffy.error.operation_failed",[text],error,self.errorTarget)}else{_gliffy.handleError("com.gliffy.error.operation_malformed",[text],error,self.errorTarget)}})},clearPreviewImage:function(){$(".gliffy-document-browser-preview div").empty()},categorySelect:function(categoryItem){this.clearPreviewImage();if(this.__selectedCategoryItem!==null){this.__selectedCategoryItem.removeClass("gliffy-selected")}categoryItem.addClass("gliffy-selected");this.__selectedCategoryItem=categoryItem;this.render(categoryItem.data("url"))},documentSelect:function(documentItem){if(this.__selectedDocumentItem!==null){this.__selectedDocumentItem.removeClass("gliffy-selected")}documentItem.addClass("gliffy-selected");this.__selectedDocumentItem=documentItem;$(".gliffy-document-browser-preview div").html('<img src="'+documentItem.data("image")+'" class="gliffy-document-preview-image" />')},open:function(documentItem){var activeDocument,i,doc,openUrl=documentItem.data("url");if(openUrl.indexOf(".json")>1){openUrl=openUrl.substring(0,openUrl.indexOf(".json"))}for(i=0;i<this.__editor.getDocumentManager().getDocuments().length;i++){doc=this.__editor.getDocumentManager().getDocuments()[i];if(doc.__urls.open===openUrl){activeDocument=doc;break}}if(activeDocument){GliffyApp.documentTabsController.selectTab(activeDocument);$("#gliffy-modal-document-browser").modal("hide")}else{GliffyApp.documentTabsController.selectTab(new _gliffy.Document());this.__editor.open({url:documentItem.data("url"),scale:1,callback:this.__stageRenderCallback()})}},__stageRenderCallback:function(){$(window).trigger("gliffy-render-complete");$("#gliffy-modal-document-browser").modal("hide")}})}());(function(){GLIFFY.UpdateSplashController=_gliffy.Class.extend({options:null,_editor:null,_toLink:"",standardUser:{isAdmin:false,productInfo:"<ul>   <li>new stuff 1</li>   <li>new stuff 2</li>   <li>new stuff 3</li></ul>",productVersion:"5.1.1",admins:[{name:"Joe Admin",email:"roccob@gliffy.com"}],name:"Jane User",email:"jane@user.com",subject:"upgrade now!",body:"Your copy of Gliffy is not up to date.",emailServer:null,installerURL:"http://rocco-macbookpro-3.local:1990/confluence/plugins/servlet/upm#manage/com.gliffy.integration.confluence"},standardAdmin:{isAdmin:true,productInfo:"<ul>   <li>new stuff 1</li>   <li>new stuff 2</li>   <li>new stuff 3</li></ul>",productVersion:"5.1.1",admins:[{name:"",email:"roccob@gliffy.com"}],name:"Joe Admin",email:"joe@admin.com",subject:"upgrade now!",body:"Your copy of Gliffy is not up to date.",emailServer:null,installerURL:"http://rocco-macbookpro-3.local:1990/confluence/plugins/servlet/upm#manage/com.gliffy.integration.confluence"},init:function(o){if(o.editor){this._editor=o.editor}},openOnInit:function(o){var options=$.extend(true,this.standardUser,o),currentCookie,cookieArray,i,shouldShow=true;this.options=options;currentCookie=$.cookie("doNotShowUpdateSplash")||"[]";cookieArray=JSON.parse(currentCookie);for(i=0;i<cookieArray.length;i++){if(cookieArray[i]===options.productVersion){shouldShow=false}}if(shouldShow){this.setMode("splash");this.show()}return shouldShow},setMode:function(mode){var options=this.options,to,comma,i;$(".gliffy-update-splash-mode-splash").css("display",mode==="splash"?"":"none");$(".gliffy-update-splash-mode-email").css("display",mode==="email"?"":"none");$(".gliffy-update-splash-button-back").css("display",mode==="email"?"":"none");$(".gliffy-update-splash-mode-thanks").css("display",mode==="thanks"?"":"none");$(".gliffy-update-splash-button-contact").css("display",mode==="splash"&&!options.isAdmin?"":"none");$(".gliffy-update-splash-button-install").css("display",mode==="splash"&&options.isAdmin?"":"none");$(".gliffy-update-splash-admin-div").css("display",mode==="splash"&&!options.isAdmin?"":"none");$(".gliffy-update-splash-install-div").css("display",mode==="splash"&&options.isAdmin?"":"none");$(".gliffy-update-splash-install-link").attr("href",options.installerURL);$(".gliffy-update-splash-button-email").css("display",mode==="email"?"":"none");if(mode==="splash"){$(".gliffy-update-splash-product-info").html(options.productInfo)}if(mode==="email"){to="";comma="";this._toLink="";for(i=0;i<options.admins.length;i++){comma=(i<options.admins.length-1?", ":"");to+=options.admins[i].name+"<"+options.admins[i].email+"> "+comma;this._toLink+=options.admins[i].email+comma}$(".gliffy-update-splash-to").text(to);$(".gliffy-update-splash-input-subject").attr("value",options.subject);$(".gliffy-update-splash-input-body").attr("value",options.body);this.updateMailToLink()}},updateMailToLink:function(){var subject=encodeURIComponent($(".gliffy-update-splash-input-subject").val()),body=encodeURIComponent($(".gliffy-update-splash-input-body").val()),mailtoLink="mailto:"+this._toLink+"?subject="+subject+"&body="+body;$(".gliffy-update-splash-button-email").attr("href",mailtoLink)},goToInstaller:function(){window.open(this.options.installerURL,"_blank","")},show:function(){$("#gliffy-modal-update-splash").modal("show")},showAction:function(){_gliffy.KeyManager.setState("input")},hideAction:function(){var options=this.options,currentCookie,cookieArray;if($("#gliffy-update-splash-nomore").is(":checked")){currentCookie=$.cookie("doNotShowUpdateSplash")||"[]";cookieArray=JSON.parse(currentCookie);cookieArray.push(this.options.productVersion);$.cookie("doNotShowUpdateSplash",JSON.stringify(cookieArray),{expires:365})}_gliffy.KeyManager.setLastState()},seti18nFont:function(){if(this._editor.language===null||this._editor.language.substring(0,2)!=="en"){$(".gliffy-update-splash-title").css("font-family","sans-serif")}}})}());(function(){GLIFFY.FeedbackController=_gliffy.Class.extend({_feedbackURL:"",init:function(o){},setMode:function(mode){$(".gliffy-feedback-try-again").css("display","none");switch(mode){case"rate":$(".gliffy-feedback-submit").css("display","");$(".gliffy-rate-container").css("display","");$(".gliffy-thanks-container").css("display","none");$(".gliffy-feedback-error-container").css("display","none");$(".gliffy-feedback-rate").addClass("active");break;case"thanks":$(".gliffy-feedback-submit").css("display","none");$(".gliffy-rate-container").css("display","none");$(".gliffy-feedback-error-container").css("display","none");$(".gliffy-thanks-container").css("display","");$(".gliffy-feedback-rate").removeClass("active");break;case"error":$(".gliffy-feedback-submit").css("display","none");$(".gliffy-rate-container").css("display","none");$(".gliffy-feedback-rate").addClass("active");$(".gliffy-feedback-error-container").css("display","");$(".gliffy-thanks-container").css("display","none");$(".gliffy-feedback-rate").removeClass("active");break;case"none":$(".gliffy-feedback-submit").css("display","none");$(".gliffy-rate-container").css("display","none");$(".gliffy-thanks-container").css("display","none");$(".gliffy-feedback-error-container").css("display","none");$(".gliffy-feedback-rate").removeClass("active");break;default:_gliffy.Logger.warn("Unsupported feedback mode.")}},submitFeedback:function(){var params=null,self=this;if($(".gliffy-feedback-email-input").val()===""){$(".gliffy-feedback-try-again").css("display","")}else{params={fullname:$(".gliffy-feedback [name='fullname']").val()||"",email:$(".gliffy-feedback [name='email']").val()||"",feedback:$(".gliffy-feedback [name='feedback']").val()||"",performanceRating:$(".gliffy-feedback input:radio[name=performance]:checked").val()||"",designRating:$(".gliffy-feedback input:radio[name=design]:checked").val()||"",product:"Confluence"+(_gliffy.confluenceVersion||"")+"-Gliffy"+(_gliffy.versionString||"")};$.ajax({type:"POST",url:self._feedbackURL,data:JSON.stringify(params),dataType:"json",contentType:"application/json; charset=utf-8",success:function(){self.setMode("thanks")},error:function(e){self.setMode("error")}})}},show:function(feedbackURL){this._feedbackURL=feedbackURL||"";$("#gliffy-modal-feedback").modal("show")},showAction:function(){this.setMode("none");_gliffy.KeyManager.setState("input")},hideAction:function(){this.setMode("none");_gliffy.KeyManager.setLastState()},openAction:function(){}})}());(function(){GliffyApp.ThemeController=GliffyApp.AbstractPropertiesController.extend({_firstOpen:true,_onShow:null,init:function(){var self=this;$(window).resize(function(){var dialog=$("#gliffy-theme-dialog");var left=parseInt(dialog.css("left").toLowerCase().replace("px",""),10);if(left>$(window).width()){dialog.css({left:($(window).width())+"px",top:$(".gliffy-html5-container").offset().top+"px"})}})},setOnShow:function(onShow){var self=this;self._onShow=onShow;setInterval(function(){if(self._onShow){self._onShow()}},1000)},performOnShow:function(){if(this._onShow){this._onShow()}},showDialog:function(){var dialog=$("#gliffy-theme-dialog"),left;left=parseInt(dialog.css("left").toLowerCase().replace("px",""),10);if(this._firstOpen||left>$(window).width()){dialog.css({left:($(window).width())+"px",top:$(".gliffy-html5-container").offset().top+"px"})}this._firstOpen=false;if(this._onShow){this._onShow()}dialog.show()},hideDialog:function(){$("#gliffy-theme-dialog").hide();_gliffy.toolbarController.toggleThemesButton(false)},handleDrag:function(event,dd){var dialog=$("#gliffy-theme-dialog"),newX=dd.offsetX+200,newY=dd.offsetY,dialogWidth=dialog.width(),dialogHeight=dialog.height(),windowWidth=$(window).width(),windowHeight=$(window).height();if(dd.offsetX<0){newX=200}else{if(dd.offsetX>(windowWidth-dialogWidth)){newX=windowWidth-dialogWidth+200}}if(dd.offsetY<90){newY=90}else{if(dd.offsetY>(windowHeight-dialogHeight-15)){newY=(windowHeight-dialogHeight-15)}}dialog.css({left:newX+"px",top:newY+"px"})},handleDragStart:function(event){}})}());(function(){var _load=[];GliffyApp.GlobalView=Ember.View.create({showUnstable:false,supported:false,init:function(){var metaDom=$("meta[name=gliffy-show-unstable]");if(metaDom.length>0){this.showUnstable=metaDom.attr("content")==="true"}metaDom=$("meta[name=gliffy-supported]");if(metaDom.length>0){this.supported=metaDom.attr("content")==="true"}},didInsertElement:function(){var i;for(i=0;i<_load.length;i++){_load[i]()}},appendTemplate:function(templateName,parent){parent=parent||"#gliffy";var render=function(){Ember.View.create({templateName:templateName}).appendTo(parent)};_load.push(render);if($(parent).length>0){render()}},renderTemplate:function(templateName,container){var render=function(){$(container).html("");Ember.View.create({templateName:templateName}).appendTo($(container))};_load.push(render);if($(container).length>0){render()}}})}());(function(){GliffyApp.AbstractInputModalView=Ember.View.extend({didInsertElement:function(e){var self=this;$(".gliffy-input-modal").on("hide",function(e){$(".gliffy-input-modal-error").hide()});$(".gliffy-input-modal").on("show",function(e){self.doOnShow()});$(".gliffy-input-modal").on("shown",function(e){self.doOnShown()});$(".gliffy-input-modal-input").focus(function(){setTimeout(function(){if(window.GLIFFY.KeyManager){window.GLIFFY.KeyManager.setState("input")}},100)});$(".gliffy-input-modal-input").blur(function(){if(window.GLIFFY.KeyManager){window.GLIFFY.KeyManager.setState("modals")}})},doOnShow:function(){$(".gliffy-input-modal-input").val("")},doOnShown:function(){$(".gliffy-input-modal-input").focus()},handleSubmit:function(e){$(".gliffy-input-modal-error").hide()},handleInputKeyDown:function(e){if(e.keyCode===13){e.preventDefault();this.handleSubmit(e)}},displayErrorMessage:function(errorMsg){$(".gliffy-input-modal-error").show();$(".gliffy-input-modal-error p").html(errorMsg)}})}());(function(){GliffyApp.AbstractPropertiesTextField=Ember.TextField.extend({keyDown:function(e){if(e.keyCode===13||e.keyCode===9){this.handleEnterOrTabKey(e.keyCode);if(e.keyCode===13){e.preventDefault()}}},focusOut:function(e){if($(e.currentTarget).is(":visible")){this.__commit(this.propertyKey,this.value)}else{this.__rollback()}},__commit:function(){throw ("You need to override __commit() for GliffyApp.AbstractPropertiesTextField")},__rollback:function(){throw ("You need to override __rollback() for GliffyApp.AbstractPropertiesTextField")}})}());(function(){GliffyApp.DocumentPropertiesView=Ember.View.extend({titleBinding:Ember.Binding.oneWay("GliffyApp.documentModel.title"),versionBinding:Ember.Binding.oneWay("GliffyApp.documentModel.currentRevision"),gridVisibleBinding:Ember.Binding.oneWay("GliffyApp.documentModel.gridVisible"),clickGridCheckbox:function(e){GliffyApp.documentPropertiesController.resetDialogControls();GliffyApp.documentPropertiesController.updateProperty("GridVisible",$("#gliffy-document-properties-checkbox-grid").prop("checked"))},pageBreaksVisibleBinding:Ember.Binding.oneWay("GliffyApp.documentModel.pageBreaksVisible"),clickPageBreaksCheckbox:function(e){GliffyApp.documentPropertiesController.resetDialogControls();GliffyApp.documentPropertiesController.updateProperty("PageBreaksVisible",$("#gliffy-document-properties-checkbox-pagebreaks").prop("checked"))},showExportBorderBinding:Ember.Binding.oneWay("GliffyApp.documentModel.exportBorder"),clickExportBorderCheckbox:function(e){GliffyApp.documentPropertiesController.resetDialogControls();GliffyApp.documentPropertiesController.updateProperty("ExportBorder",$("#gliffy-document-properties-checkbox-exportborder").prop("checked"))},snapToGridBinding:Ember.Binding.oneWay("GliffyApp.documentModel.snapToGrid"),clickSnapCheckbox:function(e){GliffyApp.documentPropertiesController.resetDialogControls();GliffyApp.documentPropertiesController.updateProperty("SnapToGrid",$("#gliffy-document-properties-checkbox-snap").prop("checked"))},clickColorButton:function(e){GliffyApp.colorpickerController.toggleColorSwatchPicker(e.currentTarget,GliffyApp.documentPropertiesController);e.preventDefault()},didInsertElement:function(){var diffx,diffy;$("#gliffy-document-properties-dialog-close-btn").tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy-document-properties-pagecolor-button").tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy-document-properties-dialog-close-btn").on("click",function(){GliffyApp.documentPropertiesController.hideDialog()});_gliffy.Mouse.registerClickState({name:"documentProperties",modes:["document-properties-drag"],target:".gliffy-document-properties-dragarea",mouseDown:function(event){_gliffy.Mouse.setClickMode("documentProperties");_gliffy.Mouse.setState("document-properties-drag");_gliffy.Mouse.__mousedown(event)}});_gliffy.Mouse.registerDragState([{modes:["document-properties-drag"],dragStart:function(event){var dialog=$("#gliffy-document-properties-dialog");GliffyApp.documentPropertiesController.resetDialogControls();diffx=event.pageX-dialog.offset().left;diffy=event.pageY-dialog.offset().top},drag:function(event){var dialog=$("#gliffy-document-properties-dialog"),newX=event.pageX,newY=event.pageY,dialogWidth=dialog.width(),dialogHeight=dialog.height(),windowWidth=$(window).width(),windowHeight=$(window).height();newX=newX-diffx+200;newY=newY-diffy;if(newX<200){newX=200}else{if(newX>(windowWidth-dialogWidth)){newX=windowWidth-dialogWidth+200}}if(newY<90){newY=90}else{if(newY>(windowHeight-dialogHeight-15)){newY=(windowHeight-dialogHeight-15)}}dialog.css({left:newX+"px",top:newY+"px"})},dragEnd:function(event){}}])}});GliffyApp.DocumentPropertiesTextField=GliffyApp.AbstractPropertiesTextField.extend({mouseDown:function(e){GliffyApp.documentPropertiesController.resetDialogControls()},__commit:function(prop,value){if(GliffyApp.documentPropertiesController.isValidPropertyValue(prop,value)){if(this.value!==this.oldValue){GliffyApp.documentPropertiesController.updateSizeProperty(prop,value)}}else{this.__rollback()}_gliffy.KeyManager.setState("stage")}});GliffyApp.DocumentPropertiesTextFieldWidth=GliffyApp.DocumentPropertiesTextField.extend({propertyKey:"MaxWidth",valueBinding:Ember.Binding.oneWay("GliffyApp.documentModel.maxWidth"),oldValueBinding:Ember.Binding.oneWay("GliffyApp.documentModel.maxWidth"),__rollback:function(){this.set("value",GliffyApp.documentModel.maxWidth)},handleEnterOrTabKey:function(keyCode){if(keyCode===13){$("#gliffy-document-properties-textfield-width").blur()}}});GliffyApp.DocumentPropertiesTextFieldHeight=GliffyApp.DocumentPropertiesTextField.extend({propertyKey:"MaxHeight",valueBinding:Ember.Binding.oneWay("GliffyApp.documentModel.maxHeight"),oldValueBinding:Ember.Binding.oneWay("GliffyApp.documentModel.maxHeight"),__rollback:function(){this.set("value",GliffyApp.documentModel.maxHeight)},handleEnterOrTabKey:function(keyCode){$("#gliffy-document-properties-textfield-height").blur()}})}());(function(){GliffyApp.ContextualPropertiesView=Ember.View.extend({clickColorButton:function(e){GliffyApp.colorpickerController.toggleColorSwatchPicker(e.currentTarget,GliffyApp.contextualPropertiesController);e.preventDefault()},alignLeft:function(e){GliffyApp.contextualPropertiesController.doAlign("left");_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextualProperties",action:"alignLeft"});e.preventDefault()},alignCenter:function(e){GliffyApp.contextualPropertiesController.doAlign("center");_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextualProperties",action:"alignCenter"});e.preventDefault()},alignRight:function(e){GliffyApp.contextualPropertiesController.doAlign("right");_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextualProperties",action:"alignRight"});e.preventDefault()},alignTop:function(e){GliffyApp.contextualPropertiesController.doAlign("top");_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextualProperties",action:"alignTop"});e.preventDefault()},alignMiddle:function(e){GliffyApp.contextualPropertiesController.doAlign("middle");_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextualProperties",action:"alignMiddle"});e.preventDefault()},alignBottom:function(e){GliffyApp.contextualPropertiesController.doAlign("bottom");_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextualProperties",action:"alignBottom"});e.preventDefault()},distributeHorizontal:function(e){GliffyApp.contextualPropertiesController.doDistribute("horizontal");_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextualProperties",action:"distributeHorizontal"});e.preventDefault()},distributeVertical:function(e){GliffyApp.contextualPropertiesController.doDistribute("vertical");_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextualProperties",action:"distributeVertical"});e.preventDefault()},selectBorderWidth:function(e){GliffyApp.contextualPropertiesController.updateShapeTabProperty("StrokeWidth",Number(e.currentTarget.getAttribute("data-gliffy-value")));_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextualProperties",action:"borderWidth",value:Number(e.currentTarget.getAttribute("data-gliffy-value"))});e.preventDefault();$("#gliffy-contextual-properties-border-width").click()},selectLaneNumber:function(e){GliffyApp.contextualPropertiesController.updateShapeTabProperty("Lanes",Number(e.currentTarget.getAttribute("data-gliffy-value")));_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextualProperties",action:"selectLane",value:Number(e.currentTarget.getAttribute("data-gliffy-value"))});e.preventDefault();$("#gliffy-contextual-properties-lanes").click()},selectArrowBegin:function(e){GliffyApp.contextualPropertiesController.updateLineTabProperty("StartArrow",Number(e.currentTarget.getAttribute("data-gliffy-value")));_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextualProperties",action:"startArrow",value:Number(e.currentTarget.getAttribute("data-gliffy-value"))});e.preventDefault();$("#gliffy-contextual-properties-arrowbegin").click()},selectArrowEnd:function(e){GliffyApp.contextualPropertiesController.updateLineTabProperty("EndArrow",Number(e.currentTarget.getAttribute("data-gliffy-value")));_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextualProperties",action:"endArrow",value:Number(e.currentTarget.getAttribute("data-gliffy-value"))});e.preventDefault();$("#gliffy-contextual-properties-arrowend").click()},selectLineWidth:function(e){GliffyApp.contextualPropertiesController.updateLineTabProperty("StrokeWidth",Number(e.currentTarget.getAttribute("data-gliffy-value")));_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextualProperties",action:"lineWidth",value:Number(e.currentTarget.getAttribute("data-gliffy-value"))});e.preventDefault();$("#gliffy-contextual-properties-line-width").click()},selectDashStyle:function(e){var val=e.currentTarget.getAttribute("data-gliffy-value");if(val==="null"){val=null}_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextualProperties",action:"dashStyle"});GliffyApp.contextualPropertiesController.updateLineTabProperty("DashStyle",val);if(val){_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextualProperties",action:"lineDashStyle",value:parseInt(val,10)})}e.preventDefault();$("#gliffy-contextual-properties-dash-style").click()},selectLineType:function(e){GliffyApp.contextualPropertiesController.updateLineTabProperty("LineType",e.currentTarget.getAttribute("data-gliffy-value"));_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextualProperties",action:"lineType"+e.currentTarget.getAttribute("data-gliffy-value")});e.preventDefault();$("#gliffy-contextual-properties-line-type").click()},clickDropdown:function(e){var domId=e.currentTarget.getAttribute("id"),dropdownContainer=$(e.currentTarget).parent(),dropdown=dropdownContainer.children("ul");GliffyApp.contextualPropertiesController.resetDialogControls(domId);if(this.__isDropdownBelowFold(dropdownContainer,dropdown)){dropdown.css("top",-(dropdown.height()+12))}else{dropdown.css("top","100%")}$(e.currentTarget).tooltip("hide");e.preventDefault()},__isDropdownBelowFold:function(dropdownContainer,dropdown){return(dropdownContainer.offset().top+dropdownContainer.height()+dropdown.height()>$(window).height())},fixedAspectBinding:Ember.Binding.oneWay("GliffyApp.overlayModel.fixedAspect"),clickAspectRatioCheckbox:function(e){GliffyApp.contextualPropertiesController.resetDialogControls();GliffyApp.contextualPropertiesController.updateShapeTabProperty("LockAspectRatio",$("#gliffy-contextual-properties-checkbox-fixedaspect").prop("checked"));_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextualProperties",action:$("#gliffy-contextual-properties-checkbox-fixedaspect").prop("checked")?"fixAspect":"unfixAspect"});_gliffy.KeyManager.setState("contextualProperties")},lockShapeBinding:Ember.Binding.oneWay("GliffyApp.overlayModel.lockShape"),clickLockShapeCheckbox:function(e){GliffyApp.contextualPropertiesController.resetDialogControls();GliffyApp.contextualPropertiesController.updateShapeTabProperty("LockPosition",$("#gliffy-contextual-properties-checkbox-lockshape").prop("checked"));_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextualProperties",action:$("#gliffy-contextual-properties-checkbox-lockshape").prop("checked")?"lockPosition":"unlockPosition"});_gliffy.KeyManager.setState("contextualProperties")},shapeStateBooleanBinding:Ember.Binding.oneWay("GliffyApp.overlayModel.shapeStateBoolean"),clickStateCheckbox:function(e){GliffyApp.contextualPropertiesController.resetDialogControls();GliffyApp.contextualPropertiesController.updateShapeTabProperty("State",Number($("#gliffy-contextual-properties-span-state input").prop("checked")))},didInsertElement:function(){$("#gliffy-contextual-properties-dialog .jqmClose").attr("title",$.i18n._("MODAL_CLOSE"));$("#gliffy-contextual-properties-controls button").tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy-contextual-properties-controls select").tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy-contextual-properties-border-width").tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy-contextual-properties-gradient-button").parent().tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy-contextual-properties-shadow-button").parent().tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy-contextual-properties-controls .jqmClose").tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD);$(".gliffy-text-properties span").tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy-contextual-properties-arrowbegin").tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy-contextual-properties-lanes").tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy-contextual-properties-arrowend").tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy-contextual-properties-linecolor-button").tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy-contextual-properties-line-width").tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy-contextual-properties-dash-style").tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy-contextual-properties-line-type").tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy-contextual-properties-dialog-Trigger button").click(function(e){GliffyApp.contextualPropertiesController.showDialog(e)}).tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy-contextual-properties-controls-tabs").find(".gliffy-shape-properties-tab").attr("title",$.i18n._("SHAPE_PROPERTIES"));$("#gliffy-contextual-properties-controls-tabs").find(".gliffy-line-properties-tab").attr("title",$.i18n._("LINE_PROPERTIES"));$("#gliffy-contextual-properties-controls-tabs").find(".gliffy-text-properties-tab").attr("title",$.i18n._("TEXT_PROPERTIES"));$("#gliffy-contextual-properties-controls-tabs li").tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy-contextual-properties-dialog").jqm({modal:false,trigger:"#gliffy-contextual-properties-dialog-Trigger",onHide:GliffyApp.contextualPropertiesController.closeDialog,overlay:0,overlayClass:"whiteOverlay"});$("#gliffy-contextual-properties-dialog .jqmClose").on("click",function(){if($.browser.msie){setTimeout(function(){$("#gliffy-contextual-properties-controls").show()},100)}});$(".gliffy-contextual-properties-dragarea").bind("drag",function(event,dd){GliffyApp.contextualPropertiesController.handleDrag(event,dd)});$(".gliffy-contextual-properties-dragarea").bind("dragstart",function(event){GliffyApp.contextualPropertiesController.handleDragStart(event)});$("#gliffy-contextual-properties-controls-tabs li a").on("shown",function(e){GliffyApp.contextualPropertiesController.showTab()});GliffyApp.overlayModel.addObserver("lockShape",function(){GliffyApp.contextualPropertiesController.setTextFieldDisabled("#gliffy-contextual-properties-textfield-x",GliffyApp.overlayModel.lockShape);GliffyApp.contextualPropertiesController.setTextFieldDisabled("#gliffy-contextual-properties-textfield-y",GliffyApp.overlayModel.lockShape);GliffyApp.contextualPropertiesController.setTextFieldDisabled("#gliffy-contextual-properties-textfield-width",GliffyApp.overlayModel.lockShape);GliffyApp.contextualPropertiesController.setTextFieldDisabled("#gliffy-contextual-properties-textfield-height",GliffyApp.overlayModel.lockShape);GliffyApp.contextualPropertiesController.setTextFieldDisabled("#gliffy-contextual-properties-textfield-rotation",GliffyApp.overlayModel.lockShape)});$("#gliffy-contextual-properties-button-loremipsum").click(function(e){GliffyApp.contextualPropertiesController.handleLoremIpsumClick()});$("#gliffy-contextual-properties-dialog-Trigger").append($('<button id="gliffy-contextual-properties-gte-trigger" class="btn gliffy-btn-primary" data-original-title="edit text (or double click on the shape)"><i class="gliffy-tool-type gliffy-icon-toolbar-text-white""></i></button>').click(function(ev){GliffyApp.contextualPropertiesController.__editor.overlayManager.getActiveOverlay().makeTextEditable();ev.stopPropagation();ev.preventDefault();return false}).tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD))}});GliffyApp.ContextualPropertiesTextField=GliffyApp.AbstractPropertiesTextField.extend({mouseDown:function(e){GliffyApp.contextualPropertiesController.resetDialogControls()},handleEnterOrTabKey:function(){this.__commit(this.propertyKey,this.value)},__commit:function(prop,value){if(GliffyApp.contextualPropertiesController.isValidPropertyValue(prop,value)){if(parseInt(this.value,10)!==parseInt(this.oldValue,10)){_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextualProperties",action:"type"+_gliffy.Utils.capitalize(prop),value:parseInt(this.value,10)});GliffyApp.contextualPropertiesController.updateShapeTabProperty(prop,value)}}else{this.__rollback()}}});GliffyApp.ContextualPropertiesTextFieldX=GliffyApp.ContextualPropertiesTextField.extend({propertyKey:"x",valueBinding:Ember.Binding.oneWay("GliffyApp.contextualPropertiesController.overlayX"),oldValueBinding:Ember.Binding.oneWay("GliffyApp.contextualPropertiesController.overlayX"),__rollback:function(){this.set("value",GliffyApp.contextualPropertiesController.overlayX)}});GliffyApp.ContextualPropertiesTextFieldY=GliffyApp.ContextualPropertiesTextField.extend({propertyKey:"y",valueBinding:Ember.Binding.oneWay("GliffyApp.contextualPropertiesController.overlayY"),oldValueBinding:Ember.Binding.oneWay("GliffyApp.contextualPropertiesController.overlayY"),__rollback:function(){this.set("value",GliffyApp.contextualPropertiesController.overlayY)}});GliffyApp.ContextualPropertiesTextFieldWidth=GliffyApp.ContextualPropertiesTextField.extend({propertyKey:"width",valueBinding:Ember.Binding.oneWay("GliffyApp.contextualPropertiesController.overlayWidth"),oldValueBinding:Ember.Binding.oneWay("GliffyApp.contextualPropertiesController.overlayWidth"),__rollback:function(){this.set("value",GliffyApp.contextualPropertiesController.overlayWidth)}});GliffyApp.ContextualPropertiesTextFieldHeight=GliffyApp.ContextualPropertiesTextField.extend({propertyKey:"height",valueBinding:Ember.Binding.oneWay("GliffyApp.contextualPropertiesController.overlayHeight"),oldValueBinding:Ember.Binding.oneWay("GliffyApp.contextualPropertiesController.overlayHeight"),__rollback:function(){this.set("value",GliffyApp.contextualPropertiesController.overlayHeight)}});GliffyApp.ContextualPropertiesTextFieldRotation=GliffyApp.ContextualPropertiesTextField.extend({propertyKey:"rotation",valueBinding:Ember.Binding.oneWay("GliffyApp.contextualPropertiesController.overlayRotation"),oldValueBinding:Ember.Binding.oneWay("GliffyApp.contextualPropertiesController.overlayRotation"),__rollback:function(){this.set("value",GliffyApp.contextualPropertiesController.overlayRotation)}});GliffyApp.PropertiesBootstrapToggleButton=Ember.Button.extend({buttonClass:Ember.computed(function(){if(this.buttonOn){return"btn active"}else{return"btn"}}).property("buttonOn"),didInsertElement:function(){$("#"+this.domElementId).attr("data-toggle","button")}});GliffyApp.PropertiesGradientButton=GliffyApp.PropertiesBootstrapToggleButton.extend({buttonOnBinding:Ember.Binding.oneWay("GliffyApp.contextualPropertiesController.overlayGradientOn"),domElementId:"gliffy-contextual-properties-gradient-button",click:function(e){GliffyApp.contextualPropertiesController.resetDialogControls();GliffyApp.contextualPropertiesController.updateShapeTabProperty("Gradient",!GliffyApp.overlayModel.gradientOn);_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextualProperties",action:GliffyApp.overlayModel.gradientOn?"gradientOn":"gradientOff"});e.preventDefault()}});GliffyApp.PropertiesShadowButton=GliffyApp.PropertiesBootstrapToggleButton.extend({buttonOnBinding:Ember.Binding.oneWay("GliffyApp.overlayModel.shadowOn"),domElementId:"gliffy-contextual-properties-shadow-button",click:function(e){GliffyApp.contextualPropertiesController.resetDialogControls();GliffyApp.contextualPropertiesController.updateShapeTabProperty("DropShadow",!GliffyApp.overlayModel.shadowOn);_gliffy.Utils.analyticsEvent("trackEvent",{category:"contextualProperties",action:GliffyApp.overlayModel.shadowOn?"shadowOn":"shadowOff"});e.preventDefault()}})}());(function(){GliffyApp.AbstractMenuView=Ember.View.extend({__tooltipHideTimeout:null,onMenuClick:function(e,followUpClickId,keepSelected,skipTextBlur){if(skipTextBlur===undefined||skipTextBlur===false){$("#gliffy-edit-text").trigger("customblur.gliffy-edit-text")}if(!keepSelected){if(e.deselect===undefined||e.deselect!==false){_gliffy.toolbarController.doDeselectAll()}}e.preventDefault();if(followUpClickId){$("#"+followUpClickId).click()}}})}());(function(){GliffyApp.ToolbarView=GliffyApp.AbstractMenuView.extend({__tooltipHideTimeout:null,zoomBinding:Ember.Binding.oneWay("GliffyApp.documentModel.zoom"),zoomPercent:Ember.computed(function(){return Math.round(this.zoom*100)+"%"}).property("zoom"),didInsertElement:function(){var self=this;$(".gliffy-tools .btn").tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy-anchor-exit").tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy-toolbar-button-pointer").click();$("#gliffy-anchor-exit").on("click",function(e){self.__tooltipHideTimeout=setTimeout(function(){$("#gliffy-anchor-exit").tooltip("hide")},1000)});$(".gliffy-toolbar .gliffy-filemenu").on("click",function(e){$(".gliffy-filemenu-import .qq-upload-button").removeClass("qq-upload-button-focus");$(".gliffy-filemenu-import .gliffy-file-upload-button").trigger("mouseleave")})},drawModeClick:function(e){this.onMenuClick(e);if(!e.isTrigger){_gliffy.Utils.analyticsEvent("trackEvent",{category:"drawModeClick",action:e.currentTarget.value})}_gliffy.toolbarController.updateDrawMode(_gliffy.Editor.DRAW_MODE[e.currentTarget.value])},zoomSelect:function(e){if(!e.isTrigger){_gliffy.Utils.analyticsEvent("trackEvent",{category:"toolbarClick",action:"zoomSelect"})}this.onMenuClick(e,"gliffy-toolbar-zoom-text",false);_gliffy.toolbarController.handleZoomSelect(e.currentTarget.getAttribute("data-gliffy-value"))},zoomInClick:function(e){if(!e.isTrigger){_gliffy.Utils.analyticsEvent("trackEvent",{category:"toolbarClick",action:"zoomIn"})}$("#gliffy-edit-text").trigger("customblur.gliffy-edit-text");_gliffy.toolbarController.doZoomIn()},zoomOutClick:function(e){if(!e.isTrigger){_gliffy.Utils.analyticsEvent("trackEvent",{category:"toolbarClick",action:"zoomOut"})}$("#gliffy-edit-text").trigger("customblur.gliffy-edit-text");_gliffy.toolbarController.doZoomOut()},navigatorClick:function(e){var currentlyActive=$(e.currentTarget).hasClass("active");_gliffy.Utils.analyticsEvent("trackEvent",{category:"toolbarClick",action:(currentlyActive?"navigatorOff":"navigatorOn")});$("#gliffy-edit-text").trigger("customblur.gliffy-edit-text");_gliffy.toolbarController.togglePageNavigator(!currentlyActive)},drawingGuidesClick:function(e){var currentlyActive=$(e.currentTarget).hasClass("active");_gliffy.Utils.analyticsEvent("trackEvent",{category:"toolbarClick",action:(currentlyActive?"drawingGuidesOff":"drawingGuidesOn")});$("#gliffy-edit-text").trigger("customblur.gliffy-edit-text");_gliffy.toolbarController.toggleDrawingGuides(!currentlyActive)},snapToGridClick:function(e){var currentlyActive=$(e.currentTarget).hasClass("active");_gliffy.Utils.analyticsEvent("trackEvent",{category:"toolbarClick",action:(currentlyActive?"snapToGridOff":"snapToGridOn")});$("#gliffy-edit-text").trigger("customblur.gliffy-edit-text");_gliffy.toolbarController.toggleSnapToGrid(!currentlyActive)},showGridClick:function(e){var currentlyActive=$(e.currentTarget).hasClass("active");_gliffy.Utils.analyticsEvent("trackEvent",{category:"toolbarClick",action:(currentlyActive?"showGridOff":"showGridOn")});$("#gliffy-edit-text").trigger("customblur.gliffy-edit-text");_gliffy.toolbarController.toggleShowGrid(!currentlyActive)},themesClick:function(e){var currentlyActive=$(e.currentTarget).hasClass("active");$("#gliffy-edit-text").trigger("customblur.gliffy-edit-text");_gliffy.toolbarController.toggleThemes(!currentlyActive)},undoClick:function(e){if(!e.isTrigger){_gliffy.Utils.analyticsEvent("trackEvent",{category:"toolbarClick",action:"undo"})}_gliffy.toolbarController.doUndo()},redoClick:function(e){if(!e.isTrigger){_gliffy.Utils.analyticsEvent("trackEvent",{category:"toolbarClick",action:"redo"})}_gliffy.toolbarController.doRedo()},groupClick:function(e){if(!e.isTrigger){_gliffy.Utils.analyticsEvent("trackEvent",{category:"toolbarClick",action:"group"})}$("#gliffy-edit-text").trigger("customblur.gliffy-edit-text");_gliffy.toolbarController.doGroup()},ungroupClick:function(e){if(!e.isTrigger){_gliffy.Utils.analyticsEvent("trackEvent",{category:"toolbarClick",action:"ungroup"})}$("#gliffy-edit-text").trigger("customblur.gliffy-edit-text");_gliffy.toolbarController.doUnGroup()},bringToFrontClick:function(e){if(!e.isTrigger){_gliffy.Utils.analyticsEvent("trackEvent",{category:"toolbarClick",action:"bringToFront"})}$("#gliffy-edit-text").trigger("customblur.gliffy-edit-text");_gliffy.toolbarController.doBringToFront()},sendToBackClick:function(e){if(!e.isTrigger){_gliffy.Utils.analyticsEvent("trackEvent",{category:"toolbarClick",action:"sendToBack"})}$("#gliffy-edit-text").trigger("customblur.gliffy-edit-text");_gliffy.toolbarController.doSendToBack()}})}());(function(){GliffyApp.FileMenuView=GliffyApp.AbstractMenuView.extend({didInsertElement:function(){var self=this;$(".gliffy-filemenu-import .gliffy-file-upload-button").on("mouseenter",function(){$(this).css("background-color","#E4EAF2")});$(".gliffy-filemenu-import .gliffy-file-upload-button").on("mouseleave",function(){$(this).css("background-color","#FFFFFF")});GliffyApp.documentModel.addObserver("currentRevision",function(){if(GliffyApp.documentModel.currentRevision>0){$(".gliffy-filemenu-revisionhistory").show()}else{$(".gliffy-filemenu-revisionhistory").hide()}});_gliffy.toolbarController.setFileMenuWidth()},menuNew:function(e){if(!e.isTrigger){_gliffy.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"new"})}_gliffy.toolbarController.doNew();_gliffy.toolbarController.doDeselectAll();this.onMenuClick(e,"gliffy-toolbar-menu-file",false)},menuOpen:function(e){if(!e.isTrigger){_gliffy.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"open"})}_gliffy.toolbarController.doOpen();_gliffy.toolbarController.doDeselectAll();this.onMenuClick(e,"gliffy-toolbar-menu-file",false)},menuSave:function(e){if(!e.isTrigger){_gliffy.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"save"})}this.onMenuClick(e,"gliffy-toolbar-menu-file",false);_gliffy.toolbarController.doSave()},menuSaveAndClose:function(e){if(!e.isTrigger){_gliffy.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"saveAndClose"})}this.onMenuClick(e,"gliffy-toolbar-menu-file",false);_gliffy.toolbarController.doSaveAndClose()},menuClose:function(e){if(!e.isTrigger){_gliffy.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"close"})}this.onMenuClick(e,"gliffy-toolbar-menu-file",false);_gliffy.toolbarController.doClose()},menuImport:function(e){if(!e.isTrigger){_gliffy.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"import"})}this.onMenuClick(e,"gliffy-toolbar-menu-file",false);$(".gliffy-filemenu-import .gliffy-file-upload-button").trigger("mouseleave")},menuExportAsSVG:function(e){if(!e.isTrigger){_gliffy.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"exportAsSVG"})}this.onMenuClick(e,"gliffy-toolbar-menu-file",false);_gliffy.toolbarController.doExportData("image/svg+xml","svg")},menuExportAsGliffy:function(e){if(!e.isTrigger){_gliffy.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"exportAsGliffy"})}this.onMenuClick(e,"gliffy-toolbar-menu-file",false);_gliffy.toolbarController.doExportData("application/gliffy+json","gliffy")},menuExportAsGliffyOld:function(e){if(!e.isTrigger){_gliffy.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"exportAsGliffyOld"})}this.onMenuClick(e,"gliffy-toolbar-menu-file",false);_gliffy.toolbarController.doExportData("application/gliffy+xml","gxml")},menuExportAsJPG:function(e){if(!e.isTrigger){_gliffy.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"exportAsJPG"})}this.onMenuClick(e,"gliffy-toolbar-menu-file",false);_gliffy.toolbarController.doExportImage("image/jpeg","jpg")},menuExportAsPNG:function(e){if(!e.isTrigger){_gliffy.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"exportAsPNG"})}this.onMenuClick(e,"gliffy-toolbar-menu-file",false);_gliffy.toolbarController.doExportImage("image/png","png")},menuDocumentProperties:function(e){if(!e.isTrigger){_gliffy.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"documentProperties"})}this.onMenuClick(e,"gliffy-toolbar-menu-file",false);GliffyApp.documentPropertiesController.showDialog()},menuRevisionHistory:function(e){if(!e.isTrigger){_gliffy.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"revisionHistory"})}this.onMenuClick(e,"gliffy-toolbar-menu-file",false);GliffyApp.revisionHistoryController.loadRevisionHistory()},menuPrint:function(e){if(!e.isTrigger){_gliffy.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"print"})}this.onMenuClick(e,"gliffy-toolbar-menu-file",false);_gliffy.toolbarController.doPrint()},menuRename:function(e){},menuSaveAs:function(e){}})}());(function(){GliffyApp.EditMenuView=GliffyApp.AbstractMenuView.extend({didInsertElement:function(){_gliffy.toolbarController.setEditMenuWidth()},menuUndo:function(e){if(!e.isTrigger){_gliffy.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"undo"})}this.onMenuClick(e,"gliffy-toolbar-menu-edit",true,true);_gliffy.toolbarController.doUndo()},menuRedo:function(e){if(!e.isTrigger){_gliffy.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"redo"})}this.onMenuClick(e,"gliffy-toolbar-menu-edit",true,true);_gliffy.toolbarController.doRedo()},menuSelectAll:function(e){if(!e.isTrigger){_gliffy.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"selectAll"})}this.onMenuClick(e,"gliffy-toolbar-menu-edit",true);_gliffy.toolbarController.doSelectAll()},menuGroup:function(e){if(!e.isTrigger){_gliffy.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"group"})}this.onMenuClick(e,"gliffy-toolbar-menu-edit",true);_gliffy.toolbarController.doGroup()},menuUnGroup:function(e){if(!e.isTrigger){_gliffy.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"ungroup"})}this.onMenuClick(e,"gliffy-toolbar-menu-edit",true);_gliffy.toolbarController.doUnGroup()},menuCopy:function(e){if(!e.isTrigger){_gliffy.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"copy"})}this.onMenuClick(e,"gliffy-toolbar-menu-edit",true);_gliffy.toolbarController.doCopy()},menuCut:function(e){if(!e.isTrigger){_gliffy.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"cut"})}this.onMenuClick(e,"gliffy-toolbar-menu-edit",true);_gliffy.toolbarController.doCut()},menuPaste:function(e){if(!e.isTrigger){_gliffy.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"paste"})}this.onMenuClick(e,"gliffy-toolbar-menu-edit",true);_gliffy.toolbarController.doPaste()},menuDelete:function(e){if(!e.isTrigger){_gliffy.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"delete"})}this.onMenuClick(e,"gliffy-toolbar-menu-edit",true);_gliffy.toolbarController.doDelete()}})}());(function(){GliffyApp.HelpMenuView=GliffyApp.AbstractMenuView.extend({didInsertElement:function(){$(".gliffy-help-menu-link-user-manual").on("click",function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"helpUserManual"})});$(".gliffy-help-menu-link-user-newsletter").on("click",function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"helpNewsletter"})});$(".gliffy-help-menu-link-about-us").on("click",function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"helpAboutUs"})});$(".gliffy-help-menu-link-shape-shortcuts").on("click",function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"helpShapeShortcuts"})});$(".gliffy-help-menu-link-document-shortcuts").on("click",function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"helpDocumentShortcuts"})});$(".gliffy-help-menu-link-eula").on("click",function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"helpEULA"})});$(".gliffy-help-menu-link-search-support").on("click",function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"helpSearchSupport"})});$(".gliffy-help-menu-link-create-ticket").on("click",function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"helpCreateTicket"})})},menuTips:function(e){e.preventDefault();GliffyApp.tipsController.open();if(!e.isTrigger){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"tips"})}}})}());(function(){GliffyApp.ManageLibraryView=Ember.View.extend({handleCheckboxClick:function(e){var checked=e.currentTarget.checked,library=e.currentTarget.getAttribute("data-gliffy-library");if(checked){$("#gliffy-symbol-library div[data-gliffy-library='"+library+"']").show()}else{$("#gliffy-symbol-library div[data-gliffy-library='"+library+"']").hide()}}})}());GliffyApp.DocumentTabsView=Ember.View.extend({});(function(){GliffyApp.RevisionHistoryView=Ember.View.extend({currentBaseRevisionBinding:Ember.Binding.oneWay("GliffyApp.revisionHistoryController.currentBaseRevision"),currentMaxRevisionBinding:Ember.Binding.oneWay("GliffyApp.revisionHistoryController.currentMaxRevision"),numRevisionsBinding:Ember.Binding.oneWay("GliffyApp.revisionHistoryController.numRevisions"),okayClick:function(e){var openUrl=$('#revisionHistory label input[name="gliffy-revision-radio-button"]:checked').attr("data-gliffy-revision-url");GliffyApp.revisionHistoryController.openRevision(openUrl);$("#revisionHistory").modal("hide")},nextClick:function(e){GliffyApp.revisionHistoryController.handleNextClick();e.preventDefault()},previousClick:function(e){GliffyApp.revisionHistoryController.handlePreviousClick();e.preventDefault()}})}());(function(){GliffyApp.ColorpickerView=Ember.View.extend({didInsertElement:function(){$(".gliffy-colorswatchpicker button").tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD);$(".gliffy-colorswatchpicker").mousedown(function(e){return false});$(".gliffy-colorswatchpicker .swatch").click(function(e){GliffyApp.colorpickerController.handleSwatchClick(e)});$(".gliffy-colorswatchpicker .gliffy-nofill").tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD)},handleCustomButtonClick:function(e){GliffyApp.colorpickerController.handleCustomButtonClick(e)}})}());(function(){GliffyApp.TipsView=Ember.View.extend({didInsertElement:function(){var controller=GliffyApp.tipsController;controller.__update();$("#gliffy-tips-link-next-tip").click(function(e){e.preventDefault();controller.__currentTip++;controller.__update()});$("#gliffy-tips-link-previous-tip").click(function(e){e.preventDefault();controller.__currentTip--;controller.__update()});$(".gliffy-tips-footer button").click(function(e){controller.close(true)});$(".gliffy-tips-header .close").click(function(e){controller.close()});$("#gliffy-tips-checkbox-no-tips").click(function(e){if(controller.handleNoTipsChecked){controller.handleNoTipsChecked(e.currentTarget.checked)}else{if(e.currentTarget.checked){$.cookie("doNotShowTips",true,{expires:365})}else{$.removeCookie("doNotShowTips",{expires:365})}}})}})}());(function(){GliffyApp.SidebarView=Ember.View.extend({didInsertElement:function(){GliffyApp.shapeLibraryController.fixImageButtons()}})}());(function(){GliffyApp.SaveDialogView=Ember.View.extend({didInsertElement:function(){var self=this,toolbarController=GliffyApp.toolbarController;GliffyApp.saveDialogController.hide();$("#saveDialog").find("form").submit(function(event){event.preventDefault();GliffyApp.saveDialogController.applySave()});$("#saveDialog").find(".gliffy-save-dialog-button").click(function(event){event.preventDefault();GliffyApp.saveDialogController.applySave()});$("#saveDialog").find(".gliffy-save-dialog-cancel-button").click(function(event){GliffyApp.saveDialogController.cancelSave()})}})}());(function(){GliffyApp.ThemeView=Ember.View.extend({_draggingDialog:false,_themes:null,didInsertElement:function(){var self=this;GliffyApp.themeController.setOnShow(function(){var documentManager=GliffyApp.themeController.__editor.getDocumentManager(),activeTheme=documentManager.getActiveStage().themeData;$("#gliffy-theme-title-bar").html($.i18n._("THEMES_TITLE"));try{if(activeTheme&&activeTheme.uid){$(".gliffy-theme-item").each(function(index){if($(this).data("gliffy-theme-data")&&($(this).data("gliffy-theme-data").uid===activeTheme.uid)){$(this).addClass("active")}else{$(this).removeClass("active")}})}else{$(".gliffy-theme-item").each(function(index){$(this).removeClass("active")})}}catch(e){}});$("#gliffy-theme-undo-tooltip").tooltip(_gliffy.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy-theme-dialog").jqm({modal:false,onHide:GliffyApp.themeController.closeDialog,overlay:0,overlayClass:"whiteOverlay"});$(".gliffy-theme-dragarea").bind("drag",function(event,dd){GliffyApp.themeController.handleDrag(event,dd)}).bind("dragstart",function(event,dd){self._draggingDialog=true}).bind("dragend",function(event,dd){self._draggingDialog=false});$("#gliffy-theme-dialog .jqmClose").bind("click",function(event){GliffyApp.themeController.hideDialog()});var themes=[{uid:"com.gliffy.theme.daily_glyph",name:"The Daily Glyph",shape:{primary:{strokeWidth:2,strokeColor:"#333333",fillColor:"#EEEEEE",gradient:false,dropShadow:false,opacity:1,text:{color:"#000000",bold:null,italic:null,underline:null}},secondary:{strokeWidth:2,strokeColor:"#666666",fillColor:"#FFFFFF",gradient:false,dropShadow:false,opacity:1,text:{color:"#000000",bold:null,italic:null,underline:null}},tertiary:{strokeWidth:2,strokeColor:"#333333",fillColor:"#CCCCCC",gradient:false,dropShadow:false,opacity:1,text:{color:"#000000",bold:null,italic:null,underline:null}},highlight:{strokeWidth:2,strokeColor:"#333333",fillColor:"#333333",gradient:false,dropShadow:false,opacity:1,text:{color:"#FFFFFF",bold:null,italic:null,underline:null}}},line:{strokeWidth:2,strokeColor:"#333333",fillColor:"none",arrowType:2,interpolationType:"linear",cornerRadius:0,text:{color:"#000000",bold:null,italic:null,underline:null}},text:{color:"#000000",bold:null,italic:null,underline:null},stage:{color:null}},{uid:"com.gliffy.theme.blueprint",name:"Blueprint",shape:{primary:{strokeWidth:2,strokeColor:"#0B599F",fillColor:"#DDE6F1",gradient:false,dropShadow:false,opacity:1,text:{color:"#08233F",bold:null,italic:null,underline:null}},secondary:{strokeWidth:2,strokeColor:"#08233F",fillColor:"#424D76",gradient:false,dropShadow:false,opacity:1,text:{color:"#FFFFFF",bold:null,italic:null,underline:null}},tertiary:{strokeWidth:2,strokeColor:"#0B599F",fillColor:"#FFFFFF",gradient:false,dropShadow:false,opacity:1,text:{color:"#08233F",bold:null,italic:null,underline:null}},highlight:{strokeWidth:2,strokeColor:"#0B599F",fillColor:"#0B599F",gradient:false,dropShadow:false,opacity:1,text:{color:"#ffffff",bold:null,italic:null,underline:null}}},line:{strokeWidth:2,strokeColor:"#0B599F",fillColor:"none",arrowType:2,interpolationType:"linear",cornerRadius:0,text:{color:"#08233F",bold:null,italic:null,underline:null}},text:{color:"#08233F",bold:null,italic:null,underline:null},stage:{color:"#FFFFFF"}},{uid:"com.gliffy.theme.cloudy_day",name:"Cloudy Day",shape:{primary:{strokeWidth:2,strokeColor:"#7F9EAD",fillColor:"#CBD8DE",gradient:false,dropShadow:false,opacity:1,text:{color:"#000000",bold:null,italic:null,underline:null}},secondary:{strokeWidth:2,strokeColor:"#555555",fillColor:"#EEEEEE",gradient:false,dropShadow:false,opacity:1,text:{color:"#000000",bold:null,italic:null,underline:null}},tertiary:{strokeWidth:2,strokeColor:"#7E725A",fillColor:"#CCC7BD",gradient:false,dropShadow:false,opacity:1,text:{color:"#000000",bold:null,italic:null,underline:null}},highlight:{strokeWidth:2,strokeColor:"#314047",fillColor:"#4A5F68",gradient:false,dropShadow:false,opacity:1,text:{color:"#ffffff",bold:null,italic:null,underline:null}}},line:{strokeWidth:2,strokeColor:"#4A5F68",fillColor:"none",arrowType:2,interpolationType:"quadratic",cornerRadius:0,text:{color:"#000000",bold:null,italic:null,underline:null}},text:{color:"#252F34",bold:null,italic:null,underline:null},stage:{color:"#FFFFFF"}},{uid:"com.gliffy.theme.eggplant_casserole",name:"Eggplant Casserole",shape:{primary:{strokeWidth:2,strokeColor:"#60327C",fillColor:"#DFD7E5",gradient:false,dropShadow:false,opacity:1,text:{color:"#432657",bold:null,italic:null,underline:null}},secondary:{strokeWidth:2,strokeColor:"#377c32",fillColor:"#D7E4D6",gradient:false,dropShadow:false,opacity:1,text:{color:"#235522",bold:null,italic:null,underline:null}},tertiary:{strokeWidth:2,strokeColor:"#7c5d32",fillColor:"#E6DFD6",gradient:false,dropShadow:false,opacity:1,text:{color:"#3E2D17",bold:null,italic:null,underline:null}},highlight:{strokeWidth:2,strokeColor:"#60327C",fillColor:"#60327C",gradient:false,dropShadow:false,opacity:1,text:{color:"#DFD7E5",bold:null,italic:null,underline:null}}},line:{strokeWidth:2,strokeColor:"#60327C",fillColor:"none",arrowType:2,interpolationType:"quadratic",cornerRadius:0,text:{color:"#432657",bold:null,italic:null,underline:null}},text:{color:"#432657",bold:null,italic:null,underline:null},stage:{color:null}},{uid:"com.gliffy.theme.technorama",name:"Technorama",shape:{primary:{strokeWidth:2,strokeColor:"#0E75AB",fillColor:"#0099CC",gradient:false,dropShadow:false,opacity:1,text:{color:"#FFFFFF",bold:null,italic:null,underline:null}},secondary:{strokeWidth:2,strokeColor:"#AAAAAA",fillColor:"#EEEEEE",gradient:false,dropShadow:false,opacity:1,text:{color:"#000000",bold:null,italic:null,underline:null}},tertiary:{strokeWidth:2,strokeColor:"#B5BF5E",fillColor:"#EEF19F",gradient:false,dropShadow:false,opacity:1,text:{color:"#1A1B11",bold:null,italic:null,underline:null}},highlight:{strokeWidth:2,strokeColor:"#90B328",fillColor:"#C6DD58",gradient:false,dropShadow:false,opacity:1,text:{color:"#1C210C",bold:null,italic:null,underline:null}}},line:{strokeWidth:2,strokeColor:"0E75AB",fillColor:"none",arrowType:2,interpolationType:"quadratic",cornerRadius:0,text:{color:"#071E2D",bold:null,italic:null,underline:null}},text:{color:"#071E2D",bold:null,italic:null,underline:null},stage:{color:"#FFFFFF"}},{uid:"com.gliffy.theme.business_casual",name:"Business Casual",shape:{primary:{strokeWidth:2,strokeColor:"#2A5666",fillColor:"#4B8598",gradient:false,dropShadow:false,opacity:1,text:{color:"#FFFFFF",bold:null,italic:null,underline:null}},secondary:{strokeWidth:2,strokeColor:"#58483B",fillColor:"#867160",gradient:false,dropShadow:false,opacity:1,text:{color:"#FFFFFF",bold:null,italic:null,underline:null}},tertiary:{strokeWidth:2,strokeColor:"#B2B973",fillColor:"#D1D693",gradient:false,dropShadow:false,opacity:1,text:{color:"#000000",bold:true,italic:null,underline:null}},highlight:{strokeWidth:2,strokeColor:"#6F1C03",fillColor:"#9D3100",gradient:false,dropShadow:false,opacity:1,text:{color:"#FFFFFF",bold:null,italic:null,underline:null}}},line:{strokeWidth:2,strokeColor:"2A5666",fillColor:"none",arrowType:2,interpolationType:"linear",cornerRadius:10,text:{color:"#332714",bold:null,italic:null,underline:null}},text:{color:"#332714",bold:null,italic:null,underline:null},stage:{color:"#FFFFFF"}},{uid:"com.gliffy.theme.beach_day",name:"Beach Day",shape:{primary:{strokeWidth:2,strokeColor:"#00A4DA",fillColor:"#AEE4F4",gradient:false,dropShadow:false,opacity:1,text:{color:"#004257",bold:null,italic:null,underline:null}},secondary:{strokeWidth:2,strokeColor:"#CDB25E",fillColor:"#EACF81",gradient:false,dropShadow:false,opacity:1,text:{color:"#332D1A",bold:null,italic:null,underline:null}},tertiary:{strokeWidth:2,strokeColor:"#FFBE00",fillColor:"#FFF1CB",gradient:false,dropShadow:false,opacity:1,text:{color:"#000000",bold:null,italic:null,underline:null}},highlight:{strokeWidth:2,strokeColor:"#00A4DA",fillColor:"#00A4DA",gradient:false,dropShadow:false,opacity:1,text:{color:"#ffffff",bold:null,italic:null,underline:null}}},line:{strokeWidth:2,strokeColor:"#00A4DA",fillColor:"none",arrowType:2,interpolationType:"quadratic",cornerRadius:0,text:{color:"#002248",bold:null,italic:null,underline:null}},text:{color:"#002248",bold:null,italic:null,underline:null},stage:{color:"#FFFFFF"}},{uid:"com.gliffy.theme.spring_green",name:"Spring Green",shape:{primary:{strokeWidth:2,strokeColor:"#418104",fillColor:"#6BAF21",gradient:false,dropShadow:false,opacity:1,text:{color:"#FFFFFF",bold:null,italic:null,underline:null}},secondary:{strokeWidth:2,strokeColor:"#3971B4",fillColor:"#589AD7",gradient:false,dropShadow:false,opacity:1,text:{color:"#FFFFFF",bold:null,italic:null,underline:null}},tertiary:{strokeWidth:2,strokeColor:"#624025",fillColor:"#91643C",gradient:false,dropShadow:false,opacity:1,text:{color:"#FFFFFF",bold:null,italic:null,underline:null}},highlight:{strokeWidth:2,strokeColor:"#D27023",fillColor:"#E88C3D",gradient:false,dropShadow:false,opacity:1,text:{color:"#FFFFFF",bold:null,italic:null,underline:null}}},line:{strokeWidth:2,strokeColor:"#418104",fillColor:"none",arrowType:2,interpolationType:"linear",cornerRadius:10,text:{color:"#2F3A1C",bold:null,italic:null,underline:null}},text:{color:"#2F3A1C",bold:null,italic:null,underline:null},stage:{color:"#FFFFFF"}},{uid:"com.gliffy.theme.blue_sweater",name:"Blue Sweater",shape:{primary:{strokeWidth:2,strokeColor:"#003068",fillColor:"#CCD5E1",gradient:false,dropShadow:false,opacity:1,text:{color:"#010B14",bold:null,italic:null,underline:null}},secondary:{strokeWidth:2,strokeColor:"#006800",fillColor:"#CCE0CC",gradient:false,dropShadow:false,opacity:1,text:{color:"#031C00",bold:null,italic:null,underline:null}},tertiary:{strokeWidth:2,strokeColor:"#6A3C00",fillColor:"#E2D8CC",gradient:false,dropShadow:false,opacity:1,text:{color:"#1B1000",bold:null,italic:null,underline:null}},highlight:{strokeWidth:2,strokeColor:"#003068",fillColor:"#003068",gradient:false,dropShadow:false,opacity:1,text:{color:"#FFFFFF",bold:null,italic:null,underline:null}}},line:{strokeWidth:2,strokeColor:"#003068",fillColor:"none",arrowType:2,interpolationType:"quadratic",cornerRadius:0,text:{color:"#010B14",bold:null,italic:null,underline:null}},text:{color:"#010B14",bold:null,italic:null,underline:null},stage:{color:"#FFFFFF"}},{uid:"com.gliffy.theme.earthy",name:"Earthy",shape:{primary:{strokeWidth:2,strokeColor:"#422000",fillColor:"#DAD2CC",gradient:false,dropShadow:false,opacity:1,text:{color:"#2E1600",bold:null,italic:null,underline:null}},secondary:{strokeWidth:2,strokeColor:"#0D3E00",fillColor:"#CFD8CC",gradient:false,dropShadow:false,opacity:1,text:{color:"#092C00",bold:null,italic:null,underline:null}},tertiary:{strokeWidth:2,strokeColor:"#004C67",fillColor:"#CBDBE0",gradient:false,dropShadow:false,opacity:1,text:{color:"#003547",bold:null,italic:null,underline:null}},highlight:{strokeWidth:2,strokeColor:"#024100",fillColor:"#16530E",gradient:false,dropShadow:false,opacity:1,text:{color:"#DCE9D8",bold:null,italic:null,underline:null}}},line:{strokeWidth:2,strokeColor:"3D1F28",fillColor:"none",arrowType:2,interpolationType:"linear",cornerRadius:10,text:{color:"#2E1600",bold:null,italic:null,underline:null}},text:{color:"#2A0002",bold:null,italic:null,underline:null},stage:{color:"#FFFFFF"}},{uid:"com.gliffy.theme.rosy",name:"Rosy",shape:{primary:{strokeWidth:2,strokeColor:"#231218",fillColor:"#72404D",gradient:false,dropShadow:false,opacity:1,text:{color:"#FFFFFF",bold:null,italic:null,underline:null}},secondary:{strokeWidth:2,strokeColor:"#A5817F",fillColor:"#CBA7A6",gradient:false,dropShadow:false,opacity:1,text:{color:"#161110",bold:null,italic:null,underline:null}},tertiary:{strokeWidth:2,strokeColor:"#C0AE9A",fillColor:"#DAC9B7",gradient:false,dropShadow:false,opacity:1,text:{color:"#100E0B",bold:null,italic:null,underline:null}},highlight:{strokeWidth:2,strokeColor:"#231218",fillColor:"#9DAC95",gradient:false,dropShadow:false,opacity:1,text:{color:"#272B25",bold:null,italic:null,underline:null}}},line:{strokeWidth:2,strokeColor:"#231218",fillColor:"none",arrowType:2,interpolationType:"linear",cornerRadius:10,text:{color:"#000000",bold:null,italic:null,underline:null}},text:{color:"#000000",bold:null,italic:null,underline:null},stage:{color:"#FFFFFF"}},{uid:"com.gliffy.theme.goldfish",name:"Goldfish",shape:{primary:{strokeWidth:2,strokeColor:"#DA8707",fillColor:"#FCD186",gradient:false,dropShadow:false,opacity:1,text:{color:"#312101",bold:null,italic:null,underline:null}},secondary:{strokeWidth:2,strokeColor:"#AA9B2E",fillColor:"#E6DB77",gradient:false,dropShadow:false,opacity:1,text:{color:"#2A2709",bold:null,italic:null,underline:null}},tertiary:{strokeWidth:2,strokeColor:"#3E6B3F",fillColor:"#70AE73",gradient:false,dropShadow:false,opacity:1,text:{color:"#FFFFFF",bold:null,italic:null,underline:null}},highlight:{strokeWidth:2,strokeColor:"#0B5B61",fillColor:"#008D95",gradient:false,dropShadow:false,opacity:1,text:{color:"#FFFFFF",bold:null,italic:null,underline:null}}},line:{strokeWidth:2,strokeColor:"DA8707",fillColor:"none",arrowType:2,interpolationType:"linear",cornerRadius:10,text:{color:"#312101",bold:null,italic:null,underline:null}},text:{color:"#312101",bold:null,italic:null,underline:null},stage:{color:"#FFFFFF"}}];this._themes=themes;this.createThemes(themes)},applyThemeToNode:function(node,themeData,skipText){if(node.isShape()){var shapeInfo=node.getShapeInformation(),themeType=(shapeInfo&&shapeInfo.defaults&&shapeInfo.defaults.themeType)?shapeInfo.defaults.themeType:null;if(themeType&&themeData.shape[themeType]){node.getGraphic().fromObject(themeData.shape[themeType])}}else{if(node.isLine()){var line=node.getGraphic();var uid=node.getUid();if(!(uid&&uid.substring(0,20)==="com.gliffy.shape.uml")){if(line.getStartArrow()!==0){line.setStartArrow(themeData.line.arrowType)}if(line.getEndArrow()!==0){line.setEndArrow(themeData.line.arrowType)}}node.getGraphic().fromObject(themeData.line)}else{if(!skipText&&node.isText()){var text=node.getGraphic();if(node.isTextChild()){if(node.parent.isLine()){text.editable.applyTheme(themeData.line.text)}else{if(node.parent.isShape()){var shapeInfo=node.parent.getShapeInformation();var themeType=(shapeInfo&&shapeInfo.defaults&&shapeInfo.defaults.themeType)?shapeInfo.defaults.themeType:null;if(themeType&&themeData.shape[themeType]&&themeData.shape[themeType].text){text.editable.applyTheme(themeData.shape[themeType].text)}}}}else{text.editable.applyTheme(themeData.text)}}}}},__createTextHideStyles:function(themeData){var scrollTop=$("#gliffy-theme-area")[0].scrollTop;if($("#gliffy-text-preview-stylesheet").length===0){$("head").append('<style type="text/css" id="gliffy-text-preview-stylesheet"/>')}$("#gliffy-text-preview-stylesheet").html(".gliffy-text span[style]{display:none}");if(_gliffy.BrowserDetect.browser==="Explorer"){$("#gliffy-theme-area")[0].scrollTop=scrollTop}},__createTextPreviewStyles:function(themeData){var scrollTop=$("#gliffy-theme-area")[0].scrollTop;if($("#gliffy-text-preview-stylesheet").length===0){$("head").append('<style type="text/css" id="gliffy-text-preview-stylesheet"/>')}var styleSheet=$("#gliffy-text-preview-stylesheet");var contents="";if(themeData.line.text.color){contents+=".gliffy-text-with-line-parent span[style]{color:"+themeData.line.text.color+" !important;}\n"}if(themeData.text.color){contents+=".gliffy-text-standalone span[style]{color:"+themeData.text.color+" !important;}\n"}$.each(themeData.shape,function(key,value){contents+=".gliffy-text-with-shape-parent-"+key+" span[style]{color: "+value.text.color+" !important;}\n"});styleSheet.html(contents);if(_gliffy.BrowserDetect.browser==="Explorer"){$("#gliffy-theme-area")[0].scrollTop=scrollTop}},__removeTextPreviewStyles:function(){var scrollTop=$("#gliffy-theme-area")[0].scrollTop;$("#gliffy-text-preview-stylesheet").remove();if(_gliffy.BrowserDetect.browser==="Explorer"){$("#gliffy-theme-area")[0].scrollTop=scrollTop}},_cachedStage:null,createThemes:function(themes){var self=this,table=$("#gliffy-theme-area").append("<table />").find("table"),tr,i,td,item,themeData,previewImageClass;var activeTheme=GliffyApp.themeController.__editor.getDocumentManager().getActiveStage().themeData;for(i=0;i<themes.length;i++){themeData=themes[i];if(i%2===0){tr=$("<tr />");table.append(tr)}td=$("<td />");tr.append(td);previewImageClass="gliffy-icon-theme-"+themeData.uid.split("com.gliffy.theme.")[1].replace("_","-");item=$('<div class="gliffy-theme-item" />').data("gliffy-theme-data",themeData).data("gliffy-theme-index",i).addClass(previewImageClass);td.append(item)}var themeApplied=false;var reset=function(){if(!themeApplied){var documentManager=GliffyApp.themeController.__editor.getDocumentManager(),stage=documentManager.getActiveStage();$(this).removeClass("highlight");if(self._cachedStage){stage.fromObject(self._cachedStage);self._cachedStage=null}documentManager.redraw()}themeApplied=false;self.__removeTextPreviewStyles()};$("#gliffy-theme-area").hoverIntent(function(e){if(self._draggingDialog){return}var documentManager=GliffyApp.themeController.__editor.getDocumentManager(),stage=documentManager.getActiveStage()},function(e){if(self._draggingDialog){return}reset()});$(".gliffy-theme-item").hoverIntent(function(e){if(self._draggingDialog){return}if(!themeApplied){self.__createTextHideStyles(themeData);$(this).addClass("highlight");GliffyApp.themeController.__editor.overlayManager.deselectAll();$("#gliffy-edit-text").trigger("customblur.gliffy-edit-text");var themeData=$(this).data("gliffy-theme-data"),documentManager=GliffyApp.themeController.__editor.getDocumentManager(),stage=documentManager.getActiveStage();if(self._cachedStage===null){self._cachedStage=stage.toObject()}if(themeData.stage.color){stage.setBackground(themeData.stage.color)}stage.iterateNodes(function(node){node.update();if(_gliffy.Pick.isNodePartiallyInside(node,documentManager.getActiveStageViewPort())){self.applyThemeToNode(node,themeData,true)}});documentManager.redraw();self.__createTextPreviewStyles(themeData)}},function(e){if(self._draggingDialog){return}if(!themeApplied){var documentManager=GliffyApp.themeController.__editor.getDocumentManager(),stage=documentManager.getActiveStage();$(this).removeClass("highlight")}}).click(function(e){var documentManager=GliffyApp.themeController.__editor.getDocumentManager(),stage=documentManager.getActiveStage(),themeData=$(this).data("gliffy-theme-data");var scrollTop=$("#gliffy-theme-area")[0].scrollTop;_gliffy.Utils.analyticsEvent("trackEvent",{category:"themeSelect",action:themeData.name});$(".gliffy-theme-item").removeClass("active").removeClass("highlight");$(this).addClass("active");_gliffy.Spinner.show({context:"theme",noAnimate:true});themeApplied=true;if(_gliffy.BrowserDetect.browser==="Explorer"){$("#gliffy-theme-area")[0].scrollTop=scrollTop}setTimeout(function(){var nodeQueue=[];stage.iterateNodes(function(node){node.update();nodeQueue.push(node)});var interval=setInterval(function(){for(var i=0;i<3;i++){if(nodeQueue.length===0){clearInterval(interval);stage.themeData=themeData;stage.commandHistory.addAndExecuteCommand(new _gliffy.UpdateThemeCommand({stageObject:stage.toObject(),stageUndoObject:self._cachedStage}));self._cachedStage=null;self.__removeTextPreviewStyles();documentManager.redraw();reset();$("#gliffy-theme-undo-tooltip").tooltip("show");setTimeout(function(){$("#gliffy-theme-undo-tooltip").tooltip("hide")},3000);_gliffy.Spinner.hide({context:"theme"});return}else{var node=nodeQueue.pop();self.applyThemeToNode(node,themeData,false);if(_gliffy.BrowserDetect.browser==="Explorer"){$("#gliffy-theme-area")[0].scrollTop=scrollTop}}}},1)},30)})}})}());(function(){_gliffy.Slider=_gliffy.Class.extend({_sliderMarkup:'<div class="gliffy-slider"><div class="gliffy-initial-pos"></div><div class="gliffy-slider-handler" /></div>',_handle:null,_handle_width:null,_slider:null,_max:null,_min:null,_width:null,_reset_value:null,_reset_step:null,_reset_pos:null,target:null,value:null,init:function(o){var lastpos,self=this,options=$.extend({},{min:0,max:100,step:0,value:50,namespace:"gliffy.viewer.zoom",reset_step:2,reset_value:50,dragStartCallback:function(self){},dragEndCallback:function(self){},dragCallback:function(self,lastValue){}},o);if(!options.target){throw new Error("Slider must have a target container set")}this._max=options.max;this._min=options.min;this.value=options.reset_value;this._step=options.step;this._reset_value=options.reset_value;this._reset_step=options.reset_step;this.target=options.target;this._slider=$(this._sliderMarkup);this._handle=this._slider.find(".gliffy-slider-handler");options.target.append(this._slider);this._handle_width=this._handle.width();this._width=this._slider.width();this.moveHandle();this._reset_pos=this._slider.find(".gliffy-initial-pos");if(this._reset_step>0){this._reset_pos.css({left:this._handle.css("left")})}else{this._reset_pos.hide()}this.value=options.value;this.moveHandle();this.dragEvent="drag."+options.namespace;this.dragInitEvent="draginit."+options.namespace;this.dragEndEvent="dragend."+options.namespace;this.clickEvent="mousedown."+options.namespace;lastpos={x:this._handle.offset().left};this._handle.bind(this.dragInitEvent,{which:1},function(){lastpos={x:self._handle.offset().left};options.dragStartCallback(self)}).bind(this.dragEvent,{which:1},function(event){var lastValue=self.value,pos=lastpos;lastpos=self._updatePosition(event,lastpos);options.dragCallback(self,lastValue)}).bind(this.dragEndEvent,{which:1},function(event){lastpos=self._updatePosition(event,lastpos);options.dragEndCallback(self)}).mousedown(function(event){event.stopPropagation()});this._slider.bind(this.clickEvent,function(event){event.preventDefault();event.stopPropagation();var lastValue=self.value;lastpos=self._updatePosition(event,lastpos);options.dragStartCallback(self);options.dragCallback(self,lastValue);options.dragEndCallback(self)})},_updatePosition:function(event,lastpos){var xDiff=event.pageX-this._handle_width/2-lastpos.x,valueDiff=(this._max-this._min)*(xDiff/this._width),newValue=this.value+valueDiff;if(this._handle_width===0){this._handle_width=this._handle.width()}if(this._width===0){this._width=this._slider.width()}if(Math.abs(valueDiff)>this._step){if(newValue>(this._reset_value-this._reset_step)&&newValue<(this._reset_value+this._reset_step)){this.value=this._reset_value}else{if(newValue>this._max){this.value=this._max}else{if(newValue<this._min){this.value=this._min}else{this.value=newValue}}}this.moveHandle();return{x:this._handle.offset().left}}return lastpos},moveHandle:function(){var val=null;if(this.value>this._max||this.value===this._max){val="100%"}else{if(this.value<this._min||this.value===this._min){val=0}else{val=parseInt((this.value-this._min)/(this._max-this._min)*100,10)+"%"}}this._handle.css({left:val})},remove:function(){this._handle.unbind(this.dragInitEvent).unbind(this.dragEvent).unbind(this.dragEndEvent);this._slider.remove()}})}());(function(){_gliffy.Dialog={hide:function(){$("#alertDialog").modal("hide")},__bindButtonActions:function(button,footer){var $button,self=this,buttonTemplate;buttonTemplate={text:$.i18n._("DIALOG_OK"),callback:null,primary:true,dismiss:true,add_classes:[]};button=$.extend({},buttonTemplate,button);$button=$("<button />").addClass("btn").html(Mustache.escape(button.text));if(button.primary){$button.addClass("gliffy-btn-primary")}if(button.add_classes&&button.add_classes.length>0){$button.addClass(button.add_classes.join(" "))}footer.append($button);$button.unbind("click.gliffy-dialog");if(button.callback&&button.callback!==undefined){$button.bind("click.gliffy-dialog",function(e){if(button.dismiss){self.hide()}button.callback($button[0]);e.preventDefault()})}else{if(button.dismiss){$button.bind("click.gliffy-dialog",function(e){self.hide();e.preventDefault()})}}},hideDialog:function(){$("#alertDialog").modal("hide")},showGenericDialog:function(o){var i,buttonTemplate={text:$.i18n._("DIALOG_OK"),callback:null,primary:true,dismiss:true,add_classes:[]},$footer,options,self=this;options=$.extend({content:"",title:"",cancelCallback:null,buttons:[],escapeHTML:true,skipNodeDeselect:false,backdropStatic:false},o);if(options.backdropStatic){$("#alertDialog").attr("data-backdrop","static")}$("#alertDialog").data("skipNodeDeselect",options.skipNodeDeselect);$("#alertDialog").modal("show");$("#alertDialog .modal-header h4").html(options.escapeHTML?Mustache.escape(options.title):options.title);$("#alertDialog .modal-body").html(options.escapeHTML?Mustache.escape(options.content):options.content);$footer=$("#alertDialog .modal-footer");$footer.html("");if(!$.isArray(options.buttons)){options.buttons=[buttonTemplate]}for(i=0;i<options.buttons.length;i++){this.__bindButtonActions(options.buttons[i],$footer)}if(options.cancelCallback){$("#alertDialog .modal-header a").bind("click",options.cancelCallback)}},showAlertDialog:function(o){var options=$.extend({content:$.i18n._("DIALOG_AN_UNKNOWN_ERROR_HAS_OCCURRED"),title:$.i18n._("DIALOG_ALERT"),cancelCallback:null,buttons:[{text:$.i18n._("DIALOG_OK"),callback:null,primary:true,dismiss:true,add_classes:[]}]},o);_gliffy.Dialog.showGenericDialog(options)},showYesNoDialog:function(o){var options=$.extend({content:"",title:"",cancelCallback:null,buttons:[{text:$.i18n._("DIALOG_YES"),callback:null,primary:true,dismiss:true,add_classes:[]},{text:$.i18n._("DIALOG_NO"),callback:null,primary:false,dismiss:true,add_classes:[]}]},o);this.showGenericDialog(options)}}}());(function(){_gliffy.Spinner={__contexts:{},showNodeSpinner:function(node){var opts,target,spinner;opts={lines:7,length:5,width:4,radius:4,corners:1,rotate:46,color:"#000",speed:1.3,trail:34,shadow:false,hwaccel:true,className:"spinner",zIndex:2000000000,top:"auto",left:"auto"};target=$("<div/>",{"class":"gliffy-node-spinner"});target.css({width:50,height:50,marginTop:-10,marginLeft:-10});node.getDomViewbox().append(target);spinner=new Spinner(opts).spin(target.get(0))},hideNodeSpinner:function(node){node.getDomViewbox().find(".gliffy-node-spinner").remove()},show:function(o){var options=$.extend({},{noAnimate:false},{context:"general"},o),$spinnerIcon=$(".gliffy-spinner-icon"),$spinnerBg=$(".gliffy-spinner-bg"),hadContexts=false;$.each(this.__contexts,function(key,val){hadContexts=true});if(!hadContexts){this.__contexts[o.context]=true;$spinnerIcon.stop();$spinnerBg.stop();$spinnerIcon.show();$spinnerBg.show();$spinnerIcon.css("opacity",1);$spinnerBg.css("opacity",0.5)}},hide:function(o){var options=$.extend({},{context:"general",force:false},o),$spinnerIcon=$(".gliffy-spinner-icon"),$spinnerBg=$(".gliffy-spinner-bg"),contextsRemain=false;delete this.__contexts[o.context];if(o.force){this.__contexts={}}$.each(this.__contexts,function(key,val){contextsRemain=true});if(!contextsRemain){$spinnerIcon.stop();$spinnerBg.stop();if(parseFloat($spinnerIcon.css("opacity"))>0.1){$spinnerIcon.animate({opacity:0},100,function(){$spinnerIcon.hide()})}else{$spinnerIcon.hide()}if(parseFloat($spinnerBg.css("opacity"))>0.1){$spinnerBg.animate({opacity:0},100,function(){$spinnerBg.hide()})}else{$spinnerBg.hide()}}},forceHide:function(){this.hide({force:true})}}}());(function(){$(function(){$("body").on("click","#gliffy-hide-library",function(){var sidebar=$(".gliffy-sidebar"),centerPane=$("#gliffy-center-pane").parent(),start=parseInt(centerPane.css("marginLeft"),10);$(".gliffy-sidebar").animate({left:-sidebar.width()},{complete:function(){var button=$('<div><a class="btn" id="gliffy-show-library" href="#"><i class="icon-chevron-right"></i></a></div>');button.appendTo("body").css({opacity:0.5}).animate({opacity:1});button.click(function(){sidebar.animate({left:0},{step:function(now,fx){button.css({left:start+now-10,opacity:-now/start});centerPane.css({marginLeft:start+now});$(window).trigger("resize")},complete:function(){button.remove()}});return false})},step:function(now,fx){centerPane.css({marginLeft:start+now});$(window).trigger("resize")}});return false})})}());var public_classes=["shapeLibrary","Viewer","Editor","Utils","IntegrationHandler","Components","setErrorHandler","setI18nHandler","Logger","Class","AffineTransform","BrowserDetect","Dialog","Slider","Renderer","Spinner","FileHandlerRegister","DefaultFileHandler","CopyCommand","CutCommand","PasteCommand","BoundingBox","Node","FileHandlerUtils","FEATURES","Text"],i=0;window.GLIFFY=window.GLIFFY||{};for(i=0;i<public_classes.length;i++){window.GLIFFY[public_classes[i]]=_gliffy[public_classes[i]]}_gliffy.NoDebug={SKIP_CATCH_ERRORS:false,SKIP_RENDER_LOOP:false,DISPLAY_GUIDES:false,NO_CONTEXT_MENU:false,NO_TIPS:false,NO_ERROR_DIALOG:false,FINITE_NUMBER_CHECKS:false,NO_NAVIGATE_WARNING:false,STARTUP_FILE:null,LOG_TO_CONSOLE:false,LOG_ANALYTICS:false,USE_ANALYTICS_DEBUG_JS:false,I18N_UNDERSCORES:false,SHOW_RTREE:false};_gliffy.FullDebug={SKIP_CATCH_ERRORS:true,SKIP_RENDER_LOOP:false,DISPLAY_GUIDES:false,NO_CONTEXT_MENU:false,NO_TIPS:true,NO_ERROR_DIALOG:true,FINITE_NUMBER_CHECKS:true,NO_NAVIGATE_WARNING:true,STARTUP_FILE:null,LOG_TO_CONSOLE:true,LOG_ANALYTICS:true,USE_ANALYTICS_DEBUG_JS:true,I18N_UNDERSCORES:true,SHOW_RTREE:false};_gliffy.Debug=_gliffy.NoDebug;if($.url().param("debug")==="true"){_gliffy.Debug=_gliffy.FullDebug}}());