(function(){(function(){GliffyApp.DocumentListItemModel=Ember.Object.extend({isBeingEdited:Ember.computed(function(){var a=this.get("currentlyEditedBy");return(a!==undefined&&a!==null&&a!=="N/A")}).property("currentlyEditedBy").cacheable(),tooltip:Ember.computed(function(){if(this.isEditable){return this.get("name")+", click to edit"}else{return this.get("name")}}).property("name").cacheable(),isEditable:false,isEditingName:false,isLoaded:false})}());(function(){var a=new GLIFFY.Message();GliffyApp.accountFoldersController=Ember.Object.create({SHARED_FOLDER_ID:"Shared",RECENT_FOLDER_ID:"Recent",STARRED_FOLDER_ID:"Starred",defaultFolders:null,selectedItem:null,selectedCommonFolderId:0,container:null,rootFolderId:0,__dropZones:null,allowDelete:false,init:function(){var b=this;this.__dropZones=[]},showFolderContainer:function(){$(".gliffy-account-folders-loading").hide();this.container.show()},hideFolderContainer:function(){this.container.hide();$(".gliffy-account-folders-loading").show()},updateDropZones:function(){var c=this.__dropZones,d=$(".gliffy-account-folders-container"),b=d.offset().left,e=b+d.width();c.length=0;$(".gliffy-account-folders-container a:visible").each(function(g,h){var h=$(h),j=h.offset(),i=new GLIFFY.BoundingBox(b,j.top,e,j.top+h.height()),k=h.parent().attr("id"),f=GliffyApp.accountFoldersController.getFolderTitleById(k);c.push({element:h,bounds:i,id:k,name:f})})},getFolderInfoAtPosition:function(b,e){var c,d;for(c=0;c<this.__dropZones.length;c++){d=this.__dropZones[c];if(d.bounds.pointInside(b,e)){return d}}return null},load:function(e,c,f){var d=this,b;this.container=c;this.hideFolderContainer();a.send("getFolders",null,function(g){d.rootFolderId=0;if(d.defaultFolders){d.folder_data=$.extend(true,{},d.defaultFolders);d.folder_data.data.push(g);b=g.attr.id;d.rootFolderId=b}else{d.folder_data=data}d.defaultFolders=null;c.jstree({json_data:d.folder_data,plugins:["themes","json_data","ui","sort"],themes:{theme:"gliffy-folder-tree",dots:false,icons:true,url:"/css/gliffy-folder-tree.css"}}).bind("select_node.jstree",function(i,h){d.handleSelectNode(i,h)}).bind("loaded.jstree",function(i,h){f.apply(null,[b]);d.updateDropZones()}).bind("hover_node.jstree",function(i,h){d.showHoverBar(h.rslt.obj.attr("id"))}).bind("dehover_node.jstree",function(i,h){d.hideHoverBar()}).bind("open_node.jstree",function(i,h){d.updateDropZones()}).bind("after_open.jstree",function(i,h){if(!c.is(":visible")){setTimeout(function(){d.showFolderContainer()},500)}})},function(){d.defaultFolders=null;if(!c.is(":visible")){d.showFolderContainer()}})},selectFolder:function(b){this.container.jstree("select_node","#"+b+":first")},openFolder:function(c,b){this.container.jstree("open_node","#"+c+":first",function(){if(b){b()}})},openSelectedFolder:function(){this.openFolder(this.getSelectedFolder().attr("id"))},createFolder:function(h,c){var e=this.checkFolderNameError(h),d=this,b="inside",g=this.container.jstree("get_selected"),f,i=this.getSelectedFolderId();if(e){this.displayFolderNameError(e)}else{if(i<0){this.selectFolder(this.rootFolderId);g=this.container.jstree("get_selected");i=this.rootFolderId}a.send("createFolder",{folderName:h,parentFolderId:i},function(j){f={data:h,attr:{id:j.path}};d.container.jstree("create_node",g,b,f,false,false);d.container.jstree("correct_state",f);c();d.openSelectedFolder();d.updateDropZones();GLIFFY.Utils.analyticsEvent("trackEvent",{category:"accountFolders",action:"addFolder",value:window.location.pathname})},function(l,j,k){d.displayFolderNameError(l.responseText);console.error("I borked",k)})}},displayFolderNameError:function(b){$("#gliffy-folder-create-modal .gliffy-input-modal-error").show();$("#gliffy-folder-create-modal .gliffy-input-modal-error p").html(b)},checkFolderNameError:function(c){var b=null,f="abcdefghijklmnopqrstuvwxyz0123456789@.-_ ",d,e;if(c.split(" ").join("")===""){b="Folder name is blank"}else{for(d=0;d<c.length;d++){e=c.charAt(d).toLowerCase();if(f.indexOf(e)!=-1){continue}b="Alpha-numeric characters only";break}}return b},handleSelectNode:function(d,c){var g=c.rslt.obj.attr("id"),f=$("#"+g+" .jstree-clicked").text(),b=c.rslt.obj.attr("showOnlyPublic");this.container.trigger("folderClicked",{id:g,title:f,showOnlyPublic:b});this.selectedItem=c.rslt.obj;this.deselectAllCommonFolders();this.showSelectionBar();this.toggleDeleteButton(c)},showSelectionBar:function(){this.container.parent().find(".gliffy-folder-selection-bar").show();this.positionSelectionBar()},toggleDeleteButton:function(c){var b=$(".jstree-clicked").width();if(this.allowDelete&&b>0&&c.rslt.obj.parents("li").length>0){$(".gliffy-folder-settings-button").show()}else{$(".gliffy-folder-settings-button").hide()}},hideSelectionBar:function(){$(".gliffy-folder-selection-bar").hide();$(".gliffy-folder-settings-button").hide()},showHoverBar:function(c){var b=this.container.parent().find(".gliffy-folder-hover-bar");b.show();b.css("top",this.container.find("#"+c+" a:first").offset().top-this.container.offset().top+this.container.position().top);b.css("left",3);b.width(this.container.width()-3)},hideHoverBar:function(){$(".gliffy-folder-hover-bar").hide()},positionSelectionBar:function(){var b=this.container.parent().find(".gliffy-folder-selection-bar");if(b.is(":visible")){b.width(this.container.width()-3);if(this.container.find(".jstree-clicked").offset()){b.css("top",this.container.find(".jstree-clicked").offset().top-this.container.offset().top+this.container.position().top);b.css("left",3);this.positionDeleteButton()}}},positionDeleteButton:function(){var b=this.container.parent().find(".gliffy-folder-selection-bar");$(".gliffy-folder-settings-button").css("top",b.offset().top+3);$(".gliffy-folder-settings-button").css("left",b.offset().left+b.width()-20)},handleDelete:function(){var b=this;GLIFFY.Dialog.showYesNoDialog({title:"Delete Folder",content:"Are you sure you want to delete folder "+this.getSelectedFolderTitle()+"?",cancelCallback:null,buttons:[{text:"Cancel",callback:null,primary:false,dismiss:true},{text:"Delete",callback:function(c){b.deleteSelectedFolder()},primary:true,dismiss:true}]})},deleteSelectedFolder:function(){var b=this;a.send("deleteFolder",b.selectedItem.attr("id"),function(c){if(c.success==="false"){b.displayFolderDeleteError(c.error)}else{b.hideSelectionBar();b.container.jstree("delete_node",b.selectedItem);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"accountFolders",action:"deleteFolder",value:window.location.pathname})}b.updateDropZones()},function(e,c,d){b.displayFolderDeleteError(d);console.error("I borked")})},displayFolderDeleteError:function(b){GLIFFY.Dialog.showAlertDialog({title:"Error",content:b,buttons:[{text:"OK",primary:true,dismiss:true}]})},isNestedFolder:function(b){if(this.selectedItem!==null){if(this.container.jstree("get-parent",b)){return true}}return false},renameNode:function(c,b){this.container.jstree("rename_node",c,b)},getSelectedFolder:function(){return this.selectedItem},getSelectedFolderId:function(){if(this.selectedItem!==null){return this.selectedItem.attr("id")}return -1},getFolderTitleById:function(c){var b=$("#"+c+" > a").text();return b.substring(1)},getSelectedFolderTitle:function(){var b;if(this.selectedItem!==null){b=$("#"+this.selectedItem.attr("id")+" .jstree-clicked").text();return b.substring(1)}return null},handleCommonFolderClick:function(c,b){this.hideSelectionBar();this.deselectAllCommonFolders();$(c.currentTarget).addClass("gliffy-selected");if(this.selectedItem!==null){this.container.jstree("deselect_node",this.selectedItem);this.selectedItem=null}this.selectedCommonFolderId=b;this.container.trigger("folderClicked",{id:b})},deselectAllCommonFolders:function(){$(".gliffy-common-folders-container div.gliffy-common-folder").removeClass("gliffy-selected")},isSharedFolderSelected:function(){return(this.selectedItem===null&&this.selectedCommonFolderId===this.SHARED_FOLDER_ID)},toggleSettingsDropdown:function(){this.container.find(".gliffy-folder-settings-button .dropdown-toggle").click()},folder_data:null})}());(function(){var a=new GLIFFY.Message();GliffyApp.AbstractFileDialogController=Ember.Object.extend({DEFAULT_FOLDERS:null,containerSelector:null,INITIAL_IMAGE_LOAD_LIMIT:5,__sortKeys:["lastEdited","alphabetical","reverseAlphabetical","createDate"],createNewTab:true,init:function(b){this._super();this.DEFAULT_FOLDERS={data:[]};this.containerSelector=b},configDocumentList:function(){GliffyApp.documentListController.clear();GliffyApp.documentListController.setContainer($(this.containerSelector+" .gliffy-document-list-container"));GliffyApp.documentListController.setListLayout(true)},configDocumentSearch:function(){GliffyApp.documentSearchController.clear()},configDocumentSort:function(){GliffyApp.documentSortController.populateDropdown(this.__sortKeys)},configAccountFolders:function(){GliffyApp.accountFoldersController.defaultFolders=this.DEFAULT_FOLDERS;var b=this;GliffyApp.accountFoldersController.load("folder_tree.json",$(this.containerSelector+" .gliffy-account-folders-container"),function(c){GliffyApp.accountFoldersController.showFolderContainer();$(b.containerSelector+" .gliffy-common-folder.recent").click()})},open:function(f){var c=this,d,b=null,e;if(f!==null){a.send("open",f.urls.open,function(g){if(g!==null){if(editor.getDocumentManager().getActiveDocument().isNewNotDirty()){editor.open({url:g,scale:1,callback:function(){GliffyApp.documentModel.update(editor.getDocumentManager().getActiveDocument())}})}else{a.send("newWindow",g)}this.hide()}},function(g,h){GLIFFY.Dialog.showAlertDialog({content:h,title:"Oops!"})})}},sortDocumentList:function(c,b){GliffyApp.documentListController.doSort(b,c)},search:function(b){GliffyApp.documentListController.doSearch(b)},handleDoubleClickItem:function(){GliffyApp.documentListController.handleDoubleClickItem()},handleDocumentListScroll:function(b){GliffyApp.documentListController.scroll(b)},handleDocumentListScrollStart:function(b){GliffyApp.documentListController.scrollStart(b)},handleDocumentListScrollEnd:function(b){GliffyApp.documentListController.scrollEnd(b)},handleFolderClick:function(b){if(b.id===GliffyApp.accountFoldersController.RECENT_FOLDER_ID){GliffyApp.documentListController.load("recent_diagrams.json",".recent",this.INITIAL_IMAGE_LOAD_LIMIT)}else{GliffyApp.documentListController.load("folder_diagrams.json",b.id,this.INITIAL_IMAGE_LOAD_LIMIT)}}})}());(function(){var a=new GLIFFY.Message();GliffyApp.documentListController=Ember.Object.create({isEditableItems:false,isListLayout:false,documentList:null,masterDocumentList:null,sortOrder:null,sortProperty:null,filterValue:null,filterProperty:null,itemHeight:125,container:null,__itemIsBeingSelected:false,__initialLoadLimit:5,__scrollTimeout:null,__tempTime:null,__scrolling:null,__documentsCount:0,__documentsLoaded:0,__lazyRenderTimeout:null,selectedItem:null,init:function(){var b=this;this.documentList=Ember.A([]);this.reset()},setContainer:function(b){this.container=b},setListLayout:function(c){this.set("isListLayout",c)},clear:function(){this.documentList.clear();this.__documentsLoaded=0;this.__documentsCount=0;this.filterValue="";if(this.__lazyRenderTimeout!==null){clearTimeout(this.__lazyRenderTimeout);this.__lazyRenderTimeout=null}},reset:function(){this.sortOrder="desc";this.sortProperty="lastModified";this.filterValue="";this.filterProperty="name";this.__initialLoadLimit=5;this.__itemIsBeingSelected=false},load:function(e,b,d){var c=this;this.clear();this.clearSelectedItem();this.hideDocumentItemError();this.__itemIsBeingSelected=false;if(d){this.__initialLoadLimit=d}this.showSpinner();if(this.isDemo){this.__buildMasterDocumentList(this.documentListJSONStub.diagrams);this.render()}else{a.send("getDocuments",b,function(f){c.__buildMasterDocumentList(f);c.render()},function(h,f,g){console.error("error loading document list",h,f,g);c.hideSpinner()})}},showSpinner:function(){$(".gliffy-document-list .gliffy-inner-spinner-icon").show()},hideSpinner:function(){$(".gliffy-document-list .gliffy-inner-spinner-icon").hide()},setFilterValue:function(b){if(this.get("filterValue")!==b){this.set("filterValue",b);this.render()}},getSortedData:function(d){var c,b=this;if(this.get("sortOrder")=="asc"){c=d.sort(function(f,e){if(typeof f[b.sortProperty]=="number"){return f[b.sortProperty]-e[b.sortProperty]}else{return((f[b.sortProperty].toLowerCase()<e[b.sortProperty].toLowerCase())?-1:((f[b.sortProperty].toLowerCase()>e[b.sortProperty].toLowerCase())?1:0))}})}else{c=d.sort(function(f,e){if(typeof f[b.sortProperty]=="number"){return e[b.sortProperty]-f[b.sortProperty]}else{return((e[b.sortProperty].toLowerCase()<f[b.sortProperty].toLowerCase())?-1:((e[b.sortProperty].toLowerCase()>f[b.sortProperty].toLowerCase())?1:0))}})}return c},render:function(){var b=this;var e=Ember.A([]);var f=this.getFilteredData(this.getSortedData(this.masterDocumentList));var d=50;this.__documentsCount=f.length;if(d>this.__documentsCount){d=this.__documentsCount}if(this.__documentsCount===0){this.hideSpinner()}for(var c=0;c<d;c++){if(c>=0&&c<=this.__initialLoadLimit){if(!f[c].get("isLoaded")){f[c].set("isLoaded",true)}}this.__documentsLoaded++;e.pushObject(f[c])}this.set("documentList",e);if(this.__documentsLoaded<this.__documentsCount){this.__lazyRenderTimeout=setTimeout(function(){b.__renderRemaining(f,d)},250)}if(this.get("documentList").length===0){$(".gliffy-document-list-no-documents-message").show()}else{$(".gliffy-document-list-no-documents-message").hide()}this.container.parent().scrollTop(0);setTimeout(function(){b.hideSpinner();b.loadVisibleDocuments()},50)},__renderRemaining:function(g,f){var c=this;var b=this.__documentsCount-this.__documentsLoaded;var d=this.__documentsLoaded;if(f>b){f=b}for(var e=d;e<(d+f);e++){this.__documentsLoaded++;this.documentList.pushObject(g[e])}if(this.__documentsLoaded<this.__documentsCount){this.__lazyRenderTimeout=setTimeout(function(){c.__renderRemaining(g,f)},250)}},doSort:function(b,c){var d=this.filterValue;this.showSpinner();this.clear();this.set("filterValue",d);this.set("sortOrder",b);this.set("sortProperty",c);this.render();GLIFFY.Utils.analyticsEvent("trackEvent",{category:"documentList",action:"sort",value:c+"/"+b})},doSearch:function(b){this.showSpinner();this.clear();this.set("filterValue",b);this.render();GLIFFY.Utils.analyticsEvent("trackEvent",{category:"documentList",action:"search"})},__buildMasterDocumentList:function(e){var c,d,b;this.masterDocumentList=[];for(c=0;c<e.length;c++){d=e[c];b=GliffyApp.DocumentListItemModel.create();if(c>=0&&c<=5){b.set("isLoaded",true)}b.setProperties(d);b.set("isEditable",this.isEditableItems);this.masterDocumentList[this.masterDocumentList.length]=b}},getFilteredData:function(d){var b=this,c;c=d.filter(function(e){if(e[b.filterProperty].length>=b.get("filterValue").length&&e[b.filterProperty].toLowerCase().search(b.get("filterValue").toLowerCase())>-1){return true}else{return false}});return c},handleSelectItem:function(c,b){if(this.selectedItem!==null&&b.id!==this.selectedItem.id){this.clearSelectedItem();this.hideDocumentItemError()}if(this.isListLayout){$(".gliffy-document-list tr").removeClass("gliffy-selected")}else{$(".gliffy-document-list .gliffy-grid-item").removeClass("gliffy-selected")}$(c.currentTarget).addClass("gliffy-selected");this.selectedItem=b;if(this.isEditableItems){$(".gliffy-document-list-item-delete").hide();$(c.currentTarget).find(".gliffy-document-list-item-delete").show();$(".gliffy-document-list-item-share").hide();$(c.currentTarget).find(".gliffy-document-list-item-share").show()}},handleDoubleClickItem:function(){if(this.selectedItem!==null){this.container.trigger("documentListItemOpen",this.selectedItem)}},handleDocumentNameClick:function(f,d){var b=this,c;this.handleSelectItem(f,d);if(this.isEditableItems){$(f.currentTarget).removeAttr("data-original-title").tooltip("hide");this.selectedItem.set("isEditingName",true);c=setTimeout(function(){b.container.find(".gliffy-selected input").focus().select();b.hideRenameSpinner(b.getSelectedItemDOM())},5)}},handleRenameDocument:function(c){var b=this;this.hideDocumentItemError();var d=this.getSelectedItemDOM();var e=this.selectedItem;if(this.validateDocumentName(c,function(f){b.displayDocumentItemError(f)})){this.showRenameSpinner(d);this.renameDocument(e,c,function(f){if(f.error){b.displayDocumentItemError(f.error)}else{e.set("name",c);b.hideRenameInput(e)}b.hideRenameSpinner(d)},function(f){b.displayDocumentItemError(f);b.hideRenameSpinner(d)})}},renameDocument:function(c,f,b,e){var d=this;a.send("renameDocument",{id:c.id,newName:f},function(g){b(g);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"document",action:"rename",value:window.location.pathname})},function(){})},showRenameSpinner:function(b){b.find("input").hide();b.find(".gliffy-document-rename-saving").show()},hideRenameSpinner:function(b){b.find(".gliffy-document-rename-saving").hide();b.find("input").show()},validateDocumentName:function(c,b){if(c.replace(" ","")===""){b("Document name cannot be blank.");return false}else{if(c.indexOf('"')>-1||c.indexOf("\\")>-1||c.indexOf("/")>-1||c.indexOf("<")>-1){b('Document name cannot contain the characters "/ or <.');return false}}return true},displayDocumentItemError:function(b){var c=this.getErrorAlertDOM();c.css("top",this.getSelectedItemDOM().position().top+50);c.css("left",this.getSelectedItemDOM().position().left+250);c.show();c.find("strong").html("Error!");c.find("span").html(b)},hideDocumentItemError:function(){this.getErrorAlertDOM().hide()},getSelectedItemDOM:function(){return this.container.find(".gliffy-selected")},getErrorAlertDOM:function(){return GliffyApp.documentListController.container.parent().find(".alert-floating")},clearSelectedItem:function(){if(this.selectedItem!==null){if(this.selectedItem.isEditingName){this.hideRenameInput(this.selectedItem)}this.selectedItem=null}},hideRenameInput:function(c){this.selectedItem.set("isEditingName",false);var b=setTimeout(function(){$(".gliffy-document-list-item-tooltip").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD)},5)},handleDocumentDelete:function(c){var b=this;if(this.selectedItem!==null){this.doDocumentDelete(this.selectedItem,function(){b.__removeSelectedDocumentItem();GLIFFY.Utils.analyticsEvent("trackEvent",{category:"documentManager",action:"deleteDiagram",value:window.location.pathname})},function(d){b.displayDocumentItemError(d)})}},doDocumentDelete:function(d,b,c,h){var i=this,e,j,f,g;if(GliffyApp.accountFoldersController.isSharedFolderSelected()){e="Remove Diagram";j="Are you sure you want to remove diagram "+d.name+" from your Shared folder?";f="Remove";g=function(k){GliffyApp.collaborationController.removeCollaborator({id:GliffyApp.authController.get("user").get("uid")},d.id,function(){b()},function(n,l,m){c(m)})}}else{e="Delete Diagram";j="Are you sure you want to delete diagram "+d.name+"?";f="Delete";g=function(k){i.deleteDocument(d.id,b,c)}}GLIFFY.Dialog.showYesNoDialog({title:e,content:j,cancelCallback:h,buttons:[{text:"Cancel",callback:h,primary:false,dismiss:true},{text:f,callback:g,primary:true,dismiss:true}]})},deleteDocument:function(e,b,d){var c=this;a.send("deleteDocument",e,function(f){GliffyApp.authController.account.set("diagrams",GliffyApp.authController.account.get("diagrams")-1);GliffyApp.authController.account.fetch(function(){b()},function(){console.error("Unable to update account settings after diagram delete");b()})},function(h,f,g){d(g);console.error("Error deleting document",g)})},__removeSelectedDocumentItem:function(){this.container.find('td[data-gliffy-document-id="'+this.selectedItem.id+'"]').parent().hide();this.clearSelectedItem()},handleDocumentCollaborate:function(b){if(this.selectedItem!==null){GliffyApp.collaborationController.show(this.selectedItem.id,this.selectedItem.name);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"documentManager",action:"collaborateClick",value:window.location.pathname})}},handleDocumentPublish:function(c){var b=this;if(this.selectedItem!==null){GliffyApp.documentModel.populate(this.selectedItem);GliffyApp.publishController.show(function(){b.selectedItem.set("isPublic",GliffyApp.documentModel.get("isPublic"))});GLIFFY.Utils.analyticsEvent("trackEvent",{category:"documentManager",action:"publishClick",value:window.location.pathname})}},handleSelectFavorite:function(c,b){if($(c.target).hasClass("gliffy-icon-star-off")){this.callFavoriteAPI(b,true,function(){$(c.target).removeClass("gliffy-icon-star-off");$(c.target).addClass("gliffy-icon-star");$(c.target).attr("data-original-title","click to un-star")})}else{this.callFavoriteAPI(b,false,function(){$(c.target).removeClass("gliffy-icon-star");$(c.target).addClass("gliffy-icon-star-off");$(c.target).attr("data-original-title","click to star")})}},callFavoriteAPI:function(c,d,b){window.GLIFFY.API.PUT("diagram_favorite.json",{value:d},{query:{diagramId:c.id},success:function(f,g,e){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"document",action:"star",value:window.location.pathname});b()},error:function(g,e,f){this.displayDocumentItemError(f);console.error("error setting favorite",g,e,f)},context:this})},isScrolledIntoView:function(d){var f=0;var e=f+this.container.parent().height();var b=$(d).offset().top-this.container.parent().offset().top;var c=b+$(d).height();return(c>=f&&c<=e)||(b>=f&&b<=e)},scroll:function(d){var b=this;var c=(new Date()).getTime();if(c-b.__tempTime>200&&!b.__scrolling){b.container.trigger("scrollStart");b.__tempTime=c}clearTimeout(b.__scrollTimeout);b.__scrollTimeout=setTimeout(function(){if(b.__scrolling){b.container.trigger("scrollEnd")}},200)},scrollStart:function(b){this.__scrolling=true},scrollEnd:function(b){this.__scrolling=false;this.loadVisibleDocuments()},loadVisibleDocuments:function(){var d,b;for(var c=0;c<this.documentList.length;c++){if(this.isListLayout){d=this.container.find("tr").get(c)}else{d=this.container.find(".gliffy-grid-item").get(c)}b=this.documentList.get(c);if(!b.get("isLoaded")){if(d!==null&&$(d).offset()!==null&&this.isScrolledIntoView(d)){if(!b.get("isLoaded")){b.set("isLoaded",true)}}}}},documentListJSONStub:{diagrams:[{name:"My Cool Diagram",isFavorite:true,lastModified:1350950400,lastModifiedFriendly:"October 23, 2012",createDate:1212969600,createDateFriendly:"June 09, 2008",isPublic:false,createdBy:"Jack Muir",lastModifiedBy:"Han Lee",currentlyEditedBy:"Han Lee",urls:{thumbnail:"/go/view/90209.png?size=thumbnail&ts=-408129242",open:"/go/api/diagram.json?diagramId=90000",update:"/go/api/diagram.json?diagramId=90000"},"read-only":false},{name:"Aardvark Migration",isFavorite:true,lastModified:1352678400,lastModifiedFriendly:"November 12, 2012",createDate:1342828800,createDateFriendly:"July 21, 2012",isPublic:true,createdBy:"Clint Dickson",lastModifiedBy:"Kerry Liu",urls:{thumbnail:"/go/view/90172.png?size=thumbnail&ts=-408129242",open:"/go/api/diagram.json?diagramId=90001",update:"/go/api/diagram.json?diagramId=90000"},"read-only":false},{name:"BPMN",isFavorite:false,lastModified:1338854400,lastModifiedFriendly:"June 05, 2012",createDate:1334188800,createDateFriendly:"April 12, 2012",isPublic:false,createdBy:"Todd",lastModifiedBy:"Rocco",urls:{thumbnail:"/go/view/90000.png?size=thumbnail&ts=-408129242",open:"/go/api/diagram.json?diagramId=90001",update:"/go/api/diagram.json?diagramId=90000"},"read-only":false},{name:"Floorplan of a really nice house on Mars that has big chickens in the garage and a small car in the yard",isFavorite:false,lastModified:1233792000,lastModifiedFriendly:"February 05, 2009",createDate:1231718400,createDateFriendly:"January 12, 2009",isPublic:true,createdBy:"Todd",lastModifiedBy:"Eric Chiang",urls:{thumbnail:"/go/view/90004.png?size=thumbnail&ts=-408129242",open:"/go/api/diagram.json?diagramId=90001",update:"/go/api/diagram.json?diagramId=90000"},"read-only":false},{name:"BPMN 2",isFavorite:false,lastModified:1272326400,lastModifiedFriendly:"April 27, 2010",createDate:1193788800,createDateFriendly:"October 31, 2007",isPublic:false,createdBy:"Ron",lastModifiedBy:"Carole",urls:{thumbnail:"/go/view/90001.png?size=thumbnail&ts=-408129242",open:"/go/api/diagram.json?diagramId=90001",update:"/go/api/diagram.json?diagramId=90000"},"read-only":false}]}})}());(function(){GliffyApp.documentManagerController=GliffyApp.AbstractFileDialogController.create({init:function(){this._super(".gliffy-document-manager")},config:function(){GliffyApp.set("documentModel",GliffyApp.DocumentModel.create());this.createNewTab=true;GliffyApp.documentListController.isEditableItems=true;this.configDocumentList();this.configDocumentSearch();this.configDocumentSort();this.configAccountFolders();GliffyApp.accountFoldersController.allowDelete=true;this.configBindings();var a=this;GliffyApp.fileUploadController.createFileUploaderButton($(".gliffy-document-manager .gliffy-document-real-import-button"),this.__getImportOptions()).bind("giffy_fileUploadSuccess",function(c,b){GliffyApp.progressBarController.hide();a.importDocument(window.GLIFFY.ENV.importDiagramUrl);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"documentManager",action:"import",value:b.filename.substring(b.filename.lastIndexOf(".")+1)})}).bind("gliffy_fileUploadError",function(c,b){GliffyApp.progressBarController.hide();GLIFFY.Dialog.showAlertDialog({title:"Error",content:"An error occurred when trying to import your file. "+b.reason+".  Contact support if the problem persists.",buttons:[{text:"OK",primary:true,dismiss:true}]})}).bind("gliffy_fileUploadProgress",function(c,b){GliffyApp.progressBarController.updateProgress(b.currentSize,b.totalSize)}).bind("gliffy_fileUploadStart",function(c,b){GliffyApp.progressBarController.show("Importing "+b)});GliffyApp.authController.addLoginCallback(function(){GliffyApp.fileUploadController.updateOptions($(".gliffy-document-manager .gliffy-document-real-import-button"),a.__getImportOptions())});GliffyApp.accountManageController.loadReasons();GliffyApp.accountManageController.accountLoad()},importDocument:function(a){GLIFFY.Dialog.showYesNoDialog({title:"Import file",content:"Your file has finished importing.",cancelCallback:null,buttons:[{text:"Open",callback:function(b){window.open(a)},primary:true,dismiss:true},{text:"Cancel",callback:null,primary:false,dismiss:true}]})},__getImportOptions:function(){return{url:window.GLIFFY.API.getActionUrl("upload_file.json"),allowExtensions:[GliffyApp.fileUploadController.FILE_EXTENSION_GON,GliffyApp.fileUploadController.FILE_EXTENSION_GXML,GliffyApp.fileUploadController.FILE_EXTENSION_VDX],buttonText:"Import"}},configBindings:function(){$(".gliffy-document-manager .gliffy-document-list").bind("documentListItemOpen",function(b,a){GliffyApp.documentManagerController.open(a);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"documentManager",action:"documentOpen"})});$(".gliffy-document-manager .gliffy-document-list").scroll(function(a){GliffyApp.documentManagerController.handleDocumentListScroll(a)});$(".gliffy-document-manager .gliffy-document-list").bind("scrollStart",function(a){GliffyApp.documentManagerController.handleDocumentListScrollStart(a)});$(".gliffy-document-manager .gliffy-document-list").bind("scrollEnd",function(a){GliffyApp.documentManagerController.handleDocumentListScrollEnd(a)});$(".gliffy-document-manager .gliffy-document-sort-dropdown").delegate("a","click",function(a){a.preventDefault();GliffyApp.documentManagerController.sortDocumentList($(a.currentTarget).data("gliffy-sort-key"),$(a.currentTarget).data("gliffy-sort-order"))});$(".gliffy-document-manager .gliffy-document-search a").on("click",function(a){GliffyApp.documentManagerController.search($(".gliffy-document-manager .gliffy-document-search input").attr("value"))});$(".gliffy-document-manager .gliffy-document-search input").on("keyup",function(a){if(a.keyCode===13){GliffyApp.documentManagerController.search($(".gliffy-document-manager .gliffy-document-search input").attr("value"))}});$(".gliffy-document-manager .gliffy-account-folders-container").bind("folderClicked",function(b,a){GliffyApp.documentManagerController.handleFolderClick(a)});$(window).resize(function(a){GliffyApp.accountFoldersController.positionSelectionBar()});$(".gliffy-document-manager .gliffy-account-folders").scroll(function(a){GliffyApp.accountFoldersController.positionSelectionBar()});$(".gliffy-document-manager .gliffy-common-folder span").hover(function(){GliffyApp.accountFoldersController.hideHoverBar();$(this).parent().addClass("gliffy-folder-hovered")},function(){$(this).parent().removeClass("gliffy-folder-hovered")})},handleCreateNewFolder:function(){$("#gliffy-folder-create-modal .gliffy-modal").modal("show");GLIFFY.Utils.analyticsEvent("trackEvent",{category:"documentManager",action:"createNewFolderClick"})},handleNewDiagram:function(a){var b="";if(GliffyApp.accountFoldersController.getSelectedFolderId()>-1){b+="&folderId="+GliffyApp.accountFoldersController.getSelectedFolderId()}else{b+="&folderId="+GliffyApp.accountFoldersController.rootFolderId}window.open(a+b);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"documentManager",action:"createNewDiagramClick"})}})}());(function(){GliffyApp.documentSearchController=Ember.Object.create({searchValue:"",updateSearchValue:function(a){this.set("searchValue",a)},search:function(){},clear:function(){this.set("searchValue","");$(".gliffy-document-search input").val("")}})}());(function(){GliffyApp.documentSortController=Ember.Object.create({SORT_KEY_OBJECTS:{lastEdited:{desc:"Last Edited",sortOrder:"desc",sortProperty:"lastModified"},alphabetical:{desc:"Alphabetical A-Z",sortOrder:"asc",sortProperty:"name"},reverseAlphabetical:{desc:"Alphabetical Z-A",sortOrder:"desc",sortProperty:"name"},createDate:{desc:"Date Created",sortOrder:"asc",sortProperty:"createDate"}},sortKeys:null,init:function(){this.sortKeys=Ember.A([])},populateDropdown:function(c){var a,b;this.sortKeys.clear();for(a=0;a<c.length;a++){b=Ember.Object.create();b.setProperties(this.SORT_KEY_OBJECTS[c[a]]);this.sortKeys.pushObject(b)}}})}());(function(){GliffyApp.fileOpenBrowserController=GliffyApp.AbstractFileDialogController.create({init:function(){this._super(".gliffy-file-open-browser")},show:function(){this.createNewTab=true;$("#gliffy-modal-file-open-browser").modal("show");GliffyApp.documentListController.set("isEditableItems",false);this.configDocumentList();this.configDocumentSearch();this.configDocumentSort();this.configAccountFolders();GliffyApp.accountFoldersController.set("allowDelete",false)},hide:function(){$("#gliffy-modal-file-open-browser").modal("hide")}})}());(function(){GliffyApp.AccountFoldersView=Ember.View.extend({handleDeleteClick:function(a){a.preventDefault();GliffyApp.accountFoldersController.toggleSettingsDropdown();GliffyApp.accountFoldersController.handleDelete()},handleRenameClick:function(a){a.preventDefault();GliffyApp.accountFoldersController.toggleSettingsDropdown()},handlePermissionsClick:function(a){a.preventDefault();GliffyApp.accountFoldersController.toggleSettingsDropdown();GliffyApp.folderPermissionsModalController.show(GliffyApp.accountFoldersController.getSelectedFolderId(),GliffyApp.accountFoldersController.getSelectedFolderTitle());GLIFFY.Utils.analyticsEvent("trackEvent",{category:"accountFolders",action:"folderPermissions",value:window.location.pathname})},handleSettingsClick:function(a){GliffyApp.accountFoldersController.toggleSettingsDropdown()},clickRecent:function(a){GliffyApp.accountFoldersController.handleCommonFolderClick(a,GliffyApp.accountFoldersController.RECENT_FOLDER_ID)},clickStarred:function(a){GliffyApp.accountFoldersController.handleCommonFolderClick(a,GliffyApp.accountFoldersController.STARRED_FOLDER_ID);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"accountFolders",action:"starredFolderClick",value:window.location.pathname})},clickShared:function(a){GliffyApp.accountFoldersController.handleCommonFolderClick(a,GliffyApp.accountFoldersController.SHARED_FOLDER_ID);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"accountFolders",action:"sharedFolderClick",value:window.location.pathname})}})}());(function(){var a=true;GliffyApp.DocumentListItemView=Ember.View.extend({didInsertElement:function(c){var b=this;$(".gliffy-document-list-item-tooltip").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);$(".gliffy-icon-star").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);$(".gliffy-icon-star-off").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);$(".gliffy-document-list-item-delete").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);this.$().bind("dblclick",function(d){GliffyApp.documentListController.handleDoubleClickItem()});this.$().bind("mousedown",function(d){if(GliffyApp.accountFoldersController.getSelectedFolderId()!==-1){b.mousedown(d)}});this.$("img").bind("mousedown",function(d){if(GliffyApp.accountFoldersController.getSelectedFolderId()!==-1){b.mousedown(d)}return false});$(".gliffy-document-list-container .gliffy-document-title").delegate("input","dblclick",function(d){return false})},mousedown:function(c){var b=this;this.proxy=new GLIFFY.DragProxy(5,c.pageX,c.pageY);this.$().bind("mousemove.dragthreshold",function(d){b.startDrag(d)}).bind("mouseup.dragthreshold",function(d){b.endDrag(d)}).bind("mouseout.dragthreshold",function(d){b.endDrag(d)})},startDrag:function(d){var b=this,c;if(this.proxy.aboveThreshold(d.pageX,d.pageY)){this.click(d);$(d.currentTarget).unbind(".dragthreshold");this.proxy.setElement($("<div></div>").addClass("gliffy-document-proxy").html("<span class='dropping'><span class='gliffy-document-rename-spinner'></span></span><span class='dragging'>Move</span> <strong class='source'></strong> to <strong class='target'></strong><span class='no-target'>...</span>").appendTo("#gliffy"));c=this.get("content");this.proxy.getElement().children(".source").html(c.name);this.proxy.getElement().children(".dropping").hide();this.proxy.activate(function(e){b.drag(e)},function(f,e){b.drop(f,e)});this.proxy.move(d.pageX,d.pageY)}},endDrag:function(b){this.proxy=null;$(b.currentTarget).unbind(".dragthreshold")},drag:function(c){var b=GliffyApp.accountFoldersController.getFolderInfoAtPosition(c.pageX,c.pageY);$(".gliffy-dropzone").removeClass("gliffy-dropzone");if(b){$(b.element).addClass("gliffy-dropzone");this.proxy.getElement().children(".target").html(b.name);this.proxy.getElement().children(".no-target").hide()}else{this.proxy.getElement().children(".target").html("");this.proxy.getElement().children(".no-target").show()}return true},drop:function(g,d){var f=GliffyApp.accountFoldersController.getFolderInfoAtPosition(g.pageX,g.pageY),c=this.proxy,b=this,e;this.proxy=null;if(!f){$(".gliffy-dropzone").removeClass("gliffy-dropzone");d(false)}else{if(f.id===GliffyApp.accountFoldersController.getSelectedFolderId()){$(".gliffy-dropzone").removeClass("gliffy-dropzone");d(true)}else{c.getElement().children(".dropping").show();c.getElement().children(".dragging").hide();e=this.get("content");GLIFFY.API.POST("move_diagram.json",{diagramId:e.id,folderId:f.id},{success:function(h){if(h.error){GliffyApp.documentListController.displayDocumentItemError(h.error);c.getElement().css({backgroundColor:"#ffbbaa"}).children(".dropping").hide();d(false)}else{c.getElement().css({backgroundColor:"#ccffdd"}).children(".dropping").hide();b.$().hide();d(true);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"documentManager",action:"moveDiagram",value:window.location.pathname})}$(".gliffy-dropzone").removeClass("gliffy-dropzone")},error:function(k,i,h){var j;if(i==="timeout"){j="This could not be moved to "+f.name+" because the server could not be reached. Please make sure that you are connected to the internet and try again."}else{if(i==="error"&&k.status===401){j="You do not have permissions to move this to "+f.name+"."}else{if(i==="error"&&k.status===404){j="The document or folder does not exist anymore."}else{j="This could not be moved to "+f.name+" because of an unknown error. Please contact support if this continues to happen."}}}GliffyApp.documentListController.displayDocumentItemError(j);$(".gliffy-dropzone").removeClass("gliffy-dropzone");c.getElement().css({backgroundColor:"#ffbbaa"}).children(".dropping").hide();d(false)}})}}},click:function(b){b.preventDefault();if(!b.target.className.match(/\bclickable\b/)){GliffyApp.documentListController.handleSelectItem(b,this.get("content"))}},handleDocumentDelete:function(b){b.preventDefault();GliffyApp.documentListController.handleDocumentDelete(b)},handleDocumentCollaborate:function(b){b.preventDefault();GliffyApp.documentListController.handleDocumentCollaborate(b)},handleDocumentPublish:function(b){b.preventDefault();GliffyApp.documentListController.handleDocumentPublish(b)},favorite:function(b){b.preventDefault();GliffyApp.documentListController.handleSelectFavorite(b,this.get("content"))},handleDocumentNameClick:function(b){b.preventDefault();GliffyApp.documentListController.handleDocumentNameClick(b,this.get("content"))},handleInputKeyDown:function(b){if(b.keyCode===13){GliffyApp.documentListController.handleRenameDocument(b.currentTarget.value)}else{if(b.keyCode===27){GliffyApp.documentListController.hideRenameInput()}}}})}());(function(){GliffyApp.DocumentListView=Ember.View.extend({didInsertElement:function(){},closeAlert:function(a){a.preventDefault();$(".gliffy-document-list-alert").hide()}})}());(function(){GliffyApp.DocumentManagerCreateButtonView=Ember.View.extend({handleCreateButtonClick:function(b){var a=GliffyApp.accountFoldersController.getSelectedFolderTitle();if(a===null){a="Account Diagrams"}$(b.currentTarget).parent().find(".gliffy-menu-item-new-diagram").html("New Diagram in folder "+a)},handleNewFolder:function(a){a.preventDefault();$(".gliffy-document-create-button .gliffy-btn-primary").click();GliffyApp.documentManagerController.handleCreateNewFolder()},handleNewDiagramBasedOnTemplate:function(a){a.preventDefault();if(GliffyApp.authController.hasPermission("diagrams")){GliffyApp.documentManagerController.handleNewDiagram(window.GLIFFY.ENV.newDiagramFromTemplateUrl);$(".gliffy-document-create-button .gliffy-btn-primary").click()}else{GliffyApp.authController.showUpgradeDialog("diagrams")}},handleNewDiagram:function(a){a.preventDefault();if(GliffyApp.authController.hasPermission("diagrams")){GliffyApp.documentManagerController.handleNewDiagram(window.GLIFFY.ENV.newDiagramUrl);$(".gliffy-document-create-button .gliffy-btn-primary").click()}else{GliffyApp.authController.showUpgradeDialog("diagrams")}}})}());(function(){GliffyApp.DocumentSearchView=Ember.View.extend({search:function(a){a.preventDefault()}});GliffyApp.DocumentSearchTextField=Ember.TextField.extend({keyDown:function(a){if(a.keyCode===13){a.preventDefault();GliffyApp.documentSearchController.updateSearchValue(this.value)}},keyUp:function(a){GliffyApp.documentSearchController.updateSearchValue(a.currentTarget.value)}})}());(function(){GliffyApp.DocumentSortView=Ember.View.extend({selectItem:function(a){$(".gliffy-document-sort-dropdown .dropdown-toggle").click();$(".gliffy-document-sort-dropdown-button").html(a.context.desc)}})}());(function(){GliffyApp.FileOpenBrowserView=Ember.View.extend({didInsertElement:function(){$(".gliffy-file-open-browser .gliffy-document-list").bind("documentListItemOpen",function(b,a){GliffyApp.fileOpenBrowserController.open(a)});$(".gliffy-file-open-browser .gliffy-document-list").scroll(function(a){GliffyApp.fileOpenBrowserController.handleDocumentListScroll(a)});$(".gliffy-file-open-browser .gliffy-document-list").bind("scrollStart",function(a){GliffyApp.fileOpenBrowserController.handleDocumentListScrollStart(a)});$(".gliffy-file-open-browser .gliffy-document-list").bind("scrollEnd",function(a){GliffyApp.fileOpenBrowserController.handleDocumentListScrollEnd(a)});$(".gliffy-file-open-browser .gliffy-document-sort-dropdown").delegate("a","click",function(a){a.preventDefault();GliffyApp.fileOpenBrowserController.sortDocumentList($(a.currentTarget).data("gliffy-sort-key"),$(a.currentTarget).data("gliffy-sort-order"))});$(".gliffy-file-open-browser .gliffy-document-search a").on("click",function(a){GliffyApp.fileOpenBrowserController.search($(".gliffy-file-open-browser .gliffy-document-search input").attr("value"))});$(".gliffy-file-open-browser .gliffy-document-search input").on("keyup",function(a){if(a.keyCode===13){GliffyApp.fileOpenBrowserController.search($(".gliffy-file-open-browser .gliffy-document-search input").attr("value"))}});$(".gliffy-file-open-browser .gliffy-account-folders-container").bind("folderClicked",function(b,a){GliffyApp.fileOpenBrowserController.handleFolderClick(a)});$("#gliffy-modal-file-open-browser .close").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);$(".gliffy-file-open-browser .gliffy-account-folders").scroll(function(a){GliffyApp.accountFoldersController.positionSelectionBar()});$(".gliffy-file-open-browser .gliffy-common-folder span").hover(function(){GliffyApp.accountFoldersController.hideHoverBar();$(this).parent().addClass("gliffy-folder-hovered")},function(){$(this).parent().removeClass("gliffy-folder-hovered")})},open:function(a){a.preventDefault();GliffyApp.fileOpenBrowserController.handleDoubleClickItem()}})}());(function(){GliffyApp.FolderCreateModalView=GliffyApp.AbstractInputModalView.extend({handleSubmit:function(a){this._super(a);GliffyApp.accountFoldersController.createFolder($("#gliffy-folder-create-modal input").val(),function(){$("#gliffy-folder-create-modal .gliffy-modal").modal("hide")})}})}())}());